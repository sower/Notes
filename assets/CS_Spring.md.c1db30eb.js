import{_ as l,c as p,o,a,d as s,b as n}from"./app.c729a732.js";const e="/Notes/assets/1648975394639-fa7ee6c7-1b21-40cf-abc1-095e7034bd7e.dee6c56a.gif",t="/Notes/assets/1647764006879-b912438c-b849-4985-bd53-8179202216c1.9f2cf2de.png",g=JSON.parse('{"title":"Spring","description":"","frontmatter":{"title":"Spring","created_at":"2022-04-03T08:42:16.000Z","updated_at":"2023-02-19T07:22:04.000Z","word_count":17539},"headers":[{"level":2,"title":"—— Spring ——","slug":"——-spring-——","link":"#——-spring-——","children":[]},{"level":2,"title":"Core","slug":"core","link":"#core","children":[{"level":3,"title":"IoC","slug":"ioc","link":"#ioc","children":[]},{"level":3,"title":"AOP","slug":"aop","link":"#aop","children":[]},{"level":3,"title":"SpEL","slug":"spel","link":"#spel","children":[]},{"level":3,"title":"Application Event","slug":"application-event","link":"#application-event","children":[]},{"level":3,"title":"Utils","slug":"utils","link":"#utils","children":[]}]},{"level":2,"title":"Data Access","slug":"data-access","link":"#data-access","children":[{"level":3,"title":"JDBCTemplate","slug":"jdbctemplate","link":"#jdbctemplate","children":[]},{"level":3,"title":"事务（Transaction）","slug":"事务-transaction","link":"#事务-transaction","children":[]}]},{"level":2,"title":"Spring MVC","slug":"spring-mvc","link":"#spring-mvc","children":[{"level":3,"title":"注解","slug":"注解","link":"#注解","children":[]},{"level":3,"title":"拦截器（Interceptor）","slug":"拦截器-interceptor","link":"#拦截器-interceptor","children":[]},{"level":3,"title":"控制器通知 Controller Advice","slug":"控制器通知-controller-advice","link":"#控制器通知-controller-advice","children":[]},{"level":3,"title":"文件上传","slug":"文件上传","link":"#文件上传","children":[]},{"level":3,"title":"文件下载","slug":"文件下载","link":"#文件下载","children":[]}]},{"level":2,"title":"Web Reactive","slug":"web-reactive","link":"#web-reactive","children":[{"level":3,"title":"WebClient","slug":"webclient","link":"#webclient","children":[]}]},{"level":2,"title":"Spring Boot","slug":"spring-boot","link":"#spring-boot","children":[{"level":3,"title":"starter（启动器）","slug":"starter-启动器","link":"#starter-启动器","children":[]},{"level":3,"title":"注解","slug":"注解-1","link":"#注解-1","children":[]},{"level":3,"title":"Common Application Properties","slug":"common-application-properties","link":"#common-application-properties","children":[]},{"level":3,"title":"静态资源配置","slug":"静态资源配置","link":"#静态资源配置","children":[]},{"level":3,"title":"Web 开发","slug":"web-开发","link":"#web-开发","children":[]},{"level":3,"title":"Bean Validation","slug":"bean-validation","link":"#bean-validation","children":[]},{"level":3,"title":"I18n","slug":"i18n","link":"#i18n","children":[]}]},{"level":2,"title":"JPA","slug":"jpa","link":"#jpa","children":[{"level":3,"title":"注解","slug":"注解-2","link":"#注解-2","children":[]},{"level":3,"title":"操作数据","slug":"操作数据","link":"#操作数据","children":[]},{"level":3,"title":"审计 Auditing","slug":"审计-auditing","link":"#审计-auditing","children":[]}]},{"level":2,"title":"Spring Security","slug":"spring-security","link":"#spring-security","children":[]},{"level":2,"title":"Spring Cache","slug":"spring-cache","link":"#spring-cache","children":[]},{"level":2,"title":"—— ORM ——","slug":"——-orm-——","link":"#——-orm-——","children":[{"level":3,"title":"Hibernate","slug":"hibernate","link":"#hibernate","children":[]},{"level":3,"title":"MyBatis","slug":"mybatis","link":"#mybatis","children":[]}]},{"level":2,"title":"Druid","slug":"druid","link":"#druid","children":[]}],"relativePath":"CS/Spring.md"}'),r={name:"CS/Spring.md"},c=a('<h2 id="——-spring-——" tabindex="-1">—— <a href="https://spring.io/" target="_blank" rel="noreferrer">Spring</a> —— <a class="header-anchor" href="#——-spring-——" aria-hidden="true">#</a></h2><p>分层领域模型</p><ul><li>DO（Data Object）：与数据库表结构一一对应，通过DAO层向上传输数据源对象。</li><li>DTO（Data Transfer Object）：数据传输对象，Service或Manager向外传输的对象。</li><li>BO（Business Object）：业务对象， 由Service层输出的封装业务逻辑的对象。</li><li>AO（Application Object）：应用对象， 在Web层与Service层之间抽象的复用对象模型，极为贴近展示层，复用度不高。</li><li>VO（View Object）：视图层对象，通常是Web向模板渲染引擎层传输的对象。</li><li>POJO（Plain Ordinary Java Object）：专指只有setter/getter/toString的简单类，包括DO/DTO/BO/VO等。</li></ul><h2 id="core" tabindex="-1"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#spring-core" target="_blank" rel="noreferrer">Core</a> <a class="header-anchor" href="#core" aria-hidden="true">#</a></h2><p>IoC（Inverse of Control，控制反转）：依赖注入（Dependency Injection，DI）。Spring 通过 IoC 容器来管理所有 Java 对象的实例化和初始化，控制对象与对象之间的依赖关系 <br> AOP（Aspect Oriented Programming，面向切面编程）：横向抽取机制，取代了传统纵向继承体系的重复性代码，其应用主要体现在事务处理、日志管理、权限控制、异常处理等方面。 <br> <img src="'+e+`" alt=""></p><h3 id="ioc" tabindex="-1">IoC <a class="header-anchor" href="#ioc" aria-hidden="true">#</a></h3><ul><li>设值注入（<strong>Setter</strong> Injection）：IoC 容器首先会调用默认的构造方法（无参构造方法）实例化 Bean（Java 对象），然后通过 Java 的反射机制调用这个 Bean 的 setXxx() 方法，将属性值注入到 Bean 中</li><li>构造注入（<strong>Constructor</strong> Injection）：通过 Bean 的带参构造函数，以实现 Bean 的属性注入</li></ul><p><strong>Spring 容器</strong> <br> <strong>BeanFactory 接口</strong> <br> 负责配置、创建、管理 Bean。在初始化容器时，并未实例化 Bean，直到第一次访问某个 Bean 时才实例化目标 Bean</p><p>常用方法</p><ul><li><code>boolean containsBean(String name)</code>：判断 Spring 容器是否包含 id 为 name 的 Bean 实例</li><li><code>T getBean(Class&lt;T&gt; requiredType)</code>：获取 Spring 容器中属于 requiredType 类型的、唯一的 Bean 实例</li><li><code>Object getBean(String name)</code>：返回容器 id 为 name 的 Bean 实例</li><li><code>T getBean(String name, Class requiredType)</code>：返回容器中 id 为 name，并且类型为 requiredType 的 Bean</li><li><code>Class&lt;?&gt; getType(String name)</code>：返回容器中 id 为 name 的 Bean 实例的类型</li></ul><p><strong>ApplicationContext 接口</strong> <br> Spring 上下文，BeanFactory 的子接口。在初始化应用上下文时就实例化所有单实例的 Bean <br> 常用实现类：FileSystemXmlApplicationContext、ClassPathXmlApplicationContext 和 AnnotationConfigApplicationContext</p><p><strong>后置处理器</strong></p><ul><li>BeanPostProcessor Bean 后置处理器 <ul><li>postProcessBeforeInitialization（初始化前执行）</li><li>postProcessAfterInitialization（初始化后执行）</li></ul></li><li>BeanFactoryPostProcessor 容器后置处理器</li></ul><p><strong>XML装配Bean</strong> <br> 配置 applicationContext.xml</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;?</span><span style="color:#E06C75;">xml</span><span style="color:#D19A66;"> version</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;1.0&quot;</span><span style="color:#D19A66;"> encoding</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">beans</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">xmlns</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">xmlns:xsi</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">xsi:schemaLocation</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.springframework.org/schema/beans</span></span>
<span class="line"><span style="color:#98C379;">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;mailService&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.MailService&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!-- 使用设值注入方式装配实例 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">		&lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;userService&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.UserService&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;username&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;root&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;mailService&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">ref</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;mailService&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!-- 使用构造注入装配实例 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;user&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.UserService&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">constructor-arg</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">index</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;0&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;snow&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">constructor-arg</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">index</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;1&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">ref</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;mailService&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">  // 短命名空间注入  需要在头文件中加入约束文件</span></span>
<span class="line"><span style="color:#ABB2BF;">  // p 命名空间</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;userService&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.UserService&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">p:username</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;root&quot;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#D19A66;">p:mailService-ref</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;mailService&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  // c 命名空间</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;user&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.UserService&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">c:username</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;snow&quot;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#D19A66;">c:mailService-ref</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;mailService&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">  // 注入集合</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;javaCollection&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.JavaCollection&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--数组类型--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;users&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">array</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">ref</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">bean</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;userService&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">ref</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">ref</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">bean</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;user&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">ref</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">null</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E06C75;">array</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--List 类型--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;list&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">list</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;张三&lt;/</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;李四&lt;/</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;王五&lt;/</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;赵六&lt;/</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E06C75;">list</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--Map 类型--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;maps&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">map</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">entry</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">key</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;JAVA&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;java&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">entry</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">entry</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">key</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;PHP&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;php&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">entry</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E06C75;">map</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--Set 类型--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;sets&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">set</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;MySQL&lt;/</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;Redis&lt;/</span><span style="color:#E06C75;">value</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E06C75;">set</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">  // 注入内部Bean</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;employee&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;net.Employee&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;empNo&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;001&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;empName&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;小王&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;dept&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;">&lt;!--内部 Bean--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;net.Dept&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;deptNo&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;004&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;deptName&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;技术部&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">  // Bean继承  子Bean可以继承父 Bean 的配置数据，也可重写或添加属于自己的配置信息</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">&lt;!--父Bean--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;parentBean&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;xxx.ParentBean&quot;</span><span style="color:#ABB2BF;"> &gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;age&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;45&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;sex&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;m&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt; </span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">&lt;!--子Bean--&gt;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;childBean&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;xxx.ChildBean&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">parent</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;parentBean&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">beans</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><p>使用</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">App</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">static</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{ </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">ApplicationContext</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">context</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">ClassPathXmlApplicationContext</span><span style="color:#ABB2BF;">( </span><span style="color:#98C379;">&quot;applicationContext.xml&quot;</span><span style="color:#ABB2BF;">); </span></span>
<span class="line"><span style="color:#ABB2BF;">                                </span><span style="color:#7F848E;font-style:italic;">// = new FileSystemXmlApplicationContext(String configLocation);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 获取Bean</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">UserService</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">userService</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getBean</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;UserService&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">UserService</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 正常调用</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">userService</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getUserName</span><span style="color:#ABB2BF;">());  </span><span style="color:#7F848E;font-style:italic;">// root</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">//手动销毁 Bean</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><table><thead><tr><th>属性名称</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>Bean 的唯一标识符，Spring IoC 容器对 Bean 的配置和管理通过该属性完成。</td></tr><tr><td>name</td><td>Bean 的名称，通过 name 属性为同一个 Bean 同时指定多个名称，每个名称之间用逗号或分号隔开。Spring 容器可以通过 name 属性配置和管理容器中的 Bean。</td></tr><tr><td>class</td><td>Bean 的具体实现类，它必须是一个完整的类名，即类的全限定名。</td></tr><tr><td>scope</td><td>Bean 的作用域，属性值可以为 singleton（单例）、prototype（原型）、request、session 和 global Session。默认值是 singleton。</td></tr><tr><td>constructor-arg</td><td><code>&lt;bean&gt;</code> 元素的子元素，通过该元素，将构造参数传入，以实现 Bean 的实例化。该元素的 index 属性指定构造参数的序号（从 0 开始），type 属性指定构造参数的类型。</td></tr><tr><td>property</td><td><code>&lt;bean&gt;</code>元素的子元素，用于调用 Bean 实例中的 setter 方法对属性进行赋值，从而完成属性的注入。该元素的 name 属性用于指定 Bean 实例中相应的属性名。</td></tr><tr><td>ref</td><td><code>&lt;property&gt;</code>和 <code>&lt;constructor-arg&gt;</code> 等元素的子元索，用于指定对某个 Bean 实例的引用，即 <code>&lt;bean&gt;</code> 元素中的 id 或 name 属性。</td></tr><tr><td>value</td><td><code>&lt;property&gt;</code> 和 <code>&lt;constractor-arg&gt;</code> 等元素的子元素，用于直接指定一个常量值。</td></tr><tr><td>list</td><td>用于封装 List 或数组类型的属性注入。</td></tr><tr><td>set</td><td>用于封装 Set 类型的属性注入。</td></tr><tr><td>map</td><td>用于封装 Map 类型的属性注入。</td></tr><tr><td>entry</td><td><code>&lt;map&gt;</code> 元素的子元素，用于设置一个键值对。其 key 属性指定字符串类型的键值，ref 或 value 子元素指定其值。</td></tr><tr><td>init-method</td><td>容器加载 Bean 时调用该方法，类似于 Servlet 中的 init() 方法</td></tr><tr><td>destroy-method</td><td>容器删除 Bean 时调用该方法，类似于 Servlet 中的 destroy() 方法。该方法只在 scope=singleton 时有效</td></tr><tr><td>lazy-init</td><td>懒加载，值为 true，容器在首次请求时才会创建 Bean 实例；值为 false，容器在启动时创建 Bean 实例。该方法只在 scope=singleton 时有效</td></tr></tbody></table><p><strong>自动装配 autowired</strong></p><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>byName</td><td>根据 Property 的 name 自动装配，如果一个 Bean 的 name 和另一个 Bean 中的 Property 的 name 相同，则自动装配这个 Bean 到 Property 中。</td></tr><tr><td>byType</td><td>根据 Property 的数据类型（Type）自动装配，如果一个 Bean 的数据类型兼容另一个 Bean 中 Property 的数据类型，则自动装配。</td></tr><tr><td>constructor</td><td>根据构造方法的参数的数据类型，进行 byType 模式的自动装配。</td></tr><tr><td>autodetect</td><td>如果发现默认的构造方法，则用 constructor 模式，否则用 byType 模式。</td></tr><tr><td>no</td><td>默认情况下，不使用自动装配，Bean 依赖必须通过 ref 元素定义。</td></tr></tbody></table><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">···</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;mailService&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.MailService&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">		&lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;userService&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.UserService&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">autowire</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;byName&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;username&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;root&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">&lt;!-- property name=&quot;mailService&quot; ref=&quot;mailService&quot; / --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">···</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>Annotation装配Bean</strong> <br> 定义 Bean</p><ul><li>@Component：描述 Spring 中的 Bean，表示一个组件（Bean），可以作用在任何层次</li><li>@Repository：用于将数据访问层（DAO层）的类标识为 Spring 中的 Bean，功能同 _@_Component</li><li>@Service：通常作用在业务层（Service 层）</li><li>@Controller：通常作用在控制层</li></ul><p>依赖注入</p><ul><li><p>@Autowired：对 Bean 的属性变量、属性的 Set 方法及构造函数进行标注，配合对应的注解处理器完成 Bean 的自动配置工作。默认按照 Bean 的<strong>类型</strong>进行装配。</p></li><li><p>@Resource：与 @Autowired 一样，默认按照 Bean <strong>实例名</strong>称进行装配。</p></li><li><p>@Qualifier：与 _@_Autowired 注解配合使用，会将默认的按 Bean 类型装配修改为按 Bean 的实例名称装配，Bean 的实例名称由 _@_Qualifier 注解的参数指定。</p></li><li><p>@Primary：@Autowired 自动装配找到多个匹配的 Bean时，首选该 Bean</p></li><li><p>@Scope(value = &quot;prototype&quot;, proxyMode = ScopedProxyMode.DEFAULT) ：指定 Bean 的作用域、代理方式</p></li><li><p>@Order(1)：指定 Bean 的加载顺序，值越小优先级越高</p></li><li><p>标注方法</p><ul><li>@PostConstruct：指定 Bean 的初始化方法</li><li>@PreDestroy：指定 Bean 销毁之前的方法</li></ul></li><li><p>@Value：属性占位符需要放到 \${key:defaultValue} 之中，SpEL 表达式要放到 #{ ... } 之中</p></li></ul><p>配置 applicationContext.xml</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;?</span><span style="color:#E06C75;">xml</span><span style="color:#D19A66;"> version</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;1.0&quot;</span><span style="color:#D19A66;"> encoding</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">beans</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">xmlns</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">xmlns:xsi</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">xmlns:context</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.springframework.org/schema/context&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">xsi:schemaLocation</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.springframework.org/schema/beans</span></span>
<span class="line"><span style="color:#98C379;">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span>
<span class="line"><span style="color:#98C379;">        http://www.springframework.org/schema/context</span></span>
<span class="line"><span style="color:#98C379;">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">context:annotation-config</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">&lt;!--使用context命名空间，通知spring扫描指定目录，进行注解的解析--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">context:component-scan</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">base-package</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;包名&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">beans</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Component</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">UserService</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Autowired</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">MailService</span><span style="color:#E06C75;"> mailService</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">...</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Component</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">MailService</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Autowired</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">required</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">false</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">ZoneId</span><span style="color:#E06C75;"> zoneId </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ZoneId</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">systemDefault</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">PostConstruct</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> init</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Init mail service with zoneId = &quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">zoneId</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">PreDestroy</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> shutdown</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Shutdown mail service&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 启动容器</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Configuration</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">ComponentScan</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">AppConfig</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">static</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 创建第三方Bean</span></span>
<span class="line"><span style="color:#ABB2BF;">        @</span><span style="color:#E5C07B;">Bean</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">ZoneId</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">createZoneId</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ZoneId</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">of</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Z&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">ApplicationContext</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">context</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">AnnotationConfigApplicationContext</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">AppConfig</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">UserService</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">userService</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getBean</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">UserService</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">user</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">userService</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;bob@example.com&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;password&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">user</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getName</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="aop" tabindex="-1">AOP <a class="header-anchor" href="#aop" aria-hidden="true">#</a></h3><p>Aspect Oriented Programming，面向切面编程</p><p>作用范围：spring托管的bean的非static方法</p><p><strong>术语</strong></p><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>Joinpoint（连接点）</td><td>指那些被拦截到的点，在 Spring 中，可以被动态代理拦截目标类的方法。</td></tr><tr><td>Pointcut（切入点）</td><td>指要对哪些 Joinpoint 进行拦截，即被拦截的连接点。</td></tr><tr><td>Advice（通知）</td><td>指拦截到 Joinpoint 之后要做的事情，即对切入点增强的内容。</td></tr><tr><td>Target（目标）</td><td>指代理的目标对象。</td></tr><tr><td>Weaving（植入）</td><td>指把增强代码应用到目标上，生成代理对象的过程。</td></tr><tr><td>Proxy（代理）</td><td>指生成的代理对象。</td></tr><tr><td>Aspect（切面）</td><td>切入点和通知的结合。</td></tr></tbody></table><p><strong>Spring AOP 通知类型</strong></p><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>org.springframework.aop.MethodBeforeAdvice （前置通知）</td><td>在方法之前自动执行的通知称为前置通知，可用于权限管理等功能。</td></tr><tr><td>org.springframework.aop.AfterReturningAdvice （后置通知）</td><td>在方法之后自动执行的通知称为后置通知，可用于关闭流、上传文件、删除临时文件等功能。</td></tr><tr><td>org.aopalliance.intercept.MethodInterceptor （环绕通知）</td><td>在方法前后自动执行的通知称为环绕通知，可用于日志、事务管理等功能。</td></tr><tr><td>org.springframework.aop.ThrowsAdvice （异常通知）</td><td>在方法抛出异常时自动执行的通知称为异常通知，可用于处理异常记录日志等功能。</td></tr><tr><td>org.springframework.aop.IntroductionInterceptor （引介通知）</td><td>在目标类中添加一些新的方法和属性，可用于修改旧版本程序（增强类）。</td></tr></tbody></table><p><strong>XML的声明式</strong></p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">//切面类</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">MyAspect</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">// 前置通知</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> myBefore</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">JoinPoint</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">joinPoint</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;前置通知，目标：&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">joinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getTarget</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;方法名称:&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">joinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSignature</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">getName</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">// 后置通知</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> myAfterReturning</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">JoinPoint</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">joinPoint</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;后置通知，方法名称：&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">joinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSignature</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">getName</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">// 环绕通知</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Object</span><span style="color:#61AFEF;"> myAround</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ProceedingJoinPoint</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">proceedingJoinPoint</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">            </span><span style="color:#C678DD;">throws</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Throwable</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;环绕开始&quot;</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">// 开始</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">obj</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">proceedingJoinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">proceed</span><span style="color:#ABB2BF;">(); </span><span style="color:#7F848E;font-style:italic;">// 执行当前目标方法</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;环绕结束&quot;</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">// 结束</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> obj;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">// 异常通知</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> myAfterThrowing</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">JoinPoint</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">joinPoint</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Throwable</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">e</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;异常通知&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;出错了&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">e</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMessage</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">// 最终通知</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> myAfter</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;最终通知&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>applicationContext.xml 配置</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">&lt;!--目标类 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;customerDao&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.mengma.dao.CustomerDaoImpl&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--切面类 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myAspect&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.mengma.aspectj.xml.MyAspect&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--AOP 编程 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">aop:config</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">aop:aspect</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">ref</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myAspect&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">&lt;!-- 配置切入点，通知最后增强哪些方法 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">aop:pointcut</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">expression</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;execution ( * com.mengma.dao.*.* (..))&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myPointCut&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">&lt;!--前置通知，关联通知 Advice和切入点PointCut --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">aop:before</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">method</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myBefore&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">pointeut-ref</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myPointCut&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">&lt;!--后置通知，在方法返回之后执行，就可以获得返回值returning 属性 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">aop:after-returning</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">method</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myAfterReturning&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#D19A66;">pointcut-ref</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myPointCut&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">returning</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;returnVal&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">&lt;!--环绕通知 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">aop:around</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">method</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myAround&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">pointcut-ref</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myPointCut&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">&lt;!--抛出通知：用于处理程序发生异常，可以接收当前方法产生的异常 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">&lt;!-- *注意：如果程序没有异常，则不会执行增强 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">&lt;!-- * throwing属性：用于设置通知第二个参数的名称，类型Throwable --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">aop:after-throwing</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">method</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myAfterThrowing&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#D19A66;">pointcut-ref</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myPointCut&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">throwing</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;e&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">&lt;!--最终通知：无论程序发生任何事情，都将执行 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">aop:after</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">method</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myAfter&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">pointcut-ref</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;myPointCut&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;/</span><span style="color:#E06C75;">aop:aspect</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">aop:config</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><strong>Annotation 的声明式</strong></p><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>_@_Aspect</td><td>用于定义一个切面。</td></tr><tr><td>_@_Before</td><td>用于定义前置通知，相当于 BeforeAdvice。</td></tr><tr><td>_@_AfterReturning</td><td>用于定义后置通知，相当于 AfterReturningAdvice。</td></tr><tr><td>_@_Around</td><td>用于定义环绕通知，相当于MethodInterceptor。</td></tr><tr><td>_@_AfterThrowing</td><td>用于定义抛出通知，相当于ThrowAdvice。</td></tr><tr><td>_@_After</td><td>用于定义最终final通知，不管是否异常，该通知都会执行。</td></tr><tr><td>_@_DeclareParents</td><td>用于定义引介通知，相当于IntroductionInterceptor</td></tr></tbody></table><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Component</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Aspect</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Slf4j</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">WebLogAspect</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Pointcut</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;execution( public * me.demo.controller..*.*(..))&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> requestLog</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Pointcut</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;@annotation(me.demo.aspect.LogInOutParam)&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> methodLog</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#7F848E;font-style:italic;">// 前置通知</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Before</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;requestLog() || methodLog()&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> doBefore</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">JoinPoint</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">joinPoint</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">ServletRequestAttributes</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">requestAttributes</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (ServletRequestAttributes) </span><span style="color:#E5C07B;">RequestContextHolder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getRequestAttributes</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">Optional</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">ofNullable</span><span style="color:#ABB2BF;">(requestAttributes).</span><span style="color:#61AFEF;">map</span><span style="color:#ABB2BF;">(ServletRequestAttributes</span><span style="color:#C678DD;">::</span><span style="color:#ABB2BF;">getRequest)</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">ifPresent</span><span style="color:#ABB2BF;">(request </span><span style="color:#C678DD;">-&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Received {} - {} request {}&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">request</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getRemoteAddr</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">request</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMethod</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">ServletUriComponentsBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">fromContextPath</span><span style="color:#ABB2BF;">(request).</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">()));</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">MethodSignature</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">signature</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (MethodSignature) </span><span style="color:#E5C07B;">joinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSignature</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Ready into {} . {} - ARGS: (name) {} - (value) {}&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">signature</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getDeclaringTypeName</span><span style="color:#ABB2BF;">(), </span><span style="color:#E5C07B;">signature</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getName</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">signature</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getParameterNames</span><span style="color:#ABB2BF;">(), </span><span style="color:#E5C07B;">joinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getArgs</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#7F848E;font-style:italic;">// 环绕通知</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Around</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;requestLog() || methodLog()&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Object</span><span style="color:#61AFEF;"> doAround</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ProceedingJoinPoint</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">proceedingJoinPoint</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">      </span><span style="color:#C678DD;">throws</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Throwable</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">StopWatch</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">stopWatch</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">StopWatch</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">proceedingJoinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toShortString</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">stopWatch</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">obj</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">null</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">try</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;">// 执行当前目标方法</span></span>
<span class="line"><span style="color:#ABB2BF;">      obj </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">proceedingJoinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">proceed</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> obj;</span></span>
<span class="line"><span style="color:#ABB2BF;">    } </span><span style="color:#C678DD;">finally</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">stopWatch</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">stop</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">methodName</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">proceedingJoinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSignature</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">getName</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;{} - {} complete, it takes {}ms&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">proceedingJoinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getTarget</span><span style="color:#ABB2BF;">(), methodName</span></span>
<span class="line"><span style="color:#ABB2BF;">          , </span><span style="color:#E5C07B;">stopWatch</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLastTaskTimeMillis</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">Objects</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">nonNull</span><span style="color:#ABB2BF;">(obj)) {</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;{} return result -&gt; {}&quot;</span><span style="color:#ABB2BF;">, methodName,</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">StringUtils</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">abbreviate</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toJSONString</span><span style="color:#ABB2BF;">(obj), </span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#7F848E;font-style:italic;">// 异常通知</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">AfterThrowing</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">value</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;requestLog()&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">throwing</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;e&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> doAfterThrowing</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">JoinPoint</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">joinPoint</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Throwable</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">e</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;{} - {} execute error {}&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">joinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getTarget</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">joinPoint</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSignature</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">getName</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        , </span><span style="color:#E5C07B;">e</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMessage</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><p>applicationContext.xml 配置</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">&lt;!--扫描含com.mengma包下的所有注解--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">context:component-scan</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">base-package</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.mengma&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">&lt;!-- 使切面开启自动代理 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">aop:aspectj-autoproxy</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">aop:aspectj-autoproxy</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>AspectJ 切入点语法</p><ul><li><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#aop-pointcuts-designators" target="_blank" rel="noreferrer">Supported Pointcut Designators</a></li><li>Spring AOP 常用的切入点指示符（pointcut designators，PCD） <ul><li>可用通配符： <ul><li><code>*</code> 代表一个任意类型的参数</li><li><code>..</code> 代表零个或多个任意类型的参数，在表示类时，必须和 * 联合使用，而在表示入参时则单独使用</li><li><code>+</code> 表示按类型匹配指定类的所有类，必须跟在类名后面，如 com.smart.Car+ 继承或扩展指定类的所有类，同时还包括指定类本身</li><li>运算符：<code>&amp;&amp;、||、！</code></li></ul></li><li>execution：用于匹配执行方法的连接点 <ul><li><code>execution(&lt;修饰符&gt;? &lt;返回值类型&gt; &lt;所属类&gt;?&lt;方法名&gt;(形参类型列表) &lt;声明抛出的异常&gt;?)</code>，? 表示该部分可省略</li><li>如 <code>execution(* com.example.app.service.impl.*.*(..))</code>，匹配 com.example.app.service.impl 包中任意类的任意方法的执行</li></ul></li><li>within：用于限定匹配特定域下的连接点。当使用 Spring AOP 的时候，只能匹配方法执行的连接点。 <ul><li>如 within(com.example.app.service..*)，匹配在 com.example.app.service 包或其子包中的任意连接点</li></ul></li><li>this：用于限定 AOP 代理对象必须是指定类型的实例，匹配该对象的所有连接点 <ul><li>this(com.example.app.service.AccountService)，匹配实现了 com.example.app.service.AccountService 接口的 AOP 代理的所有连接点</li></ul></li><li>target：用于限定目标对象必须是指定类型的实例，匹配该对象的所有连接点 <ul><li>target(com.example.app.service.AccountService)，匹配实现了 com.example.app.service.AccountService 接口的目标对象的所有连接点</li></ul></li><li>args：args(参数类型列表)，用于对连接点的参数类型进行限制，要求参数是指定类型的实例</li><li>bean：bean(Bean的id或name)，用于限定只匹配指定 Bean 实例内方法的连接点，支持使用 * 通配符，注意：bean 切入点表达式是 Spring AOP 额外支持的</li><li>@annotation：用于匹配标注有指定注解的方法</li><li>@within：用于匹配标注有指定注解的类内所有方法 <ul><li>如 @within(feign.Client+)，切入 feign.Client 的实现类</li></ul></li><li>@target：用于匹配标注有指定注解的类的目标对象内所有方法</li><li>@args：用于匹配入参标注有指定注解的方法</li></ul></li></ul><h3 id="spel" tabindex="-1">SpEL <a class="header-anchor" href="#spel" aria-hidden="true">#</a></h3><p>Spring Expression Language 是一种功能强大的表达式语言，支持运行时查询和操作对象图 。</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// 构造解析器</span></span>
<span class="line"><span style="color:#E5C07B;">ExpressionParser</span><span style="color:#E06C75;"> parser </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">new</span><span style="color:#E06C75;"> </span><span style="color:#61AFEF;">SpelExpressionParser</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 解析器解析字符串表达式</span></span>
<span class="line"><span style="color:#E5C07B;">Expression</span><span style="color:#E06C75;"> exp </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">parser</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">parseExpression</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;new String(&#39;hello spel&#39;).toUpperCase()&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 获取表达式的值</span></span>
<span class="line"><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> message </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">exp</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getValue</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(message);</span><span style="color:#E06C75;"> </span><span style="color:#7F848E;font-style:italic;">// HELLO SPEL</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="application-event" tabindex="-1">Application Event <a class="header-anchor" href="#application-event" aria-hidden="true">#</a></h3><p><strong>内置事件</strong></p><ul><li>上下文更新事件（ContextRefreshedEvent）：在调用ConfigurableApplicationContext 接口中的refresh()方法时被触发。</li><li>上下文开始事件（ContextStartedEvent）：当容器调用ConfigurableApplicationContext的Start()方法开始/重新开始容器时触发该事件。</li><li>上下文停止事件（ContextStoppedEvent）：当容器调用ConfigurableApplicationContext的Stop()方法停止容器时触发该事件。</li><li>上下文关闭事件（ContextClosedEvent）：当ApplicationContext被关闭时触发该事件。容器被关闭时，其管理的所有单例Bean都被销毁。</li><li>请求处理事件（RequestHandledEvent）：在Web应用中，当一个http请求（request）结束触发该事件。</li></ul><p>1 自定义事件，继承 ApplicationEvent</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Data</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">DemoEvent</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ApplicationEvent</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> msg</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> DemoEvent</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">source</span><span style="color:#ABB2BF;">,</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">msg</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">super</span><span style="color:#ABB2BF;">(source);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">msg</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> msg;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>2 定义监听器，实现 ApplicationListener 或者通过 @EventListener 注解到方法上</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Component</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">DemoListener</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">//使用onApplicationEvent方法对消息进行接受处理</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">EventListener</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> onApplicationEvent</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">DemoEvent</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">event</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">msg</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">event</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMsg</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;DemoListener获取到了监听消息:&quot;</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">msg);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>3 定义发布者，通过 ApplicationEventPublisher</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Component</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">DemoPublisher</span><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Autowired</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ApplicationContext</span><span style="color:#E06C75;"> applicationContext</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> publish</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">msg</span><span style="color:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">applicationContext</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">publishEvent</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">DemoEvent</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">,msg));</span><span style="color:#7F848E;font-style:italic;">//使用ApplicationContext对象的publishEvent发布事件</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="utils" tabindex="-1">Utils <a class="header-anchor" href="#utils" aria-hidden="true">#</a></h3><h4 id="stringutils" tabindex="-1">StringUtils <a class="header-anchor" href="#stringutils" aria-hidden="true">#</a></h4><ul><li>boolean <s>isEmpty</s>(Object str)：字符串是否为空或者空字符串</li><li>boolean hasLength(CharSequence str)：字符串是否为空，或者长度为 0</li><li>boolean hasText(String str)：字符串是否有内容（不为空，且不全为空格）</li><li>boolean containsWhitespace(String str)：字符串是否包含空格</li><li>String trimWhitespace(String str)：去掉字符串前后的空格</li><li>String trimAllWhitespace(String str)：去掉字符串中所有的空格</li><li>String unqualify(String qualifiedName)：得到以 . 分割的最后一个值（可以用来获取类名或者文件后缀）</li><li>String unqualify(String qualifiedName, char separator)：得到以给定字符分割的最后一个值（可以用来获取文件名 File.separatorChar）</li><li>String getFilename(String path)：获取文件名</li><li>String getFilenameExtension(String path)：获取文件后缀名</li><li>String capitalize(String str)：首字母大写</li><li>String uncapitalize(String str)：取消首字母大写</li><li>boolean substringMatch(CharSequence str, int index, CharSequence substring)：判断从指定索引开始，是否匹配子字符串</li><li>int countOccurrencesOf(String str, String sub)：判断子字符串在字符串中出现的次数</li><li>String replace(String inString, String oldPattern, String newPattern)：在字符串中使用子字符串替换</li><li>String delete(String inString, String pattern)：删除所有匹配的子字符串</li><li>String deleteAny(String inString, String charsToDelete)：删除子字符串中任意出现的字符</li><li>String quote(String str)：在字符串前后增加单引号，比较适合在日志时候使用</li><li>String[] addStringToArray(String[] array, String str)：把一个字符串添加到一个字符串数组中</li><li>String[] concatenateStringArrays(String[] array1, String[]array2)：连接两个字符串数组</li><li>String[] mergeStringArrays(String[] array1, String[] array2)：连接两个字符串数组，去掉重复元素</li><li>String[] sortStringArray(String[] array)：字符串数组排序</li><li>String[] tokenizeToStringArray(String str, String delimiters)：对每一个元素执行 trim 操作，并去掉空字符串</li><li>String[] delimitedListToStringArray(String str, String delimiter)：分割字符串，以 delimiter 作为整体分隔符</li><li><code>Set&lt;String&gt; commaDelimitedListToSet(String str)</code>：使用逗号分割字符串，并放到 set 中去重</li><li><code>String collectionToDelimitedString(Collection&lt;?&gt; coll, String delim, String prefix, String suffix)</code>：将集合中的每个元素使用前缀、后缀、分隔符连接</li><li><code>String collectionToDelimitedString(Collection&lt;?&gt; coll, String delim)</code>：将集合中的每个元素使用指定字符串连接</li><li>String arrayToDelimitedString(Object[] arr, String delim)：数组使用指定字符串连接</li><li>String[] split(String toSplit, String delimiter)：在第一次出现分隔符时分割</li><li>Properties splitArrayElementsIntoProperties(String[] array, String delimiter)：把字符串数组中的每一个字符串按照给定的分隔符装配到一个 Properties 中</li></ul><h4 id="numberutils" tabindex="-1">NumberUtils <a class="header-anchor" href="#numberutils" aria-hidden="true">#</a></h4><ul><li><code>T convertNumberToTargetClass(Number number, Class&lt;T&gt; targetClass)</code></li><li><code>T parseNumber(String text, Class&lt;T&gt; targetClass)</code></li><li><code>T parseNumber(String text, Class&lt;T&gt; targetClass, NumberFormat numberFormat)</code></li></ul><h4 id="objectutils" tabindex="-1">ObjectUtils <a class="header-anchor" href="#objectutils" aria-hidden="true">#</a></h4><ul><li>boolean isCheckedException(Throwable ex)</li><li>boolean isArray(Object obj)</li><li>boolean isEmpty(Object[] array)</li><li>boolean isEmpty(Object obj)</li><li>Object unwrapOptional(Object obj)</li><li>boolean containsElement(Object[] array, Object element)</li><li>A[] addObjectToArray(A[] array, O obj)</li><li>boolean nullSafeEquals(Object o1, Object o2)</li><li>int nullSafeHashCode(Object obj)</li><li>String nullSafeToString(Object obj)</li><li>String nullSafeToString(Object[] array)</li></ul><h4 id="filecopyutils" tabindex="-1">FileCopyUtils <a class="header-anchor" href="#filecopyutils" aria-hidden="true">#</a></h4><p>用于文件和流复制，所有复制方法都使用 4096 字节的块大小，并在完成后关闭所有受影响的流</p><ul><li>int copy(File in, File out)</li><li>void copy(byte[] in, File out)</li><li>int copy(InputStream in, OutputStream out)</li><li>void copy(byte[] in, OutputStream out)</li><li>int copy(Reader in, Writer out)</li><li>void copy(String in, Writer out)</li><li>String copyToString(Reader in)</li><li>byte[] copyToByteArray(File in)</li><li>byte[] copyToByteArray(InputStream in)</li></ul><h4 id="filesystemutils" tabindex="-1">FileSystemUtils <a class="header-anchor" href="#filesystemutils" aria-hidden="true">#</a></h4><ul><li>boolean deleteRecursively(File root)：递归删除</li><li>boolean deleteRecursively(Path root)</li><li>void copyRecursively(File src, File dest)：递归复制</li><li>void copyRecursively(Path src, Path dest)</li></ul><h4 id="beanutils" tabindex="-1">BeanUtils <a class="header-anchor" href="#beanutils" aria-hidden="true">#</a></h4><ul><li>void copyProperties(Object source, Object target, String... ignoreProperties)：浅克隆（原理：反射）</li><li><code>boolean isSimpleProperty(Class&lt;?&gt; clazz)</code>：判断给定的类型是否表示简单属性：八大基本类型/包装类型、字符串或其它 CharSequence、Number、Enum、Date、URI、URL、Locale、Class 或对应的数组</li><li><code>T instantiateClass(Class&lt;T&gt; clazz)</code>：使用无参构造器实例化</li><li><code>Method findDeclaredMethod(Class&lt;?&gt; clazz, String methodName, Class&lt;?&gt;... paramTypes)</code></li></ul><h4 id="beancopier" tabindex="-1">BeanCopier <a class="header-anchor" href="#beancopier" aria-hidden="true">#</a></h4><ul><li>类方法：BeanCopier create(Class source, Class target, boolean useConverter)：通过操作字节码生成用于两个 JavaBean 间进行复制的类</li><li>抽象方法：void copy(Object var1, Object var2, Converter var3)：对两个 Bean 间属性名和类型完全相同的变量进行拷贝</li></ul><h4 id="beanmap" tabindex="-1">BeanMap <a class="header-anchor" href="#beanmap" aria-hidden="true">#</a></h4><ul><li>类方法：BeanMap create(Object bean)：JavaBean 对象转 Map 对象，BeanMap.create(bean).keySet();</li><li>实例方法：void putAll(Map t)：Map 对象转 JavaBean 对象，BeanMap.create(bean).putAll(map);</li></ul><h4 id="aoputils" tabindex="-1">AopUtils <a class="header-anchor" href="#aoputils" aria-hidden="true">#</a></h4><ul><li>boolean isAopProxy(Object object)：是否是代理对象</li><li>boolean isJdkDynamicProxy(Object object)：判断是否是 JDK 代理对象</li><li>boolean isCglibProxy(Object object)：判断是否是 cglib 代理对象</li><li><code>Class&lt;?&gt; getTargetClass(Object candidate)</code>：获取对象的真实类型</li><li><code>Method getMostSpecificMethod(Method method, Class&lt;?&gt; targetClass)</code>：获取真实对象上对应的方法</li><li>Object invokeJoinpointUsingReflection(Object target, Method method, Object[] args)：在 target 对象上，使用 args 参数列表执行 method</li></ul><h4 id="reflectionutils" tabindex="-1">ReflectionUtils <a class="header-anchor" href="#reflectionutils" aria-hidden="true">#</a></h4><ul><li><code>Field findField(Class&lt;?&gt; clazz, String name)</code></li><li><code>Field findField(Class&lt;?&gt; clazz, String name, Class&lt;?&gt; type)</code></li><li>Object getField(Field field, Object target)</li><li>void setField(Field field, Object target, Object value)</li><li><code>Method findMethod(Class&lt;?&gt; clazz, String name)</code></li><li><code>Method findMethod(Class&lt;?&gt; clazz, String name, Class&lt;?&gt;... paramTypes)</code></li><li>Object invokeMethod(Method method, Object target)</li><li>Object invokeMethod(Method method, Object target, Object... args)</li></ul><h4 id="stopwatch" tabindex="-1">StopWatch <a class="header-anchor" href="#stopwatch" aria-hidden="true">#</a></h4><p>秒表，可用于查看多个任务的耗时情况，线程不安全</p><ul><li>构造器：StopWatch(String id)</li><li>void start(String taskName)</li><li>void stop()</li><li>long getTotalTimeMillis()、long getLastTaskTimeMillis()</li><li>TaskInfo[] getTaskInfo()、TaskInfo getLastTaskInfo()</li><li>String shortSummary()</li></ul><h2 id="data-access" tabindex="-1"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#spring-data-tier" target="_blank" rel="noreferrer">Data Access</a> <a class="header-anchor" href="#data-access" aria-hidden="true">#</a></h2><h3 id="jdbctemplate" tabindex="-1">JDBCTemplate <a class="header-anchor" href="#jdbctemplate" aria-hidden="true">#</a></h3><p>通过配置文件、注解、Java 配置类等形式获取数据库的相关信息，实现了对 JDBC 开发过程中的驱动加载、连接的开启和关闭、SQL 语句的创建与执行、异常处理、事务处理、数据类型转换等操作的封装</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;?</span><span style="color:#E06C75;">xml</span><span style="color:#D19A66;"> version</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;1.0&quot;</span><span style="color:#D19A66;"> encoding</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">beans</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">xmlns</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#D19A66;">xmlns:xsi</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#D19A66;">xmlns:context</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.springframework.org/schema/context&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#D19A66;">xsi:schemaLocation</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.springframework.org/schema/beans</span></span>
<span class="line"><span style="color:#98C379;">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span>
<span class="line"><span style="color:#98C379;">    http://www.springframework.org/schema/context</span></span>
<span class="line"><span style="color:#98C379;">            http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--开启组件扫描--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">context:component-scan</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">base-package</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;net.biancheng.c&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">context:component-scan</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--引入 jdbc.properties 中的配置--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">context:property-placeholder</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">location</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;classpath:jdbc.properties&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">context:property-placeholder</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#ABB2BF;">  	</span><span style="color:#7F848E;font-style:italic;">&lt;!--定义数据源 Bean--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;dataSource&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">&lt;!--数据库连接地址--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;url&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;\${jdbc.url}&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">&lt;!--数据库的用户名--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;username&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;\${jdbc.username}&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">&lt;!--数据库的密码--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;password&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;\${jdbc.password}&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">&lt;!--数据库驱动--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;driverClassName&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;\${jdbc.driver}&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--定义JdbcTemplate Bean--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;jdbcTemplate&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">&lt;!--将数据源的 Bean 注入到 JdbcTemplate 中--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;dataSource&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">ref</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;dataSource&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">beans</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>methods</p><ul><li>public int update(String sql) 用于执行新增、更新、删除等语句；</li><li>public int update(String sql,Object... args)</li><li>public void execute(String sql) 可以执行任意 SQL，一般用于执行 DDL 语句；</li><li>public T execute(String sql, PreparedStatementCallback action)</li><li><code>public &lt;T&gt; List&lt;T&gt; query(String sql, RowMapper&lt;T&gt; rowMapper, @Nullable Object... args) </code></li><li>用于执行查询语句；</li><li><code>public &lt;T&gt; T queryForObject(String sql, RowMapper&lt;T&gt; rowMapper, @Nullable Object... args)</code></li><li><code>public int[] batchUpdate(String sql, List&lt;Object[]&gt; batchArgs, final int[] argTypes) </code></li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Repository</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">UserDaoImpl</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">implements</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">UserDao</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Resource</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">JdbcTemplate</span><span style="color:#E06C75;"> jdbcTemplate</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Resource</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">NamedParameterJdbcTemplate</span><span style="color:#E06C75;"> namedParameterJdbcTemplate</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">int</span><span style="color:#61AFEF;"> addUer</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">user</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">sql</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;INSERT into \`user\` (\`user\`.user_name,\`user\`.\`status\`) VALUES(?,?);&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">update</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">jdbcTemplate</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(sql, </span><span style="color:#E5C07B;">user</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getUserName</span><span style="color:#ABB2BF;">(), </span><span style="color:#E5C07B;">user</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getStatus</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> update;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">int</span><span style="color:#61AFEF;"> update</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">user</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">sql</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;UPDATE \`user\` SET status=? WHERE user_name=?;&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">jdbcTemplate</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(sql, </span><span style="color:#E5C07B;">user</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getStatus</span><span style="color:#ABB2BF;">(), </span><span style="color:#E5C07B;">user</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getUserName</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">int</span><span style="color:#61AFEF;"> delete</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">user</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">sql</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;DELETE FROM \`user\` where user_name=?;&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">jdbcTemplate</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(sql, </span><span style="color:#E5C07B;">user</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getUserName</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">int</span><span style="color:#61AFEF;"> count</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">user</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">sql</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;SELECT COUNT(*) FROM \`user\` where \`status\`=?;&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">jdbcTemplate</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">queryForObject</span><span style="color:#ABB2BF;">(sql, </span><span style="color:#E5C07B;">Integer</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">user</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getStatus</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> getList</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">user</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">sql</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;SELECT * FROM \`user\` where \`status\`=?;&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">jdbcTemplate</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">query</span><span style="color:#ABB2BF;">(sql, </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">BeanPropertyRowMapper</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;">&gt;(</span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">), </span><span style="color:#E5C07B;">user</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getStatus</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> batchAddUser</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">[]&gt; </span><span style="color:#E06C75;font-style:italic;">batchArgs</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">sql</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;INSERT into \`user\` (\`user\`.user_name,\`user\`.\`status\`) VALUES(?,?);&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">jdbcTemplate</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">batchUpdate</span><span style="color:#ABB2BF;">(sql, batchArgs);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="事务-transaction" tabindex="-1">事务（Transaction） <a class="header-anchor" href="#事务-transaction" aria-hidden="true">#</a></h3><p><strong>编程式事务管理</strong> 通过编写代码实现的事务管理 <br> <strong>TransactionDefinition</strong>：定义了一个事务规则——事务隔离、事务传播、事务超时、只读状态 <br> TransactionStatus 表示一个事务</p><p><strong>PlatformTransactionManager</strong>： 具体的事务管理由 PlatformTransactionManager 的实现类DataSourceTransactionManager来完成</p><ul><li>TransactionStatus getTransaction(@Nullable TransactionDefinition definition)：开始事务，transactionDefinition 可从容器中获取</li><li>void commit(TransactionStatus status)：提交事务</li><li>void rollback(TransactionStatus status)：回滚事务</li></ul><p><strong>声明式事务管理</strong> 底层采用了 AOP 技术，只需要在配置文件中进行相关的规则声明 <br> <code>@Transactional</code> 建议标注在实现类（或实现类的方法）上 <br> 可用属性</p><ul><li>transactionManager：指定使用的事务管理器 Bean 的 id</li><li>isolation：用于指定事务的隔离级别，默认为底层事务的隔离级别 Isolation.DEFAULT</li><li>propagation：指定事务传播行为，默认 Propagation.REQUIRED</li><li>readOnly：指定事务是否只读，默认 false</li><li>rollbackFor：指定遇到特定异常时强制回滚事务，默认 ex instanceof RuntimeException || ex instanceof Error （RuntimeException 或 Error）时才回滚，DefaultTransactionAttribute#rollbackOn</li><li>rollbackForClassName：指定遇到特定的多个异常时强制回滚事务。该属性值可以指定多个异常类名</li><li>noRollbackFor：指定遇到特定异常时强制不回滚事务</li><li>noRollbackForClassName：指定遇到特定的多个异常时强制不回滚事务。该属性值可以指定多个异常类名</li><li>timeout：指定事务的超时时长</li></ul><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>注意事项</p><ul><li>自调用失效：一个类<strong>自身方法之间的调用</strong></li><li>方法是 public 且非静态的</li></ul></div><h2 id="spring-mvc" tabindex="-1"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html" target="_blank" rel="noreferrer">Spring MVC</a> <a class="header-anchor" href="#spring-mvc" aria-hidden="true">#</a></h2><p><strong>MVC</strong></p><ul><li>**模型(Model) **封装了应用程序数据，通常它们将由POJO类组成。</li><li>**视图(View) **负责渲染模型数据，一般来说它生成客户端浏览器可以解释HTML输出。</li><li>**控制器(Controller) **负责处理用户请求并构建适当的模型，并将其传递给视图进行渲染。</li></ul><p>执行流程 <br> <img src="`+t+`" alt=""></p><h3 id="注解" tabindex="-1">注解 <a class="header-anchor" href="#注解" aria-hidden="true">#</a></h3><p><code>@RequestMapping</code>：用于类或方法，用来转换 Web 请求（访问路径和参数）</p><ul><li><p>常用属性：</p><ul><li>value、path：用于将指定请求的实际地址转换到方法上，value 的属性值可以不带斜杠</li><li>method：用来指定该方法仅仅处理哪些 HTTP 请求方式，包括 GET、POST、HEAD、OPTIONS、PUT、PATCH、DELETE、TRACE，如果没有指定 method 属性值，则请求处理方法可以处理任意的 HTTP 请求方式</li><li>consumes：指定处理<strong>请求的提交内容类型</strong>（Content-Type），如 &quot;application/json&quot;、&quot;text/html&quot;、&quot;application/x-www-form-urlencoded&quot;、&quot;multipart/form-data&quot;（MediaType 提供了常用的媒体类型）</li><li>produces：指定<strong>返回的内容类型</strong>，返回的内容类型必须是 request 请求头（Accept）中所包含的类型，如 &quot;application/json;charset=UTF-8&quot;、&quot;application/json&quot;</li><li>headers：指定请求中必须包含某些指定的 header 值，才能让该方法处理，如 &quot;Accept=application/json&quot;</li><li>params：指定请求中必须包含某些参数值时，才让该方法处理，如 params=&quot;myParam=myValue”，方法仅处理其中名为“myParam”、值为“myValue”的请求</li></ul></li><li><p>组合注解：<code>@GetMapping、@PostMapping、@PutMapping、@DeleteMapping、PatchMapping</code></p></li><li><p>后缀匹配：Spring MVC 中默认将 .* 作为匹配后缀，即映射到 /person 的方法也隐式映射到 /person.*。通过重写 WebMvcConfigurerAdapter 类中的 configurePathMatch 方法可设置不忽略“.”后面的参数，configurer.setUseSuffixPatternMatch(false)（Spring Boot 默认设置为 false）</p></li><li><p>URI 模式：</p><ul><li>? 匹配 1 个字符（但不能是代表路径分隔符的 /）</li><li><ul><li>匹配 0 或多个任意的字符（可以是代表路径分隔符的 /）</li></ul></li><li>** 匹配 0 或多个目录</li><li><code>{varName:regex}</code>，如<code>{spring:[a-z]+} </code>将<strong>正则表达式</strong> [a-z]+ 匹配到的值赋值给名为 spring 的路径变量</li><li>也可以嵌入 <code>\${…} </code>占位符，这些占位符在启动时通过 PropertyPlaceHolderConfigurer 对本地、系统、环境和其它属性源来解析</li><li>最长匹配原则：存在多个路径匹配模式时，Spring MVC 会以最长符合路径模式来匹配一个路径</li></ul><p><br> <code>@CrossOrigin</code>：可用于类或方法，<strong>设置跨域行为</strong>，常用属性：origins（允许域名）、methods、allowedHeaders、exposedHeaders、allowCredentials（是否允许发送 Cookie，<strong>启用后允许域名不能设置为 &#39;*&#39;</strong>）、maxAge（本次预检请求的有效期，单位为秒）</p></li></ul><p><strong>Util</strong></p><ul><li>HttpMethod</li><li>HttpStatus</li><li>UriComponents</li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E5C07B;">UriComponents</span><span style="color:#E06C75;"> uriComponents </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">UriComponentsBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">fromHttpUrl</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://www.bing.cn&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">path</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;search/{content}&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">queryParam</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;q&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;spring&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">uriVariables</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ImmutableMap</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">of</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;content&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;abc&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">StandardCharsets</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">UTF_8</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>HtmlUtils</li><li>AntPathMatcher</li><li>PathPattern <ul><li><code>?</code> matches one character</li><li><code>*</code> matches zero or more characters within a path segment</li><li><code>**</code> matches zero or more path segments until the end of the path</li><li><code>{spring}</code> matches a path segment and captures it as a variable named &quot;spring&quot;</li><li><code>{spring:[a-z]+}</code> matches the regexp [a-z]+ as a path variable named &quot;spring&quot;</li><li><code>{*spring}</code> matches zero or more path segments until the end of the path and captures it as a variable named &quot;spring&quot;</li></ul></li></ul><p>方法参数</p><table><thead><tr><th>控制器方法参数</th><th>描述</th></tr></thead><tbody><tr><td>WebRequest, NativeWebRequest</td><td>对请求参数、请求、会话属性的通用访问，不直接使用 Servlet API</td></tr><tr><td>javax.servlet.ServletRequest, javax.servlet.ServletResponse</td><td>选择任意特定的请求或响应类型 —— 如：ServletRequest、HttpServletRequest，或 Spring 的 MultipartRequest、MultipartHttpServletRequest</td></tr><tr><td>javax.servlet.http.HttpSession</td><td>强制会话的存在。因此，该参数不可能为 null。 *会话访问不是线程安全的。如果多个请求被允许并发地访问会话，考虑设置 RequestMappingHandlerAdapter 的 synchronizeOnSession 标志为 true</td></tr><tr><td>javax.servlet.http.PushBuilder</td><td>Servlet 4.0 push builder API，用来编程式 HTTP/2 资源推送。注意，每个 Servlet Spec，如果客户端不支持 HTTP/2 特性，注入的 PushBuilder 实例可以为 null</td></tr><tr><td>java.security.Principal</td><td>当前已认证的用户；如果已知，可能是一个特定的 Principal 实现</td></tr><tr><td>HttpMethod</td><td>请求的 HTTP 方式</td></tr><tr><td>java.util.Locale</td><td>当前请求的区域设置，由可用的最具体的 LocaleResolver 确定，实际上是已配置的 LocaleResolver 或 LocaleContextResolver</td></tr><tr><td>java.util.TimeZone + java.time.ZoneId</td><td>当前请求关联的时区，由 LocaleContextResolver 确定</td></tr><tr><td>java.io.InputStream, java.io.Reader</td><td>用于访问由 Servlet API 暴露的原始请求体</td></tr><tr><td>java.io.OutputStream, java.io.Writer</td><td>用于访问由 Servlet API 暴露的原始响应体</td></tr><tr><td>@PathVariable</td><td>用于访问 URI 模板变量</td></tr><tr><td>@MatrixVariable</td><td>用于访问 URI 路径段中的键值对</td></tr><tr><td>@RequestParam</td><td>用来访问 Servlet 请求参数。参数值被转换为声明的方法参数类型。</td></tr><tr><td>@RequestHeader</td><td>用来访问请求报文头。报文头值被转换为声明的方法参数类型</td></tr><tr><td>@CookieValue</td><td>用来访问 Cookie。Cookie 值被转换为声明的方法参数类型</td></tr><tr><td>@RequestBody</td><td>用来访问 HTTP 请求报文体。报文体内容使用 HttpMessageConverters 被转换为声明的方法参数类型</td></tr><tr><td><code>HttpEntity&lt;B&gt;</code></td><td>用来访问请求报文头和报文体。报文体使用 HttpMessageConverters 被转换</td></tr><tr><td>@RequestPart</td><td>用来访问 multipart/form-data 请求的一部分</td></tr><tr><td>java.util.Map, org.springframework.ui.Model, org.springframework.ui.ModelMap</td><td>用来访问用于 HTTP 控制器的模型，作为视图渲染的一部分暴露给模板</td></tr><tr><td>RedirectAttributes</td><td>指定在重定向时使用的属性 —— 用来附加临时存储到重定向之后请求的查询字符串，flash 属性</td></tr><tr><td>@ModelAttribute</td><td>用于访问模型（如果不存在就实例化）中存在的应用数据绑定和校验的属性。</td></tr><tr><td>Errors, BindingResult</td><td>用于访问命令对象（如 @ModelAttribute 参数）校验和数据绑定产生的错误，或 @RequestBody 或 @RequestPart 参数校验产生的错误；Errors 或 BindingResult 参数必须紧跟在被校验的方法参数之后</td></tr><tr><td>SessionStatus + class-level @SessionAttributes</td><td>用于标记表单处理完成以清除通过类级别 @SessionAttributes 注解声明的会话属性</td></tr><tr><td>UriComponentsBuilder</td><td>用于准备一个相对于当前请求的主机、端口、方案、上下文路径和 Servlet 映射的文字部分的 URL，还需要考虑 Forwarded 和 X-Forwarded-* 报文头</td></tr><tr><td>@SessionAttribute</td><td>用于访问任意会话属性</td></tr><tr><td>@RequestAttribute</td><td>用于访问请求属性</td></tr></tbody></table><p>返回值</p><table><thead><tr><th>控制器方法返回值</th><th>描述</th></tr></thead><tbody><tr><td>@ResponseBody</td><td>返回值通过 HttpMessageConverters 转换并写入响应</td></tr><tr><td><code>HttpEntity&lt;B&gt;, ResponseEntity&lt;B&gt;</code></td><td>返回值指定完整的响应，包括通过 HttpMessageConverters 转换并写入响应的 HTTP 报文头和报文体</td></tr><tr><td>HttpHeaders</td><td>用于返回只有报文头没有报文体的响应</td></tr><tr><td>String</td><td>用于 ViewResolver 解析的视图名，并与隐式的模型</td></tr><tr><td>View</td><td>View 实例，与隐式的模型一起用来渲染模型</td></tr><tr><td>java.util.Map, org.springframework.ui.Model</td><td>将被添加到隐式模型的属性，视图名由 RequestToViewNameTranslator 隐式地确定</td></tr><tr><td>@ModelAttribute</td><td>将被添加的模型的属性</td></tr><tr><td>ModelAndView object</td><td>待使用的视图和模型，以及可选的响应状态</td></tr><tr><td>void</td><td>void 返回类型（或 null 返回值）的方法，如果它同时包含 ServletResponse，或者 OutputStream 属性，或者 @ResponseStatus 注解，则认为它已经处理完了响应。</td></tr><tr><td><code>DeferredResult&lt;V&gt;</code></td><td>从任意线程异步地生成任意上述返回值</td></tr><tr><td><code>Callable&lt;V&gt;</code></td><td>在 Spring MVC 托管的线程中异步地生成任意上述返回值</td></tr><tr><td>ListenableFuture, CompletionStage, CompletableFuture</td><td>DeferredResult 的便捷替代方案</td></tr><tr><td>ResponseBodyEmitter, SseEmitter</td><td>在 HttpMessageConverter 的帮助下异步地发出一个对象流以写入响应</td></tr><tr><td>StreamingResponseBody</td><td>异步地写入响应 OutputStream</td></tr></tbody></table><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">RestController</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">RequestMapping</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;/persons&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">PersonController</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">GetMapping</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;/{id}&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Person</span><span style="color:#61AFEF;"> getPerson</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">PathVariable</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Long</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">id</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">PostMapping</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">ResponseStatus</span><span style="color:#E06C75;">(</span><span style="color:#E5C07B;">HttpStatus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">CREATED</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> add</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">RequestBody</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Person</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">person</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="拦截器-interceptor" tabindex="-1">拦截器（Interceptor） <a class="header-anchor" href="#拦截器-interceptor" aria-hidden="true">#</a></h3><ol><li>自定义拦截器：自定义一个类实现 Hanlderlnterceptor 接口或者继承 HandlerlnterceptorAdapter 抽象类，重写 preHandle 方法（在请求发生前执行），或重写 postHandle 方法（在请求完成后执行）</li></ol><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">MyInterceptor</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">implements</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">HandlerInterceptor</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">boolean</span><span style="color:#61AFEF;"> preHandle</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">HttpServletRequest</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">request</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">HttpServletResponse</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">response</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">handler</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">throws</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Exception</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;preHandle方法在控制器的处理请求方法调用之前执行&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">        </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> postHandle</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">HttpServletRequest</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">request</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">HttpServletResponse</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">response</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">handler</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">ModelAndView</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">modelAndView</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">throws</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Exception</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;postHandle方法在控制器的处理请求方法调用之后，解析视图之前执行&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">        </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> afterCompletion</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">HttpServletRequest</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">request</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">HttpServletResponse</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">response</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">handler</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Exception</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">ex</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">            </span><span style="color:#C678DD;">throws</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Exception</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;afterCompletion方法在控制器的处理请求方法执行完成后执行，即视图渲染结束之后执行&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>注册拦截器：拦截器的配置XML方式</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">mvc:interceptors</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">mvc:interceptor</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--/** 包括路径及其子路径--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--/admin/* 拦截的是/admin/add等等这种 , /admin/add/user不会被拦截--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--/admin/** 拦截的是/admin/下的所有--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">mvc:mapping</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">path</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;/**&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">&lt;!--bean配置的就是拦截器--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.example.MyInterceptor&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;/</span><span style="color:#E06C75;">mvc:interceptor</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">mvc:interceptors</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>或（Spring boot） 自定义一个配置类实现 WebMvcConfigurer 接口，在配置类中配置该拦截器的 Bean，重写 addInterceptors 方法</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Slf4j</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Configuration</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">MyConfig</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">implements</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">WebMvcConfigurer</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">......</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> addInterceptors</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">InterceptorRegistry</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">registry</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;注册拦截器&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">//拦截所有请求，包括静态资源文件</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">registry</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">addInterceptor</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">MyInterceptor</span><span style="color:#ABB2BF;">()).</span><span style="color:#61AFEF;">addPathPatterns</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/**&quot;</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">//放行登录页，登陆操作，静态资源</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">excludePathPatterns</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;/login&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;/index.html&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;/user/login&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;/css/**&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;/images/**&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;/js/**&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;/fonts/**&quot;</span><span style="color:#ABB2BF;">); </span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="控制器通知-controller-advice" tabindex="-1">控制器通知 Controller Advice <a class="header-anchor" href="#控制器通知-controller-advice" aria-hidden="true">#</a></h3><p><code>@ControllerAdvice</code> 或 <code>@RestControllerAdvice</code> 定义统一的处理类，用来拦截 Controller 的方法</p><h4 id="统一异常处理" tabindex="-1">统一异常处理 <a class="header-anchor" href="#统一异常处理" aria-hidden="true">#</a></h4><ul><li><code>@ExceptionHandler(value = Exception.class)</code> 指定该方法处理的异常类型</li><li><code>@ResponseStatus(HttpStatus.xxx)</code> 指定该方法返回的状态码</li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Slf4j</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">RestControllerAdvice</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">GlobalExceptionHandler</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">ExceptionHandler</span><span style="color:#E06C75;">(</span><span style="color:#E5C07B;">Exception</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">ResponseEntity</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> handlerGeneralException</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Exception</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">exception</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Occur exception {}&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">exception</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMessage</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ResponseEntity</span><span style="color:#ABB2BF;">&lt;&gt;(</span><span style="color:#E5C07B;">exception</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMessage</span><span style="color:#ABB2BF;">(), </span><span style="color:#E5C07B;">HttpStatus</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">BAD_REQUEST</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="请求前后增强处理" tabindex="-1">请求前后增强处理 <a class="header-anchor" href="#请求前后增强处理" aria-hidden="true">#</a></h4><p><strong>RequestBodyAdvice</strong>：用于对带有 <code>@RequestBody</code>注解的 Controller 方法，在读取请求 body 之前或者在 body 转换成对象之前做相应的增强（如消息体解密、日志记录）</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Slf4j</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">ControllerAdvice</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">LogRequestBodyAdvice</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">implements</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">RequestBodyAdvice</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">boolean</span><span style="color:#61AFEF;"> supports</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">MethodParameter</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">methodParameter</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Type</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">type</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Class</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">extends</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">HttpMessageConverter</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">&gt;&gt; </span><span style="color:#E06C75;font-style:italic;">aClass</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">HttpInputMessage</span><span style="color:#61AFEF;"> beforeBodyRead</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">HttpInputMessage</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">httpInputMessage</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">MethodParameter</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">methodParameter</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Type</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">type</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Class</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">extends</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">HttpMessageConverter</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">&gt;&gt; </span><span style="color:#E06C75;font-style:italic;">aClass</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">throws</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">IOException</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> httpInputMessage;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Object</span><span style="color:#61AFEF;"> afterBodyRead</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">body</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">HttpInputMessage</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">httpInputMessage</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">MethodParameter</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">methodParameter</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Type</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">type</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Class</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">extends</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">HttpMessageConverter</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">&gt;&gt; </span><span style="color:#E06C75;font-style:italic;">aClass</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">Method</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">method</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">methodParameter</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMethod</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;{}.{}:{}&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">method</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getDeclaringClass</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">getSimpleName</span><span style="color:#ABB2BF;">(), </span><span style="color:#E5C07B;">method</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getName</span><span style="color:#ABB2BF;">(), </span><span style="color:#E5C07B;">JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toJSONString</span><span style="color:#ABB2BF;">(body));</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> body;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Object</span><span style="color:#61AFEF;"> handleEmptyBody</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">body</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">HttpInputMessage</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">httpInputMessage</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">MethodParameter</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">methodParameter</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Type</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">type</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Class</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">extends</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">HttpMessageConverter</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">&gt;&gt; </span><span style="color:#E06C75;font-style:italic;">aClass</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">Method</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">method</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">methodParameter</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMethod</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;{}.{}&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">method</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getDeclaringClass</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">getSimpleName</span><span style="color:#ABB2BF;">(), </span><span style="color:#E5C07B;">method</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getName</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> body;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><strong>ResponseBodyAdvice</strong>：对使用 <code>@ResponseBody</code> 修饰的 Controller 方法，在响应体写出之前做相应的增强</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Slf4j</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">ControllerAdvice</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">LogResponseBodyAdvice</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">implements</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ResponseBodyAdvice</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">boolean</span><span style="color:#61AFEF;"> supports</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">MethodParameter</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">methodParameter</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Class</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">aClass</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Object</span><span style="color:#61AFEF;"> beforeBodyWrite</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">body</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">MethodParameter</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">methodParameter</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">MediaType</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">mediaType</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Class</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">aClass</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">ServerHttpRequest</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">serverHttpRequest</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">ServerHttpResponse</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">serverHttpResponse</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">Method</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">method</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">methodParameter</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMethod</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">url</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">serverHttpRequest</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getURI</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">toASCIIString</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;{}.{}, url={}, result={}&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">method</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getDeclaringClass</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">getSimpleName</span><span style="color:#ABB2BF;">(), </span><span style="color:#E5C07B;">method</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getName</span><span style="color:#ABB2BF;">(), url, </span><span style="color:#E5C07B;">JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toJSONString</span><span style="color:#ABB2BF;">(body));</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> body;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="文件上传" tabindex="-1">文件上传 <a class="header-anchor" href="#文件上传" aria-hidden="true">#</a></h3><p>需导入文件上传的jar包，commons-fileupload <br> 配置bean：multipartResolver</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;multipartResolver&quot;</span><span style="color:#ABB2BF;">  </span><span style="color:#D19A66;">class</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#7F848E;font-style:italic;">&lt;!-- 请求的编码格式，默认为ISO-8859-1 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">   &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;defaultEncoding&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;utf-8&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#7F848E;font-style:italic;">&lt;!-- 上传文件大小上限，单位为字节（10485760=10M） --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">   &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;maxUploadSize&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;10485760&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">   &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;maxInMemorySize&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;40960&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">bean</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">RestController</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">UpLoadController</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">//@RequestParam(&quot;file&quot;) 将name=file控件得到的文件封装成CommonsMultipartFile 对象</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">PostMapping</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;/upload&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">String</span><span style="color:#61AFEF;"> upload</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">RequestParam</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;file&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#E5C07B;">MultipartFile</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">file</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">HttpServletRequest</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">request</span><span style="color:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">filePath</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">getPath</span><span style="color:#ABB2BF;">(request);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">saveFile</span><span style="color:#ABB2BF;">(file, filePath);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">PostMapping</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;/multiUpload&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">String</span><span style="color:#61AFEF;"> multiUpload</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">RequestParam</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;file&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#E5C07B;">MultipartFile</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">files</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">HttpServletRequest</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">request</span><span style="color:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">filePath</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">getPath</span><span style="color:#ABB2BF;">(request);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">MultipartFile</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">f</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> files){</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#61AFEF;">saveFile</span><span style="color:#ABB2BF;">(f, filePath);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;ok&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">String</span><span style="color:#61AFEF;"> getPath</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">HttpServletRequest</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">request</span><span style="color:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">request</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getServletContext</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">getRealPath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/upload&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">String</span><span style="color:#61AFEF;"> saveFile</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">MultipartFile</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">file</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">filePath</span><span style="color:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isEmpty</span><span style="color:#ABB2BF;">()){</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;未选择文件&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">filename</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getOriginalFilename</span><span style="color:#ABB2BF;">(); </span><span style="color:#7F848E;font-style:italic;">//获取上传文件原来的名称</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">File</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">temp</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">File</span><span style="color:#ABB2BF;">(filePath);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> (</span><span style="color:#56B6C2;">!</span><span style="color:#E5C07B;">temp</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">exists</span><span style="color:#ABB2BF;">()){</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">temp</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">mkdirs</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">File</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">localFile</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">File</span><span style="color:#ABB2BF;">(filePath</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">filename);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">try</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">transferTo</span><span style="color:#ABB2BF;">(localFile); </span><span style="color:#7F848E;font-style:italic;">//把上传的文件保存至本地</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getOriginalFilename</span><span style="color:#ABB2BF;">()</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&quot; 上传成功&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">IOException</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">e</span><span style="color:#ABB2BF;">){</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">e</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;上传失败&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;ok&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="文件下载" tabindex="-1">文件下载 <a class="header-anchor" href="#文件下载" aria-hidden="true">#</a></h3><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">RequestMapping</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;/download&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> </span><span style="color:#61AFEF;">downloads</span><span style="color:#E06C75;">(</span><span style="color:#E5C07B;">HttpServletResponse</span><span style="color:#E06C75;"> response </span><span style="color:#ABB2BF;">,</span><span style="color:#E5C07B;">HttpServletRequest</span><span style="color:#E06C75;"> request) throws Exception{</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#7F848E;font-style:italic;">// 下载的地址</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;">  path </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">request</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getServletContext</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">getRealPath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/upload&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;">  fileName </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;image.jpg&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#7F848E;font-style:italic;">//1、设置response 响应头</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">reset</span><span style="color:#ABB2BF;">();</span><span style="color:#E06C75;"> </span><span style="color:#7F848E;font-style:italic;">//设置页面不缓存,清空buffer</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setCharacterEncoding</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;">);</span><span style="color:#E06C75;"> </span><span style="color:#7F848E;font-style:italic;">//字符编码</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setContentType</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;multipart/form-data&quot;</span><span style="color:#ABB2BF;">);</span><span style="color:#E06C75;"> </span><span style="color:#7F848E;font-style:italic;">//二进制传输数据</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#7F848E;font-style:italic;">//设置响应头</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setHeader</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Content-Disposition&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">           </span><span style="color:#98C379;">&quot;attachment;fileName=&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">URLEncoder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">(fileName, </span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#E5C07B;">File</span><span style="color:#E06C75;"> file </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">new</span><span style="color:#E06C75;"> </span><span style="color:#61AFEF;">File</span><span style="color:#E06C75;">(path</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">fileName)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#7F848E;font-style:italic;">//2、 读取文件--输入流</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#E5C07B;">InputStream</span><span style="color:#E06C75;"> input</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">new</span><span style="color:#E06C75;"> </span><span style="color:#61AFEF;">FileInputStream</span><span style="color:#E06C75;">(file)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#7F848E;font-style:italic;">//3、 写出文件--输出流</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#E5C07B;">OutputStream</span><span style="color:#E06C75;"> out </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getOutputStream</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#C678DD;">byte</span><span style="color:#E06C75;">[] buff </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">new</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">byte</span><span style="color:#E06C75;">[</span><span style="color:#D19A66;">1024</span><span style="color:#E06C75;">]</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#C678DD;">int</span><span style="color:#E06C75;"> index</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#7F848E;font-style:italic;">//4、执行 写出操作</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#C678DD;">while</span><span style="color:#E06C75;">((index</span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">input</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">(buff)</span><span style="color:#E06C75;">)</span><span style="color:#56B6C2;">!=</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#E06C75;">){</span></span>
<span class="line"><span style="color:#E06C75;">       </span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(buff, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, index);</span></span>
<span class="line"><span style="color:#E06C75;">       </span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">flush</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;">   }</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#E5C07B;">input</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;">   </span><span style="color:#C678DD;">return</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">null</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="web-reactive" tabindex="-1"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#spring-webflux" target="_blank" rel="noreferrer">Web Reactive</a> <a class="header-anchor" href="#web-reactive" aria-hidden="true">#</a></h2><h3 id="webclient" tabindex="-1"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-client" target="_blank" rel="noreferrer">WebClient</a> <a class="header-anchor" href="#webclient" aria-hidden="true">#</a></h3><h2 id="spring-boot" tabindex="-1"><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/" target="_blank" rel="noreferrer">Spring Boot</a> <a class="header-anchor" href="#spring-boot" aria-hidden="true">#</a></h2><p>依赖配置</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;?</span><span style="color:#E06C75;">xml</span><span style="color:#D19A66;"> version</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;1.0&quot;</span><span style="color:#D19A66;"> encoding</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">project</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">xmlns</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">xmlns:xsi</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">xsi:schemaLocation</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">modelVersion</span><span style="color:#ABB2BF;">&gt;4.0.0&lt;/</span><span style="color:#E06C75;">modelVersion</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;com.yiibai&lt;/</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;demo&lt;/</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">&gt;0.0.1-SNAPSHOT&lt;/</span><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">packaging</span><span style="color:#ABB2BF;">&gt;jar&lt;/</span><span style="color:#E06C75;">packaging</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">&gt;demo&lt;/</span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">description</span><span style="color:#ABB2BF;">&gt;Demo project for Spring Boot&lt;/</span><span style="color:#E06C75;">description</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">parent</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;spring-boot-starter-parent&lt;/</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">&gt;2.2.6.RELEASE&lt;/</span><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">relativePath</span><span style="color:#ABB2BF;">/&gt; </span><span style="color:#7F848E;font-style:italic;">&lt;!-- lookup parent from repository --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">parent</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">properties</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">project.build.sourceEncoding</span><span style="color:#ABB2BF;">&gt;UTF-8&lt;/</span><span style="color:#E06C75;">project.build.sourceEncoding</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">project.reporting.outputEncoding</span><span style="color:#ABB2BF;">&gt;UTF-8&lt;/</span><span style="color:#E06C75;">project.reporting.outputEncoding</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">java.version</span><span style="color:#ABB2BF;">&gt;1.8&lt;/</span><span style="color:#E06C75;">java.version</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">properties</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">dependencies</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">dependency</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;spring-boot-starter&lt;/</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;/</span><span style="color:#E06C75;">dependency</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">dependency</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;spring-boot-starter-test&lt;/</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">scope</span><span style="color:#ABB2BF;">&gt;test&lt;/</span><span style="color:#E06C75;">scope</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;/</span><span style="color:#E06C75;">dependency</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">dependencies</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">build</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">plugins</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">plugin</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">                &lt;</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">                &lt;</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;spring-boot-maven-plugin&lt;/</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;/</span><span style="color:#E06C75;">plugin</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;/</span><span style="color:#E06C75;">plugins</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">build</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">project</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>启动类</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">SpringBootApplication</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">RestController</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">DemoApplication</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">static</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">SpringApplication</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">DemoApplication</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">, args);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">RequestMapping</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">value</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;/&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">String</span><span style="color:#61AFEF;"> hello</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;Hello World&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>@SpringBootApplication：修饰启动类，组合了以下注解：</p><ul><li>@Configuration：用于声明当前类是一个配置类</li><li>@EnableAutoConfiguration：让 Spring Boot 根据类路径中的 jar 包依赖为当前项目进行自动配置，可以通过使用 exclude 属性关闭特定的自动配置</li><li>@ComponentScan：组件扫描，可自动发现和装配 Bean</li></ul><p>定制 Banner</p><ul><li>关闭 banner：spring.main.banner-mode=off</li><li>自定义 Banner，banner.txt 或 banner.gif(jpg or png can also be used)</li></ul><h3 id="starter-启动器" tabindex="-1">starter（启动器） <a class="header-anchor" href="#starter-启动器" aria-hidden="true">#</a></h3><p>starter 中整合了该场景下各种可能用到的依赖，只需要在 Maven 中引入 starter 依赖，SpringBoot 就能自动扫描到要加载的信息并启动相应的默认配置。starter 提供了大量的自动配置。</p><ul><li>spring-boot-starter：核心 starter，包含自动配置、日志和 YAML 配置文件的支持</li><li>spring-boot-starter-web：用于使用 Spring MVC 构建 web 应用，包括 RESTful（默认的内嵌容器是 Tomcat）</li><li>spring-boot-starter-validation：Starter for using Java Bean Validation with Hibernate Validator</li><li>spring-boot-starter-test：用于测试 Spring Boot 应用，支持常用测试类库，包括 JUnit, Hamcrest 和 Mockito</li><li>spring-boot-starter-cache：用于使用 Spring 框架的缓存支持</li><li>spring-boot-starter-aop：用于使用 Spring AOP 和 AspectJ 实现面向切面编程</li></ul><p>spring-boot-starter-parent 是所有 Spring Boot 项目的父级依赖，称为 Spring Boot 的版本仲裁中心，可以对项目内的部分常用依赖进行统一管理。</p><h3 id="注解-1" tabindex="-1">注解 <a class="header-anchor" href="#注解-1" aria-hidden="true">#</a></h3><p>配置类</p><ul><li>@Configuration：用于声明当前类是一个配置类</li><li>@Import：修饰配置类，用于向当前配置类中导入其它配置类，以及 ImportSelector、 DeferredImportSelector 或 ImportBeanDefinitionRegistrar 的实现类</li><li>@ImportResource：修饰配置类，用于导入指定的 XML 配置文件</li><li>@PropertySource：修饰配置类，用于加载指定的资源配置文件</li><li>@PropertySources：修饰配置类，用于同时加载多个的资源配置文件</li><li>@ComponentScan：修饰配置类，相当于 <code>&lt;context:component-scan base-package=&quot;...&quot;/&gt;</code>，默认扫描当前包以及子包下所有使用 @Service @Components @Repository @Controller 的类，并注册为 Bean。属性：basePackages、lazyInit</li><li>@ConfigurationProperties：修饰配置类或其内部的 @Bean 方法，用于将<strong>配置文件</strong>的某类名下所有的参数值赋给配置类的属性</li><li>@Profile：修饰配置类或方法，设定当前 context 需要使用的配置环境，可达到在不同情况下选择实例化不同的 Bean</li><li>@AutoConfigureAfter：在指定的配置类初始化后再加载</li><li>@AutoConfigureBefore：在指定的配置类初始化前加载</li><li>@AutoConfigureOrder：数越小越先初始化</li></ul><p>属性注解</p><ul><li><p>@Value：修饰属性、方法或构造器函数，通过使用属性占位符从资源配置文件中加载一个参数值</p></li><li><p>@Bean：修饰方法，将该方法的返回值定义成容器中的一个 Bean</p></li><li><p>@Scope：修饰属性或方法，指定该方法对应的 Bean 的生命域</p></li><li><p>@Lazy：修饰属性、方法或 Bean 类，指定该属性延迟到调用此属性时才注入属性值，或该方法对应的 Bean 延迟初始化（可用来解决循环依赖）</p></li><li><p>@DependsOn：修饰方法，指定在初始化该方法对应的 Bean 之前初始化指定的 Bean</p></li><li><p>@Conditional：满足某个特定的条件才创建该一个特定的 Bean，其属性 value 的类型是 <code>Class&lt;? extends Condition&gt;[]</code></p></li><li><p>@Scheduled：修饰方法，用于声明该方法是一个计划任务</p></li><li><p>@EnableTransactionManagement：开启注解式事务的支持，Spring 容器会自动扫描注解</p></li><li><p>@EnableScheduling：开启计划任务的支持，再在执行计划任务的 Bean 的方法上使用 @Scheduled 声明这是一个计划任务</p></li><li><p>@EnableAsync：开启对异步任务的支持，再通过在实际执行的 Bean 的方法中使用 @Async 注解来声明其是一个异步任务</p><ul><li>实现是基于AOP，方法要从类的外部调用（即走代理类）</li><li>注解的方法必须是public，返回值只能为void或者Future</li></ul></li></ul><p>条件注解</p><ul><li>@Conditional</li><li>@ConditionalOnBean：当容器里有指定的 Bean 的条件下</li><li>@ConditionalOnMissingBean：当容器里没有指定 Bean 的情况下</li><li>@ConditionalOnClass：当类路径下有指定的类的条件下</li><li>@ConditionalOnMissingClass：当类路径下没有指定的类的条件下</li><li>@ConditionalOnProperty：基于属性作为判断条件</li><li>@ConditionalOnResource</li><li>@ConditionalOnExpression：基于 SpEL 表达式作为判断条件</li><li>@ConditionalOnWebApplication：当前项目是 Web 项目的条件下</li><li>@ConditionalOnNotWebApplication：当前项目不是 Web 项目的条件下</li></ul><h3 id="common-application-properties" tabindex="-1"><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html" target="_blank" rel="noreferrer">Common Application Properties</a> <a class="header-anchor" href="#common-application-properties" aria-hidden="true">#</a></h3><ul><li>可以使用 properties 文件、YAML 文件、环境变量和命令行参数来外部化配置</li><li>属性会以如下的顺序进行设值（即后面读取的<strong>不覆盖</strong>前面读取到的）： <ol><li>命令行参数：如<code> --server.port=9000</code>，转化成一个 property，并将其添加到 Spring Environment 中</li><li>Java 系统属性 System.getProperties()</li><li>操作系统环境变量</li><li>jar 包外部的 Profile-specific 应用属性（application-{profile}.properties 或 YAML 文件）</li><li>jar 包内部的 Profile-specific 应用属性（application-{profile}.properties 或 YAML 文件）</li><li>jar 包外部的应用配置（application.properties 或 YAML 文件）</li><li>jar 包内部的应用配置（application.properties 或 YAML 文件）</li><li>@Configuration 类上的 @PropertySource 注解</li><li>使用 SpringApplication.setDefaultProperties 指定的默认属性</li></ol></li></ul><h4 id="properties-文件配置参数" tabindex="-1"><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html#boot-features-external-config-application-property-files" target="_blank" rel="noreferrer">properties 文件配置参数</a> <a class="header-anchor" href="#properties-文件配置参数" aria-hidden="true">#</a></h4><ol><li>项目根目录下的 /config 子目录 <code>file:config/</code></li><li>项目根目录 <code>file:</code></li><li>项目 classpath 下的 /config 包<code>classpath:/config</code></li><li>项目 classpath 根路径 <code>classpath:</code></li></ol><ul><li>指定其它的配置文件名：<code>spring.config.name</code></li><li>指定配置文件的加载路径（目录位置或文件路径列表以逗号分割，目录应以 / 结尾）：<code>spring.config.location</code></li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E5C07B;">ConfigurableApplicationContext</span><span style="color:#E06C75;"> context </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">new</span><span style="color:#E06C75;"> </span><span style="color:#61AFEF;">SpringApplicationBuilder</span><span style="color:#E06C75;">(</span><span style="color:#E5C07B;">TestDefaultFile</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#E06C75;">)</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">properties</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;spring.config.location=classpath:/test-folder/my-config.properties&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(args);</span><span style="color:#E06C75;"> </span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,164),B=s("ul",null,[s("li",{"port:8080":""},[n("在 properties 文件中可以使用 "),s("code",null,"${属性名:默认值}"),n(" 引用对应属性的值（当在 properties 文件中找不到引用的属性时默认使用的属性），如 port=9090、server.port=$")]),s("li",null,[n("通过 "),s("code",null,"@..@"),n(" 占位符引用 Maven 项目的属性，通过"),s("code",null,"${..}"),n("占位符引用 Gradle 项目的属性")])],-1),y=a(`<p>全注解的方式加载 Spring 配置</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">* @Configuration 注解用于定义一个配置类，相当于 Spring 的配置文件</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">* 配置类中包含一个或多个被 @Bean 注解的方法，该方法相当于 Spring 配置文件中的 &lt;bean&gt; 标签定义的组件。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">*/</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Configuration</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">MyAppConfig</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">     * 与 &lt;bean id=&quot;personService&quot; class=&quot;PersonServiceImpl&quot;&gt;&lt;/bean&gt; 等价</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">     * 该方法返回值以组件的形式添加到容器中</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">     * 方法名是组件 id（相当于 &lt;bean&gt; 标签的属性 id)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Bean</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">PersonService</span><span style="color:#61AFEF;"> personService</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;在容器中添加了一个组件:peronService&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">PersonServiceImpl</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="属性绑定" tabindex="-1">属性绑定 <a class="header-anchor" href="#属性绑定" aria-hidden="true">#</a></h4><p>把配置文件中的值与 JavaBean 中对应的属性进行绑定</p><ul><li><code>@ConfigurationProperties</code>：标注在 JavaBean 的<strong>类名</strong>上，将 properties 属性和一个 Bean 及其属性关联，<strong>松散绑定</strong></li><li><code>@Value(&quot;\${app.name}&quot;)</code>：标注在 JavaBean 的<strong>属性</strong>上，直接将<strong>非静态属性</strong>值注入到 <strong>Bean</strong> 中</li><li><code>@PropertySource</code>** ：**加载指定的配置文件</li></ul><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">person</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">ming</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">age</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\${random.int}</span><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># 随机int</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">is-lived</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">birth</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2000-01-01</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">info</span><span style="color:#ABB2BF;">: {</span><span style="color:#E06C75;">sex</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">man</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">profession</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">programmer</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">hobbies</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    - </span><span style="color:#98C379;">code</span></span>
<span class="line"><span style="color:#ABB2BF;">    - </span><span style="color:#98C379;">music</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">pet</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">species</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">dog</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\${person.name:other}_旺财</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Component</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Data</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">ConfigurationProperties</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">prefix</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;person&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Person</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> name</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Integer</span><span style="color:#E06C75;"> age</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Boolean</span><span style="color:#E06C75;"> isLived</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">DateTimeFormat</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">pattern</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;yyyy-MM-dd&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Date</span><span style="color:#E06C75;"> birth</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Map</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">,</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> info</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> hobbies</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Pet</span><span style="color:#E06C75;"> pet</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Data</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">static</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Pet</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> name</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> species</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="静态资源配置" tabindex="-1">静态资源配置 <a class="header-anchor" href="#静态资源配置" aria-hidden="true">#</a></h3><ul><li>webjars <ul><li>WebMvcConfigurer#addResourceHandlers</li><li>把静态资源打成 jar 包，Spring Boot 会自动加载 /webjars/** 下的所有 jar 包中的静态资源</li></ul></li><li>默认静态资源路径 <ol><li>classpath:/META-INF/resources/</li><li>classpath:/resources/</li><li>classpath:/static/</li><li>classpath:/public/</li></ol></li><li>自定义静态资源<strong>加载路径</strong>：spring.resources.staticLocations</li><li>自定义静态资源<strong>映射</strong>：spring.mvc.static-path-pattern，默认值为/**（表示所有的访问都经过静态资源路径）</li></ul><h3 id="web-开发" tabindex="-1">Web 开发 <a class="header-anchor" href="#web-开发" aria-hidden="true">#</a></h3><p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config" target="_blank" rel="noreferrer">定制 MVC 配置</a>（如拦截器、格式化处理器、视图控制器等）：自定义一个配置类实现 WebMvcConfigurer 接口</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Configuration</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">WebConfig</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">implements</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">WebMvcConfigurer</span><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> addInterceptors</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">InterceptorRegistry</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">registry</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">registry</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">addInterceptor</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">XxxInterceptor</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> addCorsMappings</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">CorsRegistry</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">registry</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">registry</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">addMapping</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/api/**&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">allowedOrigins</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;http://domain2.com&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">allowedMethods</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;PUT&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;DELETE&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">allowedHeaders</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;header1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;header2&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;header3&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">exposedHeaders</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;header1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;header2&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">allowCredentials</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">maxAge</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3600</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> configureMessageConverters</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">HttpMessageConverter</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">&gt;&gt; </span><span style="color:#E06C75;font-style:italic;">converters</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> addFormatters</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">FormatterRegistry</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">registry</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Validator</span><span style="color:#61AFEF;"> getValidator</span><span style="color:#ABB2BF;">();</span><span style="color:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E06C75;">        </span><span style="color:#C678DD;">return</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">null</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="bean-validation" tabindex="-1">Bean Validation <a class="header-anchor" href="#bean-validation" aria-hidden="true">#</a></h3><p>Java Specification Requests：Java 规范提案，指向JCP(Java Community Process)提出新增一个标准化技术规范的正式请求</p><p>JSR-303 是JAVA EE 6 中的一项子规范，叫做Bean Validation。 <br> <a href="https://hibernate.org/validator/" target="_blank" rel="noreferrer">Hibernate Validator</a> 提供了 JSR 303 规范中所有内置 constraint 的实现，除此之外还有一些附加的 constraint。</p><p><strong>spring-boot-starter-validation</strong></p><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>@Null</td><td>被标注的元素必须为 null</td></tr><tr><td>@NotNull</td><td>被标注的元素必须不为 null</td></tr><tr><td>@AssertTrue</td><td>被标注的元素必须为 true</td></tr><tr><td>@AssertFalse</td><td>被标注的元素必须为 false</td></tr><tr><td>@Min(value)</td><td>一个数字，其值必须大于等于指定的最小值</td></tr><tr><td>@Max(value)</td><td>一个数字，其值必须小于等于指定的最大值</td></tr><tr><td>@DecimalMax(value)</td><td>一个数字，其值必须小于等于指定的最大值</td></tr><tr><td>@DecimalMin(value)</td><td>一个数字，其值必须大于等于指定的最小值</td></tr><tr><td>@Size</td><td>被标注的元素的大小必须在指定的范围内</td></tr><tr><td>@Digits（integer，fraction）</td><td>一个数字，其值必须在可接受的范围内；integer 指定整数精度，fraction 指定小数精度</td></tr><tr><td>@Past</td><td>一个过去的日期</td></tr><tr><td>@Future</td><td>一个将来的日期</td></tr><tr><td>@Pattern(value)</td><td>被标注的元素必须符合指定的正则表达式</td></tr></tbody></table><table><thead><tr><th>@Email</th><th>字符串，邮箱格式</th></tr></thead><tbody><tr><td>@NotEmpty</td><td>集合，不为空</td></tr><tr><td>@NotBlank</td><td>字符串，不为空字符串</td></tr><tr><td>@Positive</td><td>数字，正数</td></tr><tr><td>@PositiveOrZero</td><td>数字，正数或0</td></tr><tr><td>@Negative</td><td>数字，负数</td></tr><tr><td>@NegativeOrZero</td><td>数字，负数或0</td></tr><tr><td>@PastOrPresent</td><td>过去或者现在</td></tr></tbody></table><ul><li><code>@Valid</code> 嵌套校验</li><li><code>@Validated</code> 分组校验</li><li>自定义注解校验</li></ul><h3 id="i18n" tabindex="-1">I18n <a class="header-anchor" href="#i18n" aria-hidden="true">#</a></h3><p><strong>步骤</strong> <br> 1 在resources目录下，编写国际化资源文件</p><ul><li><code>&lt;bundleName&gt;.properties</code>：无语言设置时生效</li><li><code>&lt;bundleName&gt;_en_US.properties</code> ：英语时生效</li><li><code>&lt;bundleName&gt;_zh_CN.properties</code>：中文时生效</li></ul><p>2 使用 ResourceBundleMessageSource 管理国际化资源文件</p><blockquote><p>Spring Boot 对 ResourceBundleMessageSource 提供了默认的自动配置。Spring Boot 从容器中获取 MessageSourceProperties 组件，并从中读取国际化资源文件的 basename（文件基本名）、encoding（编码）等信息，将它们封装到 ResourceBundleMessageSource 中。 查看源码，basename默认为“message”，即 Spring Boot 默认会获取类路径下的 message.properties 以及 message_XXX.properties 作为国际化资源文件。</p></blockquote><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">MessageSourceProperties</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> basename </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;messages&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Charset</span><span style="color:#E06C75;"> encoding</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">DurationUnit</span><span style="color:#E06C75;">(</span><span style="color:#E5C07B;">ChronoUnit</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">SECONDS</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Duration</span><span style="color:#E06C75;"> cacheDuration</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">boolean</span><span style="color:#E06C75;"> fallbackToSystemLocale</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">boolean</span><span style="color:#E06C75;"> alwaysUseMessageFormat</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">boolean</span><span style="color:#E06C75;"> useCodeAsDefaultMessage</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> MessageSourceProperties</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">encoding</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">StandardCharsets</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">UTF_8</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">fallbackToSystemLocale</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">alwaysUseMessageFormat</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">useCodeAsDefaultMessage</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">...</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>自定义的国际资源文件的基本名</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># yaml</span></span>
<span class="line"><span style="color:#E06C75;">spring</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># 资源信息</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">messages</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 国际化资源文件路径</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">basename</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">i18n/&lt;bundleName&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#98C379;">spring.messages.basename=i18n/&lt;bundleName&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><br> 3 使用</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">RestController</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">DemoController</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Autowired</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">MessageSource</span><span style="color:#E06C75;"> messageSource</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">GetMapping</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;/i18n&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">String</span><span style="color:#61AFEF;"> demo</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">messageSource</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMessage</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">null</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">LocaleContextHolder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLocale</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>区域信息解析器自动配置</strong></p><blockquote><p>Spring Boot 在 WebMvcAutoConfiguration 中为区域信息解析器（LocaleResolver）进行了自动配置，它会根据请求头中携带的“Accept-Language”参数，获取相应区域信息（Locale）对象。</p></blockquote><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Bean</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">ConditionalOnMissingBean</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">DispatcherServlet</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">LOCALE_RESOLVER_BEAN_NAME</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">SuppressWarnings</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;deprecation&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">LocaleResolver</span><span style="color:#E06C75;"> </span><span style="color:#61AFEF;">localeResolver</span><span style="color:#E06C75;">() {</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> (</span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">webProperties</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLocaleResolver</span><span style="color:#ABB2BF;">()</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">==</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">WebProperties</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">LocaleResolver</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">FIXED</span><span style="color:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E06C75;">        </span><span style="color:#C678DD;">return</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">new</span><span style="color:#E06C75;"> </span><span style="color:#61AFEF;">FixedLocaleResolver</span><span style="color:#E06C75;">(</span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">webProperties</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLocale</span><span style="color:#ABB2BF;">()</span><span style="color:#E06C75;">)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">if</span><span style="color:#E06C75;"> (</span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">mvcProperties</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLocaleResolver</span><span style="color:#ABB2BF;">()</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">==</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">WebMvcProperties</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">LocaleResolver</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">FIXED</span><span style="color:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E06C75;">        </span><span style="color:#C678DD;">return</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">new</span><span style="color:#E06C75;"> </span><span style="color:#61AFEF;">FixedLocaleResolver</span><span style="color:#E06C75;">(</span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">mvcProperties</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLocale</span><span style="color:#ABB2BF;">()</span><span style="color:#E06C75;">)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">AcceptHeaderLocaleResolver</span><span style="color:#E06C75;"> localeResolver </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">new</span><span style="color:#E06C75;"> </span><span style="color:#61AFEF;">AcceptHeaderLocaleResolver</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">Locale</span><span style="color:#E06C75;"> locale </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> (</span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">webProperties</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLocale</span><span style="color:#ABB2BF;">()</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">!=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">null</span><span style="color:#E06C75;">) </span><span style="color:#C678DD;">?</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">webProperties</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLocale</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;">            </span><span style="color:#C678DD;">:</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">mvcProperties</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLocale</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">localeResolver</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setDefaultLocale</span><span style="color:#ABB2BF;">(locale);</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">return</span><span style="color:#E06C75;"> localeResolver</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>自定义区域信息解析器</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Configuration</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">LocaleConfig</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  /**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">   * 默认解析器 其中locale表示默认语言</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">   */</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Bean</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">LocaleResolver</span><span style="color:#61AFEF;"> localeResolver</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">SessionLocaleResolver</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">localeResolver</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">SessionLocaleResolver</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">localeResolver</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setDefaultLocale</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Locale</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">CHINA</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> localeResolver;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 在MvcConfig</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Configuration</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">WebConfig</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">implements</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">WebMvcConfigurer</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  /**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">   * 默认拦截器 其中lang表示切换语言的参数名</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">   */</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> addInterceptors</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">InterceptorRegistry</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">registry</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">LocaleChangeInterceptor</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">localeInterceptor</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">LocaleChangeInterceptor</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">localeInterceptor</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setParamName</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;lang&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">registry</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">addInterceptor</span><span style="color:#ABB2BF;">(localeInterceptor);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="jpa" tabindex="-1"><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/" target="_blank" rel="noreferrer">JPA</a> <a class="header-anchor" href="#jpa" aria-hidden="true">#</a></h2><p>Java Persistence API（Java 持久化 API）：定义了对象关系映射（ORM）以及实体对象持久化的标准接口 <br> Spirng Data JPA 是 Spring 提供的一套简化 JPA 开发的框架，可以理解为对 JPA 规范的再次封装抽象，底层还是使用了 Hibernate 的 JPA 技术实现</p><h3 id="注解-2" tabindex="-1">注解 <a class="header-anchor" href="#注解-2" aria-hidden="true">#</a></h3><p>javax.persistence</p><ul><li><p>实体</p><ul><li>@Entity：表示该类是一个实体类</li><li>@MappedSuperclass</li><li>@Table(name)：指定该类对应数据库中的表名，如果类名和数据库表名符合驼峰及下划线规则，可省略</li><li>@SecondaryTable(name , pkJoinColumns = @PrimaryKeyJoinColumn(name ))</li></ul></li><li><p>主键</p><ul><li>@Id：指定该属性为表的主键</li><li>@IdClass：复合主键</li><li>@GeneratedValue(strategy, generator)：主键生成策略，如 @GeneratedValue(strategy = GenerationType.IDENTITY)，依赖于数据库递增的策略</li><li>@GenericGenerator 自定义主键生成策略 <ul><li>native: 将主键的生成工作交由数据库完成，对于 oracle 采用 Sequence 方式，对于MySQL 和 SQL Server 采用identity（自增主键生成机制）</li><li>uuid: 采用128位的uuid算法生成主键，uuid被编码为一个32位16进制数字的字符串</li><li>assigned: 在插入数据的时候主键由程序处理。等同于JPA中的AUTO</li></ul></li></ul></li><li><p>映射</p><ul><li>@Column(name, nullable, length, insertable, updatable)：定义属性和表的映射关系</li><li>@JoinTable(name)、@JoinColumn(name, referencedColumnName)</li><li>@Enumerated</li><li>@Convert(converter)：指定使用的转换器（自定义转换器实现 <code>AttributeConverter&lt;X,Y&gt;</code>）</li><li>@Version 可用于乐观锁并发更新</li></ul></li><li><p>关系</p><ul><li>@OneToOne、@OneToMany、@ManyToOne、@ManyToMany <ul><li>CascadeType.MERGE 级联更新</li><li>CascadeType.PERSIST 级联保存</li><li>CascadeType.REFRESH 级联刷新</li><li>CascadeType.REMOVE 级联删除</li><li>CascadeType.ALL 级联上述4种操作</li></ul></li><li>@OrderBy 对集合排序</li><li>@NamedEntityGraph(name, attributeNodes = {@NamedAttributeNode()}) 命名实体图</li><li>@EntityGraph(value, type=EntityGraphType.FETCH)</li></ul></li></ul><p>spring-data-commons</p><ul><li><code>@Query</code>：自定义语句查询</li><li><code>@Modifying</code>：自定义语句查询涉及到修改、删除时需要加上此注解</li><li><code>@Transient</code>：属性不被持久化</li><li>@CreatedBy、@CreatedDate、@LastModifiedBy、@LastModifiedDate</li><li>@EntityListeners(AuditingEntityListener.class)</li><li>@NoRepositoryBean</li></ul><p>Hibernate</p><ul><li>org.hibernate.annotations</li><li>@CreationTimestamp、@UpdateTimestamp</li><li>@Type(type、parameters)</li></ul><h3 id="操作数据" tabindex="-1">操作数据 <a class="header-anchor" href="#操作数据" aria-hidden="true">#</a></h3><ul><li>添加依赖 spring-boot-starter-data-jpa</li><li>@EnableJpaRepositories：启用 JPA 编程</li><li>继承 <code>JpaRepository&lt;T, ID&gt;</code></li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">interface</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">CrudRepository</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Repository</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">S</span><span style="color:#61AFEF;"> save</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">S</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">entity</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Iterable</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> saveAll</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Iterable</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">entities</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">Optional</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findById</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">id</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">boolean</span><span style="color:#61AFEF;"> existsById</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">id</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">Iterable</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAll</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">Iterable</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAllById</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Iterable</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">ids</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">long</span><span style="color:#61AFEF;"> count</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> deleteById</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">id</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> delete</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">entity</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> deleteAllById</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Iterable</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">extends</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">ids</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> deleteAll</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Iterable</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">extends</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">entities</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> deleteAll</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">interface</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">PagingAndSortingRepository</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">CrudRepository</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">Iterable</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAll</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Sort</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">sort</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">Page</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAll</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Pageable</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">pageable</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">interface</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">JpaRepository</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">PagingAndSortingRepository</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;">&gt;,</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">QueryByExampleExecutor</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAll</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAll</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Sort</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">var1</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAllById</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Iterable</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">var1</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> saveAll</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Iterable</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">var1</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> flush</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">S</span><span style="color:#61AFEF;"> saveAndFlush</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">S</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">var1</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> deleteInBatch</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Iterable</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">var1</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> deleteAllInBatch</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">T</span><span style="color:#61AFEF;"> getOne</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ID</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">var1</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAll</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Example</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">var1</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAll</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Example</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">S</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">var1</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Sort</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">var2</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 动态查询</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">interface</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">JpaSpecificationExecutor</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">Optional</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findOne</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">Nullable</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Specification</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">spec</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAll</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">Nullable</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Specification</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">spec</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">Page</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAll</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">Nullable</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Specification</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">spec</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Pageable</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">pageable</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findAll</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">Nullable</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Specification</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">spec</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Sort</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">sort</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">long</span><span style="color:#61AFEF;"> count</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">Nullable</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Specification</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">spec</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">boolean</span><span style="color:#61AFEF;"> exists</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Specification</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">T</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;font-style:italic;">spec</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><ul><li>按照一定<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repository-query-keywords" target="_blank" rel="noreferrer">规则</a>命名的方法可以在不写接口实现的情况下完成逻辑（JPA 会根据方法命名生成 SQL）</li></ul><p><a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods" target="_blank" rel="noreferrer">Query Methods</a></p><table><thead><tr><th><strong>Keyword</strong></th><th><strong>Sample</strong></th><th><strong>JPQL snippet</strong></th></tr></thead><tbody><tr><td>Distinct</td><td>findDistinctByLastnameAndFirstname</td><td>select distinct … where x.lastname = ?1 and x.firstname = ?2</td></tr><tr><td>And</td><td>findByLastnameAndFirstname</td><td>… where x.lastname = ?1 and x.firstname = ?2</td></tr><tr><td>Or</td><td>findByLastnameOrFirstname</td><td>… where x.lastname = ?1 or x.firstname = ?2</td></tr><tr><td>Is, Equals</td><td>findByFirstname,findByFirstnameIs,findByFirstnameEquals</td><td>… where x.firstname = ?1</td></tr><tr><td>Between</td><td>findByStartDateBetween</td><td>… where x.startDate between ?1 and ?2</td></tr><tr><td>LessThan</td><td>findByAgeLessThan</td><td>… where x.age &lt; ?1</td></tr><tr><td>LessThanEqual</td><td>findByAgeLessThanEqual</td><td>… where x.age &lt;= ?1</td></tr><tr><td>GreaterThan</td><td>findByAgeGreaterThan</td><td>… where x.age &gt; ?1</td></tr><tr><td>GreaterThanEqual</td><td>findByAgeGreaterThanEqual</td><td>… where x.age &gt;= ?1</td></tr><tr><td>After</td><td>findByStartDateAfter</td><td>… where x.startDate &gt; ?1</td></tr><tr><td>Before</td><td>findByStartDateBefore</td><td>… where x.startDate &lt; ?1</td></tr><tr><td>IsNull, Null</td><td>findByAge(Is)Null</td><td>… where x.age is null</td></tr><tr><td>IsNotNull, NotNull</td><td>findByAge(Is)NotNull</td><td>… where x.age not null</td></tr><tr><td>Like</td><td>findByFirstnameLike</td><td>… where x.firstname like ?1</td></tr><tr><td>NotLike</td><td>findByFirstnameNotLike</td><td>… where x.firstname not like ?1</td></tr><tr><td>StartingWith</td><td>findByFirstnameStartingWith</td><td>… where x.firstname like ?1 (parameter bound with appended %)</td></tr><tr><td>EndingWith</td><td>findByFirstnameEndingWith</td><td>… where x.firstname like ?1 (parameter bound with prepended %)</td></tr><tr><td>Containing</td><td>findByFirstnameContaining</td><td>… where x.firstname like ?1 (parameter bound wrapped in %)</td></tr><tr><td>OrderBy</td><td>findByAgeOrderByLastnameDesc</td><td>… where x.age = ?1 order by x.lastname desc</td></tr><tr><td>Not</td><td>findByLastnameNot</td><td>… where x.lastname <code>&lt;&gt; ?1</code></td></tr><tr><td>In</td><td>findByAgeIn(<code>Collection&lt;Age&gt;</code> ages)</td><td>… where x.age in ?1</td></tr><tr><td>NotIn</td><td>findByAgeNotIn(<code>Collection&lt;Age&gt;</code> ages)</td><td>… where x.age not in ?1</td></tr><tr><td>True</td><td>findByActiveTrue()</td><td>… where x.active = true</td></tr><tr><td>False</td><td>findByActiveFalse()</td><td>… where x.active = false</td></tr><tr><td>IgnoreCase</td><td>findByFirstnameIgnoreCase</td><td>… where UPPER(x.firstname) = UPPER(?1)</td></tr></tbody></table><p><strong>Query subject keywords</strong></p><table><thead><tr><th><strong>Keyword</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>find…By, read…By, <br> get…By, query…By, search…By, stream…By</td><td>General query method returning typically the repository type, a Collection or Streamable subtype or a result wrapper such as Page, GeoResults or any other store-specific result wrapper. Can be used as findBy…, findMyDomainTypeBy… or in combination with additional keywords.</td></tr><tr><td>exists…By</td><td>Exists projection, returning typically a boolean result.</td></tr><tr><td>count…By</td><td>Count projection returning a numeric result.</td></tr><tr><td>delete…By, remove…By</td><td>Delete query method returning either no result (void) or the delete count.</td></tr><tr><td>…First<code>&lt;number&gt;</code>…, …Top<code>&lt;number&gt;</code>…</td><td>Limit the query results to the first <code>&lt;number&gt;</code> of results. This keyword can occur in any place of the subject between find (and the other keywords) and by.</td></tr><tr><td>…Distinct…</td><td>Use a distinct query to return only unique results. Consult the store-specific documentation whether that feature is supported. This keyword can occur in any place of the subject between find (and the other keywords) and by.</td></tr></tbody></table><p><strong>Query return types</strong></p><table><thead><tr><th><strong>Return type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>void</td><td>Denotes no return value.</td></tr><tr><td>Primitives</td><td>Java primitives.</td></tr><tr><td>Wrapper types</td><td>Java wrapper types.</td></tr><tr><td>T</td><td>A unique entity. Expects the query method to return one result at most. If no result is found, null is returned. More than one result triggers an IncorrectResultSizeDataAccessException.</td></tr><tr><td><code>Iterator&lt;T&gt;</code></td><td>An Iterator.</td></tr><tr><td><code>Collection&lt;T&gt;</code></td><td>A Collection.</td></tr><tr><td><code>List&lt;T&gt;</code></td><td>A List.</td></tr><tr><td><code>Optional&lt;T&gt;</code></td><td>A Java 8 or Guava Optional.</td></tr><tr><td><code>Option&lt;T&gt;</code></td><td>Either a Scala or Vavr Option type. Semantically the same behavior as Java 8’s Optional, described earlier.</td></tr><tr><td><code>Stream&lt;T&gt;</code></td><td>A Java 8 Stream.</td></tr><tr><td><code>Streamable&lt;T&gt;</code></td><td>A convenience extension of Iterable that directy exposes methods to stream, map and filter results, concatenate them etc.</td></tr><tr><td>Types that implement Streamable and take a Streamable constructor or factory method argument</td><td>Types that expose a constructor or ….of(…)/….valueOf(…) factory method taking a Streamable as argument.</td></tr><tr><td>Vavr Seq, List, Map, Set</td><td>Vavr collection types. See <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.collections-and-iterables.vavr" target="_blank" rel="noreferrer">Support for Vavr Collections</a> for details.</td></tr><tr><td><code>Future&lt;T&gt;</code></td><td>Expects a method to be annotated with @Async and requires Spring’s asynchronous method execution capability to be enabled.</td></tr><tr><td><code>CompletableFuture&lt;T&gt;</code></td><td>Expects a method to be annotated with @Async and requires Spring’s asynchronous method execution capability to be enabled.</td></tr><tr><td>ListenableFuture</td><td>A org.springframework.util.concurrent.ListenableFuture. Expects a method to be annotated with @Async and requires Spring’s asynchronous method execution capability to be enabled.</td></tr><tr><td><code>Slice&lt;T&gt;</code></td><td>A sized chunk of data with an indication of whether there is more data available. Requires a Pageable method parameter.</td></tr><tr><td><code>Page&lt;T&gt;</code></td><td>A Slice with additional information, such as the total number of results. Requires a Pageable method parameter.</td></tr><tr><td><code>GeoResult&lt;T&gt;</code></td><td>A result entry with additional information, such as the distance to a reference location.</td></tr><tr><td><code>GeoResults&lt;T&gt;</code></td><td>A list of <code>GeoResult&lt;T&gt;</code> with additional information, such as the average distance to a reference location.</td></tr><tr><td><code>GeoPage&lt;T&gt;</code></td><td>A Page with <code>GeoResult&lt;T&gt;</code>, such as the average distance to a reference location.</td></tr></tbody></table><p><strong>示例</strong> <br> 数据库基础配置</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">spring</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">jpa</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">properties</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">hibernate</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">dialect</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">org.hibernate.dialect.MySQLDialect</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">new_generator_mappings</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">format_sql</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">show-sql</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">datasource</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">url</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">jdbc:mysql://localhost:3306/ss?serverTimezone=UTC&amp;useSSL=false&amp;autoReconnect=true&amp;tinyInt1isBit=false&amp;useUnicode=true&amp;characterEncoding=utf8</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">username</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">root</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">123qwe</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#E06C75;">logging</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">level</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">org.hibernate.SQL</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">debug</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">org.hibernate.engine.QueryParameters</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">debug</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">org.hibernate.engine.query.HQLQueryPlan</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">debug</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">org.hibernate.type.descriptor.sql.BasicBinder</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">trace</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>编写一个对应数据库表的实体类</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Entity</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Table</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;books&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Data</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Book</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Id</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">GeneratedValue</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">strategy</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">GenerationType</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">AUTO</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Column</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;book_id&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">int</span><span style="color:#E06C75;"> bookId</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">// 用来跟表的字段做个映射，如果名字相同就不需要写</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Column</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;title&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> title</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Column</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;category&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> category</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">// get、set...</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 对于from后的子查询，需要将select子查询到的虚拟表建立一个实体类映射成一个虚拟视图，再进行关联查询操作</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Entity</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Subselect</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;native sql Query&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Synchronize</span><span style="color:#E06C75;">({</span><span style="color:#98C379;">&quot;table&quot;</span><span style="color:#E06C75;">})</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Temp</span><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">...</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>编写持久层，实现一个类（JpaRepository 或 CrudRepository）</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">interface</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">BookDao</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">CrudRepository</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Book</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Long</span><span style="color:#ABB2BF;">&gt;{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Query</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;select * from Book b where b.title=:title&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">nativeQuery</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">true</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Book</span><span style="color:#61AFEF;"> findBookByTitle</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">Param</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;title&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">title</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Query</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;select * from Book b where b.category=:category&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Page</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Book</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> findBooksByCategory</span><span style="color:#ABB2BF;">(@</span><span style="color:#E5C07B;">Param</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;category&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">category</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Pageable</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">pageable</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>使用</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Autowired</span></span>
<span class="line"><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">UserDao</span><span style="color:#E06C75;"> userDao</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Test</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">void</span><span style="color:#E06C75;"> </span><span style="color:#61AFEF;">getBooksPageable</span><span style="color:#E06C75;">()</span></span>
<span class="line"><span style="color:#E06C75;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">int</span><span style="color:#E06C75;"> pageIndex </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;"> </span><span style="color:#7F848E;font-style:italic;">//当前页码（第一页从0开始）</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">int</span><span style="color:#E06C75;"> pageSize </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;"> </span><span style="color:#7F848E;font-style:italic;">//分页大小</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">//排序</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">Sort</span><span style="color:#E06C75;"> sort </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Sort</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">by</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Sort</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Direction</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ASC</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;title&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">//分页</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">Pageable</span><span style="color:#E06C75;"> pageable </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">PageRequest</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">of</span><span style="color:#ABB2BF;">(pageIndex, pageSize, sort);</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">Page</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Book</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> Books </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">BookDao</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">findBooksByCategory</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;computer&quot;</span><span style="color:#ABB2BF;">, pageable);</span></span>
<span class="line"><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">//数据列表</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Book</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> BookList </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Books</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getContent</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">for</span><span style="color:#E06C75;"> (</span><span style="color:#E5C07B;">Book</span><span style="color:#E06C75;"> book </span><span style="color:#C678DD;">:</span><span style="color:#E06C75;"> BookList){</span></span>
<span class="line"><span style="color:#E06C75;">        </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">book</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E06C75;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">//分页信息</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;当前页码：第&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">Books</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getNumber</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;页&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;分页大小：每页&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Books</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSize</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;条&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;数据总数：共&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Books</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getTotalElements</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;条&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;总页数：共&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Books</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getTotalPages</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;页&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;排序信息：&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Books</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSort</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E06C75;">}   </span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="审计-auditing" tabindex="-1">审计 Auditing <a class="header-anchor" href="#审计-auditing" aria-hidden="true">#</a></h3><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// 实体类</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Entity</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">EntityListeners</span><span style="color:#E06C75;">(</span><span style="color:#E5C07B;">AuditingEntityListener</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Table</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;tb_user&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Data</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">User</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Id</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">GenericGenerator</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;idGenerator&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">strategy</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;uuid&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">GeneratedValue</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">generator</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;idGenerator&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> id</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Column</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;username&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">unique</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">nullable</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">length</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">64</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> username</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Column</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;password&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">nullable</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">length</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">64</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> password</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Column</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;email&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">unique</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">length</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">64</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> email</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">ManyToMany</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">targetEntity</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Role</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">cascade</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">CascadeType</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ALL</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">fetch</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">FetchType</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">LAZY</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">JoinTable</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;tb_user_role&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">joinColumns</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> {</span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">JoinColumn</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;user_id&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">referencedColumnName</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;id&quot;</span><span style="color:#E06C75;">)}</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">            </span><span style="color:#D19A66;">inverseJoinColumns</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> {</span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">JoinColumn</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;role_id&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">referencedColumnName</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;id&quot;</span><span style="color:#E06C75;">)})</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Set</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Role</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> roles</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">CreatedDate</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Column</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;created_date&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">updatable</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">false</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Date</span><span style="color:#E06C75;"> createdDate</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">CreatedBy</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Column</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;created_by&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">updatable</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">length</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">64</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> createdBy</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">LastModifiedDate</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Column</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;updated_date&quot;</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Date</span><span style="color:#E06C75;"> updatedDate</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">LastModifiedBy</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Column</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">name</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;updated_by&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">length</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">64</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> updatedBy</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 实现AuditorAware</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Configuration</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">EnableJpaAuditing</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">JpaAuditingConfiguration</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Bean</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">AuditorAware</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;"> auditorProvider</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">-&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Optional</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">of</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;system&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h2 id="spring-security" tabindex="-1"><a href="https://docs.spring.io/spring-security/reference/index.html" target="_blank" rel="noreferrer">Spring Security</a> <a class="header-anchor" href="#spring-security" aria-hidden="true">#</a></h2><p>默认用户名、密码和权限在 application.yaml 中配置</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">spring</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">security</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">user</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">ming</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">123456</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">roles</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">admin</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Configuration</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">EnableWebSecurity</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 开启注解设置权限</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">EnableGlobalMethodSecurity</span><span style="color:#E06C75;">(</span><span style="color:#D19A66;">prePostEnabled</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#D19A66;">true</span><span style="color:#E06C75;">)</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">WebSecurityConfig</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">WebSecurityConfigurerAdapter</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">// 配置密码加密器</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Bean</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">PasswordEncoder</span><span style="color:#61AFEF;"> passwordEncoder</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">BCryptPasswordEncoder</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">// 配置认证管理器</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">protected</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> configure</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">AuthenticationManagerBuilder</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">auth</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">throws</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Exception</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">auth</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">inMemoryAuthentication</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">withUser</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;admin&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">password</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">passwordEncoder</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;123&quot;</span><span style="color:#ABB2BF;">)).</span><span style="color:#61AFEF;">roles</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;admin&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">and</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">withUser</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;user&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">password</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">passwordEncoder</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;456&quot;</span><span style="color:#ABB2BF;">)).</span><span style="color:#61AFEF;">roles</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;user&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#7F848E;font-style:italic;">// 配置安全策略</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">protected</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> configure</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">HttpSecurity</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">http</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">throws</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Exception</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 配置认证</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">http</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">formLogin</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">// 哪个URL为登录页面</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">loginPage</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">// 当发现什么URL时执行登录逻辑</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">loginProcessingUrl</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/login&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">// 成功后跳转到哪里</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">successForwardUrl</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/success&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">// 失败后跳转到哪里</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">failureForwardUrl</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/fail&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 设置URL的授权问题</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 多个条件取交集</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">http</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">authorizeRequests</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">// 匹配 / 控制器  permitAll() 不需要被认证就可以访问</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">antMatchers</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">permitAll</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#7F848E;font-style:italic;">// anyRequest() 所有请求   authenticated() 必须被认证</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">anyRequest</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">authenticated</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">//开启记住我功能   cookie  默认保存时间14天</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">//自定义接收前端参数，remember为表单中的名字</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">http</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">rememberMe</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">rememberMeParameter</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;remember&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 关闭csrf</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">http</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">csrf</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">disable</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h2 id="spring-cache" tabindex="-1"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache" target="_blank" rel="noreferrer">Spring Cache</a> <a class="header-anchor" href="#spring-cache" aria-hidden="true">#</a></h2><p>spring-boot-starter-cache</p><table><thead><tr><th>名称</th><th>解释</th></tr></thead><tbody><tr><td>Cache</td><td>缓存接口，定义缓存操作。实现有：RedisCache、EhCacheCache、ConcurrentMapCache等</td></tr><tr><td>CacheManager</td><td>缓存管理器，管理各种缓存（cache）组件</td></tr><tr><td>@Cacheable</td><td>主要针对方法配置，能够根据方法的请求参数对其进行缓存</td></tr><tr><td>@CacheEvict</td><td>清空缓存</td></tr><tr><td>@CachePut</td><td>保证方法被调用，又希望结果被缓存。与@Cacheable区别在于是否每次都调用方法，常用于更新</td></tr><tr><td>@Caching</td><td>让一个类或方法上定义多个cache相关的注解</td></tr><tr><td>@EnableCaching</td><td>开启基于注解的缓存</td></tr><tr><td>keyGenerator</td><td>缓存数据时key生成策略</td></tr><tr><td>serialize</td><td>缓存数据时value序列化策略</td></tr><tr><td>@CacheConfig</td><td>统一配置本类的缓存注解的属性</td></tr></tbody></table><p>SpEL上下文数据</p><table><thead><tr><th>名称</th><th>位置</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td>methodName</td><td>root对象</td><td>当前被调用的方法名</td><td>#root.methodname</td></tr><tr><td>method</td><td>root对象</td><td>当前被调用的方法</td><td>#<a href="http://root.method.name" target="_blank" rel="noreferrer">root.method.name</a></td></tr><tr><td>target</td><td>root对象</td><td>当前被调用的目标对象实例</td><td>#root.target</td></tr><tr><td>targetClass</td><td>root对象</td><td>当前被调用的目标对象的类</td><td>#root.targetClass</td></tr><tr><td>args</td><td>root对象</td><td>当前被调用的方法的参数列表</td><td>#root.args[0]</td></tr><tr><td>caches</td><td>root对象</td><td>当前方法调用使用的缓存列表</td><td>#root.caches[0].name</td></tr><tr><td>Argument Name</td><td>执行上下文</td><td>当前被调用的方法的参数，如findArtisan(Artisan artisan)，可以通过#artsian.id获得参数</td><td>#<a href="http://artsian.id" target="_blank" rel="noreferrer">artsian.id</a></td></tr><tr><td>result</td><td>执行上下文</td><td>法执行后的返回值（仅当方法执行后的判断有效，如 unless cacheEvict的beforeInvocation=false）</td><td>#result</td></tr></tbody></table><h2 id="——-orm-——" tabindex="-1">—— ORM —— <a class="header-anchor" href="#——-orm-——" aria-hidden="true">#</a></h2><h3 id="hibernate" tabindex="-1"><a href="http://hibernate.org/orm/" target="_blank" rel="noreferrer">Hibernate</a> <a class="header-anchor" href="#hibernate" aria-hidden="true">#</a></h3><h4 id="hql" tabindex="-1">HQL <a class="header-anchor" href="#hql" aria-hidden="true">#</a></h4><p><a href="https://hibernate.net.cn/docs/72.html" target="_blank" rel="noreferrer">大小写敏感性</a>：除了Java类与属性的名称外，查询语句对大小写并不敏感 <br> <a href="https://hibernate.net.cn/docs/73.html" target="_blank" rel="noreferrer">from子句</a></p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">-- 返回Cat类的所有实例，同时返回其子类的实例</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Cat cat</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">-- 查询结果是产生一个笛卡儿积或产生跨表的连接</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Formula, Parameter</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><a href="https://hibernate.net.cn/docs/74.html" target="_blank" rel="noreferrer">关联(Association)与连接(Join)</a></p><ul><li>inner join（内连接）</li><li>left outer join（左外连接）</li><li>right outer join（右外连接）</li><li>full join (全连接，并不常用)</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">-- with关键字，可以提供额外的join条件</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Cat </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> cat </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">left join</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">cat</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">kittens</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> kitten </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">kitten</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">bodyWeight</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">-- &quot;fetch&quot;连接允许仅仅使用一个选择语句就将相关联的对象或一组值的集合随着他们的父对象的初始化而被初始化</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Cat </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> cat </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">inner join</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">fetch</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">cat</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">mate</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">left join</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">fetch</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">cat</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">kittens</span><span style="color:#ABB2BF;"> child</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">left join</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">fetch</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">child</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">kittens</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><a href="https://hibernate.net.cn/docs/76.html" target="_blank" rel="noreferrer">select子句</a></p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">cat</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> DomesticCat cat</span></span>
<span class="line"><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">cat</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">like</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;fri%&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">-- 存放在一个List对象中</span></span>
<span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> new list(mother, offspr, </span><span style="color:#D19A66;">mate</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> DomesticCat </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> mother</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">inner join</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">mother</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">mate</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> mate</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">left outer join</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">mother</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">kittens</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> offspr</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">-- 假设类Family有一个合适的构造函数，可直接返回一个实际的类型</span></span>
<span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> new Family(mother, mate, offspr)</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> DomesticCat </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> mother</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">join</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">mother</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">mate</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> mate</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">left join</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">mother</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">kittens</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> offspr</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">-- 返回了一个Map的对象</span></span>
<span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> new map( </span><span style="color:#56B6C2;">max</span><span style="color:#ABB2BF;">(bodyWeight) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> max, </span><span style="color:#56B6C2;">min</span><span style="color:#ABB2BF;">(bodyWeight) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> min, </span><span style="color:#56B6C2;">count</span><span style="color:#ABB2BF;">(*) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> n )</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Cat cat</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">-- 条件查询</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Cat cat </span><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">cat</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">mate</span><span style="color:#ABB2BF;">.</span><span style="color:#C678DD;">name</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">is not null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Person </span><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">name</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&#39;Gavin&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;A&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;King&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">-- equal to</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Person </span><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">first</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;Gavin&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">and</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">initial</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;A&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">and</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">last</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;King&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><a href="https://hibernate.net.cn/docs/83.html" target="_blank" rel="noreferrer">子查询</a> <br> HQL自查询只可以在select或者where子句中出现</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Cat </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> fatcat </span></span>
<span class="line"><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">fatcat</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">weight</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> ( </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">avg</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">cat</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">weight</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> DomesticCat cat </span></span>
<span class="line"><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">cat</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">, (</span><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">max</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">kit</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">weight</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">cat</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">kitten</span><span style="color:#ABB2BF;"> kit) </span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> Cat </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> cat</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><a href="https://hibernate.net.cn/docs/86.html" target="_blank" rel="noreferrer"><br></a></p><h3 id="mybatis" tabindex="-1"><a href="https://mybatis.org/mybatis-3/zh/index.html" target="_blank" rel="noreferrer">MyBatis</a> <a class="header-anchor" href="#mybatis" aria-hidden="true">#</a></h3><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">dependency</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;org.mybatis&lt;/</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;mybatis&lt;/</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">&gt;3.5.4&lt;/</span><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">dependency</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;?</span><span style="color:#E06C75;">xml</span><span style="color:#D19A66;"> version</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;1.0&quot;</span><span style="color:#D19A66;"> encoding</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;utf-8&quot;</span><span style="color:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;!</span><span style="color:#C678DD;">DOCTYPE</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">configuration</span><span style="color:#ABB2BF;"> PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">configuration</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 配置 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">properties</span><span style="color:#ABB2BF;"> /&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 属性 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">settings</span><span style="color:#ABB2BF;"> /&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 设置 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">typeAliases</span><span style="color:#ABB2BF;"> /&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 类型命名 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">typeHandlers</span><span style="color:#ABB2BF;"> /&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 类型处理器 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">objectFactory</span><span style="color:#ABB2BF;"> /&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 对象工厂 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">plugins</span><span style="color:#ABB2BF;"> /&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 插件 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">environments</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 配置环境 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">environment</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 环境变量 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">transactionManager</span><span style="color:#ABB2BF;"> /&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 事务管理器 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            &lt;</span><span style="color:#E06C75;">dataSource</span><span style="color:#ABB2BF;"> /&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 数据源 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;/</span><span style="color:#E06C75;">environment</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">environments</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">databaseIdProvider</span><span style="color:#ABB2BF;"> /&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 数据库厂商标识 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">mappers</span><span style="color:#ABB2BF;"> /&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 映射器 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">configuration</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>** 元素的结构**</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">resultMap</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">type</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">constructor</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 类再实例化时用来注入结果到构造方法 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">idArg</span><span style="color:#ABB2BF;">/&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- ID参数，结果为ID --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">arg</span><span style="color:#ABB2BF;">/&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 注入到构造方法的一个普通结果 --&gt;</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">constructor</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">id</span><span style="color:#ABB2BF;">/&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 用于表示哪个列是主键 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">result</span><span style="color:#ABB2BF;">/&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 注入到字段或JavaBean属性的普通结果 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">association</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">property</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">/&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 用于一对一关联 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">collection</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">property</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">/&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 用于一对多、多对多关联 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">discriminator</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">javaType</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 使用结果值来决定使用哪个结果映射 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">case</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">/&gt;</span><span style="color:#7F848E;font-style:italic;">&lt;!-- 基于某些值的结果映射 --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">discriminator</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">resultMap</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>增删查改 <br> mybatis-config.xml</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;?</span><span style="color:#E06C75;">xml</span><span style="color:#D19A66;"> version</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;1.0&quot;</span><span style="color:#D19A66;"> encoding</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;"> ?&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;!</span><span style="color:#C678DD;">DOCTYPE</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">configuration</span></span>
<span class="line"><span style="color:#ABB2BF;">  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">configuration</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">typeAliases</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;</span><span style="color:#E06C75;">typeAlias</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">alias</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;Site&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">type</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;rain.Site&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;/</span><span style="color:#E06C75;">typeAliases</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">environments</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">default</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;development&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">environment</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;development&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">transactionManager</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">type</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;JDBC&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;</span><span style="color:#E06C75;">dataSource</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">type</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;POOLED&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;driver&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;url&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;jdbc:mysql://localhost:3306/web?useSSL=false</span><span style="color:#D19A66;">&amp;</span><span style="color:#E06C75;">amp</span><span style="color:#D19A66;">;</span><span style="color:#98C379;">serverTimezone=GMT&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;username&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;root&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">property</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;password&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">value</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;mysql2020&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">      &lt;/</span><span style="color:#E06C75;">dataSource</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">environment</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;/</span><span style="color:#E06C75;">environments</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">mappers</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">mapper</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">resource</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;rain/SiteMapper.xml&quot;</span><span style="color:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;/</span><span style="color:#E06C75;">mappers</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">configuration</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>SiteMapper.xml</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;?</span><span style="color:#E06C75;">xml</span><span style="color:#D19A66;"> version</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;1.0&quot;</span><span style="color:#D19A66;"> encoding</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;!</span><span style="color:#C678DD;">DOCTYPE</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">mapper</span><span style="color:#ABB2BF;"> PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; </span></span>
<span class="line"><span style="color:#ABB2BF;">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">mapper</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">namespace</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;rain.ISite&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;</span><span style="color:#E06C75;">select</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;getSite&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">parameterType</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;int&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">resultType</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;Site&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">		select *</span></span>
<span class="line"><span style="color:#ABB2BF;">		from \`site\` where id = #{id}</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;/</span><span style="color:#E06C75;">select</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;</span><span style="color:#E06C75;">insert</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;insertSite&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">parameterType</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;Site&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">		INSERT INTO SITE(id,name,url) VALUES(#{id},#{name},#{url})</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;/</span><span style="color:#E06C75;">insert</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;</span><span style="color:#E06C75;">select</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;getSites&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">resultType</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;Site&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">		SELECT * FROM SITE</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;/</span><span style="color:#E06C75;">select</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;</span><span style="color:#E06C75;">update</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;updateSite&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">parameterType</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;Site&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">		update site set name=#{name},url=#{url} where id=#{id}</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;/</span><span style="color:#E06C75;">update</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;</span><span style="color:#E06C75;">delete</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;deleteSite&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">parameterType</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;int&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">		delete from site where id=#{id}</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;/</span><span style="color:#E06C75;">delete</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">mapper</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">interface</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ISite</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> List</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Site</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#61AFEF;">getSites</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> insertSite</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Site</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">s</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> updateSite</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Site</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">s</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> deleteSite</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">id</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Site</span><span style="color:#61AFEF;"> getSite</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">id</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Test</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">static</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">try</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">// 读取配置文件 mybatis-config.xml</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">InputStream</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">config</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Resources</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getResourceAsStream</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;mybatis-config.xml&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">// 根据配置文件构建SqlSessionFactory</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">SqlSessionFactory</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">ssf</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">SqlSessionFactoryBuilder</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">(config);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">// 通过 SqlSessionFactory 创建 SqlSession</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">SqlSession</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">ss</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ssf</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">openSession</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">// SqlSession执行映射文件中定义的SQL，并返回映射结果</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">ISite</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">mapper</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ss</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getMapper</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ISite</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">Site</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">t</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Site</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">99</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;zhihu&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;www.zhihu.com&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">mapper</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">insertSite</span><span style="color:#ABB2BF;">(t);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">t</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setId</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">mapper</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">updateSite</span><span style="color:#ABB2BF;">(t);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">mapper</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">deleteSite</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">//提交事务</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">ss</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">commit</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">r</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">mapper</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSites</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">var</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">:</span><span style="color:#ABB2BF;"> r)</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#E5C07B;">System</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">out</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">println</span><span style="color:#ABB2BF;">(x);</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">// 关闭 SqlSession</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">ss</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        } </span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">IOException</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">e</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">// TODO Auto-generated catch block</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">e</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>动态SQL</p><ul><li>if</li><li>choose (when, otherwise)</li><li>trim (where, set)</li><li>foreach</li></ul><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">select</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">id</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;findActiveBlogWithTitleLike&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">resultType</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;Blog&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  SELECT * FROM BLOG</span></span>
<span class="line"><span style="color:#ABB2BF;">  WHERE state = ‘ACTIVE’</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;</span><span style="color:#E06C75;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">test</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;title != null&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    AND title like #{title}</span></span>
<span class="line"><span style="color:#ABB2BF;">  &lt;/</span><span style="color:#E06C75;">if</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">select</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="druid" tabindex="-1"><a href="https://github.com/alibaba/druid" target="_blank" rel="noreferrer">Druid</a> <a class="header-anchor" href="#druid" aria-hidden="true">#</a></h2><p>数据库连接池，提供强大的监控和扩展功能 <br> web: <a href="http://localhost/demo/druid" target="_blank" rel="noreferrer">http://localhost/druid</a></p><p>druid-spring-boot-starter</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">spring</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">datasource</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">druid</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">db-type</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">com.alibaba.druid.pool.DruidDataSource</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">driverClassName</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">com.mysql.cj.jdbc.Driver</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">url</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">jdbc:mysql://\${DB_HOST:localhost}:\${DB_PORT:3306}/\${DB_NAME:web}?serverTimezone=Asia/Shanghai&amp;characterEncoding=utf8&amp;useSSL=false</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">username</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\${DB_USER:root}</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\${DB_PWD:mysql8}</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 初始连接数</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">initial-size</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">5</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 最小连接数</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">min-idle</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">15</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 最大连接数</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">max-active</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">30</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 超时时间(以秒数为单位)</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">remove-abandoned-timeout</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">180</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 获取连接超时时间</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">max-wait</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3000</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 连接有效性检测时间</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">time-between-eviction-runs-millis</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">60000</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 连接在池中最小生存的时间</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">min-evictable-idle-time-millis</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">300000</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 连接在池中最大生存的时间</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">max-evictable-idle-time-millis</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">900000</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 指明连接是否被空闲连接回收器(如果有)进行检验.如果检测失败,则连接将被从池中去除</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">test-while-idle</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 指明是否在从池中取出连接前进行检验,如果检验失败, 则从池中去除连接并尝试取出另一个</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">test-on-borrow</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 是否在归还到池中前进行检验</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">test-on-return</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 检测连接是否有效</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">validation-query</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">select 1</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># 配置监控统计 WebStatFilter（StatFilter监控器中的Web模板）</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">web-stat-filter</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">enabled</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 开启 WebStatFilter，即开启监控功能中的 Web 监控功能</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">url-pattern</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">/*</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 映射地址，即统计指定地址的web请求</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">exclusions</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 不统计的web请求，如下是不统计静态资源及druid监控页面本身的请求</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">session-stat-enable</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 是否启用session统计</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">session-stat-max-count</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># session统计的最大个数，默认是1000。当统计超过这个数，只统计最新的</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">principal-session-name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">userName</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 所存用户信息的serssion参数名。Druid会依照此参数名读取相应session对应的用户名记录下来（在监控页面可看到）。如果指定参数不是基础数据类型，将会自动调用相应参数对象的toString方法来取值</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">principal-cookie-name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">userName</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 与上类似，但这是通过Cookie名取到用户信息</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">profile-enable</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 监控单个url调用的sql列表</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#7F848E;font-style:italic;"># StatViewServlet监控器。开启后，访问http://域名/druid/index.html</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">stat-view-servlet</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">enabled</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># 监控后台账号和密码</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">login-password</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">admin</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">login-username</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">admin</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">url-pattern</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">/druid/*</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">reset-enable</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">allow</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">127.0.0.1,192.168.1.0/24</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 监控页面访问白名单。默认为127.0.0.1。支持子网掩码</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">deny</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">4.4.4.4</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 监控页面访问黑名单</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">filter</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">stat</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">enabled</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#7F848E;font-style:italic;"># 记录慢SQL</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">log-slow-sql</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">slow-sql-millis</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">1000</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">merge-sql</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">wall</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">enabled</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># 开启SQL防火墙功能</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">config</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">multi-statement-allow</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;">select-allow</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 允许执行Select查询操作</span></span>
<span class="line"><span style="color:#E06C75;">delete-allow</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 不允许执行delete操作</span></span>
<span class="line"><span style="color:#E06C75;">create-table-allow</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 不允许创建表</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p><a href="https://github.com/quartz-scheduler/quartz" target="_blank" rel="noreferrer">Quartz</a></p><ul><li>Scheduler 和调度程序交互的主要API</li><li>Job 调度器调度的任务组件接口</li><li>JobDetail Job实例，包含了该实例的执行计划和所需要的数据</li><li>Trigger 触发器，定义了一个触发策略</li></ul><table><thead><tr><th>触发器</th><th>适用场景</th></tr></thead><tbody><tr><td>SimpleTrigger</td><td>简单触发器，适用于 按指定的时间间隔执行多少次任务的情况</td></tr><tr><td>CronTrigger</td><td>Cron触发器，通过Cron表达式来控制任务的执行时间</td></tr><tr><td>DailyTimeIntervalTrigger</td><td>日期触发器，在给定的时间范围内或指定的星期内以秒、分钟或者小时为周期进行重复的情况</td></tr><tr><td>CalendarIntervalTrigger</td><td>日历触发器，根据一个给定的日历时间进行重复</td></tr></tbody></table><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">QuartzTest</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#E06C75;">	</span><span style="color:#7F848E;font-style:italic;">// 你需要在start和shutdown之间执行你的任务。</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">static</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">try</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">// 从工厂中获取Scheduler示例</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">Scheduler</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">scheduler</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">StdSchedulerFactory</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getDefaultScheduler</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">// 开始</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">scheduler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">// 定义Job，并将其绑定到HelloJob类中</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">JobDetail</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">job</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">JobBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">newJob</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">HelloJob</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">withIdentity</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;job1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;group1&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">// name 和 group</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">usingJobData</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;username&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;snow&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">// 置入JobDataMap</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">usingJobData</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;age&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;20&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">withDescription</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;desc-demo&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">// 触发Job执行，每30s执行一次，直到22：00</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">Trigger</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">trigger</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">TriggerBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">newTrigger</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">withIdentity</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;trigger1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;group1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">startNow</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">// 立即开始</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">withSchedule</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">SimpleScheduleBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">simpleSchedule</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                            .</span><span style="color:#61AFEF;">withIntervalInSeconds</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">30</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                            .</span><span style="color:#61AFEF;">repeatForever</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">endAt</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">dateOf</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">22</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;">// 告诉 quartz 使用trigger来调度job</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">scheduler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">scheduleJob</span><span style="color:#ABB2BF;">(job, trigger);</span></span>
<span class="line"><span style="color:#ABB2BF;">			</span><span style="color:#7F848E;font-style:italic;">// 关闭，线程终止</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">scheduler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">shutdown</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        } </span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">SchedulerException</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">se</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">se</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Slf4j</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">NoArgsConstructor</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">HelloJob</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">implements</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Job</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> execute</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">JobExecutionContext</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">context</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">throws</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">JobExecutionException</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 从context中获取属性</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">JobDetail</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">jobDetail</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">context</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getJobDetail</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">JobKey</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">key</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">jobDetail</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getKey</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">Class</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">extends</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Job</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#E06C75;">jobClass</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">jobDetail</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getJobClass</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">description</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">jobDetail</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getDescription</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">JobDataMap</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">jobDataMap</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">jobDetail</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getJobDataMap</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">username</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">jobDataMap</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getString</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;username&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">age</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">jobDataMap</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getIntValue</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;age&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">JobKey : {},</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;"> JobClass : {},</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;"> JobDesc : {},</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;"> username : {},</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;"> age : {}&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                key, </span><span style="color:#E5C07B;">jobClass</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getName</span><span style="color:#ABB2BF;">(), description, username, age);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p><strong>SpringBoot整合</strong> <br> spring-boot-starter-quartz</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Slf4j</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">DemoJob</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">extends</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">QuartzJobBean</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">protected</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> executeInternal</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">JobExecutionContext</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">jobExecutionContext</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">throws</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">JobExecutionException</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">now</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">DateTimeFormatter</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">ofPattern</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">LocalDateTime</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">now</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">log</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;当前的时间: &quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> now);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>调度器Scheduler绑定</p><ul><li>Bean自动配置</li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Configuration</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">QuartzConfig</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Bean</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">JobDetail</span><span style="color:#61AFEF;"> jobDetail1</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">JobBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">newJob</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">DemoJob</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">withIdentity</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;demo 01&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">withDescription</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;demo job test&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">// 任务描述</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">storeDurably</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">// 每次任务执行后进行存储</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Bean</span></span>
<span class="line"><span style="color:#E06C75;">  </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Trigger</span><span style="color:#61AFEF;"> trigger1</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">// 简单的调度计划的构造器</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">SimpleScheduleBuilder</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">scheduleBuilder</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">SimpleScheduleBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">simpleSchedule</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">withIntervalInSeconds</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">// 频率</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">repeatForever</span><span style="color:#ABB2BF;">(); </span><span style="color:#7F848E;font-style:italic;">// 次数</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">TriggerBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">newTrigger</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">forJob</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">jobDetail1</span><span style="color:#ABB2BF;">()) </span><span style="color:#7F848E;font-style:italic;">// 绑定工作任务</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">withIdentity</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;demo 01 Trigger&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">withSchedule</span><span style="color:#ABB2BF;">(scheduleBuilder)</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ul><li>手动配置</li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Component</span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">class</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">JobInit</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">implements</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">ApplicationRunner</span><span style="color:#E06C75;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">static</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">final</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">String</span><span style="color:#E06C75;"> ID </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> </span><span style="color:#98C379;">&quot;DEMO&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Autowired</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">private</span><span style="color:#E06C75;"> </span><span style="color:#E5C07B;">Scheduler</span><span style="color:#E06C75;"> scheduler</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#ABB2BF;">@</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#E06C75;">    </span><span style="color:#C678DD;">public</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">void</span><span style="color:#61AFEF;"> run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ApplicationArguments</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;"> </span><span style="color:#C678DD;">throws</span><span style="color:#61AFEF;"> </span><span style="color:#E5C07B;">Exception</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">JobDetail</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">jobDetail</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">JobBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">newJob</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">DemoJob</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">class</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">withIdentity</span><span style="color:#ABB2BF;">(ID </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot; 01&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">storeDurably</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">CronScheduleBuilder</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">scheduleBuilder</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#E5C07B;">CronScheduleBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">cronSchedule</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;0/5 * * * * ? *&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 创建任务触发器</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">Trigger</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">trigger</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">TriggerBuilder</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">newTrigger</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">forJob</span><span style="color:#ABB2BF;">(jobDetail)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">withIdentity</span><span style="color:#ABB2BF;">(ID </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot; 01Trigger&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">withSchedule</span><span style="color:#ABB2BF;">(scheduleBuilder)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">startNow</span><span style="color:#ABB2BF;">() </span><span style="color:#7F848E;font-style:italic;">//立即執行一次任務</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;">// 手动将触发器与任务绑定到调度器内</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">scheduler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">scheduleJob</span><span style="color:#ABB2BF;">(jobDetail, trigger);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><strong>数据库方式存储任务信息</strong> <br> yml配置</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">spring</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># Quartz 的配置，对应 QuartzProperties 配置类</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">quartz</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">job-store-type</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">jdbc</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># Job 存储器类型。默认为 memory 表示内存</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">auto-startup</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># Quartz 是否自动启动</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">startup-delay</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 延迟 N 秒启动</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">wait-for-jobs-to-complete-on-shutdown</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 应用关闭时，是否等待定时任务执行完成。默认false</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">overwrite-existing-jobs</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 是否覆盖已有 Job 的配置</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 添加 Quartz Scheduler 附加属性</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">properties</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E06C75;">org</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">quartz</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">scheduler</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">instanceName</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">clusteredScheduler</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">instanceId</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">AUTO</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">jobStore</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">class</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">org.springframework.scheduling.quartz.LocalDataSourceJobStore</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">driverDelegateClass</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">tablePrefix</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">QRTZ_</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">isClustered</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">clusterCheckinInterval</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">10000</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">useProperties</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#E06C75;">threadPool</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">class</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">org.quartz.simpl.SimpleThreadPool</span><span style="color:#ABB2BF;"> </span><span style="color:#7F848E;font-style:italic;"># 线程池类型</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">threadCount</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># 线程池大小 默认为 10</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">threadPriority</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">5</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">threadsInheritContextClassLoaderOfInitializingThread</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><table><thead><tr><th>表名</th><th>解释</th></tr></thead><tbody><tr><td>QRTZ_CALENDARS</td><td>以 Blob 类型存储 Quartz 的 Calendar 信息</td></tr><tr><td>QRTZ_CRON_TRIGGERS</td><td>存储 Cron Trigger，包括 Cron 表达式和时区信息</td></tr><tr><td>QRTZ_FIRED_TRIGGERS</td><td>存储与已触发的 Trigger 相关的状态信息，以及相联 Job 的执行信息</td></tr><tr><td>QRTZ_PAUSED_TRIGGER_GRPS</td><td>存储已暂停的 Trigger 组的信息</td></tr><tr><td>QRTZ_SCHEDULER_STATE</td><td>存储少量的有关 Scheduler 的状态信息，和别的 Scheduler 实例(假如是用于一个集群中)</td></tr><tr><td>QRTZ_LOCKS</td><td>存储程序的悲观锁的信息</td></tr><tr><td>QRTZ_JOB_DETAILS</td><td>存储每一个已配置的 Job 的详细信息</td></tr><tr><td>QRTZ_SIMPLE_TRIGGERS</td><td>存储简单的 Trigger，包括重复次数，间隔，以及已触的次数</td></tr><tr><td>QRTZ_BLOG_TRIGGERS</td><td>Trigger 作为 Blob 类型存储(用于 Quartz 用户用 JDBC 创建他们自己定制的 Trigger 类型，JobStore 并不知道如何存储实例的时候)</td></tr><tr><td>QRTZ_TRIGGER_LISTENERS</td><td>存储已配置的 TriggerListener 的信息</td></tr><tr><td>QRTZ_TRIGGERS</td><td>存储已配置的 Trigger 的信息</td></tr></tbody></table>`,117),i=[c,B,y];function F(A,b,u,C,d,E){return o(),p("div",null,i)}const D=l(r,[["render",F]]);export{g as __pageData,D as default};
