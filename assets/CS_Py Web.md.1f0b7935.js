import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.1f7d9302.js";const b=JSON.parse('{"title":"Py Web","description":"","frontmatter":{"title":"Py Web","created_at":"2022-02-01T05:44:43.000Z","updated_at":"2023-07-30T03:00:08.000Z","word_count":10235},"headers":[],"relativePath":"CS/Py Web.md","filePath":"CS/Py Web.md"}'),e={name:"CS/Py Web.md"},p=l(`<h2 id="pymysql" tabindex="-1"><a href="https://github.com/PyMySQL/PyMySQL" target="_blank" rel="noreferrer">PyMySQL</a> <a class="header-anchor" href="#pymysql" aria-label="Permalink to &quot;[PyMySQL](https://github.com/PyMySQL/PyMySQL)&quot;">​</a></h2><p>class pymysql.connections.Connection</p><ul><li>host – Host where the database server is located</li><li>user – Username to log in as</li><li>password – Password to use.</li><li>database – Database to use, None to not use a particular one.</li><li>port – MySQL port to use, default is usually OK. (default: 3306)</li><li>bind_address – When the client has multiple network interfaces, specify the interface from which to connect to the host. Argument can be a hostname or an IP address.</li><li>unix_socket – Optionally, you can use a unix socket rather than TCP/IP.</li><li>read_timeout – The timeout for reading from the connection in seconds (default: None - no timeout)</li><li>write_timeout – The timeout for writing to the connection in seconds (default: None - no timeout)</li><li>charset – Charset you want to use.</li><li>sql_mode – Default SQL_MODE to use.</li><li>read_default_file – Specifies my.cnf file to read these parameters from under the [client] section.</li><li>conv – Conversion dictionary to use instead of the default one. This is used to provide custom marshalling and unmarshalling of types. See converters.</li><li>use_unicode – Whether or not to default to unicode strings. This option defaults to true for Py3k.</li><li>client_flag – Custom flags to send to MySQL. Find potential values in constants.CLIENT.</li><li>cursorclass – Custom cursor class to use.</li><li>init_command – Initial SQL statement to run when connection is established.</li><li>connect_timeout – Timeout before throwing an exception when connecting. (default: 10, min: 1, max: 31536000)</li><li>ssl – A dict of arguments similar to mysql_ssl_set()’s parameters.</li><li>read_default_group – Group to read from in the configuration file.</li><li>compress – Not supported</li><li>named_pipe – Not supported</li><li>autocommit – Autocommit mode. None means use server default. (default: False)</li><li>local_infile – Boolean to enable the use of LOAD DATA LOCAL command. (default: False)</li><li>max_allowed_packet – Max size of packet sent to server in bytes. (default: 16MB) Only used to limit size of “LOAD LOCAL INFILE” data packet smaller than default (16KB).</li><li>defer_connect – Don’t explicitly connect on construction - wait for connect call. (default: False)</li><li>auth_plugin_map – A dict of plugin names to a class that processes that plugin.</li><li>server_public_key – SHA256 authentication plugin public key value. (default: None)</li><li>db – Alias for database. (for compatibility to MySQLdb)</li><li>passwd – Alias for password. (for compatibility to MySQLdb)</li><li>binary_prefix – Add _binary prefix on bytes and bytearray. (default: False)</li><li>begin() Begin transaction.</li><li>close() Send the quit message and close the socket.</li><li>commit() Commit changes to stable storage.</li><li>cursor(cursor=None) Create a new cursor to execute queries with.</li><li>rollback() Roll back the current transaction.</li><li>select_db(db)</li></ul><p><strong>class pymysql.cursors.Cursor(connection)</strong></p><ul><li>execute(op) 执行一个数据库的查询命令</li><li>executemany(query, args) Run several data against one query</li><li>fetchone() 取得结果集的下一行</li><li>fetchmany(size) 获取结果集的下几行</li><li>fetchall() 获取结果集中的所有行</li><li>rowcount() 返回数据条数或影响行数</li><li>close() 关闭游标对象</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 连接数据库</span></span>
<span class="line"><span style="color:#ABB2BF;">db </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pymysql.</span><span style="color:#61AFEF;">connect</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;font-style:italic;">host</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;localhost&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;font-style:italic;">port</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3310</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;font-style:italic;">user</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;woider&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;font-style:italic;">passwd</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;3243&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;font-style:italic;">db</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;python&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;font-style:italic;">charset</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf8&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 获取游标</span></span>
<span class="line"><span style="color:#ABB2BF;">cursor </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> db.</span><span style="color:#61AFEF;">cursor</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查询数据</span></span>
<span class="line"><span style="color:#ABB2BF;">sql </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;SELECT name,saving FROM trade WHERE account = &#39;123&#39; &quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">cursor.</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">(sql)</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> cursor.</span><span style="color:#61AFEF;">fetchall</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Name:</span><span style="color:#D19A66;">%s</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">Saving:</span><span style="color:#D19A66;">%.2f</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> row)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;共查找出&#39;</span><span style="color:#ABB2BF;">, cursor.rowcount, </span><span style="color:#98C379;">&#39;条数据&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 插入数据</span></span>
<span class="line"><span style="color:#ABB2BF;">sql </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;INSERT INTO trade (name, account, saving) VALUES ( &#39;</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;, &#39;</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;, </span><span style="color:#D19A66;">%.2f</span><span style="color:#98C379;"> )&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&#39;tom&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;13512345678&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">10000</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">cursor.</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">(sql </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> data)</span></span>
<span class="line"><span style="color:#ABB2BF;">db.</span><span style="color:#61AFEF;">commit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;成功插入&#39;</span><span style="color:#ABB2BF;">, cursor.rowcount, </span><span style="color:#98C379;">&#39;条数据&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 事务处理</span></span>
<span class="line"><span style="color:#ABB2BF;">sql_1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;UPDATE trade SET saving = saving + 1000 WHERE account = &#39;18012345678&#39; &quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">sql_2 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;UPDATE trade SET expend = expend + 1000 WHERE account = &#39;18012345678&#39; &quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">sql_3 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;UPDATE trade SET income = income + 2000 WHERE account = &#39;18012345678&#39; &quot;</span></span>
<span class="line"><span style="color:#C678DD;">try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    cursor.</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">(sql_1)  </span><span style="color:#7F848E;font-style:italic;"># 储蓄增加1000</span></span>
<span class="line"><span style="color:#ABB2BF;">    cursor.</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">(sql_2)  </span><span style="color:#7F848E;font-style:italic;"># 支出增加1000</span></span>
<span class="line"><span style="color:#ABB2BF;">    cursor.</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">(sql_3)  </span><span style="color:#7F848E;font-style:italic;"># 收入增加2000</span></span>
<span class="line"><span style="color:#C678DD;">except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> e:</span></span>
<span class="line"><span style="color:#ABB2BF;">    db.</span><span style="color:#61AFEF;">rollback</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 事务回滚</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;事务处理失败&#39;</span><span style="color:#ABB2BF;">, e)</span></span>
<span class="line"><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    db.</span><span style="color:#61AFEF;">commit</span><span style="color:#ABB2BF;">()  </span><span style="color:#7F848E;font-style:italic;"># 事务提交</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;事务处理成功&#39;</span><span style="color:#ABB2BF;">, cursor.rowcount)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 关闭连接</span></span>
<span class="line"><span style="color:#ABB2BF;">cursor.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">db.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h3 id="mysql-connector" tabindex="-1">mysql.connector <a class="header-anchor" href="#mysql-connector" aria-label="Permalink to &quot;mysql.connector&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> mysql.connector</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 建立连接</span></span>
<span class="line"><span style="color:#ABB2BF;">mydb </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mysql.connector.</span><span style="color:#61AFEF;">connect</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">user</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;root&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">password</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;password&#39;</span><span style="color:#ABB2BF;">[, database=</span><span style="color:#98C379;">&#39;test&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">cursor </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> mydb.</span><span style="color:#61AFEF;">cursor</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建user表:</span></span>
<span class="line"><span style="color:#ABB2BF;">cursor.</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;create table user (id varchar(20) primary key, name varchar(20))&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 插入多行记录，注意MySQL的占位符是%s:</span></span>
<span class="line"><span style="color:#ABB2BF;">sql </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;INSERT INTO customers (name, address) VALUES (</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">, </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">)&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">val </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">    (</span><span style="color:#98C379;">&#39;Peter&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Lowstreet 4&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">    (</span><span style="color:#98C379;">&#39;Amy&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Apple st 652&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">mycursor.</span><span style="color:#61AFEF;">executemany</span><span style="color:#ABB2BF;">(sql, val)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(cursor.rowcount)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 提交事务:</span></span>
<span class="line"><span style="color:#ABB2BF;">mydb.</span><span style="color:#61AFEF;">commit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 运行查询:</span></span>
<span class="line"><span style="color:#ABB2BF;">cursor.</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;select * from user where id = </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">, (</span><span style="color:#98C379;">&#39;1&#39;</span><span style="color:#ABB2BF;">,))</span></span>
<span class="line"><span style="color:#ABB2BF;">values </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cursor.</span><span style="color:#61AFEF;">fetchall</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(values)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 关闭Cursor和Connection</span></span>
<span class="line"><span style="color:#ABB2BF;">cursor.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">mydb.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="dataset" tabindex="-1"><a href="https://github.com/pudo/dataset" target="_blank" rel="noreferrer">dataset</a> <a class="header-anchor" href="#dataset" aria-label="Permalink to &quot;[dataset](https://github.com/pudo/dataset)&quot;">​</a></h2><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># connecting to a MySQL database with user and password</span></span>
<span class="line"><span style="color:#ABB2BF;">db </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> dataset.</span><span style="color:#61AFEF;">connect</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;mysql://user:password@localhost/mydatabase&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># get a reference to the table &#39;user&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">table </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> db[</span><span style="color:#98C379;">&#39;user&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># All users from China</span></span>
<span class="line"><span style="color:#ABB2BF;">chinese_users </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> table.</span><span style="color:#61AFEF;">find</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">country</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;China&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># dataset will create &quot;missing&quot; columns any time you insert a dict with an unknown key</span></span>
<span class="line"><span style="color:#ABB2BF;">table.</span><span style="color:#61AFEF;">insert</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;Jane Doe&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">age</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">37</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">country</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;France&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">gender</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;female&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">table.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">dict</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;John Doe&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">age</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">47</span><span style="color:#ABB2BF;">), [</span><span style="color:#98C379;">&#39;name&#39;</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li><p><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Database" target="_blank" rel="noreferrer">Database</a></p><ul><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Database.begin" target="_blank" rel="noreferrer">Database.begin()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Database.commit" target="_blank" rel="noreferrer">Database.commit()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Database.create_table" target="_blank" rel="noreferrer">Database.create_table()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Database.get_table" target="_blank" rel="noreferrer">Database.get_table()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Database.load_table" target="_blank" rel="noreferrer">Database.load_table()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Database.query" target="_blank" rel="noreferrer">Database.query()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Database.rollback" target="_blank" rel="noreferrer">Database.rollback()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Database.tables" target="_blank" rel="noreferrer">Database.tables</a></li></ul></li><li><p><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table" target="_blank" rel="noreferrer">Table</a></p><ul><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.__iter__" target="_blank" rel="noreferrer">Table.<strong>iter</strong>()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.__len__" target="_blank" rel="noreferrer">Table.<strong>len</strong>()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.all" target="_blank" rel="noreferrer">Table.all()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.columns" target="_blank" rel="noreferrer">Table.columns</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.count" target="_blank" rel="noreferrer">Table.count()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.create_column" target="_blank" rel="noreferrer">Table.create_column()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.create_column_by_example" target="_blank" rel="noreferrer">Table.create_column_by_example()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.create_index" target="_blank" rel="noreferrer">Table.create_index()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.delete" target="_blank" rel="noreferrer">Table.delete()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.distinct" target="_blank" rel="noreferrer">Table.distinct()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.drop" target="_blank" rel="noreferrer">Table.drop()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.drop_column" target="_blank" rel="noreferrer">Table.drop_column()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.find" target="_blank" rel="noreferrer">Table.find()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.find_one" target="_blank" rel="noreferrer">Table.find_one()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.has_column" target="_blank" rel="noreferrer">Table.has_column()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.has_index" target="_blank" rel="noreferrer">Table.has_index()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.insert" target="_blank" rel="noreferrer">Table.insert()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.insert_ignore" target="_blank" rel="noreferrer">Table.insert_ignore()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.insert_many" target="_blank" rel="noreferrer">Table.insert_many()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.update" target="_blank" rel="noreferrer">Table.update()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.update_many" target="_blank" rel="noreferrer">Table.update_many()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.upsert" target="_blank" rel="noreferrer">Table.upsert()</a></li><li><a href="https://dataset.readthedocs.io/en/latest/api.html#dataset.Table.upsert_many" target="_blank" rel="noreferrer">Table.upsert_many()</a></li></ul></li></ul><h2 id="sqlalchemy" tabindex="-1"><a href="https://www.sqlalchemy.org/" target="_blank" rel="noreferrer">SQLAlchemy</a> <a class="header-anchor" href="#sqlalchemy" aria-label="Permalink to &quot;[SQLAlchemy](https://www.sqlalchemy.org/)&quot;">​</a></h2><p><a href="https://www.osgeo.cn/sqlalchemy/" target="_blank" rel="noreferrer">https://www.osgeo.cn/sqlalchemy/</a></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> sqlalchemy </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Column, String, create_engine</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> sqlalchemy.orm </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> sessionmaker</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> sqlalchemy.ext.declarative </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> declarative_base</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建对象的基类:</span></span>
<span class="line"><span style="color:#ABB2BF;">Base </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">declarative_base</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 定义User对象:</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Base</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 表的名字:</span></span>
<span class="line"><span style="color:#ABB2BF;">    __tablename__ </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;user&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 表的结构:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">id</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Column</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">String</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;">), </span><span style="color:#E06C75;font-style:italic;">primary_key</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Column</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">String</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 初始化数据库连接:</span></span>
<span class="line"><span style="color:#ABB2BF;">engine </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">create_engine</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;mysql+mysqlconnector://root:password@localhost:3306/test&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建DBSession类型:</span></span>
<span class="line"><span style="color:#ABB2BF;">DBSession </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">sessionmaker</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">bind</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">engine)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建session对象:</span></span>
<span class="line"><span style="color:#ABB2BF;">session </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">DBSession</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建新User对象:</span></span>
<span class="line"><span style="color:#ABB2BF;">new_user </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">User</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">id</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;5&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;Bob&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加到session:</span></span>
<span class="line"><span style="color:#ABB2BF;">session.</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(new_user)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 提交即保存到数据库:</span></span>
<span class="line"><span style="color:#ABB2BF;">session.</span><span style="color:#61AFEF;">commit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 关闭session:</span></span>
<span class="line"><span style="color:#ABB2BF;">session.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="redis" tabindex="-1"><a href="https://github.com/andymccurdy/redis-py" target="_blank" rel="noreferrer">redis</a> <a class="header-anchor" href="#redis" aria-label="Permalink to &quot;[redis](https://github.com/andymccurdy/redis-py)&quot;">​</a></h2><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> redis</span></span>
<span class="line"><span style="color:#ABB2BF;">redis_conn </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> redis.</span><span style="color:#61AFEF;">Redis</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">host</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;127.0.0.1&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">port</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">6379</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">password</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;your pw&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">db</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#连接池方式</span></span>
<span class="line"><span style="color:#ABB2BF;">redis_pool </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> redis.</span><span style="color:#61AFEF;">ConnectionPool</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">host</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;127.0.0.1&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">port</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">6379</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">password</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;your pw&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">db</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">redis_conn </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> redis.</span><span style="color:#61AFEF;">Redis</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">connection_pool</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> redis_pool)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="flask" tabindex="-1"><a href="https://flask.palletsprojects.com/en/2.0.x/" target="_blank" rel="noreferrer">Flask</a> <a class="header-anchor" href="#flask" aria-label="Permalink to &quot;[Flask](https://flask.palletsprojects.com/en/2.0.x/)&quot;">​</a></h2><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> flask </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Flask</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">app </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Flask</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">hello_world</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;Hello, World!&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/user/&lt;username&gt;&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#61AFEF;"> </span><span style="color:#E06C75;font-style:italic;">methods</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;GET&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#61AFEF;"> </span><span style="color:#98C379;">&#39;POST&#39;</span><span style="color:#ABB2BF;">])</span><span style="color:#FFFFFF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">show_user_profile</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">username</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> request.method </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;POST&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># show the user profile for that user</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;User </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">escape</span><span style="color:#ABB2BF;">(username)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#D19A66;">...</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/post/&lt;int:post_id&gt;&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">show_post</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">post_id</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># show the post with the given id, the id is an integer</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;Post </span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> post_id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/path/&lt;path:subpath&gt;&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">show_subpath</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">subpath</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># show the subpath after /path/</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;Subpath </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">escape</span><span style="color:#ABB2BF;">(subpath)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">errorhandler</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">404</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">not_found</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">error</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    resp </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">make_response</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">render_template</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;error.html&#39;</span><span style="color:#ABB2BF;">), </span><span style="color:#D19A66;">404</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    resp.headers[</span><span style="color:#98C379;">&#39;X-Something&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;A value&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> resp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    app.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">debug</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">host</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;0.0.0.0&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">port</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">5000</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ul><li><a href="http://werkzeug.pocoo.org/" target="_blank" rel="noreferrer">Werkzeug</a>: WSGI工具，是介于应用和服务器之间标准的接口工具。</li><li><a href="http://jinja.pocoo.org/" target="_blank" rel="noreferrer">Jinja</a>: 模板渲染库，web 前端页面中使用的模板语言。</li><li><a href="https://pypi.org/project/MarkupSafe/" target="_blank" rel="noreferrer">MarkupSafe</a>: 与 Jinja 配合使用，当表单页面跳转时会进行验证从而避免遭遇不信任的输入带来的攻击。</li><li><a href="https://pythonhosted.org/itsdangerous/" target="_blank" rel="noreferrer">ItsDangerous</a>: 安全地注入数据以确保数据的完整性，通常用于保护 Flask 的 session cookie。</li><li><a href="https://click.palletsprojects.com/en/7.x/" target="_blank" rel="noreferrer">Click</a>: 一个解析命令行的应用，它支持在 Flask 中自定义管理命令。</li></ul><p><code>&lt;converter:variable_name&gt;</code>主要类型</p><table><thead><tr><th>类型</th><th>含义</th></tr></thead><tbody><tr><td>string</td><td>默认的数据类型，接受没有任何斜杠“/”的字符串</td></tr><tr><td>int</td><td>接受整型</td></tr><tr><td>float</td><td>接受浮点类型</td></tr><tr><td>path</td><td>和 string 类似，但是接受斜杠“/”</td></tr><tr><td>uuid</td><td>接受 uuid 字符串</td></tr></tbody></table><p>在你的包中或模块旁边创建一个名为 static 的文件夹 <br> 给静态文件生成 URL ，使用特殊的 static 端点名： <br> <code>url_for(&#39;static&#39;, filename=&#39;style.css&#39;)</code> <br> 这个文件是应该存储在文件系统上的 static/style.css 。</p><p><strong>渲染模板</strong> <br> 使用方法 render_template()</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/hello/&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/hello/&lt;name&gt;&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">hello</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">):   </span><span style="color:#7F848E;font-style:italic;"># 默认 name 为 None</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">render_template</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;hello.html&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">name)   </span><span style="color:#7F848E;font-style:italic;"># 将 name 参数传递到模板变量中</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Flask 将会在 templates 文件夹中寻找模板</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#FFFFFF;">!</span><span style="color:#D19A66;">DOCTYPE</span><span style="color:#ABB2BF;"> html</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">html lang</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;zh-CN&quot;</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">head</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">link</span></span>
<span class="line"><span style="color:#ABB2BF;">      rel</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;stylesheet&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#56B6C2;">type=</span><span style="color:#98C379;">&quot;text/css&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">      href</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{{</span><span style="color:#98C379;"> url_for(&#39;static&#39;, filename=&#39;hello.css&#39;) </span><span style="color:#D19A66;">}}</span><span style="color:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">head</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">body</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">title</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">Hello From Flask</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">title</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> name </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">!</span><span style="color:#FFFFFF;">--</span><span style="color:#ABB2BF;"> 如果 name 不为空则将 name 渲染出来 </span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">h1</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">Hello {{ name }}!</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">h1</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">!</span><span style="color:#FFFFFF;">--</span><span style="color:#ABB2BF;"> 如果 name 为空则打印 Hello World! </span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">h1</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">Hello World!</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">h1</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> endif </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">body</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">html</span><span style="color:#56B6C2;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>文件上传 <br> 在 HTML 表单设置属性 enctype=&quot;multipart/form-data&quot;</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> flask </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> request</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> werkzeug </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> secure_filename  </span><span style="color:#7F848E;font-style:italic;"># 获取上传文件的文件名</span></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/upload&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#61AFEF;"> </span><span style="color:#E06C75;font-style:italic;">methods</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;GET&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#61AFEF;"> </span><span style="color:#98C379;">&#39;POST&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">upload_file</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> request.method </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;POST&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        f </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> request.files[</span><span style="color:#98C379;">&#39;the_file&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        f.</span><span style="color:#61AFEF;">save</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/var/www/uploads/&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">secure_filename</span><span style="color:#ABB2BF;">(f.filename))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>cookies</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> flask </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> request, make_response</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">index</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 读取 cookies </span></span>
<span class="line"><span style="color:#ABB2BF;">    username </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> request.cookies.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;username&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 注意这里引用cookies字典的键值对是使用cookies.get(key)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 而不是cookies[key]，这是防止该字典不存在时报错&quot;keyerror&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 存储 cookies </span></span>
<span class="line"><span style="color:#ABB2BF;">    resp </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">make_response</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">render_template</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">...</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    resp.</span><span style="color:#61AFEF;">set_cookie</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;username&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;the username&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> resp</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>session</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> flask </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Flask, session, redirect, url_for, request</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> markupsafe </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> escape</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">app </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Flask</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置密钥，保证会话安全</span></span>
<span class="line"><span style="color:#ABB2BF;">app.secret_key </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;_5#y2L&quot;F4Q8z</span><span style="color:#56B6C2;">\\n\\xec</span><span style="color:#98C379;">]/&#39;</span></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">index</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;username&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> session:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;Logged in as </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">escape</span><span style="color:#ABB2BF;">(session[</span><span style="color:#98C379;">&#39;username&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;You are not logged in&#39;</span></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/login&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#61AFEF;"> </span><span style="color:#E06C75;font-style:italic;">methods</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;GET&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#61AFEF;"> </span><span style="color:#98C379;">&#39;POST&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> request.method </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;POST&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        session[</span><span style="color:#98C379;">&#39;username&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> request.form[</span><span style="color:#98C379;">&#39;username&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">redirect</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">url_for</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;index&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;form method=&quot;post&quot;&gt;</span></span>
<span class="line"><span style="color:#98C379;">            &lt;p&gt;&lt;input type=text name=username&gt;</span></span>
<span class="line"><span style="color:#98C379;">            &lt;p&gt;&lt;input type=submit value=Login&gt;</span></span>
<span class="line"><span style="color:#98C379;">        &lt;/form&gt;</span></span>
<span class="line"><span style="color:#98C379;">    &#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/logout&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">logout</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 如果用户名存在，则从会话中移除该用户名</span></span>
<span class="line"><span style="color:#ABB2BF;">    session.</span><span style="color:#61AFEF;">pop</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;username&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">redirect</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">url_for</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;index&#39;</span><span style="color:#ABB2BF;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>escape()可以在你不使用模板引擎的时候做转义 <br> redirect() 函数重定向用户到其它地方 <br> abort() 函数提前中断一个请求并带有一个错误代码。</p><p>api示例</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> flask</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> flask </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> request</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">api </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flask.</span><span style="color:#61AFEF;">Flask</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># CORS</span></span>
<span class="line"><span style="color:#61AFEF;">@api</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">after_request</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">after</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">resp</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># resp = make_response(resp)</span></span>
<span class="line"><span style="color:#ABB2BF;">    resp.headers[</span><span style="color:#98C379;">&#39;Access-Control-Allow-Methods&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;*&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    resp.headers[</span><span style="color:#98C379;">&#39;Access-Control-Allow-Headers&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;*&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    resp.headers[</span><span style="color:#98C379;">&#39;Access-Control-Allow-Origin&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;*&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> resp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># &#39;index&#39;是接口路径</span></span>
<span class="line"><span style="color:#61AFEF;">@api</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/index&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#61AFEF;"> </span><span style="color:#E06C75;font-style:italic;">methods</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;get&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">index</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    res </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;msg&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;成功访问首页&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;msg_code&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># json.dumps 序列化时对中文默认使用的ascii编码.想输出中文需要指定ensure_ascii=False</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(res, </span><span style="color:#E06C75;font-style:italic;">ensure_ascii</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># post入参访问方式1：url格式参数?id=1&amp;name=&#39;2&#39;</span></span>
<span class="line"><span style="color:#61AFEF;">@api</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/translate1&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#61AFEF;"> </span><span style="color:#E06C75;font-style:italic;">methods</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;post&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">translate1</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    param </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flask.request.args.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;key&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&#39;key&#39;</span><span style="color:#ABB2BF;">:</span><span style="color:#98C379;">&#39;value&#39;</span><span style="color:#ABB2BF;">}, </span><span style="color:#E06C75;font-style:italic;">ensure_ascii</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># post入参访问方式2：from-data（k-v）格式参数</span></span>
<span class="line"><span style="color:#61AFEF;">@api</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/translate2&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#61AFEF;"> </span><span style="color:#E06C75;font-style:italic;">methods</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;post&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">translate2</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    param </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flask.request.values.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;key&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&#39;key&#39;</span><span style="color:#ABB2BF;">:</span><span style="color:#98C379;">&#39;value&#39;</span><span style="color:#ABB2BF;">}, </span><span style="color:#E06C75;font-style:italic;">ensure_ascii</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># post入参访问方式3：josn格式参数</span></span>
<span class="line"><span style="color:#61AFEF;">@api</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">route</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/translate3&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#61AFEF;"> </span><span style="color:#E06C75;font-style:italic;">methods</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">translate3</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    param </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> flask.request.json.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;key&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&#39;key&#39;</span><span style="color:#ABB2BF;">:</span><span style="color:#98C379;">&#39;value&#39;</span><span style="color:#ABB2BF;">}, </span><span style="color:#E06C75;font-style:italic;">ensure_ascii</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    api.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">port</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">8888</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">debug</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">host</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;127.0.0.1&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p><a href="https://flask-cors.readthedocs.io/en/latest/#" target="_blank" rel="noreferrer"><strong>Flask-Cors</strong></a></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> flask </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Flask</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> flask_cors </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">CORS</span><span style="color:#ABB2BF;">, cross_origin</span></span>
<span class="line"><span style="color:#ABB2BF;">app </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Flask</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">cors </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">CORS</span><span style="color:#ABB2BF;">(app)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="jinja" tabindex="-1"><a href="https://palletsprojects.com/" target="_blank" rel="noreferrer">jinja</a> <a class="header-anchor" href="#jinja" aria-label="Permalink to &quot;[jinja](https://palletsprojects.com/)&quot;">​</a></h2><p>Delimiters（分隔符）</p><ul><li><code>{% ... %}</code> 语句</li><li><code>{ { ... } }</code> 打印模板输出的表达式</li><li><code>{# ... #} </code>注释</li><li><code>... ##</code> 行语句</li></ul><p>Variables（变量）</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{{ mydict[</span><span style="color:#98C379;">&#39;key&#39;</span><span style="color:#ABB2BF;">] }}</span></span>
<span class="line"><span style="color:#ABB2BF;">{{ mylist[</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">] }}</span></span>
<span class="line"><span style="color:#ABB2BF;">{{ mylist[myintvar] }}</span></span>
<span class="line"><span style="color:#ABB2BF;">{{ myobj.</span><span style="color:#61AFEF;">somemethod</span><span style="color:#ABB2BF;">() }}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Filter（过滤器）</strong> <br> 用来修改变量，使用一个竖线和变量相隔。</p><table><thead><tr><th><a href="https://jinja.palletsprojects.com/en/master/templates/#abs" target="_blank" rel="noreferrer">abs()</a></th><th><a href="https://jinja.palletsprojects.com/en/master/templates/#float" target="_blank" rel="noreferrer">float()</a></th><th><a href="https://jinja.palletsprojects.com/en/master/templates/#lower" target="_blank" rel="noreferrer">lower()</a></th><th><a href="https://jinja.palletsprojects.com/en/master/templates/#round" target="_blank" rel="noreferrer">round()</a></th><th><a href="https://jinja.palletsprojects.com/en/master/templates/#tojson" target="_blank" rel="noreferrer">tojson()</a></th></tr></thead><tbody><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#attr" target="_blank" rel="noreferrer">attr()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#forceescape" target="_blank" rel="noreferrer">forceescape()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#map" target="_blank" rel="noreferrer">map()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#safe" target="_blank" rel="noreferrer">safe()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#trim" target="_blank" rel="noreferrer">trim()</a></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#batch" target="_blank" rel="noreferrer">batch()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#format" target="_blank" rel="noreferrer">format()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#max" target="_blank" rel="noreferrer">max()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#select" target="_blank" rel="noreferrer">select()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#truncate" target="_blank" rel="noreferrer">truncate()</a></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#capitalize" target="_blank" rel="noreferrer">capitalize()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#groupby" target="_blank" rel="noreferrer">groupby()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#min" target="_blank" rel="noreferrer">min()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#selectattr" target="_blank" rel="noreferrer">selectattr()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#unique" target="_blank" rel="noreferrer">unique()</a></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#center" target="_blank" rel="noreferrer">center()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#indent" target="_blank" rel="noreferrer">indent()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#pprint" target="_blank" rel="noreferrer">pprint()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#slice" target="_blank" rel="noreferrer">slice()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#upper" target="_blank" rel="noreferrer">upper()</a></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#default" target="_blank" rel="noreferrer">default()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#int" target="_blank" rel="noreferrer">int()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#random" target="_blank" rel="noreferrer">random()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#sort" target="_blank" rel="noreferrer">sort()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#urlencode" target="_blank" rel="noreferrer">urlencode()</a></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#dictsort" target="_blank" rel="noreferrer">dictsort()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#join" target="_blank" rel="noreferrer">join()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#reject" target="_blank" rel="noreferrer">reject()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#string" target="_blank" rel="noreferrer">string()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#urlize" target="_blank" rel="noreferrer">urlize()</a></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#escape" target="_blank" rel="noreferrer">escape()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#last" target="_blank" rel="noreferrer">last()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#rejectattr" target="_blank" rel="noreferrer">rejectattr()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#striptags" target="_blank" rel="noreferrer">striptags()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#wordcount" target="_blank" rel="noreferrer">wordcount()</a></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#filesizeformat" target="_blank" rel="noreferrer">filesizeformat()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#length" target="_blank" rel="noreferrer">length()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#replace" target="_blank" rel="noreferrer">replace()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#sum" target="_blank" rel="noreferrer">sum()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#wordwrap" target="_blank" rel="noreferrer">wordwrap()</a></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#first" target="_blank" rel="noreferrer">first()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#list" target="_blank" rel="noreferrer">list()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#reverse" target="_blank" rel="noreferrer">reverse()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#title" target="_blank" rel="noreferrer">title()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#xmlattr" target="_blank" rel="noreferrer">xmlattr()</a></td></tr></tbody></table><p>Tests（测试，判断）</p><table><thead><tr><th><a href="https://jinja.palletsprojects.com/en/master/templates/#boolean" target="_blank" rel="noreferrer">boolean()</a></th><th><a href="https://jinja.palletsprojects.com/en/master/templates/#even" target="_blank" rel="noreferrer">even()</a></th><th><a href="https://jinja.palletsprojects.com/en/master/templates/#integer" target="_blank" rel="noreferrer">integer()</a></th><th><a href="https://jinja.palletsprojects.com/en/master/templates/#ne" target="_blank" rel="noreferrer">ne()</a></th><th><a href="https://jinja.palletsprojects.com/en/master/templates/#string" target="_blank" rel="noreferrer">string()</a></th></tr></thead><tbody><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#callable" target="_blank" rel="noreferrer">callable()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#false" target="_blank" rel="noreferrer">false()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#iterable" target="_blank" rel="noreferrer">iterable()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#none" target="_blank" rel="noreferrer">none()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#true" target="_blank" rel="noreferrer">true()</a></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#defined" target="_blank" rel="noreferrer">defined()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#float" target="_blank" rel="noreferrer">float()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#le" target="_blank" rel="noreferrer">le()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#number" target="_blank" rel="noreferrer">number()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#undefined" target="_blank" rel="noreferrer">undefined()</a></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#divisibleby" target="_blank" rel="noreferrer">divisibleby()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#ge" target="_blank" rel="noreferrer">ge()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#lower" target="_blank" rel="noreferrer">lower()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#odd" target="_blank" rel="noreferrer">odd()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#upper" target="_blank" rel="noreferrer">upper()</a></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#eq" target="_blank" rel="noreferrer">eq()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#gt" target="_blank" rel="noreferrer">gt()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#lt" target="_blank" rel="noreferrer">lt()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#sameas" target="_blank" rel="noreferrer">sameas()</a></td><td></td></tr><tr><td><a href="https://jinja.palletsprojects.com/en/master/templates/#escaped" target="_blank" rel="noreferrer">escaped()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#in" target="_blank" rel="noreferrer">in()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#mapping" target="_blank" rel="noreferrer">mapping()</a></td><td><a href="https://jinja.palletsprojects.com/en/master/templates/#sequence" target="_blank" rel="noreferrer">sequence()</a></td><td></td></tr></tbody></table><p>List of Control Structures</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> kenny.sick </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    Kenny </span><span style="color:#C678DD;">is</span><span style="color:#ABB2BF;"> sick.</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">elif</span><span style="color:#ABB2BF;"> kenny.dead </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    You killed Kenny!  You bastard!!!</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    Kenny looks okay </span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> so far</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> endif </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> user </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> users </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">li</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">{{ user.username</span><span style="color:#56B6C2;">|</span><span style="color:#ABB2BF;">e }}</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">li</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">li</span><span style="color:#56B6C2;">&gt;&lt;</span><span style="color:#ABB2BF;">em</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">no users found</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">em</span><span style="color:#56B6C2;">&gt;&lt;/</span><span style="color:#ABB2BF;">li</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> endfor </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Whitespace Control（空格控制） <br> 默认</p><ul><li>如果末尾有换行符，则去除；</li><li>其他空格原样保留。</li></ul><p>去掉Jinja2语句占据的空行</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">app.jinja_env.trim_blocks </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">True</span></span>
<span class="line"><span style="color:#ABB2BF;">app.jinja_env.lstrip_blocks </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">True</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Escaping（转义）</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> raw </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">ul</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    {</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> item </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> seq </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">li</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">{{ item }}</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">li</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    {</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> endfor </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">ul</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> endraw </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>模板继承</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> extends </span><span style="color:#98C379;">&quot;base.html&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> block content </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    子模板的内容</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> endblock </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Macros</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> macro </span><span style="color:#56B6C2;">input</span><span style="color:#ABB2BF;">(name, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">type</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;text&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">size</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">-%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;input</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">type=</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{{</span><span style="color:#98C379;"> type </span><span style="color:#D19A66;">}}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;"> name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{{</span><span style="color:#98C379;"> name </span><span style="color:#D19A66;">}}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;"> value</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{{</span></span>
<span class="line"><span style="color:#ABB2BF;">        value</span><span style="color:#56B6C2;">|</span><span style="color:#ABB2BF;">e }}</span><span style="color:#98C379;">&quot; size=&quot;</span><span style="color:#ABB2BF;">{{ size }}</span><span style="color:#98C379;">&quot;&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%-</span><span style="color:#ABB2BF;"> endmacro </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Call</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> macro </span><span style="color:#61AFEF;">render_dialog</span><span style="color:#ABB2BF;">(title, </span><span style="color:#C678DD;">class</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;dialog&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">-%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">div </span><span style="color:#C678DD;">class</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{{</span><span style="color:#98C379;"> class </span><span style="color:#D19A66;">}}</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">h2</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">{{ title }}</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">h2</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">div </span><span style="color:#C678DD;">class</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;contents&quot;</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            {{ </span><span style="color:#61AFEF;">caller</span><span style="color:#ABB2BF;">() }}</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">div</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">div</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%-</span><span style="color:#ABB2BF;"> endmacro </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> call </span><span style="color:#61AFEF;">render_dialog</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Hello World&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    This </span><span style="color:#C678DD;">is</span><span style="color:#ABB2BF;"> a simple dialog rendered by using a macro </span><span style="color:#C678DD;">and</span></span>
<span class="line"><span style="color:#ABB2BF;">    a call block.</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> endcall </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Filters</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">filter</span><span style="color:#ABB2BF;"> upper </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    This text becomes uppercase</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> endfilter </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Assignments</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">set</span><span style="color:#ABB2BF;"> navigation = [(</span><span style="color:#98C379;">&#39;index.html&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Index&#39;</span><span style="color:#ABB2BF;">), (</span><span style="color:#98C379;">&#39;about.html&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;About&#39;</span><span style="color:#ABB2BF;">)] </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">set</span><span style="color:#ABB2BF;"> key, value = </span><span style="color:#61AFEF;">call_something</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">set</span><span style="color:#ABB2BF;"> navigation </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">li</span><span style="color:#56B6C2;">&gt;&lt;</span><span style="color:#ABB2BF;">a href</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;/&quot;</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">Index</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">a</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">li</span><span style="color:#56B6C2;">&gt;&lt;</span><span style="color:#ABB2BF;">a href</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;/downloads&quot;</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">Downloads</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">a</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> endset </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Include</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> include </span><span style="color:#98C379;">&#39;header.html&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> include [</span><span style="color:#98C379;">&#39;page_detailed.html&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;page.html&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    Body</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> include </span><span style="color:#98C379;">&#39;footer.html&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Import</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;forms.html&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> forms </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">dl</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">dt</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">Username</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">dt</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">dd</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">{{ forms.</span><span style="color:#61AFEF;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;username&#39;</span><span style="color:#ABB2BF;">) }}</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">dd</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">dt</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">Password</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">dt</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">dd</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">{{ forms.</span><span style="color:#61AFEF;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;password&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">type</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;password&#39;</span><span style="color:#ABB2BF;">) }}</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">dd</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">dl</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">p</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">{{ forms.</span><span style="color:#61AFEF;">textarea</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;comment&#39;</span><span style="color:#ABB2BF;">) }}</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">p</span><span style="color:#56B6C2;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Global Functions <br> range([start, ]stop[, step]) <br> lipsum(n=5, html=True, min=20, max=100) <br> 为模板生成一些lorem ipsum</p><h2 id="django" tabindex="-1"><a href="https://docs.djangoproject.com/zh-hans/3.0/" target="_blank" rel="noreferrer">Django</a> <a class="header-anchor" href="#django" aria-label="Permalink to &quot;[Django](https://docs.djangoproject.com/zh-hans/3.0/)&quot;">​</a></h2><p>python -m django --version</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro has-diff"><code><span class="line"><span style="color:#ABB2BF;">django</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">admin </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">command</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> [options]</span></span>
<span class="line"><span style="color:#ABB2BF;">manage.py </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">command</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> [options]</span></span>
<span class="line"><span style="color:#ABB2BF;">py </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">m django </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">command</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> [options]</span></span>
<span class="line"><span style="color:#ABB2BF;">django</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">admin </span><span style="color:#56B6C2;">help</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">command</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    check</span></span>
<span class="line"><span style="color:#ABB2BF;">    compilemessages</span></span>
<span class="line"><span style="color:#ABB2BF;">    createcachetable</span></span>
<span class="line"><span style="color:#ABB2BF;">    dbshell</span></span>
<span class="line"><span style="color:#ABB2BF;">    diffsettings</span></span>
<span class="line"><span style="color:#ABB2BF;">    dumpdata</span></span>
<span class="line"><span style="color:#ABB2BF;">    flush</span></span>
<span class="line"><span style="color:#ABB2BF;">    inspectdb</span></span>
<span class="line"><span style="color:#ABB2BF;">    loaddata</span></span>
<span class="line"><span style="color:#ABB2BF;">    makemessages</span></span>
<span class="line"><span style="color:#ABB2BF;">    makemigrations</span></span>
<span class="line"><span style="color:#ABB2BF;">    migrate</span></span>
<span class="line"><span style="color:#ABB2BF;">    runserver</span></span>
<span class="line"><span style="color:#ABB2BF;">    sendtestemail</span></span>
<span class="line"><span style="color:#ABB2BF;">    shell</span></span>
<span class="line"><span style="color:#ABB2BF;">    showmigrations</span></span>
<span class="line"><span style="color:#ABB2BF;">    sqlflush</span></span>
<span class="line"><span style="color:#ABB2BF;">    sqlmigrate</span></span>
<span class="line"><span style="color:#ABB2BF;">    sqlsequencereset</span></span>
<span class="line"><span style="color:#ABB2BF;">    squashmigrations</span></span>
<span class="line"><span style="color:#ABB2BF;">    startapp</span></span>
<span class="line"><span style="color:#ABB2BF;">    startproject</span></span>
<span class="line"><span style="color:#ABB2BF;">    test</span></span>
<span class="line"><span style="color:#ABB2BF;">    testserver</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>创建项目 django-admin startproject</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">myProject</span></span>
<span class="line"><span style="color:#ABB2BF;">├── manage.py	项目的入口文件，用它来执行一些命令进行创建应用、启动项目、控制数据表迁移等。</span></span>
<span class="line"><span style="color:#ABB2BF;">└── myProject	主目录下的同名子目录，为项目的核心目录，包含配置文件和管理应用的文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    ├── </span><span style="color:#56B6C2;">__init__</span><span style="color:#ABB2BF;">.py	空文件，在需要的时候会引入目录下的对象。</span></span>
<span class="line"><span style="color:#ABB2BF;">    ├── settings.py	配置文件，里面包含对数据库的设置项、</span><span style="color:#D19A66;">CSRF</span><span style="color:#ABB2BF;"> Token 的设置项、模板的设置项等全部设置。</span></span>
<span class="line"><span style="color:#ABB2BF;">    ├── urls.py	路由控制文件，处理客户端请求，分发到对应的视图函数去处理</span></span>
<span class="line"><span style="color:#ABB2BF;">    └── wsgi.py	处理请求和响应</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>配置 settings.py</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">## </span><span style="color:#E06C75;">其它配置代码</span><span style="color:#ABB2BF;">...</span></span>
<span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#E06C75;">改为中文</span></span>
<span class="line"><span style="color:#E5C07B;">LANGUAGE_CODE</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;zh-hans&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#E06C75;">把国际时区改为中国时区</span><span style="color:#ABB2BF;">（</span><span style="color:#E06C75;">东八区</span><span style="color:#ABB2BF;">）</span></span>
<span class="line"><span style="color:#E5C07B;">TIME_ZONE</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;Asia/Shanghai&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">## </span><span style="color:#E06C75;">其它配置代码</span><span style="color:#ABB2BF;">...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>创建应用 python manage.py startapp <br> 并新建一个 urls.py</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">myProject</span></span>
<span class="line"><span style="color:#ABB2BF;">    ├── manage.py</span></span>
<span class="line"><span style="color:#ABB2BF;">    ├── myApp</span></span>
<span class="line"><span style="color:#ABB2BF;">    │   ├── admin.py	控制后台管理的文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    │   ├── apps.py	管理应用本身的文件，包括应用的名字如何命名，默认就是 myApp </span></span>
<span class="line"><span style="color:#ABB2BF;">    │   ├── </span><span style="color:#56B6C2;">__init__</span><span style="color:#ABB2BF;">.py</span></span>
<span class="line"><span style="color:#ABB2BF;">    │   ├── migrations	记录数据库变更信息的目录，Django 中自带的数据库版本控制功能就体现在这个目录</span></span>
<span class="line"><span style="color:#ABB2BF;">    │   │    └── </span><span style="color:#56B6C2;">__init__</span><span style="color:#ABB2BF;">.py</span></span>
<span class="line"><span style="color:#ABB2BF;">    │   ├── models.py	创建映射类的文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    │   ├── tests.py	编写测试代码的文件</span></span>
<span class="line"><span style="color:#ABB2BF;">    │   ├── views.py	创建视图函数的文件，用于处理客户端发来的请求</span></span>
<span class="line"><span style="color:#ABB2BF;">    │   └── urls.py	为了创建 URLconf，自建文件</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在 myProject/settings.py 修改 INSTALLED_APPS 项，添加创建的应用名称 myApp， <br> <strong>View</strong> <br> 编写视图</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># myApp/views.py</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> django.shortcuts </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> render</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> django.http </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> HttpResponse</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">index</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">request</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">HttpResponse</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Hello, world!&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>映射路径</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># myApp/urls.py</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> django.urls </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> path</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> . </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> views</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">urlpatterns </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">path</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">, views.index, </span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;index&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在根 URLconf 文件中指定我们创建的myApp.urls</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># myProject/urls.py</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> django.contrib </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> admin</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> django.urls </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> path,include</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> myApp </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> views  </span><span style="color:#7F848E;font-style:italic;"># 引入视图函数</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">urlpatterns </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">path</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;admin/&#39;</span><span style="color:#ABB2BF;">, admin.site.urls),</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">path</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;myApp/&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#61AFEF;">include</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;myApp.urls&#39;</span><span style="color:#ABB2BF;">)), </span><span style="color:#7F848E;font-style:italic;"># 新增路由映射</span></span>
<span class="line"><span style="color:#ABB2BF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>Model 模型</strong></p><ul><li>编辑 models.py 文件，改变模型。</li><li>python manage.py makemigrations 对模型的更改创建新的迁移表</li><li>python manage.py migrate 应用迁移到数据库中</li></ul><p><strong>数据迁移（Migrations）</strong> <br> 修改Model后，需要进行数据迁移。迁移是Django对模型所做的更改传递到数据库中的方式。 <br> 每当对数据库进行了更改（添加、修改、删除等）操作，都需要进行数据迁移。</p><p>模型是真实数据的简明描述，对应数据库的一张表，包含了存储的数据所必要的字段和行为。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># myApp/models.py</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> django.db </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> models</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Book</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">models</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Model</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> models.</span><span style="color:#61AFEF;">CharField</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">max_length</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    author </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> models.</span><span style="color:#61AFEF;">CharField</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">max_length</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">100</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    pub_date </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> models.</span><span style="color:#61AFEF;">DateTimeField</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;date published&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>模型是 django.db.models.Model 类的子类。每个字段都是 Field 类的实例。</p><p>为这个应用创建数据库 schema（生成 CREATE TABLE 语句）。 <br> 创建可以与 Book 对象进行交互的 Python 数据库 API。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># myProject/settings.py</span></span>
<span class="line"><span style="color:#D19A66;">INSTALLED_APPS</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&#39;django.contrib.admin&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&#39;django.contrib.auth&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&#39;django.contrib.contenttypes&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&#39;django.contrib.sessions&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&#39;django.contrib.messages&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&#39;django.contrib.staticfiles&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&#39;myApp&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#7F848E;font-style:italic;"># 等同&#39;myApp.apps.MyappConfig&#39;,</span></span>
<span class="line"><span style="color:#ABB2BF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">python manage.py makemigrations myApp</span></span>
<span class="line"><span style="color:#ABB2BF;">检测模型文件的修改，并且把修改的部分储存为一次迁移</span></span>
<span class="line"><span style="color:#ABB2BF;">python manage.py sqlmigrate myApp </span><span style="color:#D19A66;">0</span><span style="color:#FFFFFF;">001</span></span>
<span class="line"><span style="color:#ABB2BF;">展示迁移命令会执行自动执行的SQL 语句</span></span>
<span class="line"><span style="color:#ABB2BF;">在数据库里创建新定义的模型的数据表</span></span>
<span class="line"><span style="color:#ABB2BF;">python manage.py migrate</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>Template 模板</strong> <br> 在 myProject/myApp 里创建一个 templates 目录。Django 会在这个目录里查找模板文件。 <br> myProject/settings.py 文件中的 TEMPLATES 配置项描述了 Django 如何载入和渲染模板。默认设置了 DjangoTemplates 后端，并设置 APP_DIRS = True。这一选项将会让 DjangoTemplates 在每个 INSTALLED_APPS 文件夹中寻找 templates 子目录。 <br> 新建模板文件 myApp/templates/myApp/detail.html，</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">!</span><span style="color:#FFFFFF;">--</span><span style="color:#ABB2BF;">myApp</span><span style="color:#56B6C2;">/</span><span style="color:#ABB2BF;">templates</span><span style="color:#56B6C2;">/</span><span style="color:#ABB2BF;">myApp</span><span style="color:#56B6C2;">/</span><span style="color:#ABB2BF;">detail.html</span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">h1</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">Book List</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">h1</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">table</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">tr</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">书名</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">作者</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">出版社</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">出版时间</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">tr</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  {</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> book </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> book_list.all </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">tr</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">{{ book.name }}</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">{{ book.author }}</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">{{ book.pub_house }}</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">{{ book.pub_date }}</span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">td</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">tr</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">  {</span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> endfor </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;/</span><span style="color:#ABB2BF;">table</span><span style="color:#56B6C2;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>对于 <code>{ { book.name } }</code> ，首先 Django 尝试对 book 对象使用字典查找（也就是使用 obj.get(str) 操作），如果失败了就尝试属性查找（也就是 obj.str 操作），最后尝试列表查找（也就是 obj[int] 操作）。 <br> book_list.all 被解释为 Python 代码 book_list.objects.all()，将会返回一个可迭代的 Book 对象 <br> 创建视图来返回图书列表：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># myApp/views.py</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> django.shortcuts </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> render</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> django.http </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> HttpResponse</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> myApp.models </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Book</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">detail</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">request</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">num</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    book_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Book.objects.</span><span style="color:#61AFEF;">order_by</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;-pub_date&#39;</span><span style="color:#ABB2BF;">)[:num]</span></span>
<span class="line"><span style="color:#ABB2BF;">    context </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;book_list&#39;</span><span style="color:#ABB2BF;">: book_list}</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">render</span><span style="color:#ABB2BF;">(request, </span><span style="color:#98C379;">&#39;myApp/detail.html&#39;</span><span style="color:#ABB2BF;">, context)</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 类视图</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">DetailView</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">generic</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">DetailView</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    model </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Book</span></span>
<span class="line"><span style="color:#ABB2BF;">    template_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;myApp/detail.html&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>通用视图： ListView 和 DetailView <br> 视图函数 detail 中，首先将数据库的 Book 列表按照 pub_date 时间来排序，存储到变量 book_list 中。 <br> render() 函数返回给定模板呈现的给定文本的一个 HttpResponse 对象。 <br> context 信息将会返回到模板 myApp/detail.html <br> 添加新视图</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># myApp/urls.py</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> django.urls </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> path</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> . </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> views</span></span>
<span class="line"><span style="color:#ABB2BF;">app_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;myApp&#39;</span><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># URL names的命名空间</span></span>
<span class="line"><span style="color:#ABB2BF;">urlpatterns </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">path</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">, views.index, </span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;index&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">path</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;&lt;int:num&gt;/&#39;</span><span style="color:#ABB2BF;">, views.detail, </span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;detail&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// 模板中硬编码的URLs</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">li</span><span style="color:#ABB2BF;">&gt;&lt;</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;font-style:italic;">href</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;/myApp/{{ book.id }}/&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">li</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 推荐</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">li</span><span style="color:#ABB2BF;">&gt;&lt;</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;font-style:italic;">href</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;{% url &#39;myApp:detail&#39; book.id %}&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">li</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>启动项目 python manage.py runserver [127.0.0.1:8000]</p><p><strong>后台</strong> <br> python manage.py createsuperuser 创建管理员账号 <br> Username: rain <br> Email address: <a href="mailto:1493636205@qq.com" target="_blank" rel="noreferrer">1493636205@qq.com</a> <br> Password:15675347347 <br> 在admin中注册应用</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#E06C75;">myApp</span><span style="color:#56B6C2;">/</span><span style="color:#E5C07B;">admin</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">py</span></span>
<span class="line"><span style="color:#E06C75;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">django</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">contrib</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">admin</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> .</span><span style="color:#E06C75;">models</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">Book</span></span>
<span class="line"><span style="color:#E06C75;">admin</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">site</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">register</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">Book</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>快捷函数 <br> django.shortcuts</p><ul><li>render(request, template_name, context=None, content_type=None, status=None, using=None)：将给定的模板与给定的上下文字典组合在一起，并以渲染的文本返回一个 HttpResponse 对象。</li><li>redirect(to, *args, permanent=False, **kwargs)：将一个 HttpResponseRedirect 返回到传递的参数的适当URL。</li><li>get_object_or_404(klass, *args, **kwargs)：在给定的模型管理器( model manager) 上调用 get() ，但它会引发 Http404 而不是模型的 DoesNotExist 异常。</li><li>get_list_or_404(klass, *args, **kwargs)：返回给定模型管理器上 filter() 转换为列表的结果，如果结果列表为空，则引发 Http404。</li></ul><h3 id="模型-model" tabindex="-1">模型（Model） <a class="header-anchor" href="#模型-model" aria-label="Permalink to &quot;模型（Model）&quot;">​</a></h3><ul><li>每个模型在Django中的存在形式为一个django.db.models.Model的子类</li><li>模型的每个字段（属性）代表数据表的某一列</li></ul><p>字段名中不能有两个以上下划线在一起，因为两个下划线是Django的查询语法 <br> 字段类型</p><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>AutoField</td><td>一个自动增加的整数类型字段，从1开始计数。 id = models.AutoField(primary_key=True) 一个模型中只允许有一个自增字段，并且该字段必须为主键！</td></tr><tr><td>BigAutoField</td><td>64位整数类型自增字段</td></tr><tr><td>BigIntegerField</td><td>64位整数字段</td></tr><tr><td>BinaryField</td><td>二进制数据类型</td></tr><tr><td>BooleanField</td><td>布尔值类型，默认值是None</td></tr><tr><td>CharField</td><td>字符串类型。必须接收一个max_length参数</td></tr><tr><td>CommaSeparatedIntegerField</td><td>逗号分隔的整数类型。必须接收一个max_length参数。常用于表示较大的金额数目，例如1,000,000元。</td></tr><tr><td>DateField</td><td>class DateField(auto_now=False, auto_now_add=False, **options) 日期类型 auto_now：用于保存最后修改时间。 auto_now_add：用于保存创建日期</td></tr><tr><td>DateTimeField</td><td>日期时间类型</td></tr><tr><td>DecimalField</td><td>固定精度的十进制小数 max_digits：最大的位数，必须大于或等于小数点位数 。 decimal_places：小数点位数，精度。</td></tr><tr><td>DurationField</td><td>持续时间类型。存储一定期间的时间长度。</td></tr><tr><td>EmailField</td><td>邮箱类型，默认max_length最大长度254位</td></tr><tr><td>FileField</td><td>class FileField(upload_to=None, max_length=100, **options) 上传文件类型</td></tr><tr><td>FilePathField</td><td>文件路径类型</td></tr><tr><td>FloatField</td><td>浮点数类型</td></tr><tr><td>ImageField</td><td>图像类型</td></tr><tr><td>IntegerField</td><td>整数类型</td></tr><tr><td>GenericIPAddressField</td><td>class GenericIPAddressField(protocol=&#39;both&#39;, unpack_ipv4=False, **options)[source] IPV4或者IPV6地址</td></tr><tr><td>NullBooleanField</td><td>含NULL的布尔字段</td></tr><tr><td>PositiveIntegerField</td><td>正整数字段，0-2147483647。</td></tr><tr><td>PositiveSmallIntegerField</td><td>较小的正整数字段，0-32767。</td></tr><tr><td>SlugField</td><td>标签，用于URLs，max_length=50。</td></tr><tr><td>SmallIntegerField</td><td>小整数，-32768-32767。</td></tr><tr><td>TextField</td><td>文本内容</td></tr><tr><td>TimeField</td><td>时间字段</td></tr><tr><td>URLField</td><td>用于保存URL地址的字符串类型，默认最大长度200。</td></tr><tr><td>UUIDField</td><td>用于保存通用唯一识别码（Universally Unique Identifier）的字段</td></tr></tbody></table><p>关系类型字段 <br> class ForeignKey(to, on_delete, **options) <br> class ManyToManyField(to, **options) <br> class OneToOneField(to, on_delete, parent_link=False, **options)</p><p>字段选项 <br> null：字段为空时，Django 会将数据库中该字段设置为 NULL。 <br> blank：是否允许字段为空。 <br> choices：一系列二元组，用作此字段的选项 <br> default：字段的默认值 <br> help_text：额外的“帮助”文本，随表单控件一同显示 <br> primary_key： <br> unique： <br> db_column：定义当前字段在数据表内的列名。如果未指定，Django将使用字段名作为列名。 <br> db_index：是否为该字段创建索引。 <br> db_tablespace：用于字段索引的数据库表空间的名字，前提是当前字段设置了索引 <br> editable：如果设为False，那么当前字段将不会在admin后台或者其它的ModelForm表单中显示，同时还会被模型验证功能跳过。 <br> error_messages：用于自定义错误信息。参数接收字典类型的值。字典的键可以是null、 blank、 invalid、 invalid_choice、 unique和unique_for_date其中的一个。 <br> unique_for_date：日期唯一 <br> unique_for_month <br> unique_for_year <br> verbose_name：为字段设置一个人类可读，更加直观的别名。</p><p>查询集 <br> class QuerySet(model=None, query=None, using=None)</p><table><thead><tr><th>方法名</th><th>解释</th></tr></thead><tbody><tr><td>filter()</td><td>过滤查询对象。</td></tr><tr><td>exclude()</td><td>排除满足条件的对象</td></tr><tr><td>annotate()</td><td>使用聚合函数</td></tr><tr><td>order_by()</td><td>对查询集进行排序</td></tr><tr><td>reverse()</td><td>反向排序</td></tr><tr><td>distinct()</td><td>对查询集去重</td></tr><tr><td>values()</td><td>返回包含对象具体值的字典的QuerySet</td></tr><tr><td>values_list()</td><td>与values()类似，返回元组</td></tr><tr><td>dates()</td><td>根据日期获取查询集</td></tr><tr><td>datetimes()</td><td>根据时间获取查询集</td></tr><tr><td>none()</td><td>创建空的查询集</td></tr><tr><td>all()</td><td>获取所有的对象</td></tr><tr><td>union()</td><td>并集</td></tr><tr><td>intersection()</td><td>交集</td></tr><tr><td>difference()</td><td>差集</td></tr><tr><td>select_related()</td><td>附带查询关联对象</td></tr><tr><td>prefetch_related()</td><td>预先查询</td></tr><tr><td>extra()</td><td>附加SQL查询</td></tr><tr><td>defer()</td><td>不加载指定字段</td></tr><tr><td>only()</td><td>只加载指定的字段</td></tr><tr><td>using()</td><td>选择数据库</td></tr><tr><td>select_for_update()</td><td>锁住选择的对象，直到事务结束。</td></tr><tr><td>raw()</td><td>接收一个原始的SQL查询</td></tr></tbody></table><table><thead><tr><th>方法名</th><th>解释</th></tr></thead><tbody><tr><td>get()</td><td>获取单个对象</td></tr><tr><td>create()</td><td>创建对象，无需save()</td></tr><tr><td>get_or_create()</td><td>查询对象，如果没有找到就新建对象</td></tr><tr><td>update_or_create()</td><td>更新对象，如果没有找到就创建对象</td></tr><tr><td>bulk_create()</td><td>批量创建对象</td></tr><tr><td>count()</td><td>统计对象的个数</td></tr><tr><td>in_bulk()</td><td>根据主键值的列表，批量返回对象</td></tr><tr><td>iterator()</td><td>获取包含对象的迭代器</td></tr><tr><td>latest()</td><td>获取最近的对象</td></tr><tr><td>earliest()</td><td>获取最早的对象</td></tr><tr><td>first()</td><td>获取第一个对象</td></tr><tr><td>last()</td><td>获取最后一个对象</td></tr><tr><td>aggregate()</td><td>聚合操作</td></tr><tr><td>exists()</td><td>判断queryset中是否有对象</td></tr><tr><td>update()</td><td>批量更新对象</td></tr><tr><td>delete()</td><td>批量删除对象</td></tr><tr><td>as_manager()</td><td>获取管理器</td></tr></tbody></table><p>查询参数</p><table><thead><tr><th>字段名</th><th>说明</th></tr></thead><tbody><tr><td>exact</td><td>精确匹配</td></tr><tr><td>iexact</td><td>不区分大小写的精确匹配</td></tr><tr><td>contains</td><td>包含匹配</td></tr><tr><td>icontains</td><td>不区分大小写的包含匹配</td></tr><tr><td>in</td><td>在..之内的匹配</td></tr><tr><td>gt</td><td>大于</td></tr><tr><td>gte</td><td>大于等于</td></tr><tr><td>lt</td><td>小于</td></tr><tr><td>lte</td><td>小于等于</td></tr><tr><td>startswith</td><td>从开头匹配</td></tr><tr><td>istartswith</td><td>不区分大小写从开头匹配</td></tr><tr><td>endswith</td><td>从结尾处匹配</td></tr><tr><td>iendswith</td><td>不区分大小写从结尾处匹配</td></tr><tr><td>range</td><td>范围匹配</td></tr><tr><td>date</td><td>日期匹配</td></tr><tr><td>year</td><td>年份</td></tr><tr><td>month</td><td>月份</td></tr><tr><td>day</td><td>日期</td></tr><tr><td>week</td><td>第几周</td></tr><tr><td>week_day</td><td>周几</td></tr><tr><td>time</td><td>时间</td></tr><tr><td>hour</td><td>小时</td></tr><tr><td>minute</td><td>分钟</td></tr><tr><td>second</td><td>秒</td></tr><tr><td>isnull</td><td>判断是否为空</td></tr><tr><td>regex</td><td>区分大小写的正则匹配</td></tr><tr><td>iregex</td><td>不区分大小写的正则匹配</td></tr></tbody></table><p>聚合函数</p><ul><li>expression：引用模型字段的一个字符串，或者一个query expression。</li><li>output_field：表示返回值的model field，一个可选的参数。</li><li>**extra：关键字参数可以给聚合函数生成的SQL提供额外的信息。</li><li>Avg：class Avg(expression, output_field=FloatField(), **extra)</li><li>Count：class Count(expression, distinct=False, **extra)</li><li>Max：class Max(expression, output_field=None, **extra)</li><li>Min：class Min(expression, output_field=None, **extra)</li><li>StdDev：class StdDev(expression, sample=False, **extra) 标准差</li><li>Sum：class Sum(expression, output_field=None, **extra)</li><li>Variance：class Variance(expression, sample=False, **extra) 方差</li></ul><p>视图 <br> class HttpRequest <br> 每当一个用户请求发送过来，Django将HTTP数据包中的相关内容，打包成为一个HttpRequest对象，并传递给每个视图函数作为第一位置参数，也就是request，供我们调用 <br> class QueryDict <br> HttpRequest对象的GET和POST属性都是一个django.http.QueryDict <br> class HttpResponse <br> 每个视图实例化、填充和返回一个HttpResponse对象</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># views.py</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 视图函数</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">article_list</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">request</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&quot;&quot;&quot;处理GET请求&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> request.method </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;GET&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        articles </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ArticlePost.objects.</span><span style="color:#61AFEF;">all</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        context </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;articles&#39;</span><span style="color:#ABB2BF;">: articles}</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">render</span><span style="color:#ABB2BF;">(request, </span><span style="color:#98C379;">&#39;article/list.html&#39;</span><span style="color:#ABB2BF;">, context)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 类视图</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> django.views </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> View</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ArticleListView</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">View</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&quot;&quot;&quot;处理GET请求&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">request</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        articles </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> ArticlePost.objects.</span><span style="color:#61AFEF;">all</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        context </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;articles&#39;</span><span style="color:#ABB2BF;">: articles}</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">render</span><span style="color:#ABB2BF;">(request, </span><span style="color:#98C379;">&#39;article/list.html&#39;</span><span style="color:#ABB2BF;">, context)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># urls.py</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 视图函数</span></span>
<span class="line"><span style="color:#ABB2BF;">urlpatterns </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">path</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.../&lt;int:id&gt;&#39;</span><span style="color:#ABB2BF;">, views.article_list, </span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;...&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 类视图</span></span>
<span class="line"><span style="color:#ABB2BF;">urlpatterns </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">path</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.../&lt;int:pk&gt;&#39;</span><span style="color:#ABB2BF;">, views.ArticleListView.</span><span style="color:#61AFEF;">as_view</span><span style="color:#ABB2BF;">(), </span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;...&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>模板 <br> get_template（template_name，using = None） <br> 使用给定的名称查找和加载模板，并返回一个Template对象 <br> select_template（template_name_list，using = None） <br> Template.render(context=None, request=None) <br> 通过给定的context对该模板进行渲染。 <br> render_to_string(template_name, context=None, request=None, using=None)</p><table><thead><tr><th>标签</th><th>说明</th></tr></thead><tbody><tr><td>autoescape</td><td>自动转义开关</td></tr><tr><td>block</td><td>块引用</td></tr><tr><td>comment</td><td>注释</td></tr><tr><td>csrf_token</td><td>CSRF令牌</td></tr><tr><td>cycle</td><td>循环对象的值</td></tr><tr><td>debug</td><td>调试模式</td></tr><tr><td>extends</td><td>继承模版</td></tr><tr><td>filter</td><td>过滤功能</td></tr><tr><td>firstof</td><td>输出第一个不为False的参数</td></tr><tr><td>for</td><td>循环对象</td></tr><tr><td>for … empty</td><td>带empty说明的循环</td></tr><tr><td>if</td><td>条件判断</td></tr><tr><td>ifequal</td><td>如果等于</td></tr><tr><td>ifnotequal</td><td>如果不等于</td></tr><tr><td>ifchanged</td><td>如果有变化，则..</td></tr><tr><td>include</td><td>导入子模版的内容</td></tr><tr><td>load</td><td>加载标签和过滤器</td></tr><tr><td>lorem</td><td>生成无用的废话</td></tr><tr><td>now</td><td>当前时间</td></tr><tr><td>regroup</td><td>根据对象重组集合</td></tr><tr><td>resetcycle</td><td>重置循环</td></tr><tr><td>spaceless</td><td>去除空白</td></tr><tr><td>templatetag</td><td>转义模版标签符号</td></tr><tr><td>url</td><td>获取url字符串</td></tr><tr><td>verbatim</td><td>禁用模版引擎</td></tr><tr><td>widthratio</td><td>宽度比例</td></tr><tr><td>with</td><td>上下文变量管理器</td></tr></tbody></table><h3 id="django-rest-framework" tabindex="-1"><a href="https://github.com/encode/django-rest-framework" target="_blank" rel="noreferrer">django-rest-framework</a> <a class="header-anchor" href="#django-rest-framework" aria-label="Permalink to &quot;[django-rest-framework](https://github.com/encode/django-rest-framework)&quot;">​</a></h3><h2 id="fastapi" tabindex="-1"><a href="https://fastapi.tiangolo.com/" target="_blank" rel="noreferrer">FastAPI</a> <a class="header-anchor" href="#fastapi" aria-label="Permalink to &quot;[FastAPI](https://fastapi.tiangolo.com/)&quot;">​</a></h2><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> typing </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Optional</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> fastapi </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> FastAPI</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> uvicorn</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">app </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">FastAPI</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">read_root</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&quot;Hello&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;World&quot;</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">@app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/items/</span><span style="color:#D19A66;">{item_id}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">read_item</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">item_id</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">q</span><span style="color:#ABB2BF;">: Optional[</span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&quot;item_id&quot;</span><span style="color:#ABB2BF;">: item_id, </span><span style="color:#98C379;">&quot;q&quot;</span><span style="color:#ABB2BF;">: q}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;__main__&quot;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    uvicorn.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">app</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">app, </span><span style="color:#E06C75;font-style:italic;">host</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;127.0.0.1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">port</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">5000</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">log_level</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;info&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="requests" tabindex="-1"><a href="https://github.com/psf/requests" target="_blank" rel="noreferrer">requests</a> <a class="header-anchor" href="#requests" aria-label="Permalink to &quot;[requests](https://github.com/psf/requests)&quot;">​</a></h2><p><code>requests.request(method, url, **kwargs)</code> <br> request(method, url, params=None, data=None, headers=None, cookies=None, files=None, auth=None, timeout=None, allow_redirects=True, proxies=None, hooks=None, stream=None, verify=None, cert=None, json=None) <br> 参数:</p><ul><li>method -- method for the new Request object.</li><li>url：请求服务器地址；</li><li>params：字典或字节序列形式的请求参数（请求地址中？后面的键值对参数）；</li><li>data：字典，字节序或文件对象；向服务器提交的数据内容；</li><li>json：json格式的数据（与data=json.dumps(jsBody)等价）；</li><li>headers：字典，请求头信息；</li><li>cookies：字典或CookieJar，只从http中解析cookie；</li><li>auth：元组，支持http认证功能；</li><li>files：字典，向服务器上传文件；</li><li>timeout：设定超时秒数；</li><li>proxies：字典，设定访问代理服务器；</li><li>allow_redirects: 开关， 表示是否允许对url进行重定向， 默认为True。</li><li>stream: 开关， 指是否对获取内容进行立即下载， 默认为True。</li><li>verify：开关， 用于认证SSL证书， 默认为True。</li><li>cert： 用于设置保存本地SSL证书路径</li></ul><p>requests.head(url, **kwargs) <br> requests.get(url, params=None, **kwargs) <br> requests.post(url, data=None, json=None, **kwargs) <br> requests.put(url, data=None, **kwargs) <br> requests.patch(url, data=None, **kwargs) <br> requests.delete(url, **kwargs)</p><p><strong>class requests.Session</strong></p><p><strong>class requests.Response</strong></p><ul><li>request <ul><li>body</li><li>method</li><li>headers</li></ul></li><li>url</li><li>text -- Content of the response, in unicode.</li><li>content -- Content of the response, in bytes.</li><li>json(**kwargs) -- Returns the json-encoded content of a respon</li><li>status_code</li><li>raw</li><li>ok</li><li>is_redirect</li><li>headers</li><li>cookies</li><li>history</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> json</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> functools </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> wraps</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">func</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @wraps</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">func</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">wrapper</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, *</span><span style="color:#D19A66;font-style:italic;">args</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;running </span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">, func.</span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            res </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">func</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, *args, **kwargs)</span></span>
<span class="line"><span style="color:#ABB2BF;">            response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response</span></span>
<span class="line"><span style="color:#ABB2BF;">            request </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> response.request</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;send -&gt; </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">request.method</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">response.url</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;request headers: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">request.headers</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> request.body:</span></span>
<span class="line"><span style="color:#ABB2BF;">                logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;request body: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">request.body</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;recevie &lt;- </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">response.status_code</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;response headers: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">response.headers</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">except</span><span style="color:#ABB2BF;"> Exception </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> exception:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">exception</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;request error&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">not</span><span style="color:#ABB2BF;"> response.ok:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;request failed: &#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;response result: &#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response.headers[</span><span style="color:#98C379;">&#39;Content-Type&#39;</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">find</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;json&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">                json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">(), </span><span style="color:#E06C75;font-style:italic;">indent</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">ensure_ascii</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(response.text)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> res</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> wrapper</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ApiGateway</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">object</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">__init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">host</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path_prefix</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.host </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> host</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.path_prefix </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> path_prefix</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">Session</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># self.session.proxies = {&quot;https&quot;: None, &quot;http&quot;: None}</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.verify </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">False</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">None</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">update_headers</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @</span><span style="color:#56B6C2;">property</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">context_path</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.host </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.path_prefix</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">update_headers</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">_request</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">method</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">not</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">hasattr</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session, method):</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">raise</span><span style="color:#ABB2BF;"> ValueError(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;don&#39;t have </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">method</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        request_method </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">getattr</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session, method)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">request_method</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.context_path </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> path, **kwargs)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">_get</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.context_path </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> path, **kwargs)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">_post</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">json</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.context_path </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> path, data, json,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                          **kwargs)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">_put</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.context_path </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> path, data,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                         **kwargs)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">_delete</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">delete</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.context_path </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> path, **kwargs)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">__del__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">CloudJson</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ApiGateway</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">__init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">security_key</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">super</span><span style="color:#ABB2BF;">().</span><span style="color:#56B6C2;">__init__</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://json.extendsclass.com&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> security_key:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.headers.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&quot;Security-key&quot;</span><span style="color:#ABB2BF;">: security_key})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @log</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">create_bin</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">api_key</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">private</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#98C379;">&quot;Api-key&quot;</span><span style="color:#ABB2BF;">: api_key,</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#98C379;">&quot;Private&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;true&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> private </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;false&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_post</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;/bin&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">), </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @log</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">obtain</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">id</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_get</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;/bin/</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">id</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @log</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">id</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_put</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;/bin/</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">id</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @log</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">partially_update</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">id</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&quot;Content-type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json-patch+json&quot;</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;PATCH&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                      </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;/bin/</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">id</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                      </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">                      </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @log</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">delete</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">id</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_delete</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;/bin/</span><span style="color:#D19A66;">{</span><span style="color:#56B6C2;">id</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @log</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">bins</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">api_key</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&quot;Api-key&quot;</span><span style="color:#ABB2BF;">: api_key}</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/bins&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 下载大文件，一次性加载可能会导致内存爆满，可采取分块读写的方法</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">download_file</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    req </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;http://www.test.com/test.jpg&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">stream</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;c:</span><span style="color:#56B6C2;">\\t</span><span style="color:#E06C75;">est.jpg&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;wb&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> f:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> chunk </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> req.</span><span style="color:#61AFEF;">iter_content</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">chunk_size</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1024</span><span style="color:#ABB2BF;">):  </span><span style="color:#7F848E;font-style:italic;"># 每次加载1024字节</span></span>
<span class="line"><span style="color:#ABB2BF;">            f.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(chunk)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">id</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;659e99c04915&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    key </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;7816b5a9-451c-11ec-b95c-0242ac110002&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    cj </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">CloudJson</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;ec&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    r </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> cj.</span><span style="color:#61AFEF;">obtain</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">id</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># cj.bins(key)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br></div></div><h2 id="aiohttp" tabindex="-1"><a href="https://github.com/aio-libs/aiohttp" target="_blank" rel="noreferrer">aiohttp</a> <a class="header-anchor" href="#aiohttp" aria-label="Permalink to &quot;[aiohttp](https://github.com/aio-libs/aiohttp)&quot;">​</a></h2><p>class aiohttp.ClientSession(base_url=None, *, connector=None, cookies=None, headers=None, skip_auto_headers=None, auth=None, json_serialize=json.dumps, version=aiohttp.HttpVersion11, cookie_jar=None, read_timeout=None, conn_timeout=None, timeout=sentinel, raise_for_status=False, connector_owner=True, auto_decompress=True, read_bufsize=2 ** 16, requote_redirect_url=False, trust_env=False, trace_configs=None)</p><p>coroutine async-with request(method, url, *, params=None, data=None, json=None, cookies=None, headers=None, skip_auto_headers=None, auth=None, allow_redirects=True, max_redirects=10, compress=None, chunked=None, expect100=False, raise_for_status=None, read_until_eof=True, read_bufsize=None, proxy=None, proxy_auth=None, timeout=sentinel, ssl=None, verify_ssl=None, fingerprint=None, ssl_context=None, proxy_headers=None)</p><p>coroutine async-with ws_connect(url, *, method=&#39;GET&#39;, protocols=(), timeout=10.0, receive_timeout=None, auth=None, autoclose=True, autoping=True, heartbeat=None, origin=None, params=None, headers=None, proxy=None, proxy_auth=None, ssl=None, verify_ssl=None, fingerprint=None, ssl_context=None, proxy_headers=None, compress=0, max_msg_size=4194304)</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> aiohttp.</span><span style="color:#61AFEF;">ClientSession</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> session:</span></span>
<span class="line"><span style="color:#ABB2BF;">        headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&#39;Accept&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;application/json&#39;</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;http://httpbin.org/get&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">headers) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> resp:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(resp.status)</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> resp.</span><span style="color:#61AFEF;">text</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">asyncio.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> session.</span><span style="color:#61AFEF;">ws_connect</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;http://example.org/ws&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> ws:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> msg </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> ws:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> msg.type </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> aiohttp.WSMsgType.</span><span style="color:#D19A66;">TEXT</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> msg.data </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;close cmd&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> ws.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#C678DD;">break</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> ws.</span><span style="color:#61AFEF;">send_str</span><span style="color:#ABB2BF;">(msg.data </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;/answer&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">elif</span><span style="color:#ABB2BF;"> msg.type </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> aiohttp.WSMsgType.</span><span style="color:#D19A66;">ERROR</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">break</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">ApiGateway</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">object</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">__init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">host</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path_prefix</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">str</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.host </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> host</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.path_prefix </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> path_prefix</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> aiohttp.</span><span style="color:#61AFEF;">ClientSession</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">None</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.headers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @</span><span style="color:#56B6C2;">property</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">context_path</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.host </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.path_prefix</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">_get</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.context_path </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> path,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                               **kwargs)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">_post</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.context_path </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> path,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                                </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                                **kwargs)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">_put</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">data</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.context_path </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> path,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                               </span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">data,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                               **kwargs)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">_delete</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, **</span><span style="color:#D19A66;font-style:italic;">kwargs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">delete</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.context_path </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> path,</span></span>
<span class="line"><span style="color:#ABB2BF;">                                                  **kwargs)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.session.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    api </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">ApiGateway</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;http://httpbin.org&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">_post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/post&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">json</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&#39;key&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;value&#39;</span><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#ABB2BF;">    res </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> api.response.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">await</span><span style="color:#ABB2BF;"> api.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(res, </span><span style="color:#E06C75;font-style:italic;">indent</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">asyncio.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">())</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h2 id="loguru" tabindex="-1"><a href="https://github.com/Delgan/loguru" target="_blank" rel="noreferrer">loguru</a> <a class="header-anchor" href="#loguru" aria-label="Permalink to &quot;[loguru](https://github.com/Delgan/loguru)&quot;">​</a></h2><p><strong>logger</strong></p><ul><li><p><code>add(sink, *, level=&#39;DEBUG&#39;, format=&#39;&lt;green&gt;{time:YYYY-MM-DD HH:mm:ss.SSS}&lt;/green&gt; | &lt;level&gt;{level: &lt;8}&lt;/level&gt; | &lt;cyan&gt;{name}&lt;/cyan&gt;:&lt;cyan&gt;{function}&lt;/cyan&gt;:&lt;cyan&gt;{line}&lt;/cyan&gt; - &lt;level&gt;{message}&lt;/level&gt;&#39;, filter=None, colorize=None, serialize=False, backtrace=True, diagnose=True, enqueue=False, catch=True, **kwargs)</code></p></li><li><p>remove(handler_id=None)</p></li><li><p>complete() Wait for the end of enqueued messages and asynchronous tasks scheduled by handlers</p></li><li><p><code>catch(exception=&lt;class &#39;Exception&#39;&gt;, *, level=&#39;ERROR&#39;, reraise=False, onerror=None, exclude=None, default=None, message=&quot;An error has been caught in function &#39;{record[function]}&#39;, process &#39;{record[process].name}&#39; ({record[process].id}), thread &#39;{record[thread].name}&#39; ({record[thread].id}):&quot;)</code></p></li><li><p>opt() Parametrize a logging call to slightly change generated log message.</p></li><li><p>bind()</p></li><li><p>contextualize()</p></li><li><p>patch()</p></li><li><p>level()</p></li><li><p>disable()</p></li><li><p>enable()</p></li><li><p>configure()</p></li><li><p>parse()</p></li><li><p>log()</p></li><li><p>exception()</p><p><br> severity levels</p></li></ul><table><thead><tr><th><strong>Level name</strong></th><th><strong>Severity value</strong></th><th><strong>Logger method</strong></th></tr></thead><tbody><tr><td>TRACE</td><td>5</td><td><a href="https://loguru.readthedocs.io/en/stable/api/logger.html#loguru._logger.Logger.trace" target="_blank" rel="noreferrer">logger.trace()</a></td></tr><tr><td>DEBUG</td><td>10</td><td><a href="https://loguru.readthedocs.io/en/stable/api/logger.html#loguru._logger.Logger.debug" target="_blank" rel="noreferrer">logger.debug()</a></td></tr><tr><td>INFO</td><td>20</td><td><a href="https://loguru.readthedocs.io/en/stable/api/logger.html#loguru._logger.Logger.info" target="_blank" rel="noreferrer">logger.info()</a></td></tr><tr><td>SUCCESS</td><td>25</td><td><a href="https://loguru.readthedocs.io/en/stable/api/logger.html#loguru._logger.Logger.success" target="_blank" rel="noreferrer">logger.success()</a></td></tr><tr><td>WARNING</td><td>30</td><td><a href="https://loguru.readthedocs.io/en/stable/api/logger.html#loguru._logger.Logger.warning" target="_blank" rel="noreferrer">logger.warning()</a></td></tr><tr><td>ERROR</td><td>40</td><td><a href="https://loguru.readthedocs.io/en/stable/api/logger.html#loguru._logger.Logger.error" target="_blank" rel="noreferrer">logger.error()</a></td></tr><tr><td>CRITICAL</td><td>50</td><td><a href="https://loguru.readthedocs.io/en/stable/api/logger.html#loguru._logger.Logger.critical" target="_blank" rel="noreferrer">logger.critical()</a></td></tr></tbody></table><p><br> record dict</p><table><thead><tr><th><strong>Key</strong></th><th><strong>Description</strong></th><th><strong>Attributes</strong></th></tr></thead><tbody><tr><td>elapsed</td><td>The time elapsed since the start of the program</td><td>See <a href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" target="_blank" rel="noreferrer">datetime.timedelta</a></td></tr><tr><td>exception</td><td>The formatted exception if any, None otherwise</td><td>type, value, traceback</td></tr><tr><td>extra</td><td>The dict of attributes bound by the user (see <a href="https://loguru.readthedocs.io/en/stable/api/logger.html#loguru._logger.Logger.bind" target="_blank" rel="noreferrer">bind()</a>)</td><td>None</td></tr><tr><td>file</td><td>The file where the logging call was made</td><td>name (default), path</td></tr><tr><td>function</td><td>The function from which the logging call was made</td><td>None</td></tr><tr><td>level</td><td>The severity used to log the message</td><td>name (default), no, icon</td></tr><tr><td>line</td><td>The line number in the source code</td><td>None</td></tr><tr><td>message</td><td>The logged message (not yet formatted)</td><td>None</td></tr><tr><td>module</td><td>The module where the logging call was made</td><td>None</td></tr><tr><td>name</td><td>The <strong>name</strong> where the logging call was made</td><td>None</td></tr><tr><td>process</td><td>The process in which the logging call was made</td><td>name, id (default)</td></tr><tr><td>thread</td><td>The thread in which the logging call was made</td><td>name, id (default)</td></tr><tr><td>time</td><td>The aware local time when the logging call was made</td><td>See <a href="https://docs.python.org/3/library/datetime.html#datetime.datetime" target="_blank" rel="noreferrer">datetime.datetime</a></td></tr></tbody></table><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> loguru </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> logger</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">logger.</span><span style="color:#61AFEF;">debug</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;That&#39;s it, beautiful and simple logging!&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;If you&#39;re using Python </span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">, prefer </span><span style="color:#D19A66;">{feature}</span><span style="color:#98C379;"> of course!&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3.6</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">feature</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;f-strings&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">logger.</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(sys.stderr, </span><span style="color:#E06C75;font-style:italic;">format</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{time}</span><span style="color:#98C379;"> </span><span style="color:#D19A66;">{level}</span><span style="color:#98C379;"> </span><span style="color:#D19A66;">{message}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">filter</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;my_module&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">level</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;INFO&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">logger.</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;file_1.log&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">rotation</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;500 MB&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">compression</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;zip&quot;</span><span style="color:#ABB2BF;">)    </span><span style="color:#7F848E;font-style:italic;"># Automatically rotate too big file</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Exceptions catching within threads or main</span></span>
<span class="line"><span style="color:#61AFEF;">@logger</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">catch</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">my_function</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">x</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">y</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">z</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># An error? It&#39;s caught anyway!</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">/</span><span style="color:#ABB2BF;"> (x </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> y </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> z)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="lxml" tabindex="-1"><a href="https://lxml.de/" target="_blank" rel="noreferrer">lxml</a> <a class="header-anchor" href="#lxml" aria-label="Permalink to &quot;[lxml](https://lxml.de/)&quot;">​</a></h2><p>Class _Element(顶级基类)</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Properties(属性)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#ABB2BF;">attrib  </span><span style="color:#7F848E;font-style:italic;"># 元素属性字典</span></span>
<span class="line"><span style="color:#ABB2BF;">base  </span><span style="color:#7F848E;font-style:italic;"># 原始文档的url或None</span></span>
<span class="line"><span style="color:#ABB2BF;">sourceline  </span><span style="color:#7F848E;font-style:italic;"># 原始行数或None</span></span>
<span class="line"><span style="color:#ABB2BF;">tag  </span><span style="color:#7F848E;font-style:italic;"># tag名</span></span>
<span class="line"><span style="color:#ABB2BF;">tail  </span><span style="color:#7F848E;font-style:italic;"># 尾巴文本(存在于兄弟节点间，属于父节点的文本内容)</span></span>
<span class="line"><span style="color:#ABB2BF;">text  </span><span style="color:#7F848E;font-style:italic;"># 位于第一个子标签之前的子文本</span></span>
<span class="line"><span style="color:#ABB2BF;">prefix  </span><span style="color:#7F848E;font-style:italic;"># 命名空间前缀(XML)(详解见底部附录)</span></span>
<span class="line"><span style="color:#ABB2BF;">nsmap  </span><span style="color:#7F848E;font-style:italic;"># 命名空间与URL映射关系(XML)(详解见底部附录)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Instance Methods(实例方法)(常用)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#61AFEF;">xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, _path, </span><span style="color:#E06C75;font-style:italic;">namespaces</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">extensions</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">smart_strings</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, **_variables)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 通过xpath表达式查找指定节点元素，返回指定节点元素列表或None</span></span>
<span class="line"><span style="color:#61AFEF;">getparent</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查找父节点，返回找到的父节点对象或None</span></span>
<span class="line"><span style="color:#61AFEF;">getprevious</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查找前一个相邻的兄弟节点元素，返回找到的节点对象或None</span></span>
<span class="line"><span style="color:#61AFEF;">getnext</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查找后一个相邻的兄弟节点对象，返回找到的节点对象或None</span></span>
<span class="line"><span style="color:#61AFEF;">getchildren</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 返回所有直属的子节点对象</span></span>
<span class="line"><span style="color:#61AFEF;">getroottree</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 返回所在文档的根节点树</span></span>
<span class="line"><span style="color:#61AFEF;">find</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, path, </span><span style="color:#E06C75;font-style:italic;">namespaces</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 根据标签名或路径，返回第一个匹配到的子节点对象</span></span>
<span class="line"><span style="color:#61AFEF;">findall</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, path, </span><span style="color:#E06C75;font-style:italic;">namespaces</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 根据标签名或路径，返回全部符合要求的子节点对象</span></span>
<span class="line"><span style="color:#61AFEF;">findtext</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, path, </span><span style="color:#E06C75;font-style:italic;">default</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">namespaces</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 根据标签名或路径，返回第一个匹配到的子节点对象的text文本</span></span>
<span class="line"><span style="color:#61AFEF;">clear</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 重置节点对象，清除所有子节点对象，以及所有的text、tail对象</span></span>
<span class="line"><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, key, </span><span style="color:#E06C75;font-style:italic;">default</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 返回节点属性key对应的值</span></span>
<span class="line"><span style="color:#61AFEF;">items</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 以任意顺序返回节点属性键和值</span></span>
<span class="line"><span style="color:#61AFEF;">keys</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 以任意顺序返回包含节点全部属性名的列表</span></span>
<span class="line"><span style="color:#61AFEF;">values</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 以任意顺序返回包含节点全部属性值的列表</span></span>
<span class="line"><span style="color:#56B6C2;">set</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, key, value)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置节点属性</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>lxml.etree</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">object</span><span style="color:#ABB2BF;"> </span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">-+</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#56B6C2;">|</span></span>
<span class="line"><span style="color:#ABB2BF;">   _Element </span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">-+</span></span>
<span class="line"><span style="color:#ABB2BF;">               </span><span style="color:#56B6C2;">|</span></span>
<span class="line"><span style="color:#ABB2BF;">              ElementBase</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#61AFEF;">Functions</span><span style="color:#ABB2BF;">(函数)(常用)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#61AFEF;">HTML</span><span style="color:#ABB2BF;">(text, </span><span style="color:#E06C75;font-style:italic;">parser</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">base_url</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 将字符型HTML文档内容转换为节点树对象</span></span>
<span class="line"><span style="color:#61AFEF;">fromstring</span><span style="color:#ABB2BF;">(text, </span><span style="color:#E06C75;font-style:italic;">parser</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">base_url</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 将字符型XML文档或文档片段转换问节点树对象</span></span>
<span class="line"><span style="color:#61AFEF;">tostring</span><span style="color:#ABB2BF;">(element_or_tree, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">method</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;xml&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">xml_declaration</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">pretty_print</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">with_tail</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">standalone</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">doctype</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">exclusive</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">with_commments</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">inclusive_ns_prefixes</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 将节点树对象序列化为编码的字符型</span></span>
<span class="line"><span style="color:#61AFEF;">tounicode</span><span style="color:#ABB2BF;">(element_or_tree, </span><span style="color:#E06C75;font-style:italic;">method</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;xml&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">pretty_print</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">with_tail</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">doctype</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 将节点树对象序列化为Unicode型</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>lxml.html</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">object</span><span style="color:#ABB2BF;"> </span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">-+</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#56B6C2;">|</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">etree._Element </span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">-+</span></span>
<span class="line"><span style="color:#ABB2BF;">                  </span><span style="color:#56B6C2;">|</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">    etree.ElementBase</span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">-+</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">                        </span><span style="color:#56B6C2;">|</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">         </span><span style="color:#56B6C2;">object</span><span style="color:#ABB2BF;"> </span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">-+</span><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">|</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">                   </span><span style="color:#56B6C2;">|</span><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">|</span></span>
<span class="line"><span style="color:#ABB2BF;">           HtmlMixin </span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">-+</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">                        </span><span style="color:#56B6C2;">|</span></span>
<span class="line"><span style="color:#ABB2BF;">                       HtmlElement</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#61AFEF;">Functions</span><span style="color:#ABB2BF;">(函数)(常用)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#61AFEF;">fromstring</span><span style="color:#ABB2BF;">(html, </span><span style="color:#E06C75;font-style:italic;">base_url</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">parser</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, **kwargs)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 将字符型html文档转换为节点树或文档树</span></span>
<span class="line"><span style="color:#61AFEF;">tostring</span><span style="color:#ABB2BF;">(doc, </span><span style="color:#E06C75;font-style:italic;">pretty_print</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">include_meta_content_type</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">method</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;html&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">with_tail</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">doctype</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 将节点树或文档树序列化为字符型</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">######################################</span></span>
<span class="line"><span style="color:#56B6C2;">**</span><span style="color:#ABB2BF;">Class HtmlMixin</span><span style="color:#56B6C2;">**</span></span>
<span class="line"><span style="color:#56B6C2;">object</span><span style="color:#ABB2BF;"> </span><span style="color:#FFFFFF;">--</span><span style="color:#56B6C2;">-+</span></span>
<span class="line"><span style="color:#ABB2BF;">          </span><span style="color:#56B6C2;">|</span></span>
<span class="line"><span style="color:#ABB2BF;">          HtmlMixin</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#61AFEF;">Properties</span><span style="color:#ABB2BF;">(属性)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#ABB2BF;">base_url  </span><span style="color:#7F848E;font-style:italic;"># 文档url</span></span>
<span class="line"><span style="color:#ABB2BF;">head  </span><span style="color:#7F848E;font-style:italic;"># &lt;head&gt;标签部分</span></span>
<span class="line"><span style="color:#ABB2BF;">body  </span><span style="color:#7F848E;font-style:italic;"># &lt;body&gt;标签部分</span></span>
<span class="line"><span style="color:#ABB2BF;">forms  </span><span style="color:#7F848E;font-style:italic;"># 返回全部form列表</span></span>
<span class="line"><span style="color:#ABB2BF;">label  </span><span style="color:#7F848E;font-style:italic;"># 元素的label标签</span></span>
<span class="line"><span style="color:#ABB2BF;">classes  </span><span style="color:#7F848E;font-style:italic;"># class属性值的集合</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#ABB2BF;">Instance </span><span style="color:#61AFEF;">Methods</span><span style="color:#ABB2BF;">(实例方法)(常用)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># =====================================</span></span>
<span class="line"><span style="color:#61AFEF;">drop_tag</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 移除标签，但不移除其子标签和text文本，将其合并到父节点</span></span>
<span class="line"><span style="color:#61AFEF;">drop_tree</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 移除节点树（包含子节点和text），但不移除它的tail文本，将其合并到父节点或前一个兄弟节点</span></span>
<span class="line"><span style="color:#61AFEF;">find_class</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, class_name)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 根据class属性值查找节点元素</span></span>
<span class="line"><span style="color:#61AFEF;">get_element_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, rel)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 根据id属性值查找节点元素</span></span>
<span class="line"><span style="color:#56B6C2;">set</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, key, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置节点元素的属性</span></span>
<span class="line"><span style="color:#61AFEF;">text_content</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 返回其后代节点与其自身的全部text内容</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>爬取Bilibili排行榜</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> requests</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> lxml </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> etree</span></span>
<span class="line"><span style="color:#ABB2BF;">url </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;https://www.bilibili.com/ranking&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">header </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;User-Agent&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Mozilla/5.0&#39;</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">response </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> requests.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">url</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">url, </span><span style="color:#E06C75;font-style:italic;">headers</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">header)</span></span>
<span class="line"><span style="color:#ABB2BF;">response.encoding </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;utf-8&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">hot_text </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> response.text</span></span>
<span class="line"><span style="color:#ABB2BF;">tree </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> etree.</span><span style="color:#61AFEF;">HTML</span><span style="color:#ABB2BF;">(hot_text)</span></span>
<span class="line"><span style="color:#ABB2BF;">rank_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> tree.</span><span style="color:#61AFEF;">xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;//ul[@class=&quot;rank-list&quot;]/li&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;排名</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">标题</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">综合得分</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> num,li </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">enumerate</span><span style="color:#ABB2BF;">(rank_list,</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(num,</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(li.</span><span style="color:#61AFEF;">xpath</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.//a[@class=&quot;title&quot;]/text() | .//div[@class=&quot;pts&quot;]/div/text()&#39;</span><span style="color:#ABB2BF;">)))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="selenium" tabindex="-1"><a href="https://www.selenium.dev/" target="_blank" rel="noreferrer">Selenium</a> <a class="header-anchor" href="#selenium" aria-label="Permalink to &quot;[Selenium](https://www.selenium.dev/)&quot;">​</a></h2><p><a href="https://www.selenium.dev/zh-cn/documentation/getting_started/installing_browser_drivers/" target="_blank" rel="noreferrer">browser drivers</a></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Chrome</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 简单赋值</span></span>
<span class="line"><span style="color:#ABB2BF;">driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">executable_path</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;./chromedriver&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 或者使用上下文管理器</span></span>
<span class="line"><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> driver:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 打开百度</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://www.baidu.com/&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 输入搜索关键字</span></span>
<span class="line"><span style="color:#ABB2BF;">    element </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;kw&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    element.</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;selenium&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 点击搜索按钮</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element_by_id</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;su&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 关闭</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>package API</strong> <br> <strong>WebDriver</strong> <br> chrome</p><ul><li>class selenium.webdriver.chrome.options.Options</li><li>class selenium.webdriver.chrome.webdriver.WebDriver(executable_path=&#39;chromedriver&#39;, port=0, options: selenium.webdriver.chrome.options.Options = None, service_args=None, desired_capabilities=None, service_log_path=None, chrome_options=None, service: selenium.webdriver.chrome.service.Service = None, keep_alive=None)</li><li>class selenium.webdriver.chrome.service.Service(executable_path: str, port: int = 0, service_args: List[str] = None, log_path: str = None, env: str = None)</li></ul><p><strong>元素定位</strong> <br> class selenium.webdriver.common.by.By</p><ul><li>CLASS_NAME = &#39;class name&#39;</li><li>CSS_SELECTOR = &#39;css selector&#39;</li><li>ID = &#39;id&#39;</li><li>LINK_TEXT = &#39;link text&#39;</li><li>NAME = &#39;name&#39;</li><li>PARTIAL_LINK_TEXT = &#39;partial link text&#39;</li><li>TAG_NAME = &#39;tag name&#39;</li><li>XPATH = &#39;xpath&#39;</li></ul><p><a href="https://www.selenium.dev/selenium/docs/api/py/webdriver/selenium.webdriver.common.keys.html#module-selenium.webdriver.common.keys" target="_blank" rel="noreferrer"><strong>selenium.webdriver.common.keys</strong></a> <br> Set of special keys codes. <br> <a href="https://www.selenium.dev/selenium/docs/api/py/webdriver_support/selenium.webdriver.support.event_firing_webdriver.html#module-selenium.webdriver.support.event_firing_webdriver" target="_blank" rel="noreferrer"><strong>selenium.webdriver.support.event_firing_webdriver</strong></a> <br> <a href="https://www.selenium.dev/selenium/docs/api/py/webdriver_support/selenium.webdriver.support.abstract_event_listener.html#module-selenium.webdriver.support.abstract_event_listener" target="_blank" rel="noreferrer"><strong>selenium.webdriver.support.abstract_event_listener</strong></a></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Firefox</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support.events </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> EventFiringWebDriver, AbstractEventListener</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">MyListener</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">AbstractEventListener</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">before_navigate_to</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">url</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">driver</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Before navigate to </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> url)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">after_navigate_to</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">url</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">driver</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;After navigate to </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> url)</span></span>
<span class="line"><span style="color:#ABB2BF;">driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Firefox</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">ef_driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">EventFiringWebDriver</span><span style="color:#ABB2BF;">(driver, </span><span style="color:#61AFEF;">MyListener</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">ef_driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;http://www.google.co.in/&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><a href="https://www.selenium.dev/zh-cn/documentation/webdriver/browser_manipulation/" target="_blank" rel="noreferrer">操控浏览器</a></p><ul><li>current_url</li><li>page_source</li><li>title</li><li>back() 后退</li><li>forward() 前进</li><li>refresh() 刷新</li><li>close() 关闭单个窗口</li><li>quit() 关闭所有窗口</li><li>execute_async_script(script, *args)</li><li>execute_script(script, *args)</li><li>find_element(by=&#39;id&#39;, value=None)</li><li>find_elements(by=&#39;id&#39;, value=None)</li></ul><p>窗口管理</p><ul><li>set_window_size(480, 800)</li><li>get_window_size()</li><li>set_window_position(0, 0)</li><li>get_window_position()</li><li>maximize_window()</li><li>minimize_window(self)</li><li>fullscreen_window(self)</li><li>save_screenshot(&#39;./image.png&#39;)</li><li>get_screenshot_as_file()</li></ul><p>窗口和标签页</p><ul><li>current_window_handle：获得当前窗口句柄。</li><li>window_handles：返回所有窗口的句柄到当前会话。</li></ul><p><strong>class SwitchTo</strong></p><ul><li>window(window_name)</li><li>default_content() 跳回最外层的页面</li><li>frame(frame_reference) 可以直接取表单的id 或name属性</li><li>parent_frame()</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support.ui </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> WebDriverWait</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> expected_conditions </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">EC</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 启动驱动程序</span></span>
<span class="line"><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Firefox</span><span style="color:#ABB2BF;">() </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> driver:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 打开网址</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://seleniumhq.github.io&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 设置等待</span></span>
<span class="line"><span style="color:#ABB2BF;">    wait </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">WebDriverWait</span><span style="color:#ABB2BF;">(driver, </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 存储原始窗口的 ID</span></span>
<span class="line"><span style="color:#ABB2BF;">    original_window </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.current_window_handle</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 检查一下，我们还没有打开其他的窗口</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">assert</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(driver.window_handles) </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 单击在新窗口中打开的链接</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">LINK_TEXT</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;new window&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 等待新窗口或标签页</span></span>
<span class="line"><span style="color:#ABB2BF;">    wait.</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">number_of_windows_to_be</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 循环执行，直到找到一个新的窗口句柄</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> window_handle </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> driver.window_handles:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> window_handle </span><span style="color:#56B6C2;">!=</span><span style="color:#ABB2BF;"> original_window:</span></span>
<span class="line"><span style="color:#ABB2BF;">            driver.switch_to.</span><span style="color:#61AFEF;">window</span><span style="color:#ABB2BF;">(window_handle)</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;">break</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 等待新标签页完成加载内容</span></span>
<span class="line"><span style="color:#ABB2BF;">    wait.</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">title_is</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;SeleniumHQ Browser Automation&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 通过 id 切换框架</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.switch_to.</span><span style="color:#61AFEF;">frame</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;buttonframe&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 单击按钮</span></span>
<span class="line"><span style="color:#ABB2BF;">    driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">TAG_NAME</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;button&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><a href="https://www.selenium.dev/zh-cn/documentation/webdriver/page_loading_strategy/" target="_blank" rel="noreferrer">页面加载策略</a></p><ul><li>normal(默认)：等待整个页面的加载（返回 load 事件）</li><li>eager：保持等待, 直到完全加载并解析了HTML文档（返回 DOMContentLoaded 事件）</li><li>none：仅等待至初始页面下载完成.</li></ul><p><a href="https://www.selenium.dev/selenium/docs/api/py/webdriver_support/selenium.webdriver.support.wait.html#module-selenium.webdriver.support.wait" target="_blank" rel="noreferrer"><strong>selenium.webdriver.support.wait</strong></a> <br> WebDriverWait(driver, timeout, poll_frequency=0.5, ignored_exceptions=None) 显性等待</p><ul><li>driver ：浏览器驱动。</li><li>timeout ：最长超时时间，默认以秒为单位。</li><li>poll_frequency ：检测的间隔（步长）时间，默认为0.5S。</li><li>ignored_exceptions ：超时后的异常信息，默认情况下抛NoSuchElementException异常。</li><li>until(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为True。</li><li>until_not(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为False。</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">element </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">WebDriverWait</span><span style="color:#ABB2BF;">(driver, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0.5</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">EC</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">presence_of_element_located</span><span style="color:#ABB2BF;">((By.</span><span style="color:#D19A66;">ID</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;kw&quot;</span><span style="color:#ABB2BF;">)))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>隐性等待最大时间 <br> driver.implicitly_wait(seconds) <br> <strong>cookies</strong></p><ul><li>get_cookies()： 获得所有cookie信息。</li><li>get_cookie(name)： 返回字典的key为“name”的cookie信息。</li><li>add_cookie(cookie_dict) ： 添加cookie。“cookie_dict”指字典对象，必须有name 和value 值。</li><li>delete_cookie(name,optionsString)：删除cookie信息。“name”是要删除的cookie的名称，“optionsString”是该cookie的选项，目前支持的选项包括“路径”，“域”。</li><li>delete_all_cookies()： 删除所有cookie信息</li></ul><p><strong>class WebElement()</strong></p><ul><li>tag_name</li><li>location</li><li>size： 返回元素的尺寸。</li><li>text： 获取元素的文本。</li><li>rect 元素的尺寸和坐标</li><li>clear() 清除文本</li><li>send_keys(*value) 模拟按键输入</li><li>click()</li><li>submit()</li><li>get_property(name)</li><li>get_attribute(name)</li><li>is_displayed() 是否用户可见</li><li>is_selected()</li><li>is_enabled()</li></ul><p><a href="https://www.selenium.dev/selenium/docs/api/py/webdriver/selenium.webdriver.common.action_chains.html#module-selenium.webdriver.common.action_chains" target="_blank" rel="noreferrer"><strong>selenium.webdriver.common.action_chains</strong></a> <br> **class ActionChains(**driver)</p><ul><li>click(on_element=None)</li><li>click_and_hold(on_element=None)</li><li>context_click(on_element=None) 右击</li><li>double_click(on_element=None)</li><li>drag_and_drop(source, target)</li><li>drag_and_drop_by_offset(source, xoffset, yoffset)</li><li>key_down(value, element=None)</li><li>key_up(value, element=None)</li><li>move_to_element(to_element) 鼠标悬停</li><li>move_by_offset(xoffset, yoffset)</li><li>perform()： 执行所有 ActionChains 中存储的行为；</li><li>pause(seconds)</li><li>release(on_element=None)</li><li>reset_actions()</li><li>send_keys(*keys_to_send)</li><li>send_keys_to_element(element, *keys_to_send)</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># pressing ctrl+c</span></span>
<span class="line"><span style="color:#61AFEF;">ActionChains</span><span style="color:#ABB2BF;">(driver).</span><span style="color:#61AFEF;">key_down</span><span style="color:#ABB2BF;">(Keys.</span><span style="color:#D19A66;">CONTROL</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;c&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">key_up</span><span style="color:#ABB2BF;">(Keys.</span><span style="color:#D19A66;">CONTROL</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">perform</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><a href="https://www.selenium.dev/selenium/docs/api/py/webdriver/selenium.webdriver.common.touch_actions.html#module-selenium.webdriver.common.touch_actions" target="_blank" rel="noreferrer"><strong>selenium.webdriver.common.touch_actions</strong></a> <br> TouchActions(driver)</p><ul><li>double_tap(on_element)</li><li>flick(xspeed, yspeed)</li><li>flick_element(on_element, xoffset, yoffset, speed)</li><li>long_press(on_element)</li><li>move(xcoord, ycoord)</li><li>perform()</li><li>release(xcoord, ycoord)</li><li>scroll(xoffset, yoffset)</li><li>scroll_from_element(on_element, xoffset, yoffset)</li><li>tap(on_element)</li><li>tap_and_hold(xcoord, ycoord)</li></ul><p>Others</p><ul><li>selenium.webdriver.common.utils</li><li>selenium.webdriver.common.proxy</li><li>selenium.webdriver.common.service</li><li>selenium.webdriver.common.html5.application_cache</li><li>selenium.webdriver.support.abstract_event_listener</li><li>selenium.webdriver.support.color</li><li>selenium.webdriver.support.event_firing_webdriver</li><li>selenium.webdriver.support.expected_conditions</li><li>selenium.webdriver.support.select</li><li>Webdriver.remote</li></ul><p>Chrome</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.action_chains </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> ActionChains</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.keys </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Keys</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.support.ui </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> WebDriverWait</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> time </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> sleep</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">find_element_wait</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">driver</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">locator</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">timeout</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        显式等待，动态查找元素</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">WebDriverWait</span><span style="color:#ABB2BF;">(driver, timeout).</span><span style="color:#61AFEF;">until</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">lambda</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;font-style:italic;">s</span><span style="color:#ABB2BF;">: s.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(*locator))</span></span>
<span class="line"><span style="color:#ABB2BF;">options </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">ChromeOptions</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">options.binary_location </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;./chrome.exe&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 解决崩溃问题</span></span>
<span class="line"><span style="color:#ABB2BF;">options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;--no-sandbox&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 控制chrome以无界面模式打开</span></span>
<span class="line"><span style="color:#ABB2BF;">options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;--headless&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;--disable-gpu&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 去除 ‘Chrome正受到自动测试软件的控制’ 提示</span></span>
<span class="line"><span style="color:#ABB2BF;">options.</span><span style="color:#61AFEF;">add_experimental_option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;excludeSwitches&quot;</span><span style="color:#ABB2BF;">, [</span><span style="color:#98C379;">&#39;enable-automation&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 打开谷歌浏览器</span></span>
<span class="line"><span style="color:#ABB2BF;">driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">executable_path</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&quot;./chromedriver.exe&quot;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">options</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">options)</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://www.agefans.tv&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 输入搜索关键字</span></span>
<span class="line"><span style="color:#61AFEF;">find_element_wait</span><span style="color:#ABB2BF;">(driver,(</span><span style="color:#98C379;">&#39;id&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;top_search_input&#39;</span><span style="color:#ABB2BF;">)).</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;斗罗大陆&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">find_element_wait</span><span style="color:#ABB2BF;">(driver, (</span><span style="color:#98C379;">&#39;class name&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;search_submit&#39;</span><span style="color:#ABB2BF;">)).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.switch_to.</span><span style="color:#61AFEF;">window</span><span style="color:#ABB2BF;">(driver.window_handles[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#61AFEF;">find_element_wait</span><span style="color:#ABB2BF;">(driver, (</span><span style="color:#98C379;">&#39;link text&#39;</span><span style="color:#ABB2BF;">, animate)).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.switch_to.</span><span style="color:#61AFEF;">window</span><span style="color:#ABB2BF;">(driver.window_handles[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#61AFEF;">find_element_wait</span><span style="color:#ABB2BF;">(driver, (</span><span style="color:#98C379;">&#39;partial link text&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;100&#39;</span><span style="color:#ABB2BF;">)).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.switch_to.</span><span style="color:#61AFEF;">window</span><span style="color:#ABB2BF;">(driver.window_handles[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">play_frame </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">find_element_wait</span><span style="color:#ABB2BF;">(driver, (</span><span style="color:#98C379;">&#39;xpath&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;//*[@id=&quot;age_playfram&quot;]&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.switch_to.</span><span style="color:#61AFEF;">frame</span><span style="color:#ABB2BF;">(play_frame)</span></span>
<span class="line"><span style="color:#ABB2BF;">e </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">find_element_wait</span><span style="color:#ABB2BF;">(driver, (</span><span style="color:#98C379;">&#39;xpath&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;/html/body/div/div[4]/div[4]&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#61AFEF;">ActionChains</span><span style="color:#ABB2BF;">(driver).</span><span style="color:#61AFEF;">move_to_element_with_offset</span><span style="color:#ABB2BF;">(e, </span><span style="color:#D19A66;">150</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">()\\</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">send_keys</span><span style="color:#ABB2BF;">(Keys.</span><span style="color:#D19A66;">SPACE</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">perform</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="scrapy" tabindex="-1"><a href="https://scrapy.org/" target="_blank" rel="noreferrer">Scrapy</a> <a class="header-anchor" href="#scrapy" aria-label="Permalink to &quot;[Scrapy](https://scrapy.org/)&quot;">​</a></h2><p><a href="https://www.osgeo.cn/scrapy/index.html" target="_blank" rel="noreferrer">https://www.osgeo.cn/scrapy/index.html</a> <br> conda install -c conda-forge scrapy <br> scrapy [options] [args] <br> bench Run quick benchmark test <br> fetch Fetch a URL using the Scrapy downloader <br> genspider Generate new spider using pre-defined templates <br> runspider Run a self-contained spider (without creating a project) <br> settings Get settings values <br> shell Interactive scraping console <br> startproject Create new project <br> version Print Scrapy version <br> view Open URL in browser, as seen by Scrapy <br> <img src="https://www.runoob.com/wp-content/uploads/2018/10/8c591d54457bb033812a2b0364011e9c_articlex.png#id=GKVZl&amp;originHeight=494&amp;originWidth=700&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><ul><li>Scrapy Engine(引擎): 负责Spider、ItemPipeline、Downloader、Scheduler中间的通讯，信号、数据传递等。</li><li>Scheduler(调度器): 接受引擎发送过来的Request请求，并按照一定的方式进行整理排列，入队</li><li>Downloader（下载器）：负责下载引擎发送的所有Requests请求，并将其获取到的Responses交还</li><li>Spider（爬虫）：处理所有Responses，从中分析提取数据，获取Item字段需要的数据，并将需要跟进的URL提交给引擎</li><li>Item Pipeline(管道)：负责处理Spider中获取到的Item，并进行进行后期处理（详细分析、过滤、存储等）的地方。</li><li>Downloader Middlewares（下载中间件）：可以自定义扩展下载功能的组件。</li><li>Spider Middlewares（Spider中间件）：可以自定扩展和操作引擎和Spider中间通信的功能组件</li></ul><h2 id="pytest" tabindex="-1">Pytest <a class="header-anchor" href="#pytest" aria-label="Permalink to &quot;Pytest&quot;">​</a></h2><p><a href="https://www.osgeo.cn/pytest/contents.html" target="_blank" rel="noreferrer">https://www.osgeo.cn/pytest/contents.html</a> <br> 调用方法</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">pytest [options] [file_or_dir] [file_or_dir] [</span><span style="color:#D19A66;">...</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">pytest </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">s 显示程序中的print</span><span style="color:#56B6C2;">/</span><span style="color:#ABB2BF;">logging输出</span></span>
<span class="line"><span style="color:#ABB2BF;">pytest </span><span style="color:#FFFFFF;">--</span><span style="color:#ABB2BF;">fixtures  </span><span style="color:#7F848E;font-style:italic;"># 显示可用的内置方法参数</span></span>
<span class="line"><span style="color:#ABB2BF;">pytest </span><span style="color:#FFFFFF;">--</span><span style="color:#ABB2BF;">maxfail</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">n    </span><span style="color:#7F848E;font-style:italic;"># n次失败后停止</span></span>
<span class="line"><span style="color:#ABB2BF;">pytest </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">k </span><span style="color:#98C379;">&quot;MyClass and not method&quot;</span><span style="color:#ABB2BF;">	</span><span style="color:#7F848E;font-style:italic;">#按关键字表达式运行用例</span></span>
<span class="line"><span style="color:#ABB2BF;">pytest test_mod.py::TestClass::test_method	</span><span style="color:#7F848E;font-style:italic;">#执行模块中某条指定的测试用例</span></span>
<span class="line"><span style="color:#ABB2BF;">pytest </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">m slow	</span><span style="color:#7F848E;font-style:italic;">#执行所有带@pytest.mark.slow装饰器的用例</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>测试文件以test_开头（以_test结尾也可以）</li><li>测试类以Test开头，并且不能带有 <strong>init</strong> 方法</li><li>测试函数以test_开头</li><li>断言使用基本的assert即可</li></ul><p>自定义运行规则</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">#pytest.ini</span></span>
<span class="line"><span style="color:#ABB2BF;">[pytest]</span></span>
<span class="line"><span style="color:#ABB2BF;">addopts </span><span style="color:#56B6C2;">=-</span><span style="color:#ABB2BF;">s</span></span>
<span class="line"><span style="color:#ABB2BF;">testpaths </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> testcase  </span><span style="color:#7F848E;font-style:italic;">#当前目录下的testcase文件夹</span></span>
<span class="line"><span style="color:#ABB2BF;">python_files </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> test_</span><span style="color:#56B6C2;">*</span><span style="color:#ABB2BF;">.py  </span><span style="color:#7F848E;font-style:italic;">#当前目录下,以test_开头,以.py结尾的所有文件</span></span>
<span class="line"><span style="color:#ABB2BF;">python_classes </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> Test_</span><span style="color:#56B6C2;">*</span><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">#当前目录下,以Test_开头的类</span></span>
<span class="line"><span style="color:#ABB2BF;">python_functions </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> test_</span><span style="color:#56B6C2;">*</span><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;">#当前目录下,以test_开头的方法</span></span>
<span class="line"><span style="color:#ABB2BF;">log_cli_level </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">INFO</span><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 实时日志记录捕获的最小日志消息级别</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>@pytest.fixture(scope=&#39;function&#39;, params=None, autouse=False, ids=None, name=None)</strong> <br> scope</p><ul><li>function ：默认范围，则在测试结束时销毁fixture。</li><li>class ：在课程中最后一次测试的拆卸过程中，夹具被破坏。</li><li>module ：在模块中最后一次测试的拆卸过程中，夹具被破坏。</li><li>package ：在拆下包装中的最后一次试验时，夹具被破坏。</li><li>session ：夹具在测试会话结束时被销毁。</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> pytest</span></span>
<span class="line"><span style="color:#61AFEF;">@pytest</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">fixture</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">user</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;setup -- 前置初始化&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">yield</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;yoyo&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;teardown -- 后置清理&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_1</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">user</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">assert</span><span style="color:#ABB2BF;"> user </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;yoyo&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;测试通过&#39;</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_2</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">user</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">assert</span><span style="color:#ABB2BF;"> user </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;yuyu&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;测试失败&#39;</span></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">__name__</span><span style="color:#56B6C2;">==</span><span style="color:#98C379;">&#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    pytest.</span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;-s&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;test_fixture.py&#39;</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>参数化</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [(</span><span style="color:#98C379;">&quot;username1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;password1&quot;</span><span style="color:#ABB2BF;">), (</span><span style="color:#98C379;">&quot;username2&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;password2&quot;</span><span style="color:#ABB2BF;">)]</span></span>
<span class="line"><span style="color:#61AFEF;">@pytest</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">fixture</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">params</span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;">data</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">get_data</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">request</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(request.param)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> request.param</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_login</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">get_data</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;账号：</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> get_data[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">], </span><span style="color:#98C379;">&quot;密码：</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> get_data[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><a href="/Notes/pytest.mark..html">_@_pytest.mark. </a></p><ul><li>skip - 始终跳过该测试用例</li><li>skipif - 遇到特定情况跳过该测试用例</li><li>xfail - 遇到特定情况，产生一个“期望失败”输出</li><li>parametrize(argnames,argvalues,indirect = False,ids = None,scope = None) - 在同一个测试用例上运行多次调用(参数化数据驱动)</li><li>filterwarnings - 为标记的测试项添加警告过滤器。</li></ul><p><strong>断言</strong> <br> 使用assert语句进行断言 <br> 异常断言</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">myfunc</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">raise</span><span style="color:#ABB2BF;"> ValueError(</span><span style="color:#98C379;">&quot;Exception 123 raised&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_match</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">with</span><span style="color:#ABB2BF;"> pytest.</span><span style="color:#61AFEF;">raises</span><span style="color:#ABB2BF;">(ValueError,</span><span style="color:#E06C75;font-style:italic;">match</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;.</span><span style="color:#D19A66;">*</span><span style="color:#E06C75;"> 123 .</span><span style="color:#D19A66;">*</span><span style="color:#E06C75;">&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">myfunc</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#ABB2BF;">等同 </span><span style="color:#56B6C2;">@</span><span style="color:#ABB2BF;">pytest.mark.</span><span style="color:#61AFEF;">xfail</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">raises</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">ValueError)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>警示断言 pytest.warns <br> <strong>插件</strong></p><ul><li><p>pytest-timeout 标记超时时间 @pytest.mark.timeout(60)</p></li><li><p>pytest-html 生成html报告插件 --html=report.html</p></li><li><p><a href="https://docs.pytest.org/en/latest/reference/reference.html#functions" target="_blank" rel="noreferrer">Functions</a></p><ul><li>approx(expected, rel=None, abs=None, nan_ok=False)</li><li>fail(msg=&#39;&#39;, pytrace=True)</li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-skip" target="_blank" rel="noreferrer">pytest.skip</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-importorskip" target="_blank" rel="noreferrer">pytest.importorskip</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-xfail" target="_blank" rel="noreferrer">pytest.xfail</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-exit" target="_blank" rel="noreferrer">pytest.exit</a></li><li><strong>main(<em>args=None</em>, <em>plugins=None</em>)</strong></li><li><strong>param(<em>*values</em>[, <em>id</em>][, <em>marks</em>])</strong></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-raises" target="_blank" rel="noreferrer">pytest.raises</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-deprecated-call" target="_blank" rel="noreferrer">pytest.deprecated_call</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-register-assert-rewrite" target="_blank" rel="noreferrer">pytest.register_assert_rewrite</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-warns" target="_blank" rel="noreferrer">pytest.warns</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-freeze-includes" target="_blank" rel="noreferrer">pytest.freeze_includes</a></li></ul></li><li><p><a href="https://docs.pytest.org/en/latest/reference/reference.html#marks" target="_blank" rel="noreferrer">Marks</a></p><ul><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-mark-filterwarnings" target="_blank" rel="noreferrer">pytest.mark.filterwarnings</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-mark-parametrize" target="_blank" rel="noreferrer">pytest.mark.parametrize</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-mark-skip" target="_blank" rel="noreferrer">pytest.mark.skip</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-mark-skipif" target="_blank" rel="noreferrer">pytest.mark.skipif</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-mark-usefixtures" target="_blank" rel="noreferrer">pytest.mark.usefixtures</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-mark-xfail" target="_blank" rel="noreferrer">pytest.mark.xfail</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-version" target="_blank" rel="noreferrer">pytest.<strong>version</strong></a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-version-tuple" target="_blank" rel="noreferrer">pytest.version_tuple</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#custom-marks" target="_blank" rel="noreferrer">Custom marks</a></li></ul></li><li><p><a href="https://docs.pytest.org/en/latest/reference/reference.html#fixtures" target="_blank" rel="noreferrer">Fixtures</a></p><ul><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytest-fixture" target="_blank" rel="noreferrer">@pytest.fixture</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#config-cache" target="_blank" rel="noreferrer">config.cache</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#capsys" target="_blank" rel="noreferrer">capsys</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#capsysbinary" target="_blank" rel="noreferrer">capsysbinary</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#capfd" target="_blank" rel="noreferrer">capfd</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#capfdbinary" target="_blank" rel="noreferrer">capfdbinary</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#doctest-namespace" target="_blank" rel="noreferrer">doctest_namespace</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#request" target="_blank" rel="noreferrer">request</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytestconfig" target="_blank" rel="noreferrer">pytestconfig</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#record-property" target="_blank" rel="noreferrer">record_property</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#record-testsuite-property" target="_blank" rel="noreferrer">record_testsuite_property</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#caplog" target="_blank" rel="noreferrer">caplog</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#monkeypatch" target="_blank" rel="noreferrer">monkeypatch</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytester" target="_blank" rel="noreferrer">pytester</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#testdir" target="_blank" rel="noreferrer">testdir</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#recwarn" target="_blank" rel="noreferrer">recwarn</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#tmp-path" target="_blank" rel="noreferrer">tmp_path</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#tmp-path-factory" target="_blank" rel="noreferrer">tmp_path_factory</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#tmpdir" target="_blank" rel="noreferrer">tmpdir</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#tmpdir-factory" target="_blank" rel="noreferrer">tmpdir_factory</a></li></ul></li><li><p><a href="https://docs.pytest.org/en/latest/reference/reference.html#hooks" target="_blank" rel="noreferrer">Hooks</a></p><ul><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#bootstrapping-hooks" target="_blank" rel="noreferrer">Bootstrapping hooks</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#initialization-hooks" target="_blank" rel="noreferrer">Initialization hooks</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#collection-hooks" target="_blank" rel="noreferrer">Collection hooks</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#test-running-runtest-hooks" target="_blank" rel="noreferrer">Test running (runtest) hooks</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#reporting-hooks" target="_blank" rel="noreferrer">Reporting hooks</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#debugging-interaction-hooks" target="_blank" rel="noreferrer">Debugging/Interaction hooks</a></li></ul></li><li><p><a href="https://docs.pytest.org/en/latest/reference/reference.html#objects" target="_blank" rel="noreferrer">Objects</a></p><ul><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#callinfo" target="_blank" rel="noreferrer">CallInfo</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#class" target="_blank" rel="noreferrer">Class</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#collector" target="_blank" rel="noreferrer">Collector</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#collectreport" target="_blank" rel="noreferrer">CollectReport</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#config" target="_blank" rel="noreferrer">Config</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#exceptioninfo" target="_blank" rel="noreferrer">ExceptionInfo</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#exitcode" target="_blank" rel="noreferrer">ExitCode</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#file" target="_blank" rel="noreferrer">File</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#fixturedef" target="_blank" rel="noreferrer">FixtureDef</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#fscollector" target="_blank" rel="noreferrer">FSCollector</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#function" target="_blank" rel="noreferrer">Function</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#functiondefinition" target="_blank" rel="noreferrer">FunctionDefinition</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#item" target="_blank" rel="noreferrer">Item</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#markdecorator" target="_blank" rel="noreferrer">MarkDecorator</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#markgenerator" target="_blank" rel="noreferrer">MarkGenerator</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#mark" target="_blank" rel="noreferrer">Mark</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#metafunc" target="_blank" rel="noreferrer">Metafunc</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#module" target="_blank" rel="noreferrer">Module</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#node" target="_blank" rel="noreferrer">Node</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#parser" target="_blank" rel="noreferrer">Parser</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#optiongroup" target="_blank" rel="noreferrer">OptionGroup</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#pytestpluginmanager" target="_blank" rel="noreferrer">PytestPluginManager</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#session" target="_blank" rel="noreferrer">Session</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#testreport" target="_blank" rel="noreferrer">TestReport</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#result" target="_blank" rel="noreferrer">_Result</a></li><li><a href="https://docs.pytest.org/en/latest/reference/reference.html#stash" target="_blank" rel="noreferrer">Stash</a></li></ul></li><li><p><a href="https://docs.pytest.org/en/latest/reference/reference.html#global-variables" target="_blank" rel="noreferrer">Global Variables</a></p></li><li><p><a href="https://docs.pytest.org/en/latest/reference/reference.html#environment-variables" target="_blank" rel="noreferrer">Environment Variables</a></p></li><li><p><a href="https://docs.pytest.org/en/latest/reference/reference.html#exceptions" target="_blank" rel="noreferrer">Exceptions</a></p></li><li><p><a href="https://docs.pytest.org/en/latest/reference/reference.html#warnings" target="_blank" rel="noreferrer">Warnings</a></p></li><li><p><a href="https://docs.pytest.org/en/latest/reference/reference.html#configuration-options" target="_blank" rel="noreferrer">Configuration Options</a></p></li><li><p><a href="https://docs.pytest.org/en/latest/reference/reference.html#command-line-flags" target="_blank" rel="noreferrer">Command-line Flags</a></p></li></ul>`,214),o=[p];function t(r,c,B,i,y,F){return n(),a("div",null,o)}const d=s(e,[["render",t]]);export{b as __pageData,d as default};
