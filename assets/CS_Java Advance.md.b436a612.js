import{_ as s,c as n,o as a,a as l}from"./app.4c53b83e.js";const i=JSON.parse('{"title":"Java Advance","description":"","frontmatter":{"title":"Java Advance","created_at":"2022-04-03T08:46:14.000Z","updated_at":"2022-11-13T14:05:20.000Z","word_count":7461},"headers":[{"level":2,"title":"**\u5E76\u53D1 **Concurrent","slug":"\u5E76\u53D1-concurrent","link":"#\u5E76\u53D1-concurrent","children":[{"level":3,"title":"\u7EBF\u7A0B\uFF08Thread\uFF09","slug":"\u7EBF\u7A0B-thread","link":"#\u7EBF\u7A0B-thread","children":[]},{"level":3,"title":"\u5E76\u53D1\u6838\u5FC3\u673A\u5236","slug":"\u5E76\u53D1\u6838\u5FC3\u673A\u5236","link":"#\u5E76\u53D1\u6838\u5FC3\u673A\u5236","children":[]},{"level":3,"title":"\u7EBF\u7A0B\u901A\u4FE1","slug":"\u7EBF\u7A0B\u901A\u4FE1","link":"#\u7EBF\u7A0B\u901A\u4FE1","children":[]},{"level":3,"title":"\u5E76\u53D1\u9501","slug":"\u5E76\u53D1\u9501","link":"#\u5E76\u53D1\u9501","children":[]},{"level":3,"title":"\u7EBF\u7A0B\u6C60","slug":"\u7EBF\u7A0B\u6C60","link":"#\u7EBF\u7A0B\u6C60","children":[]},{"level":3,"title":"CompletableFuture","slug":"completablefuture","link":"#completablefuture","children":[]}]},{"level":2,"title":"JVM","slug":"jvm","link":"#jvm","children":[{"level":3,"title":"\u8FD0\u884C\u65F6\u6570\u636E\u533A\u57DF","slug":"\u8FD0\u884C\u65F6\u6570\u636E\u533A\u57DF","link":"#\u8FD0\u884C\u65F6\u6570\u636E\u533A\u57DF","children":[]},{"level":3,"title":"\u5783\u573E\u6536\u96C6","slug":"\u5783\u573E\u6536\u96C6","link":"#\u5783\u573E\u6536\u96C6","children":[]},{"level":3,"title":"\u5783\u573E\u6536\u96C6\u5668 Garbage Collector","slug":"\u5783\u573E\u6536\u96C6\u5668-garbage-collector","link":"#\u5783\u573E\u6536\u96C6\u5668-garbage-collector","children":[]},{"level":3,"title":"JDK \u76D1\u63A7\u548C\u6545\u969C\u8BCA\u65AD\u547D\u4EE4\u884C\u5DE5\u5177","slug":"jdk-\u76D1\u63A7\u548C\u6545\u969C\u8BCA\u65AD\u547D\u4EE4\u884C\u5DE5\u5177","link":"#jdk-\u76D1\u63A7\u548C\u6545\u969C\u8BCA\u65AD\u547D\u4EE4\u884C\u5DE5\u5177","children":[]}]}],"relativePath":"CS/Java Advance.md","lastUpdated":1668355447000}'),p={name:"CS/Java Advance.md"},o=l(`<h1 id="java-advance" tabindex="-1">Java Advance <a class="header-anchor" href="#java-advance" aria-hidden="true">#</a></h1><h2 id="\u5E76\u53D1-concurrent" tabindex="-1">**\u5E76\u53D1 **Concurrent <a class="header-anchor" href="#\u5E76\u53D1-concurrent" aria-hidden="true">#</a></h2><p><strong>\u5E76\u53D1\u5B89\u5168</strong>\uFF1A\u662F\u4FDD\u8BC1\u7A0B\u5E8F\u7684\u6B63\u786E\u6027\uFF0C\u4F7F\u5F97\u5E76\u53D1\u5904\u7406\u7ED3\u679C\u7B26\u5408\u9884\u671F <br> \u5E76\u53D1\u5B89\u5168\u9700\u8981\u4FDD\u8BC1\uFF1A</p><ul><li><strong>\u53EF\u89C1\u6027</strong> - \u4E00\u4E2A\u7EBF\u7A0B\u4FEE\u6539\u4E86\u67D0\u4E2A\u5171\u4EAB\u53D8\u91CF\uFF0C\u5176\u72B6\u6001\u80FD\u591F\u7ACB\u5373\u88AB\u5176\u4ED6\u7EBF\u7A0B\u77E5\u6653\uFF0C\u5373\u628A\u7EBF\u7A0B\u672C\u5730\u72B6\u6001\u53CD\u6620\u5230\u4E3B\u5185\u5B58\u4E0A\uFF0Cvolatile \u5C31\u662F\u8D1F\u8D23\u4FDD\u8BC1\u53EF\u89C1\u6027\u7684\u3002</li><li><strong>\u539F\u5B50\u6027</strong> - \u76F8\u5173\u64CD\u4F5C\u4E0D\u4F1A\u4E2D\u9014\u88AB\u5176\u4ED6\u7EBF\u7A0B\u5E72\u6270\uFF0C\u4E00\u822C\u901A\u8FC7\u540C\u6B65\u673A\u5236\uFF08\u52A0\u9501\uFF1Asychronized\u3001Lock\uFF09\u5B9E\u73B0\u3002</li><li><strong>\u6709\u5E8F\u6027</strong> - \u662F\u4FDD\u8BC1\u7EBF\u7A0B\u5185\u4E32\u884C\u8BED\u4E49\uFF0C\u907F\u514D\u6307\u4EE4\u91CD\u6392\u7B49</li></ul><p>\u539F\u5B50\u64CD\u4F5C\uFF08atomic operation\uFF09\uFF1A\u4E0D\u53EF\u88AB\u4E2D\u65AD\u7684\u4E00\u4E2A\u6216\u4E00\u7CFB\u5217\u64CD\u4F5C</p><h3 id="\u7EBF\u7A0B-thread" tabindex="-1">\u7EBF\u7A0B\uFF08Thread\uFF09 <a class="header-anchor" href="#\u7EBF\u7A0B-thread" aria-hidden="true">#</a></h3><p>\u7C7B\u65B9\u6CD5</p><ul><li>Thread currentThread()\uFF1A\u8FD4\u56DE\u5F53\u524D\u6B63\u5728\u6267\u884C\u7684\u7EBF\u7A0B\u5BF9\u8C61</li><li>void sleep(long millis)\uFF1A\u8BA9\u5F53\u524D\u6B63\u5728\u6267\u884C\u7684\u7EBF\u7A0B\u6682\u505C millis \u6BEB\u79D2\uFF0C\u5E76\u8FDB\u5165\u963B\u585E\u72B6\u6001\uFF08\u7EBF\u7A0B\u7761\u7720\uFF09</li><li>void yield()\uFF1A\u6682\u505C\u5F53\u524D\u6B63\u5728\u6267\u884C\u7684\u7EBF\u7A0B\u5BF9\u8C61\uFF0C\u8F6C\u5165\u5C31\u7EEA\u72B6\u6001\uFF08\u7EBF\u7A0B\u8BA9\u6B65\uFF09</li></ul><p>\u5B9E\u4F8B\u65B9\u6CD5</p><ul><li>void start()\uFF1A\u4F7F\u8BE5\u7EBF\u7A0B\u5F00\u59CB\u6267\u884C\uFF0CJava \u865A\u62DF\u673A\u8C03\u7528\u8BE5\u7EBF\u7A0B\u7684 run \u65B9\u6CD5\uFF0C\u53EA\u80FD\u88AB\u5904\u4E8E\u65B0\u5EFA\u72B6\u6001\u7684\u7EBF\u7A0B\u8C03\u7528\uFF0C\u5426\u5219\u4F1A\u5F15\u53D1 IllegalThreadStateException \u5F02\u5E38</li><li>void run()\uFF1A\u5982\u679C\u8BE5\u7EBF\u7A0B\u662F\u4F7F\u7528\u72EC\u7ACB\u7684 Runnable \u8FD0\u884C\u5BF9\u8C61\u6784\u9020\u7684\uFF0C\u5219\u8C03\u7528\u8BE5 Runnable \u5BF9\u8C61\u7684 run \u65B9\u6CD5\uFF1B\u5426\u5219\uFF0C\u8BE5\u65B9\u6CD5\u4E0D\u6267\u884C\u4EFB\u4F55\u64CD\u4F5C\u5E76\u8FD4\u56DE</li><li>void setName(String name)\uFF1A\u4E3A\u7EBF\u7A0B\u8BBE\u7F6E\u540D\u5B57\uFF0C\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u4E3B\u7EBF\u7A0B\u7684\u540D\u5B57\u4E3A main\uFF0C\u7528\u6237\u542F\u52A8\u7684\u591A\u4E2A\u7EBF\u7A0B\u7684\u540D\u5B57\u4F9D\u6B21\u4E3A Thread-0\u3001Thread-1\u3001Thread-2\u3001...\u3001Thread-n \u7B49</li><li>String getName()\uFF1A\u8FD4\u56DE\u8C03\u7528\u8BE5\u65B9\u6CD5\u7684\u7EBF\u7A0B\u540D\u5B57</li><li>void join()\uFF1A\u7B49\u5F85\u8C03\u7528\u8BE5\u65B9\u6CD5\u7684\u7EBF\u7A0B\u6267\u884C\u5B8C\u6210\uFF0C\u800C\u5F53\u524D\u6B63\u5728\u6267\u884C\u7684\u7EBF\u7A0B\u8FDB\u5165\u963B\u585E\u72B6\u6001\uFF08\u8054\u5408\u7EBF\u7A0B\uFF09\uFF08\u8BE5\u65B9\u6CD5\u58F0\u660E\u629B\u51FA\u4E86 InterruptedException \u5F02\u5E38\uFF09</li><li>void setDaemon(boolean on)\uFF1Aon \u4E3A&quot;true&quot;\u65F6\uFF0C\u5C06\u8BE5\u7EBF\u7A0B\u8BBE\u7F6E\u6210\u5B88\u62A4\u7EBF\u7A0B\uFF08\u7A0B\u5E8F\u9000\u51FA\u65F6\u4F1A\u88AB\u56DE\u6536\uFF09\uFF0C\u8BE5\u65B9\u6CD5\u5FC5\u987B\u5728 start() \u4E4B\u524D\u8C03\u7528\uFF0C\u5426\u5219\u4F1A\u5F15\u53D1 IllegalThreadStateException \u5F02\u5E38</li><li>boolean isDaemon()\uFF1A\u5224\u65AD\u8BE5\u7EBF\u7A0B\u662F\u5426\u4E3A\u5B88\u62A4\u7EBF\u7A0B</li><li>int getPriority()\uFF1A\u8FD4\u56DE\u7EBF\u7A0B\u7684\u4F18\u5148\u7EA7</li><li>void setPriority(int newPriority)\uFF1A\u66F4\u6539\u7EBF\u7A0B\u7684\u4F18\u5148\u7EA7\uFF08\u8303\u56F4\u662F 1~10 \u4E4B\u95F4\uFF09</li><li>boolean isAlive()\uFF1A\u6D4B\u8BD5\u7EBF\u7A0B\u662F\u5426\u5904\u4E8E\u6D3B\u52A8\u72B6\u6001 | \u53D8\u91CF\u548C\u7C7B\u578B | \u5B57\u6BB5 | \u63CF\u8FF0 | | --- | --- | --- | | static int | <a href="https://www.apiref.com/java11-zh/java.base/java/lang/Thread.html#MAX_PRIORITY" target="_blank" rel="noreferrer">MAX_PRIORITY</a> | \u7EBF\u7A0B\u53EF\u4EE5\u62E5\u6709\u7684\u6700\u5927\u4F18\u5148\u7EA7\u3002 | | static int | <a href="https://www.apiref.com/java11-zh/java.base/java/lang/Thread.html#MIN_PRIORITY" target="_blank" rel="noreferrer">MIN_PRIORITY</a> | \u7EBF\u7A0B\u53EF\u4EE5\u62E5\u6709\u7684\u6700\u4F4E\u4F18\u5148\u7EA7\u3002 | | static int | <a href="https://www.apiref.com/java11-zh/java.base/java/lang/Thread.html#NORM_PRIORITY" target="_blank" rel="noreferrer">NORM_PRIORITY</a> | \u5206\u914D\u7ED9\u7EBF\u7A0B\u7684\u9ED8\u8BA4\u4F18\u5148\u7EA7\u3002 |</li></ul><p>\u5B9E\u73B0\u591A\u7EBF\u7A0B</p><ul><li>\u7EE7\u627F <code>Thread</code>\u7C7B\u6216 <code>Runnable</code>\u63A5\u53E3\uFF0C\u5B9E\u73B0<code>run</code>\u65B9\u6CD5</li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#676E95;">// \u5B9A\u4E49 Thread \u7C7B\u7684\u5B50\u7C7B</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyThread</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Thread</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u91CD\u5199 Thread \u7C7B\u4E2D\u7684 run() \u65B9\u6CD5\uFF0C\u7EBF\u7A0B\u6267\u884C\u4F53</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u5B9A\u4E49 Runnable \u63A5\u53E3\u7684\u5B9E\u73B0\u7C7B</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyRunnable</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Runnable</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u91CD\u5199 Runnable \u63A5\u53E3\u4E2D\u7684 run() \u65B9\u6CD5\uFF0C\u7EBF\u7A0B\u6267\u884C\u4F53</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Demo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">                </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Thread</span><span style="color:#A6ACCD;"> mt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyThread</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u521B\u5EFA Thread \u5B50\u7C7B\u7684\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Thread</span><span style="color:#A6ACCD;"> mr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Thread</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyRunnable</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u7EBF\u7A0B\u540D</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u5C06 target \u4F5C\u4E3A\u8FD0\u884C\u76EE\u6807\u6765\u521B\u5EFA\u521B\u5EFA Thread \u7C7B\u7684\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A6ACCD;">        mt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u8C03\u7528\u7EBF\u7A0B\u5BF9\u8C61\u7684 start() \u65B9\u6CD5\u6765\u542F\u52A8\u8BE5\u7EBF\u7A0B</span></span>
<span class="line"><span style="color:#A6ACCD;">        mr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u4F7F\u7528\u533F\u540D\u5185\u90E8\u7C7B\u7684\u65B9\u5F0F\u521B\u5EFA</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Thread</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}.</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u4F7F\u7528\u533F\u540D\u5185\u90E8\u7C7B\u7684\u65B9\u5F0F\u521B\u5EFA</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Thread</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Runnable</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}).</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u4F7F\u7528Lambda\u8868\u8FBE\u5F0F</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Thread</span><span style="color:#89DDFF;">(()</span><span style="color:#C792EA;">-&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">++)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentThread</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getName</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">},</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Lambda</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p><code>interface Callable&lt;V&gt;</code> <br> \u63D0\u4F9B\u4E86\u4E00\u4E2A call() \u65B9\u6CD5\uFF08\u53EF\u4EE5\u6709\u8FD4\u56DE\u503C\uFF0C\u53EF\u4EE5\u58F0\u660E\u629B\u51FA\u5F02\u5E38\uFF09\u4F5C\u4E3A<strong>\u7EBF\u7A0B\u6267\u884C\u4F53</strong></p><ul><li>V call()\uFF1A\u8BA1\u7B97\u7ED3\u679C\uFF0C\u5982\u679C\u65E0\u6CD5\u8BA1\u7B97\u7ED3\u679C\uFF0C\u5219\u629B\u51FA\u4E00\u4E2A\u5F02\u5E38</li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Task</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Callable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">call</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Exception</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">longTimeCalculation</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>interface Future&lt;V&gt;</code> <br> Future\u63A5\u53E3\u4EE3\u8868 Callable \u63A5\u53E3\u91CC call() \u65B9\u6CD5\u7684\u8FD4\u56DE\u503C\uFF0C\u8868\u793A\u5F02\u6B65\u8BA1\u7B97\u7684\u7ED3\u679C <br> \u5E38\u7528\u65B9\u6CD5</p><ul><li><code>V get()</code>\uFF1A\u8FD4\u56DE Callable \u4EFB\u52A1\u91CC call() \u65B9\u6CD5\u7684\u8FD4\u56DE\u503C\uFF0C\u5982\u679C\u8BA1\u7B97\u65F6\u629B\u51FA\u5F02\u5E38\u5C06\u4F1A\u629B\u51FA ExecutionException \u5F02\u5E38\uFF0C\u5982\u679C\u5F53\u524D\u7684\u7EBF\u7A0B\u5728\u7B49\u5F85\u65F6\u88AB\u4E2D\u65AD\u5C06\u4F1A\u629B\u51FA InterruptedException \u5F02\u5E38\uFF08\u8C03\u7528\u8BE5\u65B9\u6CD5\u5C06\u5BFC\u81F4\u7A0B\u5E8F\u963B\u585E\uFF0C\u5FC5\u987B\u7B49\u5230\u5B50\u7EBF\u7A0B\u7ED3\u675F\u540E\u624D\u4F1A\u5F97\u5230\u8FD4\u56DE\u503C\uFF09</li><li><code>V get(long timeout, TimeUnit unit)</code>\uFF1A\u8FD4\u56DE Callable \u4EFB\u52A1\u91CC call() \u65B9\u6CD5\u7684\u8FD4\u56DE\u503C\uFF0C\u8BE5\u65B9\u6CD5\u8BA9\u7A0B\u5E8F\u6700\u591A\u963B\u585E timeout \u548C unit \u6307\u5B9A\u7684\u65F6\u95F4\uFF0C\u5982\u679C\u7ECF\u8FC7\u6307\u5B9A\u65F6\u95F4\u540E Callable \u4EFB\u52A1\u4F9D\u7136\u6CA1\u6709\u8FD4\u56DE\u503C\uFF0C\u5C06\u4F1A\u629B\u51FA TimeoutException \u5F02\u5E38</li><li><code>boolean cancel(boolean maylnterruptlfRunning)</code>\uFF1A\u8BD5\u56FE\u53D6\u6D88\u8BE5 Future \u91CC\u5173\u8054\u7684 Callable \u4EFB\u52A1</li><li><code>boolean isCancelled()</code>\uFF1A\u5982\u679C\u5728 Callable \u4EFB\u52A1\u6B63\u5E38\u5B8C\u6210\u524D\u88AB\u53D6\u6D88\uFF0C\u5219\u8FD4\u56DE true</li><li><code>boolean isDone()</code>\uFF1A\u5982\u679C Callable \u4EFB\u52A1\u5DF2\u5B8C\u6210\uFF08\u7531\u4E8E\u6B63\u5E38\u7EC8\u6B62\u3001\u5F02\u5E38\u6216\u53D6\u6D88\uFF09\uFF0C\u5219\u8FD4\u56DE true</li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">ExecutorService</span><span style="color:#A6ACCD;"> executor </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Executors</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">newFixedThreadPool</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;">// \u5B9A\u4E49\u4EFB\u52A1:</span></span>
<span class="line"><span style="color:#C792EA;">Callable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> task </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Task</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#676E95;">// \u63D0\u4EA4\u4EFB\u52A1\u5E76\u83B7\u5F97Future:</span></span>
<span class="line"><span style="color:#C792EA;">Future</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> future </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> executor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">submit</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">task</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#676E95;">// \u4ECEFuture\u83B7\u53D6\u5F02\u6B65\u6267\u884C\u8FD4\u56DE\u7684\u7ED3\u679C:</span></span>
<span class="line"><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> future</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u53EF\u80FD\u963B\u585E</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>class FutureTask&lt;V&gt;</code> <br> FutureTask\u7C7B\u5B9E\u73B0\u4E86<code>RunnableFuture&lt;V&gt;</code> \u63A5\u53E3\uFF08<code>RunnableFuture&lt;V&gt;</code> \u63A5\u53E3\u7EE7\u627F\u4E86<code>Runnable</code> \u63A5\u53E3\u548C<code>Future&lt;V&gt; </code>\u63A5\u53E3\uFF09 <br> \u6784\u9020\u5668\uFF1A<code>FutureTask(Callable&lt;V&gt; callable)</code>\u3001<code>FutureTask(Runnable runnable, V result)</code>\uFF08\u6307\u5B9A\u6210\u529F\u5B8C\u6210\u65F6 get \u8FD4\u56DE\u7ED9\u5B9A\u7684\u7ED3\u679C\u4E3A result\uFF09</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">CallableDemo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Callable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Long</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> callable </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyThread</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">FutureTask</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Long</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> future </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">FutureTask</span><span style="color:#89DDFF;">&lt;&gt;(</span><span style="color:#A6ACCD;">callable</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Thread</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">future</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Callable \u7EBF\u7A0B</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u4EFB\u52A1\u8017\u65F6\uFF1A</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">future</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000000</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u6BEB\u79D2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">InterruptedException</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ExecutionException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">printStackTrace</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyThread</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Callable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Long</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> ticket </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Long</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">call</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> begin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">nanoTime</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ticket </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentThread</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getName</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> \u5356\u51FA\u4E86\u7B2C </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> ticket </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> \u5F20\u7968</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                ticket</span><span style="color:#89DDFF;">--;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> end </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">nanoTime</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">end </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> begin</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><strong>\u521B\u5EFA\u7EBF\u7A0B\u7684\u4E09\u79CD\u65B9\u5F0F\u5BF9\u6BD4</strong></p><ul><li>\u7EE7\u627F Thread \u7C7B <ol><li>\u7EBF\u7A0B\u7C7B\u5DF2\u7ECF\u7EE7\u627F\u4E86 Thread \u7C7B\uFF0C\u4E0D\u80FD\u518D\u7EE7\u627F\u5176\u5B83\u7236\u7C7B</li><li>\u8BBF\u95EE\u5F53\u524D\u7EBF\u7A0B\u76F4\u63A5\u4F7F\u7528 this</li><li>\u591A\u4E2A\u7EBF\u7A0B\u4E4B\u95F4<strong>\u65E0\u6CD5\u5171\u4EAB\u7EBF\u7A0B\u7C7B\u4E2D\u7684\u5B9E\u4F8B\u53D8\u91CF</strong></li></ol></li><li>\u5B9E\u73B0 Runnable\u3001Callable \u63A5\u53E3\u7684\u65B9\u5F0F\u521B\u5EFA\u591A\u7EBF\u7A0B <ol><li>\u7EBF\u7A0B\u7C7B\u53EA\u662F\u5B9E\u73B0\u4E86 Runnable \u63A5\u53E3\uFF0C\u8FD8\u53EF\u4EE5\u7EE7\u627F\u5176\u5B83\u7C7B</li><li>\u8BBF\u95EE\u5F53\u524D\u7EBF\u7A0B\u987B\u4F7F\u7528 Thread. currentThread() \u65B9\u6CD5</li><li>\u6240\u521B\u5EFA\u7684 Runnable \u5BF9\u8C61\u53EA\u662F<strong>\u7EBF\u7A0B\u7684 target</strong>\uFF0C\u800C\u591A\u4E2A\u7EBF\u7A0B<strong>\u53EF\u4EE5\u5171\u4EAB\u540C\u4E00\u4E2A target \u5BF9\u8C61\u7684\u5B9E\u4F8B\u53D8\u91CF</strong>\uFF0C\u6240\u4EE5\u9002\u5408\u591A\u4E2A\u76F8\u540C\u7EBF\u7A0B\u6765\u5904\u7406\u540C\u4E00\u4EFD\u8D44\u6E90\u7684\u60C5\u51B5</li></ol></li></ul><h3 id="\u5E76\u53D1\u6838\u5FC3\u673A\u5236" tabindex="-1">\u5E76\u53D1\u6838\u5FC3\u673A\u5236 <a class="header-anchor" href="#\u5E76\u53D1\u6838\u5FC3\u673A\u5236" aria-hidden="true">#</a></h3><p>synchronized \u5229\u7528\u9501\u7684\u673A\u5236\u6765\u5B9E\u73B0\u4E92\u65A5\u540C\u6B65\u7684\u3002 <br> \u53EF\u4EE5\u4FDD\u8BC1\u5728\u540C\u4E00\u4E2A\u65F6\u523B\uFF0C\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u6267\u884C\u67D0\u4E2A\u65B9\u6CD5\u6216\u8005\u67D0\u4E2A\u4EE3\u7801\u5757</p><ul><li><strong>\u540C\u6B65\u5B9E\u4F8B\u65B9\u6CD5</strong> - \u5BF9\u4E8E\u666E\u901A\u540C\u6B65\u65B9\u6CD5\uFF0C\u9501\u662F\u5F53\u524D\u5B9E\u4F8B\u5BF9\u8C61</li><li><strong>\u540C\u6B65\u9759\u6001\u65B9\u6CD5</strong> - \u5BF9\u4E8E\u9759\u6001\u540C\u6B65\u65B9\u6CD5\uFF0C\u9501\u662F\u5F53\u524D\u7C7B\u7684 Class \u5BF9\u8C61</li><li><strong>\u540C\u6B65\u4EE3\u7801\u5757</strong> - \u5BF9\u4E8E\u540C\u6B65\u65B9\u6CD5\u5757\uFF0C\u9501\u662F synchonized \u62EC\u53F7\u91CC\u914D\u7F6E\u7684\u5BF9\u8C61</li></ul><p>volatile \u662F\u8F7B\u91CF\u7EA7\u7684 synchronized\uFF0C\u5B83\u5728\u591A\u5904\u7406\u5668\u5F00\u53D1\u4E2D\u4FDD\u8BC1\u4E86\u5171\u4EAB\u53D8\u91CF\u7684\u201C\u53EF\u89C1\u6027\u201D</p><ul><li><strong>\u7EBF\u7A0B\u53EF\u89C1\u6027</strong></li><li><strong>\u7981\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F</strong></li><li><strong>\u4E0D\u4FDD\u8BC1\u539F\u5B50\u6027</strong></li></ul><h4 id="cas" tabindex="-1">CAS <a class="header-anchor" href="#cas" aria-hidden="true">#</a></h4><p>Compare and Swap\uFF0C<strong>\u6BD4\u8F83\u5E76\u66FF\u6362</strong></p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#676E95;">// \u5982\u679CAtomicInteger\u7684\u5F53\u524D\u503C\u662Fprev\uFF0C\u90A3\u4E48\u5C31\u66F4\u65B0\u4E3Anext\uFF0C\u5426\u5219\u5C31\u4EC0\u4E48\u4E5F\u4E0D\u5E72</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">incrementAndGet</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">AtomicInteger</span><span style="color:#A6ACCD;"> var</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> prev</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> next</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">do</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        prev </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> var</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        next </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> prev </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(!</span><span style="color:#A6ACCD;">var</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">compareAndSet</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">prev</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> next</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> next</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u5B58\u5728\u95EE\u9898</p><ul><li>ABA \u95EE\u9898</li><li>\u5FAA\u73AF\u65F6\u95F4\u957F\u5F00\u9500\u5927</li><li>\u53EA\u80FD\u4FDD\u8BC1\u4E00\u4E2A\u5171\u4EAB\u53D8\u91CF\u7684\u539F\u5B50\u6027</li></ul><p>\u539F\u5B50\u7C7B <br> java.util.concurrent.atomic</p><ul><li>\u589E\u52A0\u503C\u5E76\u8FD4\u56DE\u65B0\u503C\uFF1Aint addAndGet(int delta)</li><li>\u52A01\u540E\u8FD4\u56DE\u65B0\u503C\uFF1Aint incrementAndGet()</li><li>\u83B7\u53D6\u5F53\u524D\u503C\uFF1Aint get()</li><li>\u7528CAS\u65B9\u5F0F\u8BBE\u7F6E\uFF1Aint compareAndSet(int expect, int update)</li></ul><p>\u57FA\u672C\u7C7B\u578B</p><ul><li>AtomicBoolean - \u5E03\u5C14\u7C7B\u578B\u539F\u5B50\u7C7B</li><li>AtomicInteger - \u6574\u578B\u539F\u5B50\u7C7B</li><li>AtomicLong - \u957F\u6574\u578B\u539F\u5B50\u7C7B</li></ul><p>\u5F15\u7528\u7C7B\u578B</p><ul><li>AtomicReference - \u5F15\u7528\u7C7B\u578B\u539F\u5B50\u7C7B</li><li>AtomicMarkableReference - \u5E26\u6709\u6807\u8BB0\u4F4D\u7684\u5F15\u7528\u7C7B\u578B\u539F\u5B50\u7C7B</li><li>AtomicStampedReference - \u5E26\u6709\u7248\u672C\u53F7\u7684\u5F15\u7528\u7C7B\u578B\u539F\u5B50\u7C7B \u89E3\u51B3\u4E86 ABA \u95EE\u9898</li></ul><p>\u6570\u7EC4\u7C7B\u578B</p><ul><li>AtomicIntegerArray - \u6574\u5F62\u6570\u7EC4\u539F\u5B50\u7C7B</li><li>AtomicLongArray - \u957F\u6574\u578B\u6570\u7EC4\u539F\u5B50\u7C7B</li><li>AtomicReferenceArray - \u5F15\u7528\u7C7B\u578B\u6570\u7EC4\u539F\u5B50\u7C7B</li></ul><p>\u5C5E\u6027\u66F4\u65B0\u5668\u7C7B\u578B</p><ul><li>AtomicIntegerFieldUpdater - \u6574\u578B\u5B57\u6BB5\u7684\u539F\u5B50\u66F4\u65B0\u5668\u3002</li><li>AtomicLongFieldUpdater - \u957F\u6574\u578B\u5B57\u6BB5\u7684\u539F\u5B50\u66F4\u65B0\u5668\u3002</li><li>AtomicReferenceFieldUpdater - \u539F\u5B50\u66F4\u65B0\u5F15\u7528\u7C7B\u578B\u91CC\u7684\u5B57\u6BB5</li></ul><p>\u539F\u5B50\u5316\u7684\u7D2F\u52A0\u5668 <br> DoubleAccumulator\u3001DoubleAdder\u3001LongAccumulator \u3001 LongAdder</p><p>\u81EA\u65CB\u9501 \u6307\u7EBF\u7A0B\u53CD\u590D\u68C0\u67E5\u9501\u53D8\u91CF\u662F\u5426\u53EF\u7528\uFF0C\u76F4\u5230\u6210\u529F\u4E3A\u6B62</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">AtomicReferenceDemo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> ticket </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">SpinLock</span><span style="color:#A6ACCD;"> lock </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SpinLock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">ExecutorService</span><span style="color:#A6ACCD;"> executorService </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Executors</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">newFixedThreadPool</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">++)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            executorService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyThread</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">lock</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        executorService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">shutdown</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SpinLock</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">AtomicReference</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Thread</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> atomicReference </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">AtomicReference</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">lock</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">Thread</span><span style="color:#A6ACCD;"> current </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentThread</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(!</span><span style="color:#A6ACCD;">atomicReference</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">compareAndSet</span><span style="color:#89DDFF;">(null,</span><span style="color:#A6ACCD;"> current</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">unlock</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">Thread</span><span style="color:#A6ACCD;"> current </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentThread</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            atomicReference</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">compareAndSet</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">current</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyThread</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Runnable</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">SpinLock</span><span style="color:#A6ACCD;"> lock</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyThread</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">SpinLock</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">lock</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">lock </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> lock</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ticket </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                lock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ticket </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentThread</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getName</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> \u5356\u51FA\u4E86\u7B2C </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> ticket </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> \u5F20\u7968</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                    ticket</span><span style="color:#89DDFF;">--;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                lock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unlock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h4 id="threadlocal-t" tabindex="-1"><code>ThreadLocal&lt;T&gt;</code> <a class="header-anchor" href="#threadlocal-t" aria-hidden="true">#</a></h4><ul><li>\u4EE3\u8868\u4E00\u4E2A\u7EBF\u7A0B\u5C40\u90E8\u53D8\u91CF</li><li>\u5F53\u8FD0\u884C\u4E8E\u591A\u7EBF\u7A0B\u73AF\u5883\u7684\u67D0\u4E2A\u5BF9\u8C61\u4F7F\u7528 ThreadLocal \u7EF4\u62A4\u53D8\u91CF\u65F6\uFF0CThreadLocal <strong>\u4E3A\u6BCF\u4E00\u4E2A\u4F7F\u7528\u8BE5\u53D8\u91CF\u7684\u7EBF\u7A0B\u5206\u914D\u4E00\u4E2A\u72EC\u7ACB\u7684\u53D8\u91CF\u526F\u672C</strong>\uFF0C\u4ECE\u800C\u89E3\u51B3\u591A\u7EBF\u7A0B\u4E2D\u5BF9\u540C\u4E00\u53D8\u91CF\u7684\u8BBF\u95EE\u51B2\u7A81</li></ul><p>\u5B9E\u4F8B\u65B9\u6CD5</p><ul><li>protected T initialValue()\uFF1A\u8FD4\u56DE\u6B64\u7EBF\u7A0B\u5C40\u90E8\u53D8\u91CF\u7684\u5F53\u524D\u7EBF\u7A0B\u7684\u201C\u521D\u59CB\u503C\u201D</li><li>T get()\uFF1A\u8FD4\u56DE\u6B64\u7EBF\u7A0B\u5C40\u90E8\u53D8\u91CF\u4E2D\u5F53\u524D\u7EBF\u7A0B\u526F\u672C\u4E2D\u7684\u503C</li><li>void remove()\uFF1A\u79FB\u9664\u6B64\u7EBF\u7A0B\u5C40\u90E8\u53D8\u91CF\u4E2D\u5F53\u524D\u7EBF\u7A0B\u7684\u503C</li><li>void set(T value)\uFF1A\u8BBE\u7F6E\u6B64\u7EBF\u7A0B\u5C40\u90E8\u53D8\u91CF\u4E2D\u5F53\u524D\u7EBF\u7A0B\u526F\u672C\u4E2D\u7684\u503C</li><li>\u5B50\u7C7B InheritableThreadLocal\uFF1A\u5728\u521B\u5EFA\u5B50\u7EBF\u7A0B\u65F6\uFF0C\u5B50\u7EBF\u7A0B\u4F1A\u63A5\u6536\u6240\u6709<strong>\u53EF\u7EE7\u627F\u7684\u7EBF\u7A0B\u5C40\u90E8\u53D8\u91CF\u7684\u521D\u59CB\u503C</strong>\uFF0C\u4EE5\u83B7\u5F97\u7236\u7EBF\u7A0B\u6240\u5177\u6709\u7684\u503C</li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ThreadLocalDemo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ThreadLocal</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Integer</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> threadLocal </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ThreadLocal</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Integer</span><span style="color:#89DDFF;">&gt;()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Integer</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">initialValue</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">ExecutorService</span><span style="color:#A6ACCD;"> executorService </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Executors</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">newFixedThreadPool</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">++)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            executorService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyThread</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">// \u5168\u90E8\u8F93\u51FA count = 10</span></span>
<span class="line"><span style="color:#A6ACCD;">        executorService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">shutdown</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyThread</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Runnable</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> count </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> threadLocal</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">++)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    count</span><span style="color:#89DDFF;">++;</span></span>
<span class="line"><span style="color:#A6ACCD;">                    Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">InterruptedException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">printStackTrace</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            threadLocal</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            threadLocal</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">remove</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentThread</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getName</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> : </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> count</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="\u7EBF\u7A0B\u901A\u4FE1" tabindex="-1">\u7EBF\u7A0B\u901A\u4FE1 <a class="header-anchor" href="#\u7EBF\u7A0B\u901A\u4FE1" aria-hidden="true">#</a></h3><p><strong>Object \u7C7B</strong>\u4E2D\u7528\u4E8E\u64CD\u4F5C\u7EBF\u7A0B\u901A\u4FE1\u7684\u5B9E\u4F8B\u65B9\u6CD5</p><ol><li>wait()\uFF1A\u8C03\u7528\u8BE5\u65B9\u6CD5\u7684\u5F53\u524D\u7EBF\u7A0B\u4F1A<strong>\u91CA\u653E</strong>\u5BF9<strong>\u8BE5\u540C\u6B65\u76D1\u89C6\u5668</strong>\uFF08\u8C03\u7528\u8005\uFF09\u7684\u9501\u5B9A\uFF0CJVM \u628A\u8BE5\u7EBF\u7A0B\u5B58\u653E\u5230<strong>\u7B49\u5F85\u6C60</strong>\u4E2D\uFF0C\u7B49\u5F85\u5176\u4ED6\u7684\u7EBF\u7A0B\u5524\u9192\u8BE5\u7EBF\u7A0B\uFF08\u8BE5\u65B9\u6CD5\u58F0\u660E\u629B\u51FA\u4E86 InterruptedException \u5F02\u5E38\uFF09\uFF08\u4E3A\u4E86\u9632\u6B62\u865A\u5047\u5524\u9192\uFF0C\u6B64\u65B9\u6CD5<strong>\u5E94\u59CB\u7EC8\u5728\u5FAA\u73AF\u4E2D\u4F7F\u7528</strong>\uFF0C\u5373\u88AB\u5524\u9192\u540E\u9700\u8981\u518D\u6B21\u5224\u65AD\u662F\u5426\u6EE1\u8DB3\u5524\u9192\u6761\u4EF6\uFF09</li><li>notify()\uFF1A\u8C03\u7528\u8BE5\u65B9\u6CD5\u7684\u5F53\u524D\u7EBF\u7A0B\u5524\u9192\u5728\u7B49\u5F85\u6C60\u4E2D\u7684\u4EFB\u610F\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u5E76\u628A\u8BE5\u7EBF\u7A0B\u8F6C\u5230<strong>\u9501\u6C60</strong>\u4E2D\u7B49\u5F85\u83B7\u53D6\u9501</li><li>notifyAll()\uFF1A\u8C03\u7528\u8BE5\u65B9\u6CD5\u7684\u5F53\u524D\u7EBF\u7A0B\u5524\u9192\u5728\u7B49\u5F85\u6C60\u4E2D\u7684\u6240\u6709\u7EBF\u7A0B\uFF0C\u5E76\u628A\u8BE5\u7EBF\u7A0B\u8F6C\u5230<strong>\u9501\u6C60</strong>\u4E2D\u7B49\u5F85\u83B7\u53D6\u9501</li></ol><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>\u8FD9\u4E9B\u65B9\u6CD5\u5FC5\u987B\u5728<strong>\u540C\u6B65\u5757</strong>\u4E2D\u4F7F\u7528\uFF0C\u4E14\u53EA\u80FD\u88AB\u540C\u6B65\u76D1\u89C6\u5668\u5BF9\u8C61\u6765\u8C03\u7528\uFF0C\u5426\u5219\u4F1A\u5F15\u53D1 IllegalMonitorStateException \u5F02\u5E38</p></div><p>\u4F7F\u7528 volatile \u6807\u5FD7\u4F4D\u63A7\u5236\u7EBF\u7A0B\u7EC8\u6B62</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ThreadStopDemo2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Exception</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">MyTask</span><span style="color:#A6ACCD;"> task </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyTask</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Thread</span><span style="color:#A6ACCD;"> thread </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Thread</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">task</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MyTask</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        TimeUnit</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">MILLISECONDS</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        task</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cancel</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyTask</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Runnable</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">volatile</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> flag </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">volatile</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> count </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0L</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentThread</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getName</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> \u7EBF\u7A0B\u542F\u52A8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">flag</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">++);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentThread</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getName</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> \u7EBF\u7A0B\u7EC8\u6B62</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">        /**</span></span>
<span class="line"><span style="color:#676E95;">         * \u901A\u8FC7 volatile \u6807\u5FD7\u4F4D\u6765\u63A7\u5236\u7EBF\u7A0B\u7EC8\u6B62</span></span>
<span class="line"><span style="color:#676E95;">         */</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cancel</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            flag </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><strong>\u751F\u4EA7\u8005\u4E0E\u6D88\u8D39\u8005\u6A21\u5F0F</strong> <br> <strong>\u7BA1\u7A0B\u6CD5</strong></p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Test</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#C792EA;">BufferContainer</span><span style="color:#A6ACCD;"> container</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BufferContainer</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Productor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Consumer</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">		System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Program End</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Productor</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Thread</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">BufferContainer</span><span style="color:#A6ACCD;"> container</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Productor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">BufferContainer</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">container </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> container</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">for</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">;++</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">			container</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Food</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">			System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u751F\u4EA7\uFF1A</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">+</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u98DF\u54C1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Consumer</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Thread</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">BufferContainer</span><span style="color:#A6ACCD;"> container</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Consumer</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">BufferContainer</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">container </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> container</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">for</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">;++</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">			System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u6D88\u8D39\uFF1A</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pop</span><span style="color:#89DDFF;">().</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">+</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\u98DF\u54C1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BufferContainer</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> size</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">Food</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> food</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BufferContainer</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">size</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">size </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> size</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">		food</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Food</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">size</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">synchronized</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">push</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Food</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;">size</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">wait</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">InterruptedException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">				e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">printStackTrace</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">		food</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">]=</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">notify</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">		num</span><span style="color:#89DDFF;">++;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">synchronized</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Food</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">pop</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">==</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">wait</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">InterruptedException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">				e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">printStackTrace</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">		num</span><span style="color:#89DDFF;">--;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">notify</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> food</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">num</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Food</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> id</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Food</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> id</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><p><strong>\u4FE1\u53F7\u706F\u6CD5</strong></p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Test</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#C792EA;">Light</span><span style="color:#A6ACCD;"> light</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Light</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Man</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">light</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Car</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">light</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Man</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Thread</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">Light</span><span style="color:#A6ACCD;"> light</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Man</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Light</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">light</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">light </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> light</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">for</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">;++</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">			light</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">green</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Car</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Thread</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">Light</span><span style="color:#A6ACCD;"> light</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Car</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Light</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">light</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">light </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> light</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">for</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">;++</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">			light</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">red</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Light</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> color</span><span style="color:#89DDFF;">=false;</span><span style="color:#676E95;">// \u7EA2\u706Ffalse\uFF0C\u7EFF\u706Ftrue</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">synchronized</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">red</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">color</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">wait</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">InterruptedException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">				e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">printStackTrace</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">		System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Car pass</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">		color</span><span style="color:#89DDFF;">=!</span><span style="color:#A6ACCD;">color</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">notify</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">synchronized</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">green</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">if</span><span style="color:#89DDFF;">(!</span><span style="color:#A6ACCD;">color</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">wait</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">InterruptedException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">				e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">printStackTrace</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">		System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Man pass</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">		color</span><span style="color:#89DDFF;">=!</span><span style="color:#A6ACCD;">color</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">notify</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p>java.util.concurrent.locks \u5305\u4E2D\uFF0CCondition \u63A5\u53E3\u4E2D\u7684 await()\u3001signal()\u3001signalAll() \u65B9\u6CD5\u66FF\u4EE3\u4E86 Object \u76D1\u89C6\u5668\u65B9\u6CD5\u7684\u4F7F\u7528</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TaskQueue</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">Queue</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> queue </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">LinkedList</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">synchronized</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">addTask</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">queue</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">notifyAll</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">synchronized</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getTask</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">InterruptedException</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">queue</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isEmpty</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">wait</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> queue</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">remove</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TaskQueue</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Lock</span><span style="color:#A6ACCD;"> lock </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ReentrantLock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u83B7\u5F97\u4E00\u4E2A\u7ED1\u5B9A\u4E86Lock\u5B9E\u4F8B\u7684Condition\u5B9E\u4F8B</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Condition</span><span style="color:#A6ACCD;"> condition </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> lock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">newCondition</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Queue</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> queue </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">LinkedList</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">addTask</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        lock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            queue</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            condition</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">signalAll</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            lock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unlock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getTask</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        lock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">queue</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isEmpty</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                condition</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">await</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> queue</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">remove</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            lock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unlock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">condition</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">await</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> TimeUnit</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SECOND</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u88AB\u5176\u4ED6\u7EBF\u7A0B\u5524\u9192</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6307\u5B9A\u65F6\u95F4\u5185\u6CA1\u6709\u88AB\u5176\u4ED6\u7EBF\u7A0B\u5524\u9192</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="\u5E76\u53D1\u9501" tabindex="-1">\u5E76\u53D1\u9501 <a class="header-anchor" href="#\u5E76\u53D1\u9501" aria-hidden="true">#</a></h3><p>\u9501\u673A\u5236\uFF08Lock\u3001sychronized\uFF09\uFF1A\u5BF9\u5171\u4EAB\u6570\u636E\u505A\u4E92\u65A5\u540C\u6B65\uFF0C\u8FD9\u6837\u5728\u540C\u4E00\u4E2A\u65F6\u523B\uFF0C\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u6267\u884C\u67D0\u4E2A\u65B9\u6CD5\u6216\u8005\u67D0\u4E2A\u4EE3\u7801\u5757\uFF0C\u90A3\u4E48\u64CD\u4F5C\u5FC5\u7136\u662F\u539F\u5B50\u6027\u7684\uFF0C\u7EBF\u7A0B\u5B89\u5168\u7684</p><ul><li><strong>\u516C\u5E73\u9501</strong> - <strong>\u591A\u7EBF\u7A0B\u6309\u7167\u7533\u8BF7\u9501\u7684\u987A\u5E8F\u6765\u83B7\u53D6\u9501</strong>\u3002</li><li><strong>\u975E\u516C\u5E73\u9501</strong> - <strong>\u591A\u7EBF\u7A0B\u4E0D\u6309\u7167\u7533\u8BF7\u9501\u7684\u987A\u5E8F\u6765\u83B7\u53D6\u9501</strong> \u3002\u53EF\u80FD\u4F1A\u51FA\u73B0\u4F18\u5148\u7EA7\u53CD\u8F6C\uFF08\u540E\u6765\u8005\u5C45\u4E0A\uFF09\u6216\u8005\u9965\u997F\u73B0\u8C61\uFF08\u67D0\u7EBF\u7A0B\u603B\u662F\u62A2\u4E0D\u8FC7\u522B\u7684\u7EBF\u7A0B\uFF0C\u5BFC\u81F4\u59CB\u7EC8\u65E0\u6CD5\u6267\u884C\uFF09\u3002</li></ul><div class="info custom-block"><p class="custom-block-title">INFO</p><p>synchronized \u53EA\u652F\u6301\u975E\u516C\u5E73\u9501\u3002 <br> ReentrantLock \u3001ReentrantReadWriteLock\uFF0C\u9ED8\u8BA4\u662F\u975E\u516C\u5E73\u9501\uFF0C\u4F46\u652F\u6301\u516C\u5E73\u9501</p></div><ul><li>**\u72EC\u4EAB\u9501\uFF08**\u4E92\u65A5\u9501\uFF09 - <strong>\u9501\u4E00\u6B21\u53EA\u80FD\u88AB\u4E00\u4E2A\u7EBF\u7A0B\u6240\u6301\u6709</strong>\u3002</li><li>**\u5171\u4EAB\u9501\uFF08**\u8BFB\u5199\u9501\uFF09 - <strong>\u9501\u53EF\u88AB\u591A\u4E2A\u7EBF\u7A0B\u6240\u6301\u6709</strong></li></ul><div class="info custom-block"><p class="custom-block-title">INFO</p><p>synchronized \u3001ReentrantLock \u53EA\u652F\u6301\u72EC\u4EAB\u9501\u3002 <br> ReentrantReadWriteLock \u5176\u5199\u9501\u662F\u72EC\u4EAB\u9501\uFF0C\u5176\u8BFB\u9501\u662F\u5171\u4EAB\u9501\u3002\u8BFB\u9501\u662F\u5171\u4EAB\u9501\u4F7F\u5F97\u5E76\u53D1\u8BFB\u662F\u975E\u5E38\u9AD8\u6548\u7684\uFF0C\u8BFB\u5199\uFF0C\u5199\u8BFB \uFF0C\u5199\u5199\u7684\u8FC7\u7A0B\u662F\u4E92\u65A5\u7684</p></div><p>\u5904\u7406\u5E76\u53D1\u540C\u6B65\u7684\u7B56\u7565</p><ul><li>\u4E50\u89C2\u9501\uFF1A\u4E50\u89C2\u601D\u60F3\uFF0C\u5373\u4E0D\u52A0\u9501\u7684\u5E76\u53D1\u64CD\u4F5C\u4E5F\u6CA1\u4EC0\u4E48\u95EE\u9898\u3002\u5BF9\u4E8E\u540C\u4E00\u4E2A\u6570\u636E\u7684\u5E76\u53D1\u64CD\u4F5C\uFF0C\u662F\u4E0D\u4F1A\u53D1\u751F\u4FEE\u6539\u7684\u3002\u5728\u66F4\u65B0\u6570\u636E\u7684\u65F6\u5019\uFF0C\u4F1A\u91C7\u7528\u4E0D\u65AD\u5C1D\u8BD5\u66F4\u65B0\u7684\u65B9\u5F0F\u66F4\u65B0\u6570\u636E\u3002\u9002\u5408\u8BFB\u591A\u5199\u5C11\u7684\u573A\u666F</li><li>\u60B2\u89C2\u9501\uFF1A\u60B2\u89C2\u601D\u60F3\uFF0C\u5373\u4E0D\u52A0\u9501\u7684\u5E76\u53D1\u64CD\u4F5C\u4E00\u5B9A\u4F1A\u51FA\u95EE\u9898\u3002\u9002\u5408\u5199\u64CD\u4F5C\u9891\u7E41\u7684\u573A\u666F\u3002</li></ul><p>\u63A7\u5236\u7C92\u5EA6\u7684\u7C97\u7EC6 <br> \u63A7\u5236\u7C92\u5EA6\u8D8A\u7EC6\uFF0C\u963B\u585E\u5F00\u9500\u8D8A\u5C0F\uFF0C\u5E76\u53D1\u6027\u4E5F\u5C31\u8D8A\u9AD8</p><ul><li><strong>\u504F\u5411\u9501</strong> - \u6307\u4E00\u6BB5\u540C\u6B65\u4EE3\u7801\u4E00\u76F4\u88AB\u4E00\u4E2A\u7EBF\u7A0B\u6240\u8BBF\u95EE\uFF0C\u90A3\u4E48\u8BE5\u7EBF\u7A0B\u4F1A\u81EA\u52A8\u83B7\u53D6\u9501\u3002\u964D\u4F4E\u83B7\u53D6\u9501\u7684\u4EE3\u4EF7\u3002</li><li><strong>\u8F7B\u91CF\u7EA7\u9501</strong> - \u6307\u5F53\u9501\u662F\u504F\u5411\u9501\u7684\u65F6\u5019\uFF0C\u88AB\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u6240\u8BBF\u95EE\uFF0C\u504F\u5411\u9501\u5C31\u4F1A\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u4F1A\u901A\u8FC7\u81EA\u65CB\u7684\u5F62\u5F0F\u5C1D\u8BD5\u83B7\u53D6\u9501\uFF0C\u4E0D\u4F1A\u963B\u585E\uFF0C\u63D0\u9AD8\u6027\u80FD\u3002</li><li><strong>\u91CD\u91CF\u7EA7\u9501</strong> - \u6307\u5F53\u9501\u4E3A\u8F7B\u91CF\u7EA7\u9501\u7684\u65F6\u5019\uFF0C\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u867D\u7136\u662F\u81EA\u65CB\uFF0C\u4F46\u81EA\u65CB\u4E0D\u4F1A\u4E00\u76F4\u6301\u7EED\u4E0B\u53BB\uFF0C\u5F53\u81EA\u65CB\u4E00\u5B9A\u6B21\u6570\u7684\u65F6\u5019\uFF0C\u8FD8\u6CA1\u6709\u83B7\u53D6\u5230\u9501\uFF0C\u5C31\u4F1A\u8FDB\u5165\u963B\u585E\uFF0C\u8BE5\u9501\u81A8\u80C0\u4E3A\u91CD\u91CF\u7EA7\u9501\u3002\u91CD\u91CF\u7EA7\u9501\u4F1A\u8BA9\u5176\u4ED6\u7533\u8BF7\u7684\u7EBF\u7A0B\u8FDB\u5165\u963B\u585E\uFF0C\u6027\u80FD\u964D\u4F4E\u3002</li></ul><table><thead><tr><th></th><th>\u5185\u7F6E\u9501</th><th>\u663E\u793A\u9501</th></tr></thead><tbody><tr><td>\u7533\u8BF7\u548C\u91CA\u653E</td><td>\u7531 JVM \u6240\u63A7\u5236</td><td>\u53EF\u4EE5\u7531\u7A0B\u5E8F\u6240\u63A7\u5236</td></tr><tr><td>\u54CD\u5E94\u4E2D\u65AD</td><td>\u4E0D\u80FD</td><td>\u80FD</td></tr><tr><td>\u8D85\u65F6\u673A\u5236</td><td>\u6CA1\u6709</td><td>\u6709</td></tr><tr><td>\u516C\u5E73\u9501</td><td>\u4E0D\u652F\u6301</td><td>\u652F\u6301</td></tr><tr><td>\u5171\u4EAB</td><td>\u72EC\u4EAB</td><td>\u57FA\u4E8E Condition \u7075\u6D3B\u7684\u63A7\u5236\u540C\u6B65\u6761\u4EF6</td></tr><tr><td>\u8BFB\u5199\u5206\u79BB</td><td>\u4E0D\u652F\u6301</td><td>\u652F\u6301</td></tr></tbody></table><p><strong>\u53EF\u91CD\u5165\u9501\uFF1A\u7EBF\u7A0B\u53EF\u4EE5\u91CD\u590D\u83B7\u53D6\u540C\u4E00\u628A\u9501</strong>\u3002\u5373\u540C\u4E00\u4E2A\u7EBF\u7A0B\u5728\u5916\u5C42\u65B9\u6CD5\u83B7\u53D6\u4E86\u9501\uFF0C\u5728\u8FDB\u5165\u5185\u5C42\u65B9\u6CD5\u4F1A\u81EA\u52A8\u83B7\u53D6\u9501\u3002<strong>\u5728\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u907F\u514D\u6B7B\u9501</strong></p><ul><li>\u540C\u6B65\u65B9\u6CD5\uFF1A\u4F7F\u7528 <code>synchronized</code>\u5173\u952E\u5B57\u6765\u4FEE\u9970\u67D0\u4E2A\u65B9\u6CD5\uFF0C\u5C31\u76F8\u5F53\u4E8E<strong>\u7ED9\u8C03\u7528\u8BE5\u65B9\u6CD5\u7684\u5BF9\u8C61</strong>\u52A0\u4E86\u9501</li></ul><p><code>synchronized</code>\u662FJava\u8BED\u8A00\u5C42\u9762\u63D0\u4F9B\u7684\u8BED\u6CD5\uFF0C\u4E0D\u9700\u8981\u8003\u8651\u5F02\u5E38</p><ul><li>\u540C\u6B65\u9501\uFF1Ajava.util.concurrent.locks \u5305\u4E2D\uFF0CLock \u53EF\u66FF\u4EE3 synchronized \u65B9\u6CD5\u548C\u8BED\u53E5\u7684\u4F7F\u7528</li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> n</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">synchronized</span><span style="color:#89DDFF;">(this)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u9501\u4F4Fthis</span></span>
<span class="line"><span style="color:#A6ACCD;">        count </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> n</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u89E3\u9501</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// equal to</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">synchronized</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> n</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u9501\u4F4Fthis</span></span>
<span class="line"><span style="color:#A6ACCD;">    count </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> n</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u89E3\u9501</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Counter</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Lock</span><span style="color:#A6ACCD;"> lock </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ReentrantLock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> count</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        lock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            count </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> n</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            lock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unlock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">lock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">tryLock</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> TimeUnit</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SECONDS</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        lock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unlock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><strong>ReentrantReadWriteLock</strong> \u53EF\u91CD\u5165\u8BFB\u5199\u9501\uFF0C\u4F7F\u7528\u540CReentrantLock</p><ul><li>\u53EA\u5141\u8BB8\u4E00\u4E2A\u7EBF\u7A0B\u5199\u5165\uFF1B\u5141\u8BB8\u591A\u4E2A\u7EBF\u7A0B\u5728\u6CA1\u6709\u5199\u5165\u65F6\u540C\u65F6\u8BFB\u53D6</li><li>\u9002\u5408\u8BFB\u591A\u5199\u5C11\u7684\u573A\u666F</li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#676E95;">// \u6CDB\u578B\u65E0\u754C\u7F13\u5B58</span></span>
<span class="line"><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">UnboundedCache</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">K</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">V</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Map</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">K</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">V</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> cacheMap </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">WeakHashMap</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ReadWriteLock</span><span style="color:#A6ACCD;"> cacheLock </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ReentrantReadWriteLock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">V</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">K</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        cacheLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readLock</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">lock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">V</span><span style="color:#A6ACCD;"> value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            value </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cacheMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">printf</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%s \u8BFB\u6570\u636E %s:%s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentThread</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getName</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> value</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            cacheLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readLock</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">unlock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">V</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">put</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">K</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">V</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        cacheLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeLock</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">lock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            cacheMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">put</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> value</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%s \u5199\u5165\u6570\u636E %s:%s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentThread</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getName</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> key</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> value</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            cacheLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeLock</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">unlock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">V</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">remove</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">K</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        cacheLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeLock</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">lock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> cacheMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">remove</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            cacheLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeLock</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">unlock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">clear</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        cacheLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeLock</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">lock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">cacheMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clear</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            cacheLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeLock</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">unlock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p><strong>StampedLock</strong> \u628A\u8BFB\u9501\u7EC6\u5206\u4E3A\u4E50\u89C2\u8BFB\u548C\u60B2\u89C2\u8BFB\uFF0C\u8FDB\u4E00\u6B65\u63D0\u5347\u5E76\u53D1\u6548\u7387</p><ul><li>\u652F\u6301\u4E09\u79CD\u6A21\u5F0F\uFF1A\u5199\u9501\u3001\u60B2\u89C2\u8BFB\u9501\u3001\u4E50\u89C2\u8BFB</li><li>\u4E0D\u53EF\u91CD\u5165\u9501</li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Point</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">StampedLock</span><span style="color:#A6ACCD;"> stampedLock </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">StampedLock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">move</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">deltaX</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">deltaY</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> stamp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> stampedLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeLock</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u83B7\u53D6\u5199\u9501</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            x </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> deltaX</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            y </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> deltaY</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            stampedLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unlockWrite</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">stamp</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u91CA\u653E\u5199\u9501</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">distanceFromOrigin</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> stamp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> stampedLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">tryOptimisticRead</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u83B7\u5F97\u4E00\u4E2A\u4E50\u89C2\u8BFB\u9501</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u6CE8\u610F\u4E0B\u9762\u4E24\u884C\u4EE3\u7801\u4E0D\u662F\u539F\u5B50\u64CD\u4F5C</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5047\u8BBEx,y = (100,200)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> currentX </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u6B64\u5904\u5DF2\u8BFB\u53D6\u5230x=100\uFF0C\u4F46x,y\u53EF\u80FD\u88AB\u5199\u7EBF\u7A0B\u4FEE\u6539\u4E3A(300,400)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> currentY </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u6B64\u5904\u5DF2\u8BFB\u53D6\u5230y\uFF0C\u5982\u679C\u6CA1\u6709\u5199\u5165\uFF0C\u8BFB\u53D6\u662F\u6B63\u786E\u7684(100,200)</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5982\u679C\u6709\u5199\u5165\uFF0C\u8BFB\u53D6\u662F\u9519\u8BEF\u7684(100,400)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(!</span><span style="color:#A6ACCD;">stampedLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">validate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">stamp</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u68C0\u67E5\u4E50\u89C2\u8BFB\u9501\u540E\u662F\u5426\u6709\u5176\u4ED6\u5199\u9501\u53D1\u751F</span></span>
<span class="line"><span style="color:#A6ACCD;">            stamp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> stampedLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readLock</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u83B7\u53D6\u4E00\u4E2A\u60B2\u89C2\u8BFB\u9501</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                currentX </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                currentY </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                stampedLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unlockRead</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">stamp</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// \u91CA\u653E\u60B2\u89C2\u8BFB\u9501</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sqrt</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">currentX </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> currentX </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> currentY </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> currentY</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>AQS <br> AbstractQueuedSynchronizer\uFF0C\u961F\u5217\u540C\u6B65\u5668\uFF0C\u5176\u4E3B\u8981\u4F5C\u7528\u662F\u5904\u7406\u540C\u6B65\u3002\u63D0\u4F9B\u4E86\u5BF9\u72EC\u4EAB\u9501\u4E0E\u5171\u4EAB\u9501\u7684\u652F\u6301</p><ul><li>\u4F7F\u7528\u4E00\u4E2A\u6574\u578B\u7684 volatile \u53D8\u91CFstate \u7EF4\u62A4\u540C\u6B65\u72B6\u6001\u3002\u72B6\u6001\u7684\u610F\u4E49\u7531\u5B50\u7C7B\u8D4B\u4E88\u3002</li><li>\u7EF4\u62A4\u4E86\u4E00\u4E2A Node \u7C7B\u578B\u7684\u53CC\u94FE\u8868\u6765\u5B8C\u6210\u540C\u6B65\u72B6\u6001\u7684\u7BA1\u7406\uFF0C\u7528\u6765\u5B58\u50A8\u83B7\u53D6\u9501\u5931\u8D25\u7684\u7EBF\u7A0B\u3002</li></ul><h3 id="\u7EBF\u7A0B\u6C60" tabindex="-1">\u7EBF\u7A0B\u6C60 <a class="header-anchor" href="#\u7EBF\u7A0B\u6C60" aria-hidden="true">#</a></h3><p>\u4E00\u79CD\u591A\u7EBF\u7A0B\u5904\u7406\u5F62\u5F0F\uFF0C\u5904\u7406\u8FC7\u7A0B\u4E2D\u5C06\u4EFB\u52A1\u6DFB\u52A0\u5230\u961F\u5217\uFF0C\u7136\u540E\u5728\u521B\u5EFA\u7EBF\u7A0B\u540E\u81EA\u52A8\u542F\u52A8\u8FD9\u4E9B\u4EFB\u52A1</p><ul><li><strong>\u964D\u4F4E\u8D44\u6E90\u6D88\u8017</strong> - \u901A\u8FC7\u91CD\u590D\u5229\u7528\u5DF2\u521B\u5EFA\u7684\u7EBF\u7A0B\u964D\u4F4E\u7EBF\u7A0B\u521B\u5EFA\u548C\u9500\u6BC1\u9020\u6210\u7684\u6D88\u8017\u3002</li><li><strong>\u63D0\u9AD8\u54CD\u5E94\u901F\u5EA6</strong> - \u5F53\u4EFB\u52A1\u5230\u8FBE\u65F6\uFF0C\u4EFB\u52A1\u53EF\u4EE5\u4E0D\u9700\u8981\u7B49\u5230\u7EBF\u7A0B\u521B\u5EFA\u5C31\u80FD\u7ACB\u5373\u6267\u884C\u3002</li><li><strong>\u63D0\u9AD8\u7EBF\u7A0B\u7684\u53EF\u7BA1\u7406\u6027</strong> - \u7EBF\u7A0B\u662F\u7A00\u7F3A\u8D44\u6E90\uFF0C\u5982\u679C\u65E0\u9650\u5236\u7684\u521B\u5EFA\uFF0C\u4E0D\u4EC5\u4F1A\u6D88\u8017\u7CFB\u7EDF\u8D44\u6E90\uFF0C\u8FD8\u4F1A\u964D\u4F4E\u7CFB\u7EDF\u7684\u7A33\u5B9A\u6027\uFF0C\u4F7F\u7528\u7EBF\u7A0B\u6C60\u53EF\u4EE5\u8FDB\u884C\u7EDF\u4E00\u7684\u5206\u914D\uFF0C\u8C03\u4F18\u548C\u76D1\u63A7</li></ul><p>Executor - \u8FD0\u884C\u4EFB\u52A1\u7684\u7B80\u5355\u63A5\u53E3</p><ul><li>ExecutorService - \u6269\u5C55\u4E86 Executor <ul><li>\u652F\u6301\u6709\u8FD4\u56DE\u503C\u7684\u7EBF\u7A0B - sumbit\u3001invokeAll\u3001invokeAny \u65B9\u6CD5\u4E2D\u90FD\u652F\u6301\u4F20\u5165Callable \u5BF9\u8C61\u3002</li><li>\u652F\u6301\u7BA1\u7406\u7EBF\u7A0B\u751F\u547D\u5468\u671F - shutdown\u3001shutdownNow\u3001isShutdown \u7B49\u65B9\u6CD5\u3002</li></ul></li><li>ScheduledExecutorService - \u6269\u5C55\u4E86 ExecutorService \u63A5\u53E3\u3002\u652F\u6301\u5B9A\u671F\u6267\u884C\u4EFB\u52A1\u3002</li><li>AbstractExecutorService - ExecutorService \u63A5\u53E3\u7684\u9ED8\u8BA4\u5B9E\u73B0\u3002</li><li>ThreadPoolExecutor - Executor \u6846\u67B6\u6700\u6838\u5FC3\u7684\u7C7B\uFF0C\u5B83\u7EE7\u627F\u4E86 AbstractExecutorService \u7C7B\u3002</li><li>ScheduledThreadPoolExecutor - ScheduledExecutorService \u63A5\u53E3\u7684\u5B9E\u73B0\uFF0C\u4E00\u4E2A\u53EF\u5B9A\u65F6\u8C03\u5EA6\u4EFB\u52A1\u7684\u7EBF\u7A0B\u6C60\u3002</li></ul><p>Executors <br> \u521B\u5EFA\u7EBF\u7A0B\u6C60\u7684\u9759\u6001\u65B9\u6CD5</p><ul><li>ExecutorService newCachedThreadPool()\uFF1A\u4E00\u4E2A\u5177\u6709\u7F13\u5B58\u529F\u80FD\u7684\u7EBF\u7A0B\u6C60\uFF0C\u7CFB\u7EDF\u6839\u636E\u9700\u8981\u521B\u5EFA\u7EBF\u7A0B\uFF08<strong>\u65E0\u754C\u7EBF\u7A0B\u6C60</strong>\uFF0C\u5DF2\u6709 60 \u79D2\u949F\u672A\u88AB\u4F7F\u7528\u7684\u7EBF\u7A0B\u4F1A\u88AB\u7EC8\u6B62\u5E76\u4ECE\u7F13\u5B58\u4E2D\u79FB\u9664\uFF09 <br> <code>new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;())</code></li><li>ExecutorService newFixedThreadPool(int nThreads)\uFF1A\u4E00\u4E2A\u53EF\u91CD\u7528\u7684\u3001<strong>\u5177\u6709\u56FA\u5B9A\u6838\u5FC3\u7EBF\u7A0B\u6570\u7684\u7EBF\u7A0B\u6C60</strong> <br> \uFF08\u4F7F\u7528\u65E0\u754C\u961F\u5217\uFF0C<strong>\u961F\u5217\u5806\u79EF\u592A\u591A</strong>\u6570\u636E\u5BFC\u81F4 OOM\uFF09 <br> <code>new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;())</code></li><li>ExecutorService newSingleThreadExecutor()\uFF1A\u4E00\u4E2A<strong>\u5355\u7EBF\u7A0B\u7684\u7EBF\u7A0B\u6C60</strong> <br> <code>new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()</code>)</li><li>ScheduledExecutorService newScheduledThreadPool(int corePoolSize)\uFF1A\u4E00\u4E2A\u7EBF\u7A0B\u6C60\uFF0C\u53EF\u5728\u6307\u5B9A\u5EF6\u8FDF\u540E\u6267\u884C\u6216\u5B9A\u671F\u6267\u884C\u7EBF\u7A0B\u4EFB\u52A1 <br> <code>new ThreadPoolExecutor(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS, new DelayedWorkQueue())</code></li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u521B\u5EFA\u4E00\u4E2A\u56FA\u5B9A\u5927\u5C0F\u7684\u7EBF\u7A0B\u6C60:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">ExecutorService</span><span style="color:#A6ACCD;"> es </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Executors</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">newFixedThreadPool</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">++)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            es</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">submit</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Task</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5173\u95ED\u7EBF\u7A0B\u6C60:</span></span>
<span class="line"><span style="color:#A6ACCD;">        es</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">shutdown</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Task</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Runnable</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> name</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Task</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> name</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">start task </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> name</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">InterruptedException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">end task </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> name</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>ForkJoinPool <br> \u7EBF\u7A0B\u6C60\u7684\u5B9E\u73B0\u7C7B\uFF0C\u5C06\u4E00\u4E2A\u4EFB\u52A1\u62C6\u5206\u6210\u591A\u4E2A\u201C\u5C0F\u4EFB\u52A1\u201D\u5E76\u884C\u8BA1\u7B97\uFF0C\u518D\u628A\u591A\u4E2A\u201C\u5C0F\u4EFB\u52A1\u201D\u7684\u7ED3\u679C\u5408\u6210\u603B\u7684\u8BA1\u7B97\u7ED3\u679C</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Exception</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u521B\u5EFA2000\u4E2A\u968F\u673A\u6570\u7EC4\u6210\u7684\u6570\u7EC4:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">long</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> array </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">long</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">2000</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> expectedSum </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> array</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">++)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            array</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">random</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            expectedSum </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> array</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Expected sum: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> expectedSum</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// fork/join:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">ForkJoinTask</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Long</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> task </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SumTask</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">array</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> array</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> startTime </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentTimeMillis</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Long</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ForkJoinPool</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">commonPool</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">invoke</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">task</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> endTime </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentTimeMillis</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Fork/join sum: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> in </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">endTime </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> startTime</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> ms.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Random</span><span style="color:#A6ACCD;"> random </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Random</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">random</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> random</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">nextInt</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">10000</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SumTask</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">RecursiveTask</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Long</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> THRESHOLD </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">500</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">long</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> array</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> start</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> end</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">SumTask</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">long</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">array</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">start</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">end</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">array </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> array</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">start </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> start</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">end </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> end</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Long</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">compute</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">end </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> start </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> THRESHOLD</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;">// \u5982\u679C\u4EFB\u52A1\u8DB3\u591F\u5C0F,\u76F4\u63A5\u8BA1\u7B97:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> sum </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> start</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> end</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">++)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                sum </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">array</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;">// \u6545\u610F\u653E\u6162\u8BA1\u7B97\u901F\u5EA6:</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">InterruptedException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> sum</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u4EFB\u52A1\u592A\u5927,\u4E00\u5206\u4E3A\u4E8C:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> middle </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">end </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> start</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">format</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">split %d~%d ==&gt; %d~%d, %d~%d</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> start</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> end</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> start</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> middle</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> middle</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> end</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">SumTask</span><span style="color:#A6ACCD;"> subtask1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SumTask</span><span style="color:#89DDFF;">(this.</span><span style="color:#A6ACCD;">array</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> start</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> middle</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">SumTask</span><span style="color:#A6ACCD;"> subtask2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SumTask</span><span style="color:#89DDFF;">(this.</span><span style="color:#A6ACCD;">array</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> middle</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> end</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">invokeAll</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">subtask1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> subtask2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Long</span><span style="color:#A6ACCD;"> subresult1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> subtask1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Long</span><span style="color:#A6ACCD;"> subresult2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> subtask2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Long</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> subresult1 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> subresult2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">result = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> subresult1 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> + </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> subresult2 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> ==&gt; </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h3 id="completablefuture" tabindex="-1">CompletableFuture <a class="header-anchor" href="#completablefuture" aria-hidden="true">#</a></h3><ul><li><code>implements Future&lt;T&gt;, CompletionStage&lt;T&gt;</code></li><li>\u7EC4\u5408\u5F0F\u5F02\u6B65\u7F16\u7A0B\uFF0C\u53EF\u4EE5\u4F20\u5165\u56DE\u8C03\u5BF9\u8C61\uFF0C\u5F53\u5F02\u6B65\u4EFB\u52A1\u5B8C\u6210\u6216\u8005\u53D1\u751F\u5F02\u5E38\u65F6\uFF0C\u81EA\u52A8\u8C03\u7528\u56DE\u8C03\u5BF9\u8C61\u7684\u56DE\u8C03\u65B9\u6CD5</li></ul><p>\u9759\u6001\u65B9\u6CD5</p><ul><li><code>CompletableFuture&lt;Void&gt; runAsync(Runnable runnable)</code></li><li><code>CompletableFuture&lt;Void&gt; runAsync(Runnable runnable, Executor executor)</code></li><li><code>CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier)</code>\uFF1A\u4F7F\u7528\u516C\u5171\u7684\u7EBF\u7A0B\u6C60 ForkJoinPool \u6267\u884C\u5F02\u6B65\u4EFB\u52A1</li><li><code>CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier, Executor executor)</code>\uFF1A\u4F7F\u7528\u6307\u5B9A\u7684\u7EBF\u7A0B\u6C60\u6267\u884C\u5F02\u6B65\u4EFB\u52A1</li><li>\u7EC4\u5408\u591A\u4E2A CompletableFuture <ul><li><code>CompletableFuture&lt;Void&gt; allOf(CompletableFuture&lt;?&gt;... cfs)</code>\uFF1A\u7B49\u5F85\u6570\u7EC4\u4E2D\u7684\u6240\u6709 CompletableFuture \u5BF9\u8C61\u90FD\u6267\u884C\u5B8C\u6BD5</li><li><code>CompletableFuture&lt;Object&gt; anyOf(CompletableFuture&lt;?&gt;... cfs)</code>\uFF1A\u53EA\u8981\u6570\u7EC4\u6709\u4EFB\u4F55\u4E00\u4E2A CompletableFuture \u5BF9\u8C61\u6267\u884C\u5B8C\u6BD5\u5C31\u4E0D\u518D\u7B49\u5F85\uFF0C\u8FD4\u56DE\u7531\u7B2C\u4E00\u4E2A\u6267\u884C\u5B8C\u6BD5\u7684 CompletableFuture \u5BF9\u8C61\u7684\u8FD4\u56DE\u503C\u6784\u6210\u7684 CompletableFuture</li></ul></li></ul><p>\u5B9E\u4F8B\u65B9\u6CD5</p><ul><li>T join()\uFF1A\u963B\u585E\u76F4\u5230\u8FD4\u56DE\u5B8C\u6210\u65F6\u7684\u7ED3\u679C\u503C\uFF0C\u5982\u679C\u9047\u5230\u5F02\u5E38\u5219\u629B\u51FA unchecked exception</li><li>\u5B9A\u4E49\u5904\u7406 CompletableFuture \u7684\u8FD4\u56DE\u7ED3\u679C\uFF0C\u5373\u56DE\u8C03\u51FD\u6570 <ul><li><code>CompletableFuture&lt;Void&gt; thenRun(Runnable action)</code></li><li><code>CompletableFuture&lt;Void&gt; thenAccept(Consumer&lt;? super T&gt; action)</code></li><li><code>CompletableFuture&lt;U&gt; thenApply(Function&lt;? super T, ? extends U&gt; fn)</code></li></ul></li><li>\u7EC4\u5408\u4E24\u4E2A CompletableFuture <ul><li><code>CompletableFuture&lt;U&gt; thenCompose(Function&lt;? super T, ? extends CompletionStage&lt;U&gt;&gt; fn)</code>\uFF1A\u5BF9\u4E24\u4E2A\u5F02\u6B65\u64CD\u4F5C\u8FDB\u884C\u6D41\u6C34\u7EBF\uFF0C\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u5B8C\u6210\u540E\uFF0C\u5C06\u5176\u7ED3\u679C\u4F5C\u4E3A\u53C2\u6570\u4F20\u9012\u7ED9\u7B2C\u4E8C\u4E2A\u64CD\u4F5C</li><li><code>CompletableFuture&lt;V&gt; thenCombine(CompletionStage&lt;? extends U&gt; other, BiFunction&lt;? super T,? super U,? extends V&gt; fn)</code>\uFF1A\u5F53\u4E24\u4E2A CompletableFuture \u5BF9\u8C61\u5B8C\u6210\u8BA1\u7B97\u540E\uFF0C\u5C06\u7ED3\u679C\u5408\u5E76</li></ul></li><li>\u5F02\u5E38\u5904\u7406\uFF08\u5982\u679C\u5F02\u5E38\u53D1\u751F\uFF0Cres \u53C2\u6570\u5C06\u662F null\uFF0C\u5426\u5219 ex \u5C06\u662F null\uFF09 <ul><li><code>ConnectionFuture&lt;T&gt; exceptionally(Function&lt;Throwable, ? extends T&gt; fn)</code>\uFF1A\u4EC5\u5728\u5F02\u5E38\u65F6\u56DE\u8C03\uFF0C\u53EF\u5728\u5F02\u5E38\u65F6\u8FD4\u56DE\u7279\u5B9A\u503C\u7528\u4E8E\u56DE\u9000</li><li><code>ConnectionFuture&lt;T&gt; whenComplete(BiConsumer&lt;? super T, ? super Throwable&gt; action)</code>\uFF1A\u65E0\u8BBA\u5F02\u5E38\u662F\u5426\u53D1\u751F\u90FD\u4F1A\u88AB\u8C03\u7528</li><li><code>ConnectionFuture&lt;U&gt; handle(BiFunction&lt;? super T, Throwable, ? extends U&gt; fn)</code>\uFF1A\u65E0\u8BBA\u5F02\u5E38\u662F\u5426\u53D1\u751F\u90FD\u4F1A\u88AB\u8C03\u7528\uFF0C\u53EF\u5728\u5F02\u5E38\u65F6\u8FD4\u56DE\u7279\u5B9A\u503C\u7528\u4E8E\u56DE\u9000</li></ul></li></ul><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Main</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Exception</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u521B\u5EFA\u5F02\u6B65\u6267\u884C\u4EFB\u52A1:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">CompletableFuture</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">Double</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> cf </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> CompletableFuture</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">supplyAsync</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Main</span><span style="color:#89DDFF;">::</span><span style="color:#A6ACCD;">fetchPrice</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5982\u679C\u6267\u884C\u6210\u529F:</span></span>
<span class="line"><span style="color:#A6ACCD;">        cf</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">thenAccept</span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">price: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5982\u679C\u6267\u884C\u5F02\u5E38:</span></span>
<span class="line"><span style="color:#A6ACCD;">        cf</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exceptionally</span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">printStackTrace</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u4E3B\u7EBF\u7A0B\u4E0D\u8981\u7ACB\u523B\u7ED3\u675F\uFF0C\u5426\u5219CompletableFuture\u9ED8\u8BA4\u4F7F\u7528\u7684\u7EBF\u7A0B\u6C60\u4F1A\u7ACB\u523B\u5173\u95ED:</span></span>
<span class="line"><span style="color:#A6ACCD;">        Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Double</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetchPrice</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">InterruptedException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">random</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.3</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">throw</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RuntimeException</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fetch price failed!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">random</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="jvm" tabindex="-1">JVM <a class="header-anchor" href="#jvm" aria-hidden="true">#</a></h2><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-hotspot-key-components.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=url&amp;id=KI4ZW&amp;originHeight=720&amp;originWidth=960&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p><h3 id="\u8FD0\u884C\u65F6\u6570\u636E\u533A\u57DF" tabindex="-1">\u8FD0\u884C\u65F6\u6570\u636E\u533A\u57DF <a class="header-anchor" href="#\u8FD0\u884C\u65F6\u6570\u636E\u533A\u57DF" aria-hidden="true">#</a></h3><p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-memory-runtime-data-area.png#crop=0.0486&amp;crop=0.0344&amp;crop=0.9559&amp;crop=0.9668&amp;from=url&amp;height=711&amp;id=G6EqC&amp;originHeight=784&amp;originWidth=658&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=&amp;width=597" alt=""></p><p>\u7A0B\u5E8F\u8BA1\u6570\u5668\uFF08Program Counter Register\uFF09\uFF1A\u4E00\u5757\u8F83\u5C0F\u7684\u5185\u5B58\u7A7A\u95F4\uFF0C\u53EF\u770B\u505A\u662F\u5F53\u524D\u7EBF\u7A0B\u6240\u6267\u884C\u7684\u5B57\u8282\u7801\u7684\u884C\u53F7\u6307\u793A\u5668 <br> Java \u865A\u62DF\u673A\u6808\uFF08Java Virtual Machine Stacks\uFF09 \u4E5F\u662F\u7EBF\u7A0B\u79C1\u6709\u7684\uFF0C\u5B83\u7684\u751F\u547D\u5468\u671F\u4E0E\u7EBF\u7A0B\u76F8\u540C <br> \u672C\u5730\u65B9\u6CD5\u6808\uFF08Native Method Stack\uFF09 \u4E0E\u865A\u62DF\u673A\u6808\u7684\u4F5C\u7528\u76F8\u4F3C\uFF0C\u4E3A Native \u65B9\u6CD5\u670D\u52A1 <br> Java \u5806\uFF08Java Heap\uFF09 \uFF1A\u5B58\u653E\u5BF9\u8C61\u5B9E\u4F8B</p><ul><li>\u65B0\u751F\u4EE3\uFF08Young Generation\uFF09 <ul><li>Eden - Eden \u548C Survivor \u7684\u6BD4\u4F8B\u4E3A 8:1</li><li>From Survivor</li><li>To Survivor</li></ul></li><li>\u8001\u5E74\u4EE3\uFF08Old Generation\uFF09</li><li>\u6C38\u4E45\u4EE3\uFF08Permanent Generation\uFF09</li></ul><p>\u65B9\u6CD5\u533A\uFF08Method Area\uFF09\u4E5F\u88AB\u79F0\u4E3A\u6C38\u4E45\u4EE3\u3002\u7528\u4E8E\u5B58\u653E\u5DF2\u88AB\u52A0\u8F7D\u7684\u7C7B\u4FE1\u606F\u3001\u5E38\u91CF\u3001\u9759\u6001\u53D8\u91CF\u3001\u5373\u65F6\u7F16\u8BD1\u5668\u7F16\u8BD1\u540E\u7684\u4EE3\u7801\u7B49\u6570\u636E\u3002 <br> \u8FD0\u884C\u65F6\u5E38\u91CF\u6C60\uFF08Runtime Constant Pool\uFF09 \u662F\u65B9\u6CD5\u533A\u7684\u4E00\u90E8\u5206\uFF0CClass \u6587\u4EF6\u4E2D\u9664\u4E86\u6709\u7C7B\u7684\u7248\u672C\u3001\u5B57\u6BB5\u3001\u65B9\u6CD5\u3001\u63A5\u53E3\u7B49\u63CF\u8FF0\u4FE1\u606F\uFF0C\u8FD8\u6709\u4E00\u9879\u4FE1\u606F\u662F\u5E38\u91CF\u6C60\uFF08Constant Pool Table\uFF09\uFF0C\u7528\u4E8E\u5B58\u653E\u7F16\u8BD1\u5668\u751F\u6210\u7684\u5404\u79CD\u5B57\u9762\u91CF\u548C\u7B26\u53F7\u5F15\u7528</p><h3 id="\u5783\u573E\u6536\u96C6" tabindex="-1">\u5783\u573E\u6536\u96C6 <a class="header-anchor" href="#\u5783\u573E\u6536\u96C6" aria-hidden="true">#</a></h3><h4 id="\u53EF\u8FBE\u6027\u5206\u6790\u7B97\u6CD5" tabindex="-1">\u53EF\u8FBE\u6027\u5206\u6790\u7B97\u6CD5 <a class="header-anchor" href="#\u53EF\u8FBE\u6027\u5206\u6790\u7B97\u6CD5" aria-hidden="true">#</a></h4><p><strong>GC Roots \u7684\u5BF9\u8C61</strong></p><ul><li>\u865A\u62DF\u673A\u6808\u4E2D\u5F15\u7528\u7684\u5BF9\u8C61</li><li>\u672C\u5730\u65B9\u6CD5\u6808\u4E2D\u5F15\u7528\u7684\u5BF9\u8C61\uFF08Native \u65B9\u6CD5\uFF09</li><li>\u65B9\u6CD5\u533A\u4E2D\uFF0C\u7C7B\u9759\u6001\u5C5E\u6027\u5F15\u7528\u7684\u5BF9\u8C61</li><li>\u65B9\u6CD5\u533A\u4E2D\uFF0C\u5E38\u91CF\u5F15\u7528\u7684\u5BF9\u8C61</li></ul><h4 id="\u5F15\u7528" tabindex="-1">\u5F15\u7528 <a class="header-anchor" href="#\u5F15\u7528" aria-hidden="true">#</a></h4><ul><li>\u5F3A\u5F15\u7528\uFF08Strong Reference\uFF09\uFF1A\u4E0D\u4F1A\u88AB\u5783\u573E\u6536\u96C6\u5668\u56DE\u6536\uFF0C\u5982\u4F7F\u7528 new \u4E00\u4E2A\u65B0\u5BF9\u8C61</li><li>\u8F6F\u5F15\u7528\uFF08Soft Reference\uFF09\uFF1A\u53EA\u6709\u5728\u5185\u5B58\u4E0D\u591F\u7684\u60C5\u51B5\u4E0B\u624D\u4F1A\u88AB\u56DE\u6536\uFF0C\u4F7F\u7528 SoftReference \u7C7B\u6765\u521B\u5EFA</li><li>\u5F31\u5F15\u7528\uFF08Weak Reference\uFF09\uFF1A\u4E00\u5B9A\u4F1A\u88AB\u5783\u573E\u6536\u96C6\u5668\u56DE\u6536</li><li>\u865A\u5F15\u7528\uFF08Phantom Reference\uFF09\uFF1A\u4E0D\u4F1A\u5BF9\u5176\u751F\u5B58\u65F6\u95F4\u6784\u6210\u5F71\u54CD\uFF0C\u5176 PhantomReference#get() \u65B9\u6CD5\u603B\u662F\u8FD4\u56DE null\uFF0C\u56E0\u6B64\u65E0\u6CD5\u83B7\u53D6\u88AB\u5F15\u7528\u7684\u5BF9\u8C61\uFF0C\u4E3B\u8981\u7528\u4E8E\u8DDF\u8E2A\u4E00\u4E2A\u5BF9\u8C61\u88AB\u56DE\u6536\u7684\u8FC7\u7A0B</li></ul><p>\u53C2\u6570</p><table><thead><tr><th>\u914D\u7F6E</th><th>\u63CF\u8FF0</th></tr></thead><tbody><tr><td>-Xss</td><td>\u865A\u62DF\u673A\u6808\u5927\u5C0F\u3002</td></tr><tr><td>-Xms</td><td>\u5806\u7A7A\u95F4\u521D\u59CB\u503C\u3002</td></tr><tr><td>-Xmx</td><td>\u5806\u7A7A\u95F4\u6700\u5927\u503C\u3002</td></tr><tr><td>-Xmn</td><td>\u65B0\u751F\u4EE3\u7A7A\u95F4\u5927\u5C0F\u3002</td></tr><tr><td>-XX:NewSize</td><td>\u65B0\u751F\u4EE3\u7A7A\u95F4\u521D\u59CB\u503C\u3002</td></tr><tr><td>-XX:MaxNewSize</td><td>\u65B0\u751F\u4EE3\u7A7A\u95F4\u6700\u5927\u503C\u3002</td></tr><tr><td>-XX:NewRatio</td><td>\u65B0\u751F\u4EE3\u4E0E\u5E74\u8001\u4EE3\u7684\u6BD4\u4F8B\u3002\u9ED8\u8BA4\u4E3A 2\uFF0C\u610F\u5473\u7740\u8001\u5E74\u4EE3\u662F\u65B0\u751F\u4EE3\u7684 2 \u500D\u3002</td></tr><tr><td>-XX:SurvivorRatio</td><td>\u65B0\u751F\u4EE3\u4E2D\u8C03\u6574 eden \u533A\u4E0E survivor \u533A\u7684\u6BD4\u4F8B\uFF0C\u9ED8\u8BA4\u4E3A 8\u3002\u5373 eden \u533A\u4E3A 80% \u7684\u5927\u5C0F\uFF0C\u4E24\u4E2A survivor \u5206\u522B\u4E3A 10% \u7684\u5927\u5C0F\u3002</td></tr><tr><td>-XX:PermSize</td><td>\u6C38\u4E45\u4EE3\u7A7A\u95F4\u7684\u521D\u59CB\u503C\u3002</td></tr><tr><td>-XX:MaxPermSize</td><td>\u6C38\u4E45\u4EE3\u7A7A\u95F4\u7684\u6700\u5927\u503C\u3002</td></tr></tbody></table><h3 id="\u5783\u573E\u6536\u96C6\u5668-garbage-collector" tabindex="-1">\u5783\u573E\u6536\u96C6\u5668 Garbage Collector <a class="header-anchor" href="#\u5783\u573E\u6536\u96C6\u5668-garbage-collector" aria-hidden="true">#</a></h3><h3 id="jdk-\u76D1\u63A7\u548C\u6545\u969C\u8BCA\u65AD\u547D\u4EE4\u884C\u5DE5\u5177" tabindex="-1">JDK \u76D1\u63A7\u548C\u6545\u969C\u8BCA\u65AD\u547D\u4EE4\u884C\u5DE5\u5177 <a class="header-anchor" href="#jdk-\u76D1\u63A7\u548C\u6545\u969C\u8BCA\u65AD\u547D\u4EE4\u884C\u5DE5\u5177" aria-hidden="true">#</a></h3><ul><li><strong>jps -l</strong>\uFF1AJVM \u8FDB\u7A0B\u72B6\u6001\u5DE5\u5177\uFF0C\u5217\u51FA\u7CFB\u7EDF\u4E0A\u7684 JVM \u8FDB\u7A0B</li><li>jcmd\uFF1AJVM \u547D\u4EE4\u884C\u8C03\u8BD5\u5DE5\u5177\uFF0C\u7528\u4E8E\u5411 JVM \u8FDB\u7A0B\u53D1\u9001\u8C03\u8BD5\u547D\u4EE4</li><li>jstat\uFF1AJVM \u7EDF\u8BA1\u76D1\u63A7\u5DE5\u5177\uFF0C\u9644\u52A0\u5230\u4E00\u4E2A JVM \u8FDB\u7A0B\u4E0A\u6536\u96C6\u548C\u8BB0\u5F55 JVM \u7684\u5404\u79CD\u6027\u80FD\u6307\u6807\u6570\u636E <ul><li><code>jstat -gcutil &lt;pid&gt; 5000 100</code>\uFF1A\u8F93\u51FA GC \u548C\u5185\u5B58\u5360\u7528\u6C47\u603B\u4FE1\u606F\uFF0C\u6BCF\u9694 5 \u79D2\u8F93\u51FA\u4E00\u6B21\uFF0C\u8F93\u51FA 100 \u6B21\uFF08\u5176\u4E2D\uFF0CS0 \u8868\u793A Survivor0 \u533A\u5360\u7528\u767E\u5206\u6BD4\uFF0CS1 \u8868\u793A Survivor1 \u533A\u5360\u7528\u767E\u5206\u6BD4\uFF0CE \u8868\u793A Eden \u533A\u5360\u7528\u767E\u5206\u6BD4\uFF0CO \u8868\u793A\u8001\u5E74\u4EE3\u5360\u7528\u767E\u5206\u6BD4\uFF0CM \u8868\u793A\u5143\u6570\u636E\u533A\u5360\u7528\u767E\u5206\u6BD4\uFF0CYGC \u8868\u793A\u65B0\u751F\u4EE3\u56DE\u6536\u6B21\u6570\uFF0CYGCT \u8868\u793A\u65B0\u751F\u4EE3\u56DE\u6536\u8017\u65F6\uFF0CFGC \u8868\u793A\u8001\u5E74\u4EE3\u56DE\u6536\u6B21\u6570\uFF0CFGCT \u8868\u793A\u8001\u5E74\u4EE3\u56DE\u6536\u8017\u65F6\uFF09</li></ul></li><li><strong>jstack</strong>\uFF1AJVM \u6808\u67E5\u770B\u5DE5\u5177\uFF0C\u53EF\u4EE5\u6253\u5370 JVM \u8FDB\u7A0B\u7684\u7EBF\u7A0B\u6808\u548C\u9501\u60C5\u51B5</li><li><strong>jinfo</strong>\uFF1AJVM \u4FE1\u606F\u67E5\u770B\u5DE5\u5177\uFF0C\u67E5\u770B JVM \u7684\u5404\u79CD\u914D\u7F6E\u4FE1\u606F</li><li><strong>jmap</strong>\uFF1AJVM \u5806\u5185\u5B58\u5206\u6790\u5DE5\u5177\uFF0C\u53EF\u4EE5\u6253\u5370 VM \u8FDB\u7A0B\u5BF9\u8C61\u76F4\u65B9\u56FE\u3001\u7C7B\u52A0\u8F7D\u7EDF\u8BA1\uFF0C\u4EE5\u53CA\u505A\u5806\u8F6C\u50A8\u64CD\u4F5C <ul><li><code>jmap -dump:format=b,file=/tmp/a.hprof &lt;pid&gt;</code>\uFF1A\u751F\u6210\u865A\u62DF\u673A\u7684\u5806\u5185\u5B58\u8F6C\u50A8\u5FEB\u7167\uFF08heapdump \u6587\u4EF6\uFF09</li><li><code>jmap -heap &lt;pid&gt;</code>\uFF1A\u663E\u793A\u5806\u8BE6\u7EC6\u4FE1\u606F\uFF0C\u5305\u62EC\u4F7F\u7528\u7684 GC \u7B97\u6CD5\u3001\u5806\u914D\u7F6E\u4FE1\u606F\u548C\u5404\u5185\u5B58\u533A\u57DF\u5185\u5B58\u4F7F\u7528\u4FE1\u606F</li><li><code>jmap -histo:live &lt;pid&gt;</code>\uFF1A\u663E\u793A\u5806\u4E2D\u5BF9\u8C61\u7684\u7EDF\u8BA1\u4FE1\u606F\uFF0C\u5305\u62EC\u6BCF\u4E2A Java \u7C7B\u7684\u5BF9\u8C61\u6570\u91CF\uFF08\u53EA\u8BA1\u7B97\u6D3B\u52A8\u7684\u5BF9\u8C61\uFF09\u3001\u5185\u5B58\u5927\u5C0F</li></ul></li><li>jhat\uFF1AJVM Heap Dump Browser\uFF0C\u7528\u4E8E\u5206\u6790 heapdump \u6587\u4EF6\uFF0C\u5B83\u4F1A\u5EFA\u7ACB\u4E00\u4E2A HTTP/HTML \u670D\u52A1\u5668\uFF0C\u8BA9\u7528\u6237\u53EF\u4EE5\u5728\u6D4F\u89C8\u5668\u4E0A\u67E5\u770B\u5206\u6790\u7ED3\u679C</li></ul>`,122),e=[o];function r(c,t,D,y,A,F){return a(),n("div",null,e)}const b=s(p,[["render",r]]);export{i as __pageData,b as default};
