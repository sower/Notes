import{_ as s,c as n,o as a,V as l}from"./chunks/framework.46d50e86.js";const b=JSON.parse('{"title":"Python Lib","description":"","frontmatter":{"title":"Python Lib","created_at":"2022-02-01T05:44:43.000Z","updated_at":"2023-02-04T09:58:30.000Z","word_count":19661},"headers":[],"relativePath":"CS/Python Lib.md","filePath":"CS/Python Lib.md"}'),p={name:"CS/Python Lib.md"},o=l(`<h2 id="——-moudle-——" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/index.html" target="_blank" rel="noreferrer">—— Moudle ——</a> <a class="header-anchor" href="#——-moudle-——" aria-label="Permalink to &quot;[—— Moudle ——](https://docs.python.org/zh-cn/3/library/index.html)&quot;">​</a></h2><h2 id="数据类型" tabindex="-1">数据类型 <a class="header-anchor" href="#数据类型" aria-label="Permalink to &quot;数据类型&quot;">​</a></h2><h3 id="datetime-基本的日期和时间类型" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/datetime.html" target="_blank" rel="noreferrer">datetime--- 基本的日期和时间类型</a> <a class="header-anchor" href="#datetime-基本的日期和时间类型" aria-label="Permalink to &quot;[datetime--- 基本的日期和时间类型](https://docs.python.org/zh-cn/3/library/datetime.html)&quot;">​</a></h3><p><strong>常量</strong></p><ul><li>datetime.MINYEAR——1</li><li>datetime.MAXYEAR——9999</li></ul><p><strong>类</strong> <br> class <strong>date</strong>time.date 一个理想化的简单型日期，属性: <a href="https://docs.python.org/zh-cn/3/library/datetime.html#datetime.date.year" target="_blank" rel="noreferrer">year</a>, month, and day。 <br> class datetime.date(year, month, day)</p><ul><li>classmethod date.today() 返回当前的本地日期</li><li>classmethod date.fromtimestamp(timestamp) 返回对应于 POSIX 时间戳的当地时间</li><li>classmethod date.fromordinal(ordinal) 返回对应于预期格列高利历序号的日期</li><li>classmethod date.fromisoformat(date_string) 返回一个对应于以 YYYY-MM-DD 格式给出的 date_string 的 date 对象</li></ul><p>实例方法</p><ul><li>date.replace(year=self.year, month=self.month, day=self.day) 返回一个具有同样值的日期</li><li>date.weekday() 返回一个整数代表星期几，星期一为0，星期天为6</li><li>date.isoweekday() 返回一个整数代表星期几，星期一为1，星期天为7</li><li>date.isoformat() 返回一个以 ISO 8601 格式 YYYY-MM-DD 来表示日期的字符串</li><li>date.strftime(format) 返回一个由显式格式字符串所指明的代表日期的字符串</li></ul><p>class datetime.<strong>time</strong> <br> 一个独立于任何特定日期的理想化时间，属性：<a href="https://docs.python.org/zh-cn/3/library/datetime.html#datetime.time.hour" target="_blank" rel="noreferrer">hour</a>, minute, second, microsecond 和 tzinfo</p><p>class datetime.time(hour=0, minute=0, second=0, microsecond=0, tzinfo=None, *, fold=0)</p><ul><li>classmethod time.fromisoformat(time_string)</li><li>time.replace(hour=self.hour, minute=self.minute, second=self.second, microsecond=self.microsecond, tzinfo=self.tzinfo, *, fold=0)</li><li>time.isoformat(timespec=&#39;auto&#39;)</li><li>time.utcoffset() 如果 tzinfo 为 None，则返回 None，否则返回 self.tzinfo.utcoffset(None)</li><li>time.dst() 如果 tzinfo 为 None，则返回 None，否则返回 self.tzinfo.dst(None)</li><li>time.tzname() 如果 tzinfo 为 None，则返回 None，否则返回 self.tzinfo.tzname(None)</li></ul><p>class datetime.**datetime **日期和时间的结合。</p><ul><li>today()</li><li>now(tz=None)</li><li>utcnow()</li><li>fromtimestamp(timestamp, tz=None)</li><li>utcfromtimestamp(timestamp) 返回对应于 POSIX 时间戳的 UTC datetime，其中 tzinfo 值为 None</li><li>combine(date, time, tzinfo=self.tzinfo) 返回一个新的 datetime 对象</li></ul><p>实例方法</p><ul><li>datetime.date()</li><li>datetime.time() 返回具有同样 hour, minute, second, microsecond 和 fold 值的 time 对象</li><li>datetime.timetz() 返回具有同样 hour, minute, second, microsecond, fold 和 tzinfo 属性性的 time 对象</li><li>datetime.astimezone(tz=None) 返回一个具有新的 tzinfo 属性 tz 的 datetime 对象，并会调整日期和时间数据使得结果对应的 UTC 时间与 self 相同，但为 tz 时区的本地时间</li><li>datetime.timestamp() 返回对应于 datetime 实例的 POSIX 时间戳</li><li>datetime.isoformat(sep=&#39;T&#39;, timespec=&#39;auto&#39;) 返回一个以 ISO 8601 格式表示的日期和时间字符串 <ul><li>&#39;auto&#39;: 如果 microsecond 为 0 则与 &#39;seconds&#39; 相同，否则与 &#39;microseconds&#39; 相同。</li><li>&#39;hours&#39;: 以两个数码的 HH 格式 包含 hour。</li><li>&#39;minutes&#39;: 以 HH:MM 格式包含 hour 和 minute。</li><li>&#39;seconds&#39;: 以 HH:MM:SS 格式包含 hour, minute 和 second。</li><li>&#39;milliseconds&#39;: 包含完整时间，但将秒值的小数部分截断至微秒。 格式为 HH:MM:SS.sss</li><li>&#39;microseconds&#39;: 以 HH:MM:SS.ffffff 格式包含完整时间。</li></ul></li></ul><p>class datetime.**timedelta **表示两个 date 或者 time 的时间间隔，精确到微秒 <br> class datetime.timedelta(days=0, seconds=0, microseconds=0, milliseconds=0, minutes=0, hours=0, weeks=0) <br> 所有参数都是可选的并且默认为 0。 这些参数可以是整数或者浮点数，也可以是正数或者负数。</p><ul><li>timedelta.total_seconds()</li></ul><p>class datetime.<strong>timezone</strong> 一个实现了 <a href="https://docs.python.org/zh-cn/3/library/datetime.html#datetime.tzinfo" target="_blank" rel="noreferrer">tzinfo</a> 抽象基类的子类，用于表示相对于 世界标准时间（UTC）的偏移量。 <br> class datetime.timezone(offset, name=None) offset 限制于 -timedelta(hours=24) 和 timedelta(hours=24) 之间 <br> 时区转换</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">datetime</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">datetime</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">timedelta</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">timezone</span></span>
<span class="line"><span style="color:#E06C75;">utc_8</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">timezone</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">timedelta</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">hours</span><span style="color:#ABB2BF;">=8))</span></span>
<span class="line"><span style="color:#E06C75;">start</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">datetime</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">fromisoformat</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">datetime</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">now</span><span style="color:#ABB2BF;">().</span><span style="color:#E06C75;">date</span><span style="color:#ABB2BF;">().</span><span style="color:#E06C75;">isoformat</span><span style="color:#ABB2BF;">()).</span><span style="color:#E06C75;">replace</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">tzinfo</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">utc_8</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">end</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">start</span><span style="color:#ABB2BF;"> + </span><span style="color:#E06C75;">timedelta</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">days</span><span style="color:#ABB2BF;">=1, </span><span style="color:#E06C75;">hours</span><span style="color:#ABB2BF;">=3)</span></span>
<span class="line"><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">start</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">astimezone</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">tz</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">timezone</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">utc</span><span style="color:#ABB2BF;">).</span><span style="color:#E06C75;">isoformat</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">timespec</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;milliseconds&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">end</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">astimezone</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">tz</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">timezone</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">utc</span><span style="color:#ABB2BF;">).</span><span style="color:#E06C75;">isoformat</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">datetime</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">today</span><span style="color:#ABB2BF;">().</span><span style="color:#E06C75;">isoformat</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">timespec</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;milliseconds&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">datetime</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">fromisoformat</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;2021-10-20T05:41:27&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#E06C75;">isoformat</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>strftime(format) ：创建由一个显式格式字符串所控制的表示时间的字符串。 <br> strptime(date_string, format)：根据表示日期和时间的字符串和相应的格式字符串来创建一个 datetime 对象。</p><table><thead><tr><th>指令</th><th>含义</th></tr></thead><tbody><tr><td>%a</td><td>本地化的缩写星期中每日的名称。</td></tr><tr><td>%A</td><td>本地化的星期中每日的完整名称。</td></tr><tr><td>%b</td><td>本地化的月缩写名称。</td></tr><tr><td>%B</td><td>本地化的月完整名称。</td></tr><tr><td>%c</td><td>本地化的适当日期和时间表示。</td></tr><tr><td>%d</td><td>十进制数 [01,31] 表示的月中日。</td></tr><tr><td>%H</td><td>十进制数 [00,23] 表示的小时（24小时制）。</td></tr><tr><td>%I</td><td>十进制数 [01,12] 表示的小时（12小时制）。</td></tr><tr><td>%j</td><td>十进制数 [001,366] 表示的年中日。</td></tr><tr><td>%m</td><td>十进制数 [01,12] 表示的月。</td></tr><tr><td>%M</td><td>十进制数 [00,59] 表示的分钟。</td></tr><tr><td>%p</td><td>本地化的 AM 或 PM 。</td></tr><tr><td>%S</td><td>十进制数 [00,61] 表示的秒。</td></tr><tr><td>%U</td><td>十进制数 [00,53] 表示的一年中的周数（星期日作为一周的第一天）作为。在第一个星期日之前的新年中的所有日子都被认为是在第0周。</td></tr><tr><td>%w</td><td>十进制数 [0(星期日),6] 表示的周中日。</td></tr><tr><td>%W</td><td>十进制数 [00,53] 表示的一年中的周数（星期一作为一周的第一天）作为。在第一个星期一之前的新年中的所有日子被认为是在第0周。</td></tr><tr><td>%x</td><td>本地化的适当日期表示。</td></tr><tr><td>%X</td><td>本地化的适当时间表示。</td></tr><tr><td>%y</td><td>十进制数 [00,99] 表示的没有世纪的年份。</td></tr><tr><td>%Y</td><td>十进制数表示的带世纪的年份。</td></tr><tr><td>%z</td><td>时区偏移以格式 +HHMM 或 -HHMM 形式的 UTC/GMT 的正或负时差指示，其中H表示十进制小时数字，M表示小数分钟数字 [-23:59, +23:59] 。</td></tr><tr><td>%Z</td><td>时区名称（如果不存在时区，则不包含字符）。</td></tr></tbody></table><p>str互换datetime</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">datetime</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">datetime</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">cday</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">datetime</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">strptime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;2015-6-1 18:19:59&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;%Y-%m-%d %H:%M:%S&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">cday</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">2015-06-01 18:19:59</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">now</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">datetime</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">now</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">now</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;%Y{y}%m{m}%d{d}&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#E06C75;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">y</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;年&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">m</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;月&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;日&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">2020</span><span style="color:#E06C75;">年10月18日</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="time-时间的访问和转换" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/time.html" target="_blank" rel="noreferrer">time--- 时间的访问和转换</a> <a class="header-anchor" href="#time-时间的访问和转换" aria-label="Permalink to &quot;[time--- 时间的访问和转换](https://docs.python.org/zh-cn/3/library/time.html)&quot;">​</a></h3><table><thead><tr><th>从</th><th>到</th><th>使用</th></tr></thead><tbody><tr><td>自纪元以来的秒数</td><td>UTC 的 <a href="https://docs.python.org/zh-cn/3/library/time.html#time.struct_time" target="_blank" rel="noreferrer">struct_time</a></td><td><a href="https://docs.python.org/zh-cn/3/library/time.html#time.gmtime" target="_blank" rel="noreferrer">gmtime()</a></td></tr><tr><td>自纪元以来的秒数</td><td>本地时间的 <a href="https://docs.python.org/zh-cn/3/library/time.html#time.struct_time" target="_blank" rel="noreferrer">struct_time</a></td><td><a href="https://docs.python.org/zh-cn/3/library/time.html#time.localtime" target="_blank" rel="noreferrer">localtime()</a></td></tr><tr><td>UTC 的 <a href="https://docs.python.org/zh-cn/3/library/time.html#time.struct_time" target="_blank" rel="noreferrer">struct_time</a></td><td>自纪元以来的秒数</td><td><a href="https://docs.python.org/zh-cn/3/library/calendar.html#calendar.timegm" target="_blank" rel="noreferrer">calendar.timegm()</a></td></tr><tr><td>本地时间的 <a href="https://docs.python.org/zh-cn/3/library/time.html#time.struct_time" target="_blank" rel="noreferrer">struct_time</a></td><td>自纪元以来的秒数</td><td><a href="https://docs.python.org/zh-cn/3/library/time.html#time.mktime" target="_blank" rel="noreferrer">mktime()</a></td></tr></tbody></table><p><strong>class time.struct_time</strong></p><table><thead><tr><th>索引</th><th>属性</th><th>值</th></tr></thead><tbody><tr><td>0</td><td>tm_year</td><td>（例如，1993）</td></tr><tr><td>1</td><td>tm_mon</td><td>range [1, 12]</td></tr><tr><td>2</td><td>tm_mday</td><td>range [1, 31]</td></tr><tr><td>3</td><td>tm_hour</td><td>range [0, 23]</td></tr><tr><td>4</td><td>tm_min</td><td>range [0, 59]</td></tr><tr><td>5</td><td>tm_sec</td><td>range [0, 61]</td></tr><tr><td>6</td><td>tm_wday</td><td>range [0, 6] ，周一为 0</td></tr><tr><td>7</td><td>tm_yday</td><td>range [1, 366]</td></tr><tr><td>8</td><td>tm_isdst</td><td>0, 1 或 -1；如下所示</td></tr><tr><td>N/A</td><td>tm_zone</td><td>时区名称的缩写</td></tr><tr><td>N/A</td><td>tm_gmtoff</td><td>以秒为单位的UTC以东偏离</td></tr></tbody></table><ul><li>time.sleep(secs)：暂停执行调用线程达到给定的秒数</li><li>time.time() ：返回以浮点数表示的从 epoch 开始的秒数的时间值</li><li>time.ctime([secs])：转换以距离初始纪元的秒数表示的时间，形式 &#39;Sun Jun 20 23:21:05 1993&#39; 代表本地时间</li><li>time.strftime(format[, t])：转换一个元组或 struct_time 表示的由 gmtime() 或 localtime() 返回的时间到由 format 参数指定的字符串</li><li>time.strptime(string[, format])：根据格式解析表示时间的字符串</li></ul><h3 id="collections-容器数据类型" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/collections.html" target="_blank" rel="noreferrer">collections--- 容器数据类型</a> <a class="header-anchor" href="#collections-容器数据类型" aria-label="Permalink to &quot;[collections--- 容器数据类型](https://docs.python.org/zh-cn/3/library/collections.html)&quot;">​</a></h3><table><thead><tr><th><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.namedtuple" target="_blank" rel="noreferrer">namedtuple()</a></th><th>创建命名元组子类的工厂函数</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.deque" target="_blank" rel="noreferrer">deque</a></td><td>类似列表(list)的容器，实现了在两端快速添加(append)和弹出(pop)</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.ChainMap" target="_blank" rel="noreferrer">ChainMap</a></td><td>类似字典(dict)的容器类，将多个映射集合到一个视图里面</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.Counter" target="_blank" rel="noreferrer">Counter</a></td><td>字典的子类，提供了可哈希对象的计数功能</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.OrderedDict" target="_blank" rel="noreferrer">OrderedDict</a></td><td>字典的子类，保存了他们被添加的顺序</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.defaultdict" target="_blank" rel="noreferrer">defaultdict</a></td><td>字典的子类，提供了一个工厂函数，为字典查询提供一个默认值</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.UserDict" target="_blank" rel="noreferrer">UserDict</a></td><td>封装了字典对象，简化了字典子类化</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.UserList" target="_blank" rel="noreferrer">UserList</a></td><td>封装了列表对象，简化了列表子类化</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/collections.html#collections.UserString" target="_blank" rel="noreferrer">UserString</a></td><td>封装了列表对象，简化了字符串子类化</td></tr></tbody></table><h4 id="namedtuple" tabindex="-1">namedtuple <a class="header-anchor" href="#namedtuple" aria-label="Permalink to &quot;namedtuple&quot;">​</a></h4><p>*<em>namedtuple(typename, field_names, <em>, rename=False, defaults=None, module=None)</em></em> <br> 元组子类，可以通过域名来获取属性值，也可以通过索引和迭代获取值。</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">collections</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">namedtuple</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">Point</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">namedtuple</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Point&#39;</span><span style="color:#ABB2BF;">, [</span><span style="color:#98C379;">&#39;x&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;y&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">p</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">Point</span><span style="color:#ABB2BF;">(1, 2)</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">p</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">x</span></span>
<span class="line"><span style="color:#ABB2BF;">1</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">p</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">y</span></span>
<span class="line"><span style="color:#ABB2BF;">2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="deque" tabindex="-1">deque <a class="header-anchor" href="#deque" aria-label="Permalink to &quot;deque&quot;">​</a></h4><p><strong>class collections.deque([iterable[, maxlen]])</strong> 双向队列</p><ul><li>append(x) 添加 x 到右端。</li><li>appendleft(x) 添加 x 到左端。</li><li>clear() 移除所有元素，使其长度为0.</li><li>copy() 创建一份浅拷贝。</li><li>count(x) 计算deque中个数等于 x 的元素。</li><li>extend(iterable) 扩展deque的右侧，通过添加iterable参数中的元素。</li><li>extendleft(iterable) 扩展deque的左侧。左添加时，在结果中iterable参数中的顺序将被反过来添加。</li><li>index(x[, start[, stop]]) 返回第 x 个元素（从 start 开始计算，在 stop 之前）。返回第一个匹配，ValueError 。</li><li>insert(i, x) 在位置 i 插入 x (如果插入会导致一个限长deque超出长度 maxlen 的话，就升起一个 IndexError )</li><li>pop() 移去并且返回一个元素，deque最右侧的那一个。如果没有元素的话，就升起 IndexError 索引错误。</li><li>popleft() 移去并且返回一个元素，deque最左侧的那一个。如果没有元素的话，就升起 IndexError 索引错误。</li><li>remove(value) 移去找到的第一个 value。 如果没有的话就升起 ValueError 。</li><li>reverse() 将deque逆序排列。返回 None 。</li><li>rotate(n=1) 向右循环移动 n 步。 如果 n 是负数，就向左循环。</li></ul><p>如果deque不是空的，向右循环移动一步就等价于 d.appendleft(d.pop()) ， 向左循环一步就等价于 d.append(d.popleft()) 。</p><p>只读属性: <strong>maxlen</strong>——Deque的最大尺寸，如果没有限定的话就是 None 。</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">collections</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">deque</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">deque</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;ghi&#39;</span><span style="color:#ABB2BF;">)                 # </span><span style="color:#E06C75;">make</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">deque</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">three</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">items</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">for</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">elem</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">:                   # </span><span style="color:#E06C75;">iterate</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">over</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">deque</span><span style="color:#98C379;">&#39;s element</span><span style="color:#FFFFFF;">s</span></span>
<span class="line"><span style="color:#ABB2BF;">...     </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">elem</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">upper</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#E06C75;">G</span></span>
<span class="line"><span style="color:#E06C75;">H</span></span>
<span class="line"><span style="color:#E06C75;">I</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;j&#39;</span><span style="color:#ABB2BF;">)                    # </span><span style="color:#E06C75;">add</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">entry</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">to</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">right</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">side</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">appendleft</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;f&#39;</span><span style="color:#ABB2BF;">)                # </span><span style="color:#E06C75;">add</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">entry</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">to</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">left</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">side</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">                                # </span><span style="color:#E06C75;">show</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">representation</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">of</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">deque</span></span>
<span class="line"><span style="color:#E06C75;">deque</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;f&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;g&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;h&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;i&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;j&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pop</span><span style="color:#ABB2BF;">()                          # </span><span style="color:#E06C75;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">and</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">remove</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">rightmost</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">item</span></span>
<span class="line"><span style="color:#98C379;">&#39;j&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">popleft</span><span style="color:#ABB2BF;">()                      # </span><span style="color:#E06C75;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">and</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">remove</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">leftmost</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">item</span></span>
<span class="line"><span style="color:#98C379;">&#39;f&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">list</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">)                          # </span><span style="color:#E06C75;">list</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">contents</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">of</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">deque</span></span>
<span class="line"><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;g&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;h&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;i&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">[0]                             # </span><span style="color:#E06C75;">peek</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">at</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">leftmost</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">item</span></span>
<span class="line"><span style="color:#98C379;">&#39;g&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">[-1]                            # </span><span style="color:#E06C75;">peek</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">at</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">rightmost</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">item</span></span>
<span class="line"><span style="color:#98C379;">&#39;i&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">list</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">reversed</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">))                # </span><span style="color:#E06C75;">list</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">contents</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">of</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">deque</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">reverse</span></span>
<span class="line"><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;i&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;h&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;g&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#98C379;">&#39;h&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">                         # </span><span style="color:#E06C75;">search</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">deque</span></span>
<span class="line"><span style="color:#E06C75;">True</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">extend</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;jkl&#39;</span><span style="color:#ABB2BF;">)                  # </span><span style="color:#E06C75;">add</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">multiple</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">elements</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">at</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">once</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span></span>
<span class="line"><span style="color:#E06C75;">deque</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;g&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;h&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;i&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;j&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;k&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;l&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">rotate</span><span style="color:#ABB2BF;">(1)                      # </span><span style="color:#E06C75;">right</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">rotation</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span></span>
<span class="line"><span style="color:#E06C75;">deque</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;l&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;g&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;h&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;i&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;j&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;k&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">rotate</span><span style="color:#ABB2BF;">(-1)                     # </span><span style="color:#E06C75;">left</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">rotation</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span></span>
<span class="line"><span style="color:#E06C75;">deque</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;g&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;h&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;i&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;j&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;k&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;l&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">deque</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">reversed</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">))               # </span><span style="color:#E06C75;">make</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">new</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">deque</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">reverse</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">order</span></span>
<span class="line"><span style="color:#E06C75;">deque</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;l&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;k&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;j&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;i&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;h&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;g&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">clear</span><span style="color:#ABB2BF;">()                        # </span><span style="color:#E06C75;">empty</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">deque</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">pop</span><span style="color:#ABB2BF;">()                          # </span><span style="color:#E06C75;">cannot</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">pop</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">an</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">empty</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">deque</span></span>
<span class="line"><span style="color:#61AFEF;">Traceback</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">most</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">recent</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">call</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">last</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">File</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;&lt;pyshell#6&gt;&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">line</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">toplevel</span><span style="color:#56B6C2;">-</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">pop</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">IndexError: </span><span style="color:#E06C75;">pop</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">an</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">empty</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">deque</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">extendleft</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;abc&#39;</span><span style="color:#ABB2BF;">)              # </span><span style="color:#61AFEF;">extendleft</span><span style="color:#ABB2BF;">() </span><span style="color:#E06C75;">reverses</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">input</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">order</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">d</span></span>
<span class="line"><span style="color:#61AFEF;">deque</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;c&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h4 id="counter" tabindex="-1">Counter <a class="header-anchor" href="#counter" aria-label="Permalink to &quot;Counter&quot;">​</a></h4><p><strong>class collections.Counter([iterable-or-mapping])</strong> <br> 字典的子类，不限制键和值</p><ul><li>elements()：返回一个迭代器，其中每个元素将重复出现计数值所指定次。 元素会按首次出现的顺序返回。 如果一个元素的计数值&lt;1，忽略。</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">c</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Counter</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">a</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">b</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">c</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">d</span><span style="color:#56B6C2;">=-</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">sorted</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">c</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">elements</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>most_common([n])：返回一个列表，其中包含 n 个最常见的元素及出现次数，按常见程度由高到低排序。 如果 n 被省略或为 None，返回计数器中的 所有 元素。 计数值相等的元素按首次出现的顺序排序：</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Counter</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;abracadabra&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">most_common</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">[(</span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">), (</span><span style="color:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">), (</span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>subtract([iterable-or-mapping])：从 迭代对象 或 映射对象 减去元素。输入和输出都可以是0或者负数。</li><li>update([iterable-or-mapping])：从 迭代对象 计数元素或者 从另一个 映射对象 (或计数器) 添加。迭代对象 应该是序列元素，而不是一个 (key, value) 对。</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">c</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Counter</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">a</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">b</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Counter</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">a</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">b</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">c</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">                       # </span><span style="color:#E06C75;">add</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">two</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">counters</span><span style="color:#ABB2BF;"> together:  </span><span style="color:#E06C75;">c</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#61AFEF;">Counter</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">c</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">                       # </span><span style="color:#61AFEF;">subtract</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">keeping</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">only</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">positive</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">counts</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">Counter</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">c</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">&amp;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">                       # intersection:  </span><span style="color:#61AFEF;">min</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">c</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">], </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">]) </span></span>
<span class="line"><span style="color:#61AFEF;">Counter</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">c</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">|</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">                       # union:  </span><span style="color:#61AFEF;">max</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">c</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">], </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#61AFEF;">Counter</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">c</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Counter</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">a</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">b</span><span style="color:#56B6C2;">=-</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#E06C75;">c</span></span>
<span class="line"><span style="color:#61AFEF;">Counter</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">c</span></span>
<span class="line"><span style="color:#61AFEF;">Counter</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="defaultdict" tabindex="-1">defaultdict <a class="header-anchor" href="#defaultdict" aria-label="Permalink to &quot;defaultdict&quot;">​</a></h4><p><strong>class collections.defaultdict([default_factory[, ...]])</strong> <br> 可以一个键映射多个值的默认值字典</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">collections</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">defaultdict</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">dd</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">defaultdict</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">lambda</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;N/A&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">dd</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;key1&#39;</span><span style="color:#ABB2BF;">] = </span><span style="color:#98C379;">&#39;abc&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">dd</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;key1&#39;</span><span style="color:#ABB2BF;">] # </span><span style="color:#E06C75;">key1存在</span></span>
<span class="line"><span style="color:#98C379;">&#39;abc&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">dd</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;key2&#39;</span><span style="color:#ABB2BF;">] # </span><span style="color:#E06C75;">key2不存在</span><span style="color:#ABB2BF;">，</span><span style="color:#E06C75;">返回默认值</span></span>
<span class="line"><span style="color:#98C379;">&#39;N/A&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [(</span><span style="color:#98C379;">&#39;red&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">), (</span><span style="color:#98C379;">&#39;blue&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">), (</span><span style="color:#98C379;">&#39;red&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">), (</span><span style="color:#98C379;">&#39;blue&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">), (</span><span style="color:#98C379;">&#39;red&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">), (</span><span style="color:#98C379;">&#39;blue&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">)]</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">defaultdict</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">set</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">for</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">k</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">v</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">in</span><span style="color:#ABB2BF;"> s:</span></span>
<span class="line"><span style="color:#ABB2BF;">...     </span><span style="color:#E06C75;">d</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">k</span><span style="color:#ABB2BF;">].</span><span style="color:#61AFEF;">add</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">v</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">...</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">sorted</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">d</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">items</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">[(</span><span style="color:#98C379;">&#39;blue&#39;</span><span style="color:#ABB2BF;">, {</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">}), (</span><span style="color:#98C379;">&#39;red&#39;</span><span style="color:#ABB2BF;">, {</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">})]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="ordereddict" tabindex="-1">OrderedDict <a class="header-anchor" href="#ordereddict" aria-label="Permalink to &quot;OrderedDict&quot;">​</a></h4><p><strong>class collections.OrderedDict([items])</strong></p><ul><li>popitem(last=True)：移除并返回一个 (key, value) 键值对。 如果 last 值为真，则按 LIFO 后进先出的顺序返回键值对，否则就按 FIFO 先进先出的顺序返回键值对。</li><li>move_to_end(key, last=True)：将现有 key 移动到有序字典的任一端。 如果 last 为真值（默认）则将元素移至末尾；如果 last 为假值则将元素移至开头。如果 key 不存在则会触发 KeyError</li></ul><h4 id="chainmap" tabindex="-1">ChainMap <a class="header-anchor" href="#chainmap" aria-label="Permalink to &quot;ChainMap&quot;">​</a></h4><p>*<em>class collections.ChainMap(<em>maps)</em></em> <br> 将多个映射快速的链接到一起 <br> 支持所有常用字典方法。还有一个 maps 属性(attribute)，一个创建子上下文的方法(method)， 一个存取它们首个映射的属性(property)</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;x&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;z&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;"> }</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">b</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;y&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;z&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;"> }</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">merged</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">ChainMap</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">b</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">merged</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;x&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#D19A66;">1</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;x&#39;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">42</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">merged</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;x&#39;</span><span style="color:#ABB2BF;">] # </span><span style="color:#E06C75;">Notice</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">change</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">to</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">merged</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">dicts</span></span>
<span class="line"><span style="color:#D19A66;">42</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="heapq-堆队列算法" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/heapq.html" target="_blank" rel="noreferrer">heapq</a> --- 堆队列算法 <a class="header-anchor" href="#heapq-堆队列算法" aria-label="Permalink to &quot;[heapq](https://docs.python.org/zh-cn/3/library/heapq.html) --- 堆队列算法&quot;">​</a></h3><blockquote><p>堆是一个二叉树，它的每个父节点的值都只会小于或大于所有孩子节点（的值）。它使用了数组来实现：从零开始计数，对于所有的 k ，都有 heap[k] &lt;= heap[2_k+1] 和 heap[k] &lt;= heap[2_k+2]。</p></blockquote><ul><li>最小堆</li><li>索引从 0 开始，最小的元素总是在根结点：heap[0]</li><li>pop 方法返回最小的项</li></ul><p>方法</p><ul><li>heapq.heappush(heap, item)：将 item 的值加入 heap 中，保持堆的不变性。</li><li>heapq.heappop(heap)：弹出并返回 heap 的最小的元素，保持堆的不变性。如果堆为空，抛出 IndexError 。</li><li>heapq.heappushpop(heap, item)：将 item 放入堆中，然后弹出并返回 heap 的最小元素。该组合操作比先调用 heappush() 再调用 heappop() 运行起来更有效率。</li><li>heapq.heapify(x)：将list x 转换成堆，原地，线性时间内。</li><li>heapq.heapreplace(heap, item)：弹出并返回 heap 中最小的一项，同时推入新的 item。 堆的大小不变。 如果堆为空则引发 IndexError。</li><li>heapq.merge(*iterables, key=None, reverse=False)：将多个已排序的输入合并为一个已排序的输出，返回已排序值的 iterator。</li><li>heapq.nlargest(n, iterable, key=None)：从 iterable 所定义的数据集中返回前 n 个最大元素组成的列表。</li><li>heapq.nsmallest(n, iterable, key=None)：从 iterable 所定义的数据集中返回前 n 个最小元素组成的列表。</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">heapsort</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">iterable</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    h </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> value </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> iterable:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">heappush</span><span style="color:#ABB2BF;">(h, value)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> [</span><span style="color:#61AFEF;">heappop</span><span style="color:#ABB2BF;">(h) </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">range</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(h))]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">heapsort</span><span style="color:#ABB2BF;">([</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">7</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">9</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">8</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="queue-一个同步的队列类" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/queue.html" target="_blank" rel="noreferrer">queue</a> --- 一个同步的队列类 <a class="header-anchor" href="#queue-一个同步的队列类" aria-label="Permalink to &quot;[queue](https://docs.python.org/zh-cn/3/library/queue.html) --- 一个同步的队列类&quot;">​</a></h3><p><strong>class queue.Queue(maxsize=0) FIFO</strong> <br> maxsize 用于设置可以放入队列中的项目数的上限。当达到这个大小的时候，插入操作将阻塞至队列中的项目被消费掉。如果 maxsize = 0，队列尺寸为无限大。 <br> <strong>class queue.LifoQueue(maxsize=0)</strong> LIFO <br> <strong>class queue.PriorityQueue(maxsize=0)</strong> 优先级队列</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">dataclasses</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">dataclass</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">field</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">typing</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">Any</span></span>
<span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E06C75;">dataclass</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">order</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">PrioritizedItem</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">priority</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">int</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">item</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">Any</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">field</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">compare</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">False</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>class queue.SimpleQueue</strong> 无界的 FIFO 队列构造函数。简单的队列，缺少任务跟踪等高级功能 <br> <strong>exception queue.Empty</strong> <br> <strong>exception queue.Full</strong></p><ul><li>Queue.qsize()</li><li>Queue.empty()</li><li>Queue.full()</li><li>Queue.put(item, block=True, timeout=None)</li><li>Queue.put_nowait(item)：相当于 put(item, False) 。</li><li>Queue.get(block=True, timeout=None)：从队列中移除并返回一个项目</li><li>Queue.get_nowait()：相当于 get(False) 。</li><li>Queue.task_done()：表示前面排队的任务已经被完成</li><li>Queue.join()：阻塞至队列中所有的元素都被接收和处理完毕</li></ul><h3 id="bisect-数组二分查找算法" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/bisect.html" target="_blank" rel="noreferrer">bisect</a> --- 数组二分查找算法 <a class="header-anchor" href="#bisect-数组二分查找算法" aria-label="Permalink to &quot;[bisect](https://docs.python.org/zh-cn/3/library/bisect.html) --- 数组二分查找算法&quot;">​</a></h3><p>二分（bisection）算法</p><ul><li>bisect.bisect_left(a, x, lo=0, hi=len(a))：在 a 中找到 x 合适的插入点以维持有序。参数 lo 和 hi 可以被用于确定需要考虑的子集；默认情况下整个列表都会被使用。如果 x 已经在 a 里存在，那么插入点会在已存在元素之前（也就是左边）。</li></ul><p>返回的插入点 i 可以将数组 a 分成两部分。左侧是 all(val &lt; x for val in a[lo:i]) ，右侧是 all(val &gt;= x for val in a[i:hi]) 。</p><ul><li>bisect.bisect_right(a, x, lo=0, hi=len(a))</li><li>bisect.bisect(a, x, lo=0, hi=len(a))：类似于 bisect_left()，但是返回的插入点是 a 中已存在元素 x 的右侧。</li><li>bisect.insort_left(a, x, lo=0, hi=len(a))：将 x 插入到一个有序序列 a 里，并维持其有序。如果 a 有序的话，这相当于 a.insert(bisect.bisect_left(a, x, lo, hi), x)。要注意搜索是 O(log n) 的，插入却是 O(n) 的。</li><li>bisect.insort_right(a, x, lo=0, hi=len(a))</li><li>bisect.insort(a, x, lo=0, hi=len(a))：类似于 insort_left()，但是把 x 插入到 a 中已存在元素 x 的右侧。</li></ul><h3 id="array-高效的数值数组" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/array.html" target="_blank" rel="noreferrer">array</a> --- 高效的数值数组 <a class="header-anchor" href="#array-高效的数值数组" aria-label="Permalink to &quot;[array](https://docs.python.org/zh-cn/3/library/array.html) --- 高效的数值数组&quot;">​</a></h3><p>定义了一种对象类型，可以紧凑地表示基本类型值的数组：字符、整数、浮点数等。 数组属于序列类型，其行为与列表非常相似，不同之处在于其中存储的对象类型是受限的。</p><table><thead><tr><th>类型码</th><th>C 类型</th><th>Python 类型</th><th>以字节表示的最小尺寸</th></tr></thead><tbody><tr><td>&#39;b&#39;</td><td>signed char</td><td>int</td><td>1</td></tr><tr><td>&#39;B&#39;</td><td>unsigned char</td><td>int</td><td>1</td></tr><tr><td>&#39;u&#39;</td><td>Py_UNICODE</td><td>Unicode 字符</td><td>2</td></tr><tr><td>&#39;h&#39;</td><td>signed short</td><td>int</td><td>2</td></tr><tr><td>&#39;H&#39;</td><td>unsigned short</td><td>int</td><td>2</td></tr><tr><td>&#39;i&#39;</td><td>signed int</td><td>int</td><td>2</td></tr><tr><td>&#39;I&#39;</td><td>unsigned int</td><td>int</td><td>2</td></tr><tr><td>&#39;l&#39;</td><td>signed long</td><td>int</td><td>4</td></tr><tr><td>&#39;L&#39;</td><td>unsigned long</td><td>int</td><td>4</td></tr><tr><td>&#39;q&#39;</td><td>signed long long</td><td>int</td><td>8</td></tr><tr><td>&#39;Q&#39;</td><td>unsigned long long</td><td>int</td><td>8</td></tr><tr><td>&#39;f&#39;</td><td>float</td><td>float</td><td>4</td></tr><tr><td>&#39;d&#39;</td><td>double</td><td>float</td><td>8</td></tr></tbody></table><p><strong>class array.array(typecode[, initializer])</strong>：一个包含由 typecode 限制类型的条目的新数组，并由可选的 initializer 值进行初始化，该值必须为一个列表、<a href="https://docs.python.org/zh-cn/3/glossary.html#term-bytes-like-object" target="_blank" rel="noreferrer">bytes-like object</a> 或包含正确类型元素的可迭代对象。 <br> <strong>array.typecode</strong>：用于创建数组的类型码字符。 <br> <strong>array.itemsize</strong>：在内部表示中一个数组项的字节长度。 <br> <strong>array.append(x)</strong>：添加一个值为 x 的新项到数组末尾。 <br> <strong>array.buffer_info()</strong>：返回一个元组 (address, length) 以给出用于存放数组内容的缓冲区元素的当前内存地址和长度。 以字节表示的内存缓冲区大小可通过 array.buffer_info()[1] * array.itemsize 来计算。 这在使用需要内存地址的低层级（因此不够安全） I/O 接口时会很有用，例如某些 ioctl() 操作。 只要数组存在并且没有应用改变长度的操作，返回数值就是有效的。 <br> <strong>array.byteswap()</strong>：“字节对调”所有数组项。 此方法只支持大小为 1, 2, 4 或 8 字节的值；对于其他值类型将引发 RuntimeError。 它适用于从不同字节序机器所生成的文件中读取数据的情况。 <br> <strong>array.count(x)</strong>：返回 x 在数组中的出现次数。 <br> <strong>array.extend(iterable)</strong>：将来自 iterable 的项添加到数组末尾。 如果 iterable 是另一个数组，它必须具有 完全 相同的类型码；否则将引发 TypeError。 如果 iterable 不是一个数组，则它必须为可迭代对象并且其元素必须为可添加到数组的适当类型。 <br> <strong>array.frombytes(s)</strong>：添加来自字符串的项，将字符串解读为机器值的数组（相当于使用 fromfile() 方法从文件中读取数据）。 <br> <strong>array.fromfile(f, n)</strong>：从 file object f 中读取 n 项（解读为机器值）并将它们添加到数组末尾。 如果可读取数据少于 n 项则将引发 EOFError，但有效的项仍然会被插入数组。 f 必须为一个真实的内置文件对象；不支持带有 read() 方法的其它对象。 <br> <strong>array.fromlist(list)</strong>：添加来自 list 的项。 这等价于 for x in list: a.append(x)，区别在于如果发生类型错误，数组将不会被改变。 <br> <strong>array.fromunicode(s)</strong>：使用来自给定 Unicode 字符串的数组扩展数组。 数组必须是类型为 &#39;u&#39; 的数组；否则将引发 ValueError。 请使用 array.frombytes(unicodestring.encode(enc)) 来将 Unicode 数据添加到其他类型的数组。 <br> <strong>array.index(x)</strong>：返回最小的 i 使得 i 为 x 在数组中首次出现的序号。 <br> <strong>array.insert(i, x)</strong>：将值 x 作为新项插入数组的 i 位置之前。 负值将被视为相对于数组末尾的位置。 <br> <strong>array.pop([i])</strong>：从数组中移除序号为 i 的项并将其返回。 可选参数值默认为 -1，因此默认将移除并返回末尾项。 <br> <strong>array.remove(x)</strong>：从数组中移除首次出现的 x。 <br> <strong>array.reverse()</strong>：反转数组中各项的顺序。 <br> <strong>array.tobytes()</strong>：将数组转换为一个机器值数组并返回其字节表示（即相当与通过 tofile() 方法写入到文件的字节序列。） <br> <strong>array.tofile(f)</strong>：将所有项（作为机器值）写入到 file object f。 <br> <strong>array.tolist()</strong>：将数组转换为包含相同项的普通列表。 <br> <strong>array.tounicode()</strong>：将数组转换为一个 Unicode 字符串。 数组必须是类型为 &#39;u&#39; 的数组；否则将引发 ValueError。 请使用 array.tobytes().decode(enc) 来从其他类型的数组生成 Unicode 字符串。</p><h3 id="dataclasses-数据类" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/dataclasses.html#module-dataclasses" target="_blank" rel="noreferrer">dataclasses</a> --- 数据类 <a class="header-anchor" href="#dataclasses-数据类" aria-label="Permalink to &quot;[dataclasses](https://docs.python.org/zh-cn/3/library/dataclasses.html#module-dataclasses) --- 数据类&quot;">​</a></h3><p>@dataclasses.dataclass(*, init=True, repr=True, eq=True, order=False, unsafe_hash=False, frozen=False, match_args=True, kw_only=False, slots=False) 用于将生成的 <a href="https://docs.python.org/zh-cn/3/glossary.html#term-special-method" target="_blank" rel="noreferrer">special method</a> 添加到类中</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#ABB2BF;">@</span><span style="color:#E06C75;">dataclass</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">C</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">a</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">int</span><span style="color:#ABB2BF;">       # &#39;</span><span style="color:#E5C07B;">a</span><span style="color:#ABB2BF;">&#39; </span><span style="color:#E5C07B;">has</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">no</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">default</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">value</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">b</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">int</span><span style="color:#ABB2BF;"> = 0   # </span><span style="color:#E5C07B;">assign</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">a</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">default</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">value</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">for</span><span style="color:#ABB2BF;"> &#39;</span><span style="color:#E5C07B;">b</span><span style="color:#ABB2BF;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#E5C07B;">a</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">和</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">b</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">都将包含在添加的</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">__init__</span><span style="color:#ABB2BF;">() </span><span style="color:#E5C07B;">方法中</span><span style="color:#ABB2BF;">，</span><span style="color:#E5C07B;">它们将被定义为</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E5C07B;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">__init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">a</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">int</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">b</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">int</span><span style="color:#ABB2BF;"> = 0):</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>dataclasses.field(*, default=MISSING, default_factory=MISSING, init=True, repr=True, hash=None, compare=True, metadata=None, kw_only=MISSING) <br> dataclasses.asdict(instance, *, dict_factory=dict) 将数据类 instance 转换为字典 <br> dataclasses.astuple(instance, *, tuple_factory=tuple) 将数据类 instance 转换为元组</p><h3 id="re-正则表达式操作" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/re.html" target="_blank" rel="noreferrer">re--- 正则表达式操作</a> <a class="header-anchor" href="#re-正则表达式操作" aria-label="Permalink to &quot;[re--- 正则表达式操作](https://docs.python.org/zh-cn/3/library/re.html)&quot;">​</a></h3><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">re</span></span>
<span class="line"><span style="color:#E06C75;">Chinese</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">re</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">compile</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;[</span><span style="color:#56B6C2;">\\u4e00</span><span style="color:#98C379;">-</span><span style="color:#56B6C2;">\\u9fa5</span><span style="color:#98C379;">]&#39;</span><span style="color:#ABB2BF;">)  # </span><span style="color:#E06C75;">中文的编码范围</span></span>
<span class="line"><span style="color:#E06C75;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">Chinese</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">search</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">q</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;en-US&#39;</span></span>
<span class="line"><span style="color:#E06C75;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;zh-CN&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>re.match(pattern, string, flags=0)：从字符串的起始位置匹配一个模式，如果起始位置匹配失败返回None</li><li>re.fullmatch(pattern, string, flags=0)</li><li>re.search(pattern, string, flags=0)：返回第一个成功的匹配</li><li>re.sub(pattern, replace, string, count=0, flags=0)：替换字符串中的匹配项</li><li>re.subn(pattern, repl, string, count=0, flags=0)：与 sub() 相同，返回一个元组 (字符串, 替换次数)</li><li>re.compile(pattern[, flags])：返回一个re.RegexObject（ Pattern ），供 match() 和 search() 使用</li><li>re.split(pattern, string[, maxsplit=0, flags=0])：按照能够匹配的子串将字符串分割后返回列表</li><li>re.findall(string[, pos[, endpos]])：在字符串中找到正则表达式所匹配的所有子串，并返回一个列表</li><li>re.finditer(pattern, string, flags=0)：和 findall 类似，找到所匹配的所有子串，并把它们作为一个迭代器返回</li><li>re.escape(pattern)：转义 pattern 中的特殊字符。</li><li>re.purge()：清除正则表达式缓存。</li><li>exception re.error(msg, pattern=None, pos=None)</li></ul><p>参数</p><ul><li>pattern：匹配的正则表达式</li><li>string：要匹配的字符串。</li><li>flags：标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等。</li><li>replace : 替换的字符串或函数。</li><li>count : 模式匹配后替换的最大次数，默认 0 表示替换所有的匹配。</li><li>maxsplit：分隔次数，maxsplit=1 分隔一次，默认为 0，不限制次数。</li><li>endpos：指定字符串的结束位置，默认为字符串的长度。</li><li>pos ：指定字符串的起始位置，默认为 0。</li></ul><table><thead><tr><th>flags</th><th>描述</th></tr></thead><tbody><tr><td>re.I</td><td>忽略大小写 IGNORECASE</td></tr><tr><td>re.L</td><td>做本地化识别（locale-aware）匹配</td></tr><tr><td>re.M</td><td>多行匹配 MULTILINE，影响 ^ 和 $</td></tr><tr><td>re.S</td><td>使 . 匹配包括换行在内的所有字符</td></tr><tr><td>re.U</td><td>根据Unicode字符集解析字符。这个标志影响 \\w, \\W, \\b, \\B.</td></tr><tr><td>re.X</td><td>可分段和添加注释</td></tr></tbody></table><p><strong>re.MatchObject</strong></p><ul><li>group(num=0)：匹配的整个表达式的字符串，group() 可以一次输入多个组号，在这种情况下它将返回一个包含那些组所对应值的元组。</li><li>groups()：返回一个包含所有小组字符串的元组，从 1 到 所含的小组号。</li></ul><h2 id="函数式编程模块" tabindex="-1">函数式编程模块 <a class="header-anchor" href="#函数式编程模块" aria-label="Permalink to &quot;函数式编程模块&quot;">​</a></h2><h3 id="itertools-为高效循环而创建迭代器的函数" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/itertools.html" target="_blank" rel="noreferrer">itertools--- 为高效循环而创建迭代器的函数</a> <a class="header-anchor" href="#itertools-为高效循环而创建迭代器的函数" aria-label="Permalink to &quot;[itertools--- 为高效循环而创建迭代器的函数](https://docs.python.org/zh-cn/3/library/itertools.html)&quot;">​</a></h3><p>无穷迭代器</p><table><thead><tr><th>迭代器</th><th>实参</th><th>结果</th><th>示例</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.count" target="_blank" rel="noreferrer">count()</a></td><td>start, [step]</td><td>start, start+step, start+2*step, ...</td><td>count(10) --&gt; 10 11 12 13 14...</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.cycle" target="_blank" rel="noreferrer">cycle()</a></td><td>p</td><td>p0, p1, ... plast, p0, p1, ...</td><td>cycle(&#39;ABCD&#39;) --&gt; A B C D A B CD ...</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.repeat" target="_blank" rel="noreferrer">repeat()</a></td><td>elem [,n]</td><td>elem, elem, elem, ... 重复无限次或n次</td><td>repeat(10, 3) --&gt; 10 10 10</td></tr></tbody></table><p>根据最短输入序列长度停止的迭代器</p><table><thead><tr><th>迭代器</th><th>实参</th><th>结果</th><th>示例</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.accumulate" target="_blank" rel="noreferrer">accumulate()</a></td><td>p [,func]</td><td>p0, p0+p1, p0+p1+p2, ...</td><td>accumulate([1,2,3,4,5]) --&gt; 1 3 610 15</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.chain" target="_blank" rel="noreferrer">chain()</a></td><td>p, q, ...</td><td>p0, p1, ... plast, q0, q1, ...</td><td>chain(&#39;ABC&#39;, &#39;DEF&#39;) --&gt; A B C D EF</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.chain.from_iterable" target="_blank" rel="noreferrer">chain.from_iterable()</a></td><td>iterable</td><td>p0, p1, ... plast, q0, q1, ...</td><td>chain.from_iterable([&#39;ABC&#39;,&#39;DEF&#39;]) --&gt; A B C D E F</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.compress" target="_blank" rel="noreferrer">compress()</a></td><td>data, selectors</td><td>(d[0] if s[0]), (d[1] if s[1]), ...</td><td>compress(&#39;ABCDEF&#39;, [1,0,1,0,1,1])--&gt; A C E F</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.dropwhile" target="_blank" rel="noreferrer">dropwhile()</a></td><td>pred, seq</td><td>seq[n], seq[n+1], ... 从pred首次真值测试失败开始</td><td>dropwhile(lambda x: x&lt;5,[1,4,6,4,1]) --&gt; 6 4 1</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.filterfalse" target="_blank" rel="noreferrer">filterfalse()</a></td><td>pred, seq</td><td>seq中pred(x)为假值的元素，x是seq中的元素。</td><td>filterfalse(lambda x: x%2,range(10)) --&gt; 0 2 4 6 8</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.groupby" target="_blank" rel="noreferrer">groupby()</a></td><td>iterable[, key]</td><td>根据key(v)值分组的迭代器</td><td></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.islice" target="_blank" rel="noreferrer">islice()</a></td><td>seq, [start,] stop [, step]</td><td>seq[start:stop:step]中的元素</td><td>islice(&#39;ABCDEFG&#39;, 2, None) --&gt; CD E F G</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.starmap" target="_blank" rel="noreferrer">starmap()</a></td><td>func, seq</td><td>func(_seq[0]), func(_seq[1]), ...</td><td>starmap(pow, [(2,5), (3,2),(10,3)]) --&gt; 32 9 1000</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.takewhile" target="_blank" rel="noreferrer">takewhile()</a></td><td>pred, seq</td><td>seq[0], seq[1], ..., 直到pred真值测试失败</td><td>takewhile(lambda x: x&lt;5,[1,4,6,4,1]) --&gt; 1 4</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.tee" target="_blank" rel="noreferrer">tee()</a></td><td>it, n</td><td>it1, it2, ... itn 将一个迭代器拆分为n个迭代器</td><td></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.zip_longest" target="_blank" rel="noreferrer">zip_longest()</a></td><td>p, q, ...</td><td>(p[0], q[0]), (p[1], q[1]), ...</td><td>zip_longest(&#39;ABCD&#39;, &#39;xy&#39;,fillvalue=&#39;-&#39;) --&gt; Ax By C- D-</td></tr></tbody></table><p>排列组合迭代器</p><table><thead><tr><th>迭代器</th><th>实参</th><th>结果</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.product" target="_blank" rel="noreferrer">product()</a></td><td>p, q, ... [repeat=1]</td><td>笛卡尔积，相当于嵌套的for循环</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.permutations" target="_blank" rel="noreferrer">permutations()</a></td><td>p[, r]</td><td>长度r元组，所有可能的排列，无重复元素</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.combinations" target="_blank" rel="noreferrer">combinations()</a></td><td>p, r</td><td>长度r元组，有序，无重复元素</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/itertools.html?highlight=itertools#itertools.combinations_with_replacement" target="_blank" rel="noreferrer">combinations_with_replacement()</a></td><td>p, r</td><td>长度r元组，有序，元素可重复</td></tr></tbody></table><table><thead><tr><th>例子</th><th>结果</th></tr></thead><tbody><tr><td>product(&#39;ABCD&#39;, repeat=2)</td><td>AA AB AC AD BA BB BC BD CA CB CC CD DA DB DC DD</td></tr><tr><td>permutations(&#39;ABCD&#39;, 2)</td><td>AB AC AD BA BC BD CA CB CD DA DB DC</td></tr><tr><td>combinations(&#39;ABCD&#39;, 2)</td><td>AB AC AD BC BD CD</td></tr><tr><td>combinations_with_replacement(&#39;ABCD&#39;, 2)</td><td>AA AB AC AD BB BC BD CC CD DD</td></tr></tbody></table><h3 id="functools-高阶函数和可调用对象上的操作" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/functools.html" target="_blank" rel="noreferrer">functools--- 高阶函数和可调用对象上的操作</a> <a class="header-anchor" href="#functools-高阶函数和可调用对象上的操作" aria-label="Permalink to &quot;[functools--- 高阶函数和可调用对象上的操作](https://docs.python.org/zh-cn/3/library/functools.html)&quot;">​</a></h3><p>@functools.cache(user_function) 简单轻量级未绑定函数缓存 <br> <strong>@functools.cached_property(func)</strong>：将一个类方法转换为特征属性，一次性计算该特征属性的值，然后将其缓存为实例生命周期内的普通属性。 <br> <strong>@functools.lru_cache(user_function)</strong> <br> <strong>@functools.lru_cache(maxsize=128, typed=False)</strong> <br> <strong>@functools.total_ordering</strong>：给定一个声明一个或多个全比较排序方法的类，这个类装饰器实现剩余的方法 <br> <strong>@functools.singledispatch</strong>：将一个函数转换为 单分派 generic function <br> <strong>@functools.wraps(wrapped, assigned=WRAPPER_ASSIGNMENTS, updated=WRAPPER_UPDATES)</strong>：用于在定义包装器函数时发起调用 update_wrapper() 作为函数装饰器</p><p>**functools.partial(func, /, *args, <strong>keywords)</strong>：返回一个新的部分对象，当被调用时其行为类似于 func 附带位置参数 args 和关键字参数 keywords 被调用。 <br> <strong>functools.reduce(function, iterable[, initializer])</strong> <br> <strong>functools.update_wrapper(wrapper, wrapped, assigned=WRAPPER_ASSIGNMENTS, updated=WRAPPER_UPDATES)</strong>：更新一个 wrapper 函数以使其类似于 wrapped 函数</p><p>**class functools.partialmethod(func, /, *args, <strong>keywords)</strong>：返回一个新的 partialmethod 描述器，其行为类似 partial 但它被设计用作方法定义而非直接用作可调用对象。 <br> <strong>class functools.singledispatchmethod(func)</strong>：将一个方法转换为 单分派 generic function</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#61AFEF;">@lru_cache</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">maxsize</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">fib</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">n</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> n </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> n</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">fib</span><span style="color:#ABB2BF;">(n</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">fib</span><span style="color:#ABB2BF;">(n</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> [</span><span style="color:#61AFEF;">fib</span><span style="color:#ABB2BF;">(n) </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> n </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">16</span><span style="color:#ABB2BF;">)]</span></span>
<span class="line"><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">8</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">13</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">21</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">34</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">55</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">89</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">144</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">233</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">377</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">610</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> fib.</span><span style="color:#61AFEF;">cache_info</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;">CacheInfo</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">hits</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">28</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">misses</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">16</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">maxsize</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">currsize</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">16</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="operator-标准运算符替代函数" tabindex="-1">operator --- 标准运算符替代函数 <a class="header-anchor" href="#operator-标准运算符替代函数" aria-label="Permalink to &quot;operator --- 标准运算符替代函数&quot;">​</a></h3><table><thead><tr><th>运算</th><th>语法</th><th>函数</th></tr></thead><tbody><tr><td>加法</td><td>a + b</td><td>add(a, b)</td></tr><tr><td>字符串拼接</td><td>seq1 + seq2</td><td>concat(seq1, seq2)</td></tr><tr><td>包含测试</td><td>obj in seq</td><td>contains(seq, obj)</td></tr><tr><td>除法</td><td>a / b</td><td>truediv(a, b)</td></tr><tr><td>除法</td><td>a // b</td><td>floordiv(a, b)</td></tr><tr><td>按位与</td><td>a &amp; b</td><td>and_(a, b)</td></tr><tr><td>按位异或</td><td>a ^ b</td><td>xor(a, b)</td></tr><tr><td>按位取反</td><td>~ a</td><td>invert(a)</td></tr><tr><td>按位或</td><td>a</td><td>b</td></tr><tr><td>取幂</td><td>a ** b</td><td>pow(a, b)</td></tr><tr><td>标识</td><td>a is b</td><td>is_(a, b)</td></tr><tr><td>标识</td><td>a is not b</td><td>is_not(a, b)</td></tr><tr><td>索引赋值</td><td>obj[k] = v</td><td>setitem(obj, k, v)</td></tr><tr><td>索引删除</td><td>del obj[k]</td><td>delitem(obj, k)</td></tr><tr><td>索引取值</td><td>obj[k]</td><td>getitem(obj, k)</td></tr><tr><td>左移</td><td>a &lt;&lt; b</td><td>lshift(a, b)</td></tr><tr><td>取模</td><td>a % b</td><td>mod(a, b)</td></tr><tr><td>乘法</td><td>a * b</td><td>mul(a, b)</td></tr><tr><td>矩阵乘法</td><td>a @ b</td><td>matmul(a, b)</td></tr><tr><td>取反（算术）</td><td>- a</td><td>neg(a)</td></tr><tr><td>取反（逻辑）</td><td>not a</td><td>not_(a)</td></tr><tr><td>正数</td><td>+ a</td><td>pos(a)</td></tr><tr><td>右移</td><td>a &gt;&gt; b</td><td>rshift(a, b)</td></tr><tr><td>切片赋值</td><td>seq[i:j] = values</td><td>setitem(seq, slice(i, j), values)</td></tr><tr><td>切片删除</td><td>del seq[i:j]</td><td>delitem(seq, slice(i, j))</td></tr><tr><td>切片取值</td><td>seq[i:j]</td><td>getitem(seq, slice(i, j))</td></tr><tr><td>字符串格式化</td><td>s % obj</td><td>mod(s, obj)</td></tr><tr><td>减法</td><td>a - b</td><td>sub(a, b)</td></tr><tr><td>真值测试</td><td>obj</td><td>truth(obj)</td></tr><tr><td>比较</td><td>a &lt; b</td><td>lt(a, b)</td></tr><tr><td>比较</td><td>a &lt;= b</td><td>le(a, b)</td></tr><tr><td>相等</td><td>a == b</td><td>eq(a, b)</td></tr><tr><td>不等</td><td>a != b</td><td>ne(a, b)</td></tr><tr><td>比较</td><td>a &gt;= b</td><td>ge(a, b)</td></tr><tr><td>比较</td><td>a &gt; b</td><td>gt(a, b)</td></tr></tbody></table><ul><li>operator.attrgetter(*attrs)</li><li>operator.itemgetter(*items)</li><li>operator.methodcaller(name, /, *args, **kwargs)</li></ul><p><strong>原地运算符</strong> <br> operator.<strong>iadd</strong>(a, b) <br> operator.<strong><strong>iadd</strong></strong>(a, b) <br> a = iadd(a, b) 等价于 a += b。 <br> operator.<strong>iand</strong>(a, b) <br> operator.<strong><strong>iand</strong></strong>(a, b) <br> a = iand(a, b) 等价于 a &amp;= b。 <br> operator.<strong>iconcat</strong>(a, b) <br> operator.<strong><strong>iconcat</strong></strong>(a, b) <br> a = iconcat(a, b) 等价于 a += b 其中 a 和 b 为序列。 <br> operator.<strong>ifloordiv</strong>(a, b) <br> operator.<strong><strong>ifloordiv</strong></strong>(a, b) <br> a = ifloordiv(a, b) 等价于 a //= b。 <br> operator.<strong>ilshift</strong>(a, b) <br> operator.<strong><strong>ilshift</strong></strong>(a, b) <br> a = ilshift(a, b) 等价于 a &lt;&lt;= b。 <br> operator.<strong>imod</strong>(a, b) <br> operator.<strong><strong>imod</strong></strong>(a, b) <br> a = imod(a, b) 等价于 a %= b。 <br> operator.<strong>imul</strong>(a, b) <br> operator.<strong><strong>imul</strong></strong>(a, b) <br> a = imul(a, b) 等价于 a *= b。 <br> operator.<strong>imatmul</strong>(a, b) <br> operator.<strong><strong>imatmul</strong></strong>(a, b) <br> a = imatmul(a, b) 等价于 a @= b。 <br> operator.<strong>ior</strong>(a, b) <br> operator.<strong><strong>ior</strong></strong>(a, b) <br> a = ior(a, b) 等价于 a |= b。 <br> operator.<strong>ipow</strong>(a, b) <br> operator.<strong><strong>ipow</strong></strong>(a, b) <br> a = ipow(a, b) 等价于 a <strong>= b。 <br> operator.<strong>irshift</strong>(a, b) <br> operator.</strong><strong>irshift</strong><strong>(a, b) <br> a = irshift(a, b) 等价于 a &gt;&gt;= b。 <br> operator.<strong>isub</strong>(a, b) <br> operator.</strong><strong>isub</strong><strong>(a, b) <br> a = isub(a, b) 等价于 a -= b。 <br> operator.<strong>itruediv</strong>(a, b) <br> operator.</strong><strong>itruediv</strong><strong>(a, b) <br> a = itruediv(a, b) 等价于 a /= b。 <br> operator.<strong>ixor</strong>(a, b) <br> operator.</strong><strong>ixor</strong>**(a, b) <br> a = ixor(a, b) 等价于 a ^= b。</p><h2 id="文件和目录访问" tabindex="-1">文件和目录访问 <a class="header-anchor" href="#文件和目录访问" aria-label="Permalink to &quot;文件和目录访问&quot;">​</a></h2><h3 id="os-多种操作系统接口" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/os.html" target="_blank" rel="noreferrer">os--- 多种操作系统接口</a> <a class="header-anchor" href="#os-多种操作系统接口" aria-label="Permalink to &quot;[os--- 多种操作系统接口](https://docs.python.org/zh-cn/3/library/os.html)&quot;">​</a></h3><ul><li>os.name ：获取平台名称</li><li>os.cpu_count() ：获取系统的核心数</li><li>os.chmod(path, mode) ： 改变权限</li><li>os.getcwd() ：函数得到当前工作目录，即当前Python脚本工作的目录路径</li><li>os.path.abspath($name) ：当前目录下文件或文件夹的绝对路径</li><li>os.path.basename(path) ：返回文件名</li><li>os.path.dirname(path) ：返回文件的上级路径</li><li>os.path.split() ：分离文件名和上级路径</li><li>os.path.join() ：合并文件名和指定路径</li><li>os.path.splitext() ：分离文件名与扩展名，返回的扩展名包括了&#39;.&#39;符号，默认只返回第一个&#39;.后缀&#39;和前缀。</li><li>os.chdir($dirname)：改变工作目录到dirname</li><li>os.listdir($path) ：返回指定目录下的所有文件和目录名</li><li>os.mkdir($path) 创建一个目录</li><li>os.rmdir($path) 删除一个目录</li><li>os.rename(src, dst) 记得不能有同名文件存在</li><li>os.path.getsize(name) 获得文件大小，如果name是目录返回0L</li><li>os.path.isfile() 函数分别检验给出的路径是一个文件</li><li>os.path.isdir() 函数分别检验给出的路径是一个目录</li><li>os.path.exists() 函数用来检验给出的路径是否真地存在</li></ul><p>执行外部shell命令</p><ul><li>os.system(’command‘) 无返回</li><li>os.popen(cmd, mode=&#39;r&#39;, buffering=-1) 可读取返回</li></ul><h3 id="pathlib-面向对象的文件系统路径" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/pathlib.html" target="_blank" rel="noreferrer">pathlib--- 面向对象的文件系统路径</a> <a class="header-anchor" href="#pathlib-面向对象的文件系统路径" aria-label="Permalink to &quot;[pathlib--- 面向对象的文件系统路径](https://docs.python.org/zh-cn/3/library/pathlib.html)&quot;">​</a></h3><ul><li>PurePath.parent 父路径</li><li>PurePath.name 最后路径组件的字符串</li><li>PurePath.suffix 最后一个组件的文件扩展名</li><li>PurePath.stem 最后一个路径组件，除去后缀</li><li>PurePath.as_posix() 返回使用正斜杠（/）的路径字符串</li><li>PurePath.is_absolute() PurePath.is_relative_to(*other) 返回此路径是否相对于 other 的路径</li><li>PurePath.joinpath(*other) 调用此方法等同于将每个 other 参数中的项目连接</li><li>PurePath.match(pattern) 将此路径与提供的通配符风格的模式匹配</li><li>PurePath.relative_to(*other) 计算此路径相对 other 表示路径的版本</li><li>PurePath.with_name(name) 返回一个新的路径并修改name</li><li>PurePath.with_stem(stem) 返回一个带有修改后 stem 的新路径</li><li>PurePath.with_suffix(suffix) 返回一个新的路径并修改 suffix</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">list_file</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">file</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">: Path, </span><span style="color:#D19A66;font-style:italic;">level</span><span style="color:#ABB2BF;">: </span><span style="color:#56B6C2;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 标题分5级</span></span>
<span class="line"><span style="color:#ABB2BF;">    level </span><span style="color:#56B6C2;">+=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> sub_path </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> path.</span><span style="color:#61AFEF;">iterdir</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># 目录以标题形式呈现，大于5级仅加粗显示</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> sub_path.</span><span style="color:#61AFEF;">is_dir</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">            directory_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#98C379;">&quot;#&quot;</span><span style="color:#56B6C2;">*</span><span style="color:#ABB2BF;">level</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">sub_path.name</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">  </span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> level </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;**</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">sub_path.name</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">**  </span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(directory_name)</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#61AFEF;">list_file</span><span style="color:#ABB2BF;">(md, sub_path, level)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># 文件以列表形式展现</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> sub_path.</span><span style="color:#61AFEF;">is_file</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">            relative_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> parse.</span><span style="color:#61AFEF;">quote</span><span style="color:#ABB2BF;">(sub_path.</span><span style="color:#61AFEF;">relative_to</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">as_posix</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;- [</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">sub_path.stem</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">](</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">relative_path</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">)  </span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    location </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;Documents&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;README.md&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;w&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> md:</span></span>
<span class="line"><span style="color:#ABB2BF;">        md.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;# Notes  </span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">list_file</span><span style="color:#ABB2BF;">(md, </span><span style="color:#61AFEF;">Path</span><span style="color:#ABB2BF;">(location))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Completed!&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><table><thead><tr><th><a href="https://docs.python.org/zh-cn/3/library/os.html#module-os" target="_blank" rel="noreferrer">os</a> 和 <a href="https://docs.python.org/zh-cn/3/library/os.path.html#module-os.path" target="_blank" rel="noreferrer">os.path</a></th><th><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#module-pathlib" target="_blank" rel="noreferrer">pathlib</a></th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.abspath" target="_blank" rel="noreferrer">os.path.abspath()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.resolve" target="_blank" rel="noreferrer">Path.resolve()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.chmod" target="_blank" rel="noreferrer">os.chmod()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.chmod" target="_blank" rel="noreferrer">Path.chmod()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.mkdir" target="_blank" rel="noreferrer">os.mkdir()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.mkdir" target="_blank" rel="noreferrer">Path.mkdir()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.makedirs" target="_blank" rel="noreferrer">os.makedirs()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.mkdir" target="_blank" rel="noreferrer">Path.mkdir()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.rename" target="_blank" rel="noreferrer">os.rename()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.rename" target="_blank" rel="noreferrer">Path.rename()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.replace" target="_blank" rel="noreferrer">os.replace()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.replace" target="_blank" rel="noreferrer">Path.replace()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.rmdir" target="_blank" rel="noreferrer">os.rmdir()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.rmdir" target="_blank" rel="noreferrer">Path.rmdir()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.remove" target="_blank" rel="noreferrer">os.remove()</a>, <a href="https://docs.python.org/zh-cn/3/library/os.html#os.unlink" target="_blank" rel="noreferrer">os.unlink()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.unlink" target="_blank" rel="noreferrer">Path.unlink()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.getcwd" target="_blank" rel="noreferrer">os.getcwd()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.cwd" target="_blank" rel="noreferrer">Path.cwd()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.exists" target="_blank" rel="noreferrer">os.path.exists()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.exists" target="_blank" rel="noreferrer">Path.exists()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.expanduser" target="_blank" rel="noreferrer">os.path.expanduser()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.expanduser" target="_blank" rel="noreferrer">Path.expanduser()</a> 和 <a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.home" target="_blank" rel="noreferrer">Path.home()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.listdir" target="_blank" rel="noreferrer">os.listdir()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.iterdir" target="_blank" rel="noreferrer">Path.iterdir()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.isdir" target="_blank" rel="noreferrer">os.path.isdir()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.is_dir" target="_blank" rel="noreferrer">Path.is_dir()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.isfile" target="_blank" rel="noreferrer">os.path.isfile()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.is_file" target="_blank" rel="noreferrer">Path.is_file()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.islink" target="_blank" rel="noreferrer">os.path.islink()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.is_symlink" target="_blank" rel="noreferrer">Path.is_symlink()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.link" target="_blank" rel="noreferrer">os.link()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.hardlink_to" target="_blank" rel="noreferrer">Path.hardlink_to()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.symlink" target="_blank" rel="noreferrer">os.symlink()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.symlink_to" target="_blank" rel="noreferrer">Path.symlink_to()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.readlink" target="_blank" rel="noreferrer">os.readlink()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.readlink" target="_blank" rel="noreferrer">Path.readlink()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.relpath" target="_blank" rel="noreferrer">os.path.relpath()</a></td><td>Path.relative_to()</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.html#os.stat" target="_blank" rel="noreferrer">os.stat()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.stat" target="_blank" rel="noreferrer">Path.stat()</a>, <a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.owner" target="_blank" rel="noreferrer">Path.owner()</a>, <a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.group" target="_blank" rel="noreferrer">Path.group()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.isabs" target="_blank" rel="noreferrer">os.path.isabs()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.PurePath.is_absolute" target="_blank" rel="noreferrer">PurePath.is_absolute()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.join" target="_blank" rel="noreferrer">os.path.join()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.PurePath.joinpath" target="_blank" rel="noreferrer">PurePath.joinpath()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.basename" target="_blank" rel="noreferrer">os.path.basename()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.PurePath.name" target="_blank" rel="noreferrer">PurePath.name</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.dirname" target="_blank" rel="noreferrer">os.path.dirname()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.PurePath.parent" target="_blank" rel="noreferrer">PurePath.parent</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.samefile" target="_blank" rel="noreferrer">os.path.samefile()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.Path.samefile" target="_blank" rel="noreferrer">Path.samefile()</a></td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/os.path.html#os.path.splitext" target="_blank" rel="noreferrer">os.path.splitext()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/pathlib.html#pathlib.PurePath.suffix" target="_blank" rel="noreferrer">PurePath.suffix</a></td></tr></tbody></table><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> pathlib </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> Path</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">listFile</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">level</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">preflag</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">flag</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">placeholder</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">depth</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">hide</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> level </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> depth:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">return</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># Hidden files</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">not</span><span style="color:#ABB2BF;"> hide </span><span style="color:#C678DD;font-style:italic;">and</span><span style="color:#ABB2BF;"> path.</span><span style="color:#61AFEF;">match</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;.*&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">or</span><span style="color:#ABB2BF;"> path.</span><span style="color:#61AFEF;">match</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;$*&#39;</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">return</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> level </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        placeholder </span><span style="color:#56B6C2;">+=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;  &#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> preflag </span><span style="color:#C678DD;font-style:italic;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;│ &#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    symbol </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">not</span><span style="color:#ABB2BF;"> level </span><span style="color:#C678DD;font-style:italic;">else</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;└─&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> flag </span><span style="color:#C678DD;font-style:italic;">else</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;├─&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(placeholder </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> symbol </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> path.name)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> path.</span><span style="color:#61AFEF;">is_dir</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">        subpath </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [x </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> x </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> path.</span><span style="color:#61AFEF;">iterdir</span><span style="color:#ABB2BF;">()]</span></span>
<span class="line"><span style="color:#ABB2BF;">        num </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(subpath)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">range</span><span style="color:#ABB2BF;">(num):</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;font-style:italic;">try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#61AFEF;">listFile</span><span style="color:#ABB2BF;">(subpath[i], level</span><span style="color:#56B6C2;">+</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, flag, i </span><span style="color:#56B6C2;">==</span></span>
<span class="line"><span style="color:#ABB2BF;">                         num </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, placeholder, depth, hide)</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;font-style:italic;">except</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;error&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span></span>
<span class="line"><span style="color:#ABB2BF;">p </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Path</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;D://&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">listFile</span><span style="color:#ABB2BF;">(p)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="shutil-高阶文件操作" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/shutil.html" target="_blank" rel="noreferrer">shutil--- 高阶文件操作</a> <a class="header-anchor" href="#shutil-高阶文件操作" aria-label="Permalink to &quot;[shutil--- 高阶文件操作](https://docs.python.org/zh-cn/3/library/shutil.html)&quot;">​</a></h3><ul><li>shutil.copy(src, dst, *, follow_symlinks=True)：将文件 src 拷贝到文件或目录 dst</li><li>shutil.copy2(src, dst, *, follow_symlinks=True)：类似于 copy()，会尝试保留文件的元数据</li><li>shutil.copyfile(src, dst, *, follow_symlinks=True)：将名为 src 的文件的内容（不包括元数据）拷贝到名为 dst 的文件并返回 dst</li><li>shutil.copytree(src, dst, symlinks=False, ignore=None, copy_function=copy2, ignore_dangling_symlinks=False, dirs_exist_ok=False)：将以 src 为根起点的整个目录树拷贝到名为 dst 的目录并返回目标目录</li><li>shutil.rmtree(path, ignore_errors=False, onerror=None)：删除一个完整的目录树</li><li>shutil.move(src, dst, copy_function=copy2)：递归地将一个文件或目录 (src) 移至另一位置 (dst) 并返回目标位置</li><li>shutil.make_archive(base_name, format[, root_dir[, base_dir[, verbose[, dry_run[, owner[, group[, logger]]]]]]])：创建一个归档文件（例如 zip 或 tar）并返回其名称</li><li>shutil.unpack_archive(filename[, extract_dir[, format]])：解包一个归档文件</li><li>shutil.get_terminal_size(fallback=(columns, lines))：获取终端窗口的尺寸</li></ul><h3 id="glob-unix-风格路径名模式扩展" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/glob.html" target="_blank" rel="noreferrer">glob</a> --- Unix 风格路径名模式扩展 <a class="header-anchor" href="#glob-unix-风格路径名模式扩展" aria-label="Permalink to &quot;[glob](https://docs.python.org/zh-cn/3/library/glob.html) --- Unix 风格路径名模式扩展&quot;">​</a></h3><ul><li>glob.glob(pathname, *, recursive=False)：返回匹配 pathname 的可能为空的路径名列表</li><li>glob.iglob(pathname, *, recursive=False)：返回一个 iterator，它会产生与 glob() 相同的结果，但不会实际地同时保存它们</li><li>glob.escape(pathname)：转义所有特殊字符 (&#39;?&#39;, &#39;*&#39; 和 &#39;[&#39;)</li></ul><h2 id="数据与文件格式" tabindex="-1">数据与文件格式 <a class="header-anchor" href="#数据与文件格式" aria-label="Permalink to &quot;数据与文件格式&quot;">​</a></h2><h3 id="pickle-python-对象序列化" tabindex="-1">pickle --- Python 对象序列化 <a class="header-anchor" href="#pickle-python-对象序列化" aria-label="Permalink to &quot;pickle --- Python 对象序列化&quot;">​</a></h3><p>对一个 Python 对象结构的二进制序列化和反序列化</p><ul><li>封存 (pickling)：将 Python 对象及其所拥有的层次结构转化为一个字节流的过程</li><li>解封 (unpickling)</li></ul><p>方法</p><ul><li>pickle.dump(obj, file, protocol=None, *, fix_imports=True, buffer_callback=None) <ul><li>将对象 obj 封存以后的对象写入已打开的 file object file</li></ul></li><li>pickle.dumps(obj, protocol=None, *, fix_imports=True, buffer_callback=None) <ul><li>将 obj 封存以后的对象作为 bytes 类型直接返回，而不是将其写入到文件</li></ul></li><li>pickle.load(file, *, fix_imports=True, encoding=&quot;ASCII&quot;, errors=&quot;strict&quot;, buffers=None) <ul><li>从已打开的 file object 文件 中读取封存后的对象，重建其中特定对象的层次结构并返回</li></ul></li><li>pickle.loads(bytes_object, *, fix_imports=True, encoding=&quot;ASCII&quot;, errors=&quot;strict&quot;, buffers=None) <ul><li>对于封存生成的对象 bytes_object，还原出原对象的结构并返回</li></ul></li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> pickle</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;bytes&gt;</span><span style="color:#ABB2BF;">  </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pickle.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">&lt;object&gt;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;object&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pickle.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">&lt;bytes&gt;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">read_pickle_file</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">filename</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(filename, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> pickle.</span><span style="color:#61AFEF;">load</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">write_to_pickle_file</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">filename</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">an_object</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(filename, </span><span style="color:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        pickle.</span><span style="color:#61AFEF;">dump</span><span style="color:#ABB2BF;">(an_object, </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>class pickle.Pickler(file, protocol=None, *, fix_imports=True, buffer_callback=None) <br> 接受一个二进制文件用于写入 pickle 数据流</p><ul><li>dump(obj)</li><li>将 obj 封存后的内容写入已打开的文件对象，该文件对象已经在构造函数中指定</li><li>persistent_id(obj)</li><li>默认无动作，子类继承重载时使用</li><li>reducer_override(self, obj)</li><li>可以在 Pickler 的子类中定义的特殊 reducer</li></ul><p>class pickle.Unpickler(file, *, fix_imports=True, encoding=&quot;ASCII&quot;, errors=&quot;strict&quot;, buffers=None) <br> 接受一个二进制文件用于读取 pickle 数据流</p><ul><li>load()：从构造函数中指定的文件对象里读取封存好的对象，重建其中特定对象的层次结构并返回</li><li>persistent_load(pid)：默认抛出 UnpicklingError 异常</li><li>find_class(module, name)：如有必要，导入 module 模块并返回其中名叫 name 的对象</li></ul><p><strong>class pickle.PickleBuffer(buffer)</strong> <br> 缓冲区的包装器 (wrapper)，缓冲区中包含着可封存的数据</p><ul><li>raw()：返回该缓冲区底层内存区域的 memoryview</li><li>release()：释放由 PickleBuffer 占用的底层缓冲区</li></ul><h3 id="json-json-编码和解码器" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/json.html" target="_blank" rel="noreferrer">json--- JSON 编码和解码器</a> <a class="header-anchor" href="#json-json-编码和解码器" aria-label="Permalink to &quot;[json--- JSON 编码和解码器](https://docs.python.org/zh-cn/3/library/json.html)&quot;">​</a></h3><ul><li><p>json.dump(obj, fp, *, skipkeys=False, ensure_ascii=True, check_circular=True, allow_nan=True, cls=None, indent=None, separators=None, default=None, sort_keys=False, **kw)</p><ul><li>将 obj 序列化为 JSON 格式化流形式</li></ul></li><li><p>json.load(fp, *, cls=None, object_hook=None, parse_float=None, parse_int=None, parse_constant=None, object_pairs_hook=None, **kw)</p></li><li><p>json.dumps(obj, *, skipkeys=False, ensure_ascii=True, check_circular=True, allow_nan=True, cls=None, indent=None, separators=None, default=None, sort_keys=False, **kw)</p><ul><li>将 obj 序列化为 JSON 格式的 str</li></ul></li><li><p>json.loads(s, *, cls=None, object_hook=None, parse_float=None, parse_int=None, parse_constant=None, object_pairs_hook=None, **kw)</p></li></ul><p>class json.<strong>JSONDecoder</strong>(<em>, object_hook=None, parse_float=None, parse_int=None, parse_constant=None, strict=True, object_pairs_hook=None) <br> 简单的JSON解码器 <br> class json.<strong>JSONEncoder</strong>(</em>, skipkeys=False, ensure_ascii=True, check_circular=True, allow_nan=True, sort_keys=False, indent=None, separators=None, default=None) <br> 用于Python数据结构的可扩展JSON编码器</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">TimeEncoder</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">json</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">JSONEncoder</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">default</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">obj</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">isinstance</span><span style="color:#ABB2BF;">(obj, datetime):</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> obj.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">elif</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">isinstance</span><span style="color:#ABB2BF;">(obj, date):</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> obj.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> json.JSONEncoder.</span><span style="color:#61AFEF;">default</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">, obj)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">&lt;str&gt;</span><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">dumps</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">&lt;object&gt;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">ensure_ascii</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">indent</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">cls</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">TimeEncoder)</span></span>
<span class="line"><span style="color:#56B6C2;">&lt;object&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">loads</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">&lt;str&gt;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">read_json_file</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">filename</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(filename, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> json.</span><span style="color:#61AFEF;">load</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">write_to_json_file</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">filename</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">an_object</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(filename, </span><span style="color:#98C379;">&#39;w&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        json.</span><span style="color:#61AFEF;">dump</span><span style="color:#ABB2BF;">(an_object, </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">ensure_ascii</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">False</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">indent</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="csv-csv-文件读写" tabindex="-1">csv --- CSV 文件读写 <a class="header-anchor" href="#csv-csv-文件读写" aria-label="Permalink to &quot;csv --- CSV 文件读写&quot;">​</a></h3><p>csv.reader(csvfile, dialect=&#39;excel&#39;, **fmtparams) <br> csv.writer(csvfile, dialect=&#39;excel&#39;, **fmtparams)</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> csv</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">read_csv_file</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">filename</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(filename, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">newline</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">list</span><span style="color:#ABB2BF;">(csv.</span><span style="color:#61AFEF;">reader</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">delimiter</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;:&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">quoting</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">csv.</span><span style="color:#D19A66;">QUOTE_NONE</span><span style="color:#ABB2BF;">))        </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">write_to_csv_file</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">filename</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">rows</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(filename, </span><span style="color:#98C379;">&#39;w&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">newline</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        writer </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> csv.</span><span style="color:#61AFEF;">writer</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">file</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        writer.</span><span style="color:#61AFEF;">writerows</span><span style="color:#ABB2BF;">(rows)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>class csv.DictReader(f, fieldnames=None, restkey=None, restval=None, dialect=&#39;excel&#39;, *args, **kwds) <br> class csv.DictWriter(f, fieldnames, restval=&#39;&#39;, extrasaction=&#39;raise&#39;, dialect=&#39;excel&#39;, *args, **kwds)</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> csv</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;names.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">newline</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> csvfile:</span></span>
<span class="line"><span style="color:#ABB2BF;">     reader </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> csv.</span><span style="color:#61AFEF;">DictReader</span><span style="color:#ABB2BF;">(csvfile)</span></span>
<span class="line"><span style="color:#ABB2BF;">     </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> row </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> reader:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(row[</span><span style="color:#98C379;">&#39;first_name&#39;</span><span style="color:#ABB2BF;">], row[</span><span style="color:#98C379;">&#39;last_name&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;names.csv&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;w&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">newline</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> csvfile:</span></span>
<span class="line"><span style="color:#ABB2BF;">    fieldnames </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;first_name&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;last_name&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    writer </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> csv.</span><span style="color:#61AFEF;">DictWriter</span><span style="color:#ABB2BF;">(csvfile, </span><span style="color:#E06C75;font-style:italic;">fieldnames</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">fieldnames)</span></span>
<span class="line"><span style="color:#ABB2BF;">    writer.</span><span style="color:#61AFEF;">writeheader</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    writer.</span><span style="color:#61AFEF;">writerow</span><span style="color:#ABB2BF;">({</span><span style="color:#98C379;">&#39;first_name&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Baked&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;last_name&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;Beans&#39;</span><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>class csv.Dialect 一个容器类，其属性包含有如何处理双引号、空白符、分隔符等的信息。 <br> 常量 <br> csv.QUOTE_ALL 指示 writer 对象给所有字段加上引号。 <br> Reader 对象</p><ul><li>csvreader.dialect 只读，供解析器使用。</li><li>csvreader.line_num 源迭代器已经读取了的行数。</li></ul><p>Writer 对象</p><ul><li>csvwriter.writerow(row) 将 row 形参写入到 writer 的文件对象，根据当前 Dialect 进行格式化</li><li>csvwriter.writerows(rows)</li><li>DictWriter.writeheader() 在 writer 的文件对象中，写入一行字段名称（字段名称在构造函数中指定）</li></ul><h3 id="html-超文本标记语言支持" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/html.html#module-html" target="_blank" rel="noreferrer">html</a> --- 超文本标记语言支持 <a class="header-anchor" href="#html-超文本标记语言支持" aria-label="Permalink to &quot;[html](https://docs.python.org/zh-cn/3/library/html.html#module-html) --- 超文本标记语言支持&quot;">​</a></h3><ul><li>html.escape(s, quote=True)：将字符串中的字符<code>&amp;</code> 、 &lt; 和 &gt; 转换为安全的HTML序列。</li><li>html.unescape(s)：将字符串中的所有命名和数字字符引用 (如 &gt;) 转换为相应的Unicode字符</li></ul><p>html.parser --- 简单的 HTML 和 XHTML 解析器 <br> class html.parser.HTMLParser(*, convert_charrefs=True) 一个能解析无效标记的解析器实例。</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">html</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">parser</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">HTMLParser</span></span>
<span class="line"><span style="color:#E06C75;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">MyHTMLParser</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">HTMLParser</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">handle_starttag</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">tag</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">attrs</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Encountered a start tag:&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">tag</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">handle_endtag</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">tag</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Encountered an end tag :&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">tag</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">handle_data</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Encountered some data  :&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">parser</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">MyHTMLParser</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;">parser</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">feed</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;&lt;html&gt;&lt;head&gt;&lt;title&gt;Test&lt;/title&gt;&lt;/head&gt;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#98C379;">&#39;&lt;body&gt;&lt;h1&gt;Parse me!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>html.entities --- HTML 一般实体的定义</p><h3 id="struct-将字节串解读为打包的二进制数据" tabindex="-1">struct --- 将字节串解读为打包的二进制数据 <a class="header-anchor" href="#struct-将字节串解读为打包的二进制数据" aria-label="Permalink to &quot;struct --- 将字节串解读为打包的二进制数据&quot;">​</a></h3><ul><li>exception struct.error</li><li>会在多种场合下被引发的异常</li><li>struct.pack(format, v1, v2, ...)</li><li>返回一个 bytes 对象，其中包含根据格式字符串 format 打包的值 v1, v2, ... 参数个数必须与格式字符串所要求的值匹配</li><li>struct.unpack(format, buffer)</li><li>根据格式字符串 format 从缓冲区 buffer 解包（假定是由 pack(format, ...) 打包）</li><li>struct.pack_into(format, buffer, offset, v1, v2, ...)</li><li>根据格式字符串 format 打包 v1, v2, ... 等值并将打包的字节串写入可写缓冲区 buffer 从 offset 开始的位置</li><li>struct.unpack_from(format, buffer, offset=0)</li><li>struct.iter_unpack(format, buffer)</li><li>根据格式字符串 format 以迭代方式从缓冲区 buffer 解包</li><li>struct.calcsize(format)</li><li>返回与格式字符串 format 相对应的结构的大小</li></ul><p><strong>class struct.Struct(format)</strong> <br> 返回一个新的 Struct 对象，它会根据格式字符串 format 来写入和读取二进制数据</p><ul><li>pack(v1, v2, ...)</li><li>pack_into(buffer, offset, v1, v2, ...)</li><li>unpack(buffer)</li><li>unpack_from(buffer, offset=0)</li><li>iter_unpack(buffer)</li><li>format</li><li>size</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> struct</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> struct.</span><span style="color:#61AFEF;">pack</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;&gt;I&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">10240099</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;">#&gt;表示字节顺序是big-endian，也就是网络序，I表示4字节无符号整数</span></span>
<span class="line"><span style="color:#C678DD;">b</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\x00\\x9c</span><span style="color:#98C379;">@c&#39;</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> struct.</span><span style="color:#61AFEF;">unpack</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;&gt;IH&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">b</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\xf0\\xf0\\xf0\\xf0\\x80\\x80</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">4042322160</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">32896</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="zipfile-使用zip存档" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/zipfile.html" target="_blank" rel="noreferrer">zipfile--- 使用ZIP存档</a> <a class="header-anchor" href="#zipfile-使用zip存档" aria-label="Permalink to &quot;[zipfile--- 使用ZIP存档](https://docs.python.org/zh-cn/3/library/zipfile.html)&quot;">​</a></h3><p>_class _zipfile.<strong>ZipFile</strong>(<em>file</em>, <em>mode=&#39;r&#39;</em>, <em>compression=ZIP_STORED</em>, <em>allowZip64=True</em>, <em>compresslevel=None</em>, <em>*</em>, <em>strict_timestamps=True</em>) <br> 打开一个 ZIP 文件，<em>file</em> 为一个指向文件的路径</p><p>ZipFile.<strong>close</strong>() 关闭归档文件。 <br> ZipFile.<strong>getinfo</strong>(<em>name</em>) 返回一个 <a href="https://docs.python.org/zh-cn/3/library/zipfile.html#zipfile.ZipInfo" target="_blank" rel="noreferrer">ZipInfo</a> 对象，其中包含有关归档成员 <em>name</em> 的信息 <br> ZipFile.<strong>infolist</strong>() <br> ZipFile.<strong>namelist</strong>() 返回按名称排序的归档成员列表。 <br> ZipFile.<strong>open</strong>(<em>name</em>, <em>mode=&#39;r&#39;</em>, <em>pwd=None</em>, <em>*</em>, <em>force_zip64=False</em>) 以二进制文件类对象的形式访问一个归档成员。 <br> ZipFile.<strong>extract</strong>(<em>member</em>, <em>path=None</em>, <em>pwd=None</em>) <br> 从归档中提取出一个成员放入当前工作目录 <br> ZipFile.<strong>extractall</strong>(<em>path=None</em>, <em>members=None</em>, <em>pwd=None</em>) <br> 从归档中提取出所有成员放入当前工作目录 <br> ZipFile.<strong>printdir</strong>() <br> 将归档的目录表打印到 sys.stdout。 <br> ZipFile.<strong>setpassword</strong>(<em>pwd</em>) <br> 设置 <em>pwd</em> 为用于提取已加密文件的默认密码。 <br> ZipFile.<strong>read</strong>(<em>name</em>, <em>pwd=None</em>) <br> 返回归档中文件 <em>name</em> 的字节数据。 <br> ZipFile.<strong>testzip</strong>() <br> 读取归档中的所有文件并检查它们的 CRC 和文件头 <br> ZipFile.<strong>write</strong>(<em>filename</em>, <em>arcname=None</em>, <em>compress_type=None</em>, <em>compresslevel=None</em>) <br> 将名为 <em>filename</em> 的文件写入归档，给予的归档名为 <em>arcname</em> <br> ZipFile.<strong>writestr</strong>(<em>zinfo_or_arcname</em>, <em>data</em>, <em>compress_type=None</em>, <em>compresslevel=None</em>)<a href="https://docs.python.org/zh-cn/3/library/zipfile.html#zipfile.ZipFile.writestr" target="_blank" rel="noreferrer">¶</a> <br> 将一个文件写入归档</p><p>_class _zipfile.<strong>Path</strong>(<em>root</em>, <em>at=&#39;&#39;</em>)</p><ul><li>Path.**name **最终的路径组成部分。</li><li>Path.<strong>open</strong>(<em>mode=&#39;r&#39;</em>, <em>*</em>, <em>pwd</em>, <em>**</em>) 在当前路径上发起调用 <a href="https://docs.python.org/zh-cn/3/library/zipfile.html#zipfile.ZipFile.open" target="_blank" rel="noreferrer">ZipFile.open()</a>。</li><li>Path.<strong>iterdir</strong>() 枚举当前目录的子目录。</li><li>Path.<strong>is_dir</strong>() 如果当前上下文引用了一个目录则返回 True。</li><li>Path.<strong>is_file</strong>() 如果当前上下文引用了一个文件则返回 True。</li><li>Path.<strong>exists</strong>() 如果当前上下文引用了 zip 文件内的一个文件或目录则返回 True。</li><li>Path.<strong>read_text</strong>(<em>*</em>, <em>**</em>) 读取当前文件为 unicode 文本</li><li>Path.<strong>read_bytes</strong>() 读取当前文件为字节串。</li><li>Path.<strong>joinpath</strong>(<em>*other</em>) 返回一个新的 Path 对象，其中合并了每个 <em>other</em> 参数</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> psutil</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> zipfile</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Zip</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 限制解压后大小不能超过1M，文件个数不能超过10</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">MAX_SIZE</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;">1024</span><span style="color:#56B6C2;">*</span><span style="color:#D19A66;">1024</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">MAX_FILE_CNT</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    @</span><span style="color:#56B6C2;">staticmethod</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">unzip</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">path</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">zip_file</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        file_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> path</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">os.sep</span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;">zip_file</span></span>
<span class="line"><span style="color:#ABB2BF;">        dest_dir </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> path</span></span>
<span class="line"><span style="color:#ABB2BF;">        src_file </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> zipfile.</span><span style="color:#61AFEF;">ZipFile</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#98C379;">&#39;r&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># 1 检查文件个数</span></span>
<span class="line"><span style="color:#ABB2BF;">        file_count </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">len</span><span style="color:#ABB2BF;">(src_file.</span><span style="color:#61AFEF;">infolist</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> file_count </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> Zip.</span><span style="color:#D19A66;">MAX_FILE_CNT</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;font-style:italic;">raise</span><span style="color:#ABB2BF;"> IOError(</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;zipfile(</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">zip_file</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">) contains </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">file_count</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> files exceed max file count&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># 2 检查第一层解压文件总大小</span></span>
<span class="line"><span style="color:#ABB2BF;">        total_size </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">sum</span><span style="color:#ABB2BF;">(info.file_size </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> info </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> src_file.</span><span style="color:#61AFEF;">infolist</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> total_size </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> Zip.</span><span style="color:#D19A66;">MAX_SIZE</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;font-style:italic;">raise</span><span style="color:#ABB2BF;"> IOError(</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;zipfile(</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">zip_file</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">) size </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">total_size</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> exceed max limit&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># 3 检查磁盘剩余空间</span></span>
<span class="line"><span style="color:#ABB2BF;">        dest_dir_partition </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;/&#39;</span><span style="color:#ABB2BF;">  </span><span style="color:#7F848E;font-style:italic;"># 解压目录所在分区</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> total_size </span><span style="color:#56B6C2;">&gt;=</span><span style="color:#ABB2BF;"> psutil.</span><span style="color:#61AFEF;">disk_usage</span><span style="color:#ABB2BF;">(dest_dir_partition).free:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;font-style:italic;">raise</span><span style="color:#ABB2BF;"> IOError(</span></span>
<span class="line"><span style="color:#ABB2BF;">                </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;zipfile(</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">zip_file</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">) size </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">total_size</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> exceed remain target disk space&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># 检查通过，解压所有文件</span></span>
<span class="line"><span style="color:#ABB2BF;">        src_file.</span><span style="color:#61AFEF;">extractall</span><span style="color:#ABB2BF;">(dest_dir)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="并发" tabindex="-1">并发 <a class="header-anchor" href="#并发" aria-label="Permalink to &quot;并发&quot;">​</a></h2><h3 id="threading-基于线程的并行" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/threading.html" target="_blank" rel="noreferrer">threading--- 基于线程的并行</a> <a class="header-anchor" href="#threading-基于线程的并行" aria-label="Permalink to &quot;[threading--- 基于线程的并行](https://docs.python.org/zh-cn/3/library/threading.html)&quot;">​</a></h3><p>GIL(global interpreter lock，全局解释器锁)：使得同一个时刻只有一个线程在一个CPU上执行字节码。无法将多个线程映射到多个CPU上。</p><p>释放条件</p><ol><li>字节码执行一定行数后释放</li><li>通过时间片划分</li><li>遇到IO操作时会主动释放。</li></ol><ul><li>threading.active_count() <ul><li>返回当前存活的线程类 Thread 对象</li></ul></li><li>threading.current_thread() <ul><li>返回当前对应调用者的控制线程的 Thread 对象</li></ul></li><li>threading.excepthook(args, /)</li><li>threading.get_ident()</li><li>返回当前线程的 “线程标识符</li><li>threading.get_native_id() <ul><li>返回内核分配给当前线程的原生集成线程 ID</li></ul></li><li>threading.enumerate() <ul><li>以列表形式返回当前所有存活的 Thread 对象</li></ul></li><li>threading.main_thread() <ul><li>返回主 Thread 对象</li></ul></li><li>threading.settrace(func) <ul><li>为所有 threading 模块开始的线程设置追踪函数</li></ul></li><li>threading.setprofile(func) <ul><li>为所有 threading 模块开始的线程设置性能测试函数</li></ul></li><li>threading.stack_size([size]) <ul><li>返回创建线程时用的堆栈大小</li></ul></li></ul><p>*<em>class threading.Thread(group=None, target=None, name=None, args=(), kwargs={}, <em>, daemon=None)</em></em> <br> target 是用于 run() 方法调用的可调用对象 <br> name 是线程名称 <br> args 是用于调用目标函数的参数元组 <br> kwargs 是用于调用目标函数的关键字参数字典</p><p>其他线程可以调用一个线程的 join() 方法。这会阻塞调用该方法的线程，直到被调用 join() 方法的线程终结。</p><ul><li>start()：开始线程活动</li><li>run()：代表线程活动的方法</li><li>join(timeout=None)：等待，直到线程终结</li><li>is_alive()：返回线程是否存活</li><li>daemon：一个表示这个线程是（True）否（False）守护线程的布尔值</li></ul><p><strong>class threading.Lock</strong> <br> 实现原始锁对象的类</p><ul><li>acquire(blocking=True, timeout=-1)：可以阻塞或非阻塞地获得锁</li><li>release()：释放一个锁</li><li>locked()：如果获得了锁则返回真值</li></ul><p><strong>class threading.RLock</strong> <br> 此类实现了重入锁对象</p><ul><li>acquire(blocking=True, timeout=-1)：可以阻塞或非阻塞地获得锁</li><li>release()：释放锁，自减递归等级</li></ul><p><strong>class threading.Condition(lock=None)</strong> <br> 实现条件变量对象的类</p><ul><li>acquire(*args)：请求底层锁</li><li>release()：释放底层锁</li><li>wait(timeout=None)：等待直到被通知或发生超时</li><li>wait_for(predicate, timeout=None)：等待，直到条件计算为真</li><li>notify(n=1)：默认唤醒一个等待这个条件的线程</li><li>notify_all()：唤醒所有正在等待这个条件的线程</li></ul><p><strong>class threading.Semaphore(value=1)</strong> <br> 该类实现信号量对象</p><ul><li>acquire(blocking=True, timeout=None)：获取一个信号量</li><li>release()：释放一个信号量，将内部计数器的值增加1</li></ul><p><strong>class threading.Event</strong> <br> 实现事件对象的类</p><ul><li>is_set()：当且仅当内部旗标为时返回 True</li><li>set()：将内部标志设置为true</li><li>clear()：将内部标志设置为false</li><li>wait(timeout=None)：阻塞线程直到内部变量为true</li></ul><p><strong>class threading.Timer(interval, function, args=None, kwargs=None)</strong> <br> 定时器，在经过 interval 秒的间隔事件后，将会用参数 args 和关键字参数 kwargs 调用 function</p><ul><li>cancel()：停止定时器并取消执行计时器将要执行的操作</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> threading</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#ABB2BF;">exitFlag </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">myThread</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">threading</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">__init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">threadID</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">name</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">counter</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">      threading.Thread.</span><span style="color:#56B6C2;">__init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.threadID </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> threadID</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> name</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.counter </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> counter</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&quot;Starting &quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.name)</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#61AFEF;">print_time</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.name, </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.counter, </span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&quot;Exiting &quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.name)</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#ABB2BF;">      </span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">print_time</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">threadName</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">delay</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">counter</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span><span style="color:#C678DD;font-style:italic;">while</span><span style="color:#ABB2BF;"> counter:</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> exitFlag:</span></span>
<span class="line"><span style="color:#ABB2BF;">         threadName.</span><span style="color:#61AFEF;">exit</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">      time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(delay)</span></span>
<span class="line"><span style="color:#ABB2BF;">      </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">: </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> (threadName, time.</span><span style="color:#61AFEF;">ctime</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">())))</span></span>
<span class="line"><span style="color:#ABB2BF;">      counter </span><span style="color:#56B6C2;">-=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">1</span></span>
<span class="line"><span style="color:#ABB2BF;">thread1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">myThread</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;Thread-1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">thread2 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">myThread</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;Thread-2&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">thread1.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">thread2.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">thread1.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">thread2.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;"> (</span><span style="color:#98C379;">&quot;Exiting Main Thread&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>加锁</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> threading</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 假定这是你的银行存款:</span></span>
<span class="line"><span style="color:#ABB2BF;">balance </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span></span>
<span class="line"><span style="color:#ABB2BF;">lock </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> threading.</span><span style="color:#61AFEF;">Lock</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">change_it</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">n</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 先存后取，结果应该为0:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">global</span><span style="color:#ABB2BF;"> balance</span></span>
<span class="line"><span style="color:#ABB2BF;">    balance </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> balance </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> n</span></span>
<span class="line"><span style="color:#ABB2BF;">    balance </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> balance </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> n</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">run_thread</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">n</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">100000</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># 先要获取锁:</span></span>
<span class="line"><span style="color:#ABB2BF;">        lock.</span><span style="color:#61AFEF;">acquire</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">try</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;"># 放心地改吧:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#61AFEF;">change_it</span><span style="color:#ABB2BF;">(n)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">finally</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#7F848E;font-style:italic;"># 改完了一定要释放锁:</span></span>
<span class="line"><span style="color:#ABB2BF;">            lock.</span><span style="color:#61AFEF;">release</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">t1 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> threading.</span><span style="color:#61AFEF;">Thread</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">target</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">run_thread, </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">,))</span></span>
<span class="line"><span style="color:#ABB2BF;">t2 </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> threading.</span><span style="color:#61AFEF;">Thread</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">target</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">run_thread, </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">8</span><span style="color:#ABB2BF;">,))</span></span>
<span class="line"><span style="color:#ABB2BF;">t1.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">t2.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">t1.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">t2.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(balance)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>ThreadLocal解决了参数在一个线程中各个函数之间互相传递的问题。</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">threading</span></span>
<span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#E06C75;">创建全局ThreadLocal对象</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">local_school</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">threading</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">local</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">process_student</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">获取当前线程关联的student</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">std</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">local_school</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">student</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Hello, %s (in %s)&#39;</span><span style="color:#ABB2BF;"> % (</span><span style="color:#E06C75;">std</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">threading</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">current_thread</span><span style="color:#ABB2BF;">().</span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#E06C75;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">process_thread</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">绑定ThreadLocal的student</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">local_school</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">student</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">name</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">process_student</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;">t1</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">threading</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Thread</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">target</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">process_thread</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;">=(</span><span style="color:#98C379;">&#39;Alice&#39;</span><span style="color:#ABB2BF;">,), </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;Thread-A&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">t2</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">threading</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Thread</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">target</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">process_thread</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;">=(</span><span style="color:#98C379;">&#39;Bob&#39;</span><span style="color:#ABB2BF;">,), </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;Thread-B&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">t1</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">start</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;">t2</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">start</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;">t1</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">join</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;">t2</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">join</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="multiprocessing-基于进程的并行" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/multiprocessing.html" target="_blank" rel="noreferrer">multiprocessing--- 基于进程的并行</a> <a class="header-anchor" href="#multiprocessing-基于进程的并行" aria-label="Permalink to &quot;[multiprocessing--- 基于进程的并行](https://docs.python.org/zh-cn/3/library/multiprocessing.html)&quot;">​</a></h3><p>*<em>class multiprocessing.Process(group=None, target=None, name=None, args=(), kwargs={}, <em>, daemon=None)</em></em> <br> Process 类拥有和 threading.Thread 等价的大部分方法。</p><p><strong>multiprocessing.Pipe([duplex])</strong> <br> 返回一对 Connection<code>对象 \`\`(conn1, conn2)</code> ， 分别表示管道的两端。</p><p>class multiprocessing.Queue([maxsize]) <br> 返回一个使用一个管道和少量锁和信号量实现的共享队列实例。 <br> 除了 task_done() 和 join() 之外，Queue 实现了标准库类 queue.Queue 中所有的方法 <br> class multiprocessing.SimpleQueue <br> 一个简化的 Queue 类的实现，很像带锁的 Pipe <br> class multiprocessing.JoinableQueue([maxsize]) <br> JoinableQueue 类是 Queue 的子类，额外添加了 task_done() 和 join() 方法 <br> multiprocessing.active_children()：返回当前进程存活的子进程的列表。 <br> multiprocessing.cpu_count()：返回系统的CPU数量。 <br> ... <br> class multiprocessing.connection.Connection <br> Connection 对象允许收发可以序列化的对象或字符串，可以看作面向消息的连接套接字。 <br> <strong>class multiprocessing.pool.Pool([processes[, initializer[, initargs[, maxtasksperchild[, context]]]]])</strong> <br> 一个进程池对象，它控制可以提交作业的工作进程池</p><ul><li>apply(func[, args[, kwds]])：使用 args 参数以及 kwds 命名参数调用 func , 它会返回结果前阻塞。</li><li>apply_async(func[, args[, kwds[, callback[, error_callback]]]])：返回一个结果对象。</li><li>map(func, iterable[, chunksize])：保持阻塞直到获得结果。</li><li>map_async(func, iterable[, chunksize[, callback[, error_callback]]])：返回一个可用于获取结果的对象。</li><li>imap(func, iterable[, chunksize])：map() 的延迟执行版本。</li><li>imap_unordered(func, iterable[, chunksize])：通过迭代器返回的结果是任意的</li><li>starmap(func, iterable[, chunksize])：和 map() 类似，不过 iterable 中的每一项会被解包再作为函数参数。</li><li>starmap_async(func, iterable[, chunksize[, callback[, error_callback]]])：相当于 starmap() 与 map_async() 的结合，迭代 iterable 的每一项，解包作为 func 的参数并执行，返回用于获取结果的对象。</li><li>close()：阻止后续任务提交到进程池，当所有任务执行完成后，工作进程会退出。</li><li>terminate()：不必等待未完成的任务，立即停止工作进程。</li><li>join()：等待工作进程结束。调用 join() 前必须先调用 close() 或者 terminate()</li></ul><p>多进程</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> multiprocessing </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> Process</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 子进程要执行的代码</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">run_proc</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">name</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Run child process </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;"> (</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">)...&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> (name, os.</span><span style="color:#61AFEF;">getpid</span><span style="color:#ABB2BF;">()))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">__name__</span><span style="color:#56B6C2;">==</span><span style="color:#98C379;">&#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Parent process </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">.&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">getpid</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">    p </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Process</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">target</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">run_proc, </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;test&#39;</span><span style="color:#ABB2BF;">,))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Child process will start.&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    p.</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    p.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Child process end.&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># linux   </span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Process (</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">) start...&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">getpid</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Only works on Unix/Linux/Mac:</span></span>
<span class="line"><span style="color:#ABB2BF;">pid </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> os.</span><span style="color:#61AFEF;">fork</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> pid </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;I am child process (</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">) and my parent is </span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">.&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> (os.</span><span style="color:#61AFEF;">getpid</span><span style="color:#ABB2BF;">(), os.</span><span style="color:#61AFEF;">getppid</span><span style="color:#ABB2BF;">()))</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;I (</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">) just created a child process (</span><span style="color:#D19A66;">%s</span><span style="color:#98C379;">).&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;"> (os.</span><span style="color:#61AFEF;">getpid</span><span style="color:#ABB2BF;">(), pid))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>线程池</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> multiprocessing.dummy </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> Pool</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">fun</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">s</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(s,</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">starting&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(s, </span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">ending&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">event</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">[</span><span style="color:#98C379;">&#39;a&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;b&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;c&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#98C379;">&#39;d&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">a </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">p </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Pool</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">p.</span><span style="color:#61AFEF;">map</span><span style="color:#ABB2BF;">(fun, event)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(time.</span><span style="color:#61AFEF;">time</span><span style="color:#ABB2BF;">()</span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;">a)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="subprocess-子进程管理" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/subprocess.html#module-subprocess" target="_blank" rel="noreferrer">subprocess</a> --- 子进程管理 <a class="header-anchor" href="#subprocess-子进程管理" aria-label="Permalink to &quot;[subprocess](https://docs.python.org/zh-cn/3/library/subprocess.html#module-subprocess) --- 子进程管理&quot;">​</a></h3><p>subprocess.run(args, *, stdin=None, input=None, stdout=None, stderr=None, capture_output=False, shell=False, cwd=None, timeout=None, check=False, encoding=None, errors=None, text=None, env=None, universal_newlines=None, **other_popen_kwargs) <br> 运行被 arg 描述的指令。等待指令完成，然后返回一个 CompletedProcess 实例。</p><p>class subprocess.CompletedProcess <br> run() 的返回值, 代表一个进程已经结束.</p><ul><li>args 被用作启动进程的参数</li><li>returncode 子进程的退出状态码</li><li>stdout 从子进程捕获到的标准输出</li><li>stderr 捕获到的子进程的标准错误</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> subprocess</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;$ ping www.python.org&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">r </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> subprocess.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;ping&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;www.python.org&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Exit code:&#39;</span><span style="color:#ABB2BF;">, r.returncode)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">js_eval</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">e</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># e = &quot;&#39;red yellow blue&#39;.split(&#39; &#39;)&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    r </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> subprocess.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        [</span><span style="color:#98C379;">&#39;node&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;-e&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;console.log(</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">)&#39;</span><span style="color:#ABB2BF;">], </span><span style="color:#E06C75;font-style:italic;">capture_output</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">eval</span><span style="color:#ABB2BF;">(r.stdout.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">js_call</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">e</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">func_name</span><span style="color:#ABB2BF;">, *</span><span style="color:#D19A66;font-style:italic;">args</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># e = &quot;function f(a,b){return a+b;}&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># func_name = &#39;f&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    r </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> subprocess.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">([</span><span style="color:#98C379;">&#39;node&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;-e&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">e</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> console.log(</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">func_name</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;(&#39;</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;,&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(args)</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;)&#39;</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">)&quot;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#ABB2BF;">                         </span><span style="color:#E06C75;font-style:italic;">capture_output</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">eval</span><span style="color:#ABB2BF;">(r.stdout.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">())</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="asyncio-异步-i-o" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/asyncio.html" target="_blank" rel="noreferrer">asyncio--- 异步 I/O</a> <a class="header-anchor" href="#asyncio-异步-i-o" aria-label="Permalink to &quot;[asyncio--- 异步 I/O](https://docs.python.org/zh-cn/3/library/asyncio.html)&quot;">​</a></h3><p>asyncio</p><table><thead><tr><th><a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.run" target="_blank" rel="noreferrer">run()</a></th><th>创建事件循环，运行一个协程，关闭事件循环。</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.create_task" target="_blank" rel="noreferrer">create_task()</a></td><td>启动一个asyncio的Task对象。</td></tr><tr><td>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.sleep" target="_blank" rel="noreferrer">sleep()</a></td><td>休眠几秒。</td></tr><tr><td>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.gather" target="_blank" rel="noreferrer">gather()</a></td><td>并发执行所有事件的调度和等待。</td></tr><tr><td>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.wait_for" target="_blank" rel="noreferrer">wait_for()</a></td><td>有超时控制的运行。</td></tr><tr><td>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.shield" target="_blank" rel="noreferrer">shield()</a></td><td>屏蔽取消操作</td></tr><tr><td>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.wait" target="_blank" rel="noreferrer">wait()</a></td><td>完成情况的监控器</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.current_task" target="_blank" rel="noreferrer">current_task()</a></td><td>返回当前Task对象</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.all_tasks" target="_blank" rel="noreferrer">all_tasks()</a></td><td>返回事件循环中所有的task对象。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.Task" target="_blank" rel="noreferrer">Task</a></td><td>Task对象</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.to_thread" target="_blank" rel="noreferrer">to_thread()</a></td><td>在不同的 OS 线程中异步地运行一个函数。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.run_coroutine_threadsafe" target="_blank" rel="noreferrer">run_coroutine_threadsafe()</a></td><td>从其他OS线程中调度一个协程。</td></tr><tr><td>for in <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.as_completed" target="_blank" rel="noreferrer">as_completed()</a></td><td>用 for 循环监控完成情况。</td></tr></tbody></table><p>子进程集</p><table><thead><tr><th>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-subprocess.html#asyncio.create_subprocess_exec" target="_blank" rel="noreferrer">create_subprocess_exec()</a></th><th>创建一个子进程。</th></tr></thead><tbody><tr><td>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-subprocess.html#asyncio.create_subprocess_shell" target="_blank" rel="noreferrer">create_subprocess_shell()</a></td><td>运行一个shell命令。</td></tr></tbody></table><p>网络IO</p><table><thead><tr><th>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-stream.html#asyncio.open_connection" target="_blank" rel="noreferrer">open_connection()</a></th><th>建立一个TCP连接。</th></tr></thead><tbody><tr><td>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-stream.html#asyncio.open_unix_connection" target="_blank" rel="noreferrer">open_unix_connection()</a></td><td>建立一个Unix socket连接。</td></tr><tr><td>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-stream.html#asyncio.start_server" target="_blank" rel="noreferrer">start_server()</a></td><td>启动TCP服务。</td></tr><tr><td>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-stream.html#asyncio.start_unix_server" target="_blank" rel="noreferrer">start_unix_server()</a></td><td>启动一个 Unix 套接字服务。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-stream.html#asyncio.StreamReader" target="_blank" rel="noreferrer">StreamReader</a></td><td>接收网络数据的高级async/await对象。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-stream.html#asyncio.StreamWriter" target="_blank" rel="noreferrer">StreamWriter</a></td><td>发送网络数据的高级async/await对象。</td></tr></tbody></table><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> asyncio</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> sys</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> urllib.parse</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">blocking_io</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">count</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;start blocking_io at </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">%X</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    time.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(count)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;blocking_io complete at </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">%X</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">execute_cmd</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">cmd</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    proc </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">create_subprocess_shell</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        cmd,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;font-style:italic;">stdout</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">asyncio.subprocess.</span><span style="color:#D19A66;">PIPE</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;font-style:italic;">stderr</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">asyncio.subprocess.</span><span style="color:#D19A66;">PIPE</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    stdout, stderr </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> proc.</span><span style="color:#61AFEF;">communicate</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;[</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">cmd</span><span style="color:#C678DD;">!r</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> exited with </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">proc.returncode</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">]&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> stdout:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;[stdout]</span><span style="color:#56B6C2;">\\n</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">stdout.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;gbk&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> stderr:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;[stderr]</span><span style="color:#56B6C2;">\\n</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">stderr.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;gbk&quot;</span><span style="color:#ABB2BF;">)</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">get_date</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    code </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;import datetime; print(datetime.datetime.now())&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># Create the subprocess; redirect the standard output into a pipe.</span></span>
<span class="line"><span style="color:#ABB2BF;">    proc </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">create_subprocess_exec</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        sys.executable, </span><span style="color:#98C379;">&#39;-c&#39;</span><span style="color:#ABB2BF;">, code,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;font-style:italic;">stdout</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">asyncio.subprocess.</span><span style="color:#D19A66;">PIPE</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># Read one line of output.</span></span>
<span class="line"><span style="color:#ABB2BF;">    data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> proc.stdout.</span><span style="color:#61AFEF;">readline</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    line </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> data.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;ascii&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">rstrip</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># Wait for the subprocess exit.</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> proc.</span><span style="color:#61AFEF;">wait</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;date is </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">line</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> line</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">print_http_headers</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">url</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    url </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> urllib.parse.</span><span style="color:#61AFEF;">urlsplit</span><span style="color:#ABB2BF;">(url)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> url.scheme </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;https&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        reader, writer </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">open_connection</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">            url.hostname, </span><span style="color:#D19A66;">443</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">ssl</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        reader, writer </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">open_connection</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">            url.hostname, </span><span style="color:#D19A66;">80</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    query </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;HEAD </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">url.path </span><span style="color:#C678DD;font-style:italic;">or</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;/&#39;</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> HTTP/1.0</span><span style="color:#56B6C2;">\\r\\n</span><span style="color:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;Host: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">url.hostname</span><span style="color:#D19A66;">}</span><span style="color:#56B6C2;">\\r\\n</span><span style="color:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\r\\n</span><span style="color:#98C379;">&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    writer.</span><span style="color:#61AFEF;">write</span><span style="color:#ABB2BF;">(query.</span><span style="color:#61AFEF;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;latin-1&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">while</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        line </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> reader.</span><span style="color:#61AFEF;">readline</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">not</span><span style="color:#ABB2BF;"> line:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;font-style:italic;">break</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        line </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> line.</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;latin1&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">rstrip</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> line:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;HTTP header&gt; </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">line</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># Ignore the body, close the socket</span></span>
<span class="line"><span style="color:#ABB2BF;">    writer.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">gather</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        asyncio.</span><span style="color:#61AFEF;">to_thread</span><span style="color:#ABB2BF;">(blocking_io, </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">print_http_headers</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://www.baidu.com&quot;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#61AFEF;">execute_cmd</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;ping bing.cn&#39;</span><span style="color:#ABB2BF;">), </span><span style="color:#61AFEF;">get_date</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">asyncio.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">())</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><p>队列示例</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> asyncio</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> random</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">worker</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">name</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">queue</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">while</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># Get a &quot;work item&quot; out of the queue.</span></span>
<span class="line"><span style="color:#ABB2BF;">        sleep_for </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> queue.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># Sleep for the &quot;sleep_for&quot; seconds.</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(sleep_for)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># Notify the queue that the &quot;work item&quot; has been processed.</span></span>
<span class="line"><span style="color:#ABB2BF;">        queue.</span><span style="color:#61AFEF;">task_done</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">name</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> has slept for </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">sleep_for</span><span style="color:#C678DD;">:.2f</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> seconds&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># Create a queue that we will use to store our &quot;workload&quot;.</span></span>
<span class="line"><span style="color:#ABB2BF;">    queue </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">Queue</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># Generate random timings and put them into the queue.</span></span>
<span class="line"><span style="color:#ABB2BF;">    total_sleep_time </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> _ </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        sleep_for </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> random.</span><span style="color:#61AFEF;">uniform</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">0.05</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">1.0</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        total_sleep_time </span><span style="color:#56B6C2;">+=</span><span style="color:#ABB2BF;"> sleep_for</span></span>
<span class="line"><span style="color:#ABB2BF;">        queue.</span><span style="color:#61AFEF;">put_nowait</span><span style="color:#ABB2BF;">(sleep_for)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># Create three worker tasks to process the queue concurrently.</span></span>
<span class="line"><span style="color:#ABB2BF;">    tasks </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">range</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        task </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">create_task</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">worker</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;worker-</span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">i</span><span style="color:#D19A66;">}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">, queue))</span></span>
<span class="line"><span style="color:#ABB2BF;">        tasks.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(task)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># Wait until the queue is fully processed.</span></span>
<span class="line"><span style="color:#ABB2BF;">    started_at </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">monotonic</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> queue.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    total_slept_for </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">monotonic</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> started_at</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># Cancel our worker tasks.</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> task </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> tasks:</span></span>
<span class="line"><span style="color:#ABB2BF;">        task.</span><span style="color:#61AFEF;">cancel</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># Wait until all worker tasks are cancelled.</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">await</span><span style="color:#ABB2BF;"> asyncio.</span><span style="color:#61AFEF;">gather</span><span style="color:#ABB2BF;">(*tasks, </span><span style="color:#E06C75;font-style:italic;">return_exceptions</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">True</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;====&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;3 workers slept in parallel for </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">total_slept_for</span><span style="color:#C678DD;">:.2f</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> seconds&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">f</span><span style="color:#98C379;">&#39;total expected sleep time: </span><span style="color:#D19A66;">{</span><span style="color:#ABB2BF;">total_sleep_time</span><span style="color:#C678DD;">:.2f</span><span style="color:#D19A66;">}</span><span style="color:#98C379;"> seconds&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">asyncio.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">())</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p><a href="https://docs.python.org/zh-cn/3/library/asyncio-llapi-index.html" target="_blank" rel="noreferrer"><strong>低层级 API</strong></a></p><p><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html" target="_blank" rel="noreferrer">事件循环</a></p><table><thead><tr><th><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.get_running_loop" target="_blank" rel="noreferrer">asyncio.get_running_loop()</a></th><th>获取当前运行的事件循环 首选 函数。</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.get_event_loop" target="_blank" rel="noreferrer">asyncio.get_event_loop()</a></td><td>获得一个事件循环实例(当前或通过策略)。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.set_event_loop" target="_blank" rel="noreferrer">asyncio.set_event_loop()</a></td><td>通过当前策略将事件循环设置当前事件循环。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.new_event_loop" target="_blank" rel="noreferrer">asyncio.new_event_loop()</a></td><td>创建一个新的事件循环。</td></tr></tbody></table><p>生命周期</p><table><thead><tr><th><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.run_until_complete" target="_blank" rel="noreferrer">loop.run_until_complete()</a></th><th>运行一个期程/任务/可等待对象直到完成。</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.run_forever" target="_blank" rel="noreferrer">loop.run_forever()</a></td><td>一直运行事件循环。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.stop" target="_blank" rel="noreferrer">loop.stop()</a></td><td>停止事件循环。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.close" target="_blank" rel="noreferrer">loop.close()</a></td><td>关闭事件循环。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.is_running" target="_blank" rel="noreferrer">loop.is_running()</a></td><td>返回 True ， 如果事件循环正在运行。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.is_closed" target="_blank" rel="noreferrer">loop.is_closed()</a></td><td>返回 True ，如果事件循环已经被关闭 。</td></tr><tr><td>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.shutdown_asyncgens" target="_blank" rel="noreferrer">loop.shutdown_asyncgens()</a></td><td>关闭异步生成器。</td></tr></tbody></table><p>调试</p><table><thead><tr><th><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.set_debug" target="_blank" rel="noreferrer">loop.set_debug()</a></th><th>开启或禁用调试模式。</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.get_debug" target="_blank" rel="noreferrer">loop.get_debug()</a></td><td>获取当前测试模式。</td></tr></tbody></table><p>调度回调函数</p><table><thead><tr><th><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.call_soon" target="_blank" rel="noreferrer">loop.call_soon()</a></th><th>尽快调用回调。</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.call_soon_threadsafe" target="_blank" rel="noreferrer">loop.call_soon_threadsafe()</a></td><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.call_soon" target="_blank" rel="noreferrer">loop.call_soon() </a> 方法线程安全的变体。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.call_later" target="_blank" rel="noreferrer">loop.call_later()</a></td><td>在给定时间 之后 调用回调函数。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.call_at" target="_blank" rel="noreferrer">loop.call_at()</a></td><td>在 指定 时间调用回调函数。</td></tr></tbody></table><p>线程/进程池</p><table><thead><tr><th>await <a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.run_in_executor" target="_blank" rel="noreferrer">loop.run_in_executor()</a></th><th>在 <a href="https://docs.python.org/zh-cn/3/library/concurrent.futures.html#module-concurrent.futures" target="_blank" rel="noreferrer">concurrent.futures </a> <br> 执行器中运行一个独占CPU或其它阻塞函数。</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.set_default_executor" target="_blank" rel="noreferrer">loop.set_default_executor()</a></td><td>设置 <a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.run_in_executor" target="_blank" rel="noreferrer">loop.run_in_executor() </a> <br> 默认执行器。</td></tr></tbody></table><p>任务与期程</p><table><thead><tr><th><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.create_future" target="_blank" rel="noreferrer">loop.create_future()</a></th><th>创建一个 <a href="https://docs.python.org/zh-cn/3/library/asyncio-future.html#asyncio.Future" target="_blank" rel="noreferrer">Future </a>对象。</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.create_task" target="_blank" rel="noreferrer">loop.create_task()</a></td><td>将协程当作 <a href="https://docs.python.org/zh-cn/3/library/asyncio-task.html#asyncio.Task" target="_blank" rel="noreferrer">Task </a>一样调度。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.set_task_factory" target="_blank" rel="noreferrer">loop.set_task_factory()</a></td><td>设置 <a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.create_task" target="_blank" rel="noreferrer">loop.create_task() </a>使用的工厂，它将用来创建 Tasks 。</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.get_task_factory" target="_blank" rel="noreferrer">loop.get_task_factory()</a></td><td>获取 <a href="https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.create_task" target="_blank" rel="noreferrer">loop.create_task() </a>使用的工厂，它用来创建 Tasks 。</td></tr></tbody></table><h2 id="网络" tabindex="-1">网络 <a class="header-anchor" href="#网络" aria-label="Permalink to &quot;网络&quot;">​</a></h2><h3 id="urllib-url-处理模块" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/urllib.html" target="_blank" rel="noreferrer">urllib--- URL 处理模块</a> <a class="header-anchor" href="#urllib-url-处理模块" aria-label="Permalink to &quot;[urllib--- URL 处理模块](https://docs.python.org/zh-cn/3/library/urllib.html)&quot;">​</a></h3><p><a href="https://docs.python.org/zh-cn/3/library/urllib.request.html" target="_blank" rel="noreferrer">urllib.request--- 用于打开 URL 的可扩展库</a> <br> <strong>urllib.request.urlopen(url, data=None, [timeout, ]*, cafile=None, capath=None, cadefault=False, context=None)</strong></p><p><strong>class urllib.request.Request(url, data=None, headers={}, origin_req_host=None, unverifiable=False, method=None)</strong> <br> <strong>···</strong></p><p><a href="https://docs.python.org/zh-cn/3/library/urllib.parse.html" target="_blank" rel="noreferrer">urllib.parse--- Parse URLs into components</a> <br> <a href="https://docs.python.org/zh-cn/3/library/urllib.parse.html#url-parsing" target="_blank" rel="noreferrer">URL 解析</a></p><ul><li>**parse.urlparse(urlstring, scheme=&#39;&#39;, allow_fragments=True) **将一个 URL 解析为六个部分，对应于 <code>scheme://netloc/path;parameters?query#fragment</code></li><li>parse.urlunparse(parts) 根据 urlparse() 所返回的元组来构造一个 URL</li><li>parse.urlsplit(urlstring, scheme=&#39;&#39;, allow_fragments=True) 类似于 urlparse()，但不会拆分来自 URL 的参数</li><li>parse.urlunsplit(parts) 将 urlsplit() 所返回的元组中的元素合并为一个字符串形式的完整 URL</li><li>parse.parse_qs(qs, keep_blank_values=False, strict_parsing=False, encoding=&#39;utf-8&#39;, errors=&#39;replace&#39;, max_num_fields=None, separator=&#39;&amp;&#39;) 解析以字符串参数形式（类型为 application/x-www-form-urlencoded 的数据）给出的查询字符串</li><li>parse.urljoin(base, url, allow_fragments=True) 通过合并一个 &quot;基准 URL&quot; (base) 和另一个 URL (url) 来构造一个完整 (&quot;absolute&quot;) URL</li><li>parse.urldefrag(url) 返回不带片段标识符的 url 修改版本</li></ul><p><a href="https://docs.python.org/zh-cn/3/library/urllib.parse.html#url-quoting" target="_blank" rel="noreferrer">URL 转码</a></p><ul><li>parse.quote(string, safe=&#39;/&#39;, encoding=None, errors=None) 使用<code>%xx</code> 转义符替换 string 中的特殊字符。 字母、数字和<code>&#39;_.-~&#39;</code> 等字符一定不会被转码</li><li>parse.quote_plus(string, safe=&#39;&#39;, encoding=None, errors=None) 类似于 quote()，但还会使用加号来替换空格</li><li>parse.quote_from_bytes(bytes, safe=&#39;/&#39;)</li><li>parse.unquote(string, encoding=&#39;utf-8&#39;, errors=&#39;replace&#39;) 将 %xx 转义符替换为其单字符等价物</li><li>parse.unquote_plus(string, encoding=&#39;utf-8&#39;, errors=&#39;replace&#39;)</li><li>parse.urlencode(query, doseq=False, safe=&#39;&#39;, encoding=None, errors=None, quote_via=quote_plus) 将一个包含有 str 或 bytes 对象的映射对象或二元组序列转换为以百分号编码的 ASCII 文本字符串</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">urllib</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">request</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">parse</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Login to weibo.cn...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">email</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Email: &#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">passwd</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">input</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Password: &#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">login_data</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">parse</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">urlencode</span><span style="color:#ABB2BF;">([</span></span>
<span class="line"><span style="color:#ABB2BF;">    (</span><span style="color:#98C379;">&#39;username&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">email</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">    (</span><span style="color:#98C379;">&#39;password&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">passwd</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">    (</span><span style="color:#98C379;">&#39;entry&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;mweibo&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">    (</span><span style="color:#98C379;">&#39;client_id&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">    (</span><span style="color:#98C379;">&#39;savestate&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;1&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">    (</span><span style="color:#98C379;">&#39;ec&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">    (</span><span style="color:#98C379;">&#39;pagerefer&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;https://passport.weibo.cn/signin/welcome?entry=mweibo&amp;r=http%3A%2F%2Fm.weibo.cn%2F&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#E06C75;">req</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">request</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Request</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://passport.weibo.cn/sso/login&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">req</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">add_header</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Origin&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;https://passport.weibo.cn&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">req</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">add_header</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;User-Agent&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Mozilla/6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/8.0 Mobile/10A5376e Safari/8536.25&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">req</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">add_header</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Referer&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;https://passport.weibo.cn/signin/login?entry=mweibo&amp;res=wel&amp;wm=3349&amp;r=http%3A%2F%2Fm.weibo.cn%2F&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">request</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">urlopen</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">req</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">login_data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">)) </span><span style="color:#E06C75;">as</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">f</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Status:&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">f</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">status</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">f</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">reason</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">for</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">k</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">v</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">f</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">getheaders</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;%s: %s&#39;</span><span style="color:#ABB2BF;"> % (</span><span style="color:#E06C75;">k</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">v</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Data:&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">f</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">read</span><span style="color:#ABB2BF;">().</span><span style="color:#E06C75;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="socket-底层网络接口" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/socket.html#module-socket" target="_blank" rel="noreferrer">socket</a> --- 底层网络接口 <a class="header-anchor" href="#socket-底层网络接口" aria-label="Permalink to &quot;[socket](https://docs.python.org/zh-cn/3/library/socket.html#module-socket) --- 底层网络接口&quot;">​</a></h3><p>socket.socket(family=AF_INET, type=SOCK_STREAM, proto=0, fileno=None) <br> 使用给定的地址族、套接字类型和协议号创建一个新的套接字。 <br> 地址（和协议）簇</p><ul><li>socket.AF_UNIX</li><li>socket.AF_INET</li><li>socket.AF_INET6</li></ul><p>套接字类型</p><ul><li>socket.SOCK_STREAM</li><li>socket.SOCK_DGRAM</li><li>socket.SOCK_RAW</li><li>socket.SOCK_RDM</li><li>socket.SOCK_SEQPACKET</li></ul><p><strong>TCP</strong> <br> server</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">time</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">threading</span></span>
<span class="line"><span style="color:#E06C75;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">tcplink</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">sock</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">addr</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Accept new connection from %s:%s...&#39;</span><span style="color:#ABB2BF;"> % </span><span style="color:#E06C75;">addr</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">sock</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">send</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">b</span><span style="color:#98C379;">&#39;Welcome!&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">while</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">sock</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">recv</span><span style="color:#ABB2BF;">(1024).</span><span style="color:#E06C75;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">time</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">sleep</span><span style="color:#ABB2BF;">(1)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">not</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">or</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> == </span><span style="color:#98C379;">&#39;exit&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E06C75;">break</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">f</span><span style="color:#98C379;">&#39;{addr[0]}:{addr[1]} &gt; {data}&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">sock</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">send</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">input</span><span style="color:#ABB2BF;">().</span><span style="color:#E06C75;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">sock</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Connection from %s:%s closed.&#39;</span><span style="color:#ABB2BF;"> % </span><span style="color:#E06C75;">addr</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">AF_INET</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">SOCK_STREAM</span><span style="color:#ABB2BF;">)  # </span><span style="color:#E06C75;">类型</span><span style="color:#ABB2BF;">，</span><span style="color:#E06C75;">类型协议</span></span>
<span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#E06C75;">监听端口</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">bind</span><span style="color:#ABB2BF;">((</span><span style="color:#98C379;">&#39;127.0.0.1&#39;</span><span style="color:#ABB2BF;">, 9999))</span></span>
<span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#E06C75;">允许连接数</span></span>
<span class="line"><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">listen</span><span style="color:#ABB2BF;">(5)</span></span>
<span class="line"><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Waiting for connection...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">while</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">接受一个新连接</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">sock</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">addr</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">accept</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">创建新线程来处理TCP连接</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">t</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">threading</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">Thread</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">target</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">tcplink</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;">=(</span><span style="color:#E06C75;">sock</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">addr</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">t</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">start</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>client</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">socket</span></span>
<span class="line"><span style="color:#E06C75;">client</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">AF_INET</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">SOCK_STREAM</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#E06C75;">建立连接</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">client</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">connect</span><span style="color:#ABB2BF;">((</span><span style="color:#98C379;">&#39;127.0.0.1&#39;</span><span style="color:#ABB2BF;">, 9999))</span></span>
<span class="line"><span style="color:#E06C75;">while</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">接收消息</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;server &gt; &#39;</span><span style="color:#ABB2BF;">+</span><span style="color:#E06C75;">client</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">recv</span><span style="color:#ABB2BF;">(1024).</span><span style="color:#E06C75;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">发送数据</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">input</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">not</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">or</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> == </span><span style="color:#98C379;">&#39;exit&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">client</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">client</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">send</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>UDP</strong> <br> server</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">socket</span></span>
<span class="line"><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">AF_INET</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">SOCK_DGRAM</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#E06C75;">监听端口</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">bind</span><span style="color:#ABB2BF;">((</span><span style="color:#98C379;">&#39;127.0.0.1&#39;</span><span style="color:#ABB2BF;">, 9999))</span></span>
<span class="line"><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Bind UDP on 9999...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">while</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">接收数据</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">addr</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">recvfrom</span><span style="color:#ABB2BF;">(1024)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">f</span><span style="color:#98C379;">&#39;{addr[0]}:{addr[1]} &gt; {data}&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">发送数据</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">sendto</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">input</span><span style="color:#ABB2BF;">().</span><span style="color:#E06C75;">encode</span><span style="color:#ABB2BF;">(), </span><span style="color:#E06C75;">addr</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>client</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">socket</span></span>
<span class="line"><span style="color:#E06C75;">client</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">AF_INET</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">socket</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">SOCK_DGRAM</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Please input...&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">while</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">True</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">发送数据</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">input</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">not</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">or</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;"> == </span><span style="color:#98C379;">&#39;exit&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;">client</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">client</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">sendto</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">encode</span><span style="color:#ABB2BF;">(), (</span><span style="color:#98C379;">&#39;127.0.0.1&#39;</span><span style="color:#ABB2BF;">, 9999))</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">接收消息</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;server &gt; &#39;</span><span style="color:#ABB2BF;"> + </span><span style="color:#E06C75;">client</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">recv</span><span style="color:#ABB2BF;">(1024).</span><span style="color:#E06C75;">decode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="smtplib-smtp协议客户端" tabindex="-1">smtplib ---SMTP协议客户端 <a class="header-anchor" href="#smtplib-smtp协议客户端" aria-label="Permalink to &quot;smtplib ---SMTP协议客户端&quot;">​</a></h3><p>class smtplib.SMTP(host=&#39;&#39;, port=0, local_hostname=None, [timeout, ]source_address=None)</p><ul><li>SMTP.set_debuglevel(level)</li><li>SMTP.docmd(cmd, args=&#39;&#39;)</li><li>SMTP.connect(host=&#39;localhost&#39;, port=0)</li><li>SMTP.helo(name=&#39;&#39;)</li><li>SMTP.ehlo(name=&#39;&#39;)</li><li>SMTP.ehlo_or_helo_if_needed()</li><li>SMTP.has_extn(name)</li><li>SMTP.verify(address)</li><li>SMTP.login(user, password, *, initial_response_ok=True)</li><li>SMTP.auth(mechanism, authobject, *, initial_response_ok=True)</li><li>SMTP.starttls(keyfile=None, certfile=None, context=None)</li><li>SMTP.sendmail(from_addr, to_addrs, msg, mail_options=(), rcpt_options=())</li><li>SMTP.send_message(msg, from_addr=None, to_addrs=None, mail_options=(), rcpt_options=())</li><li>SMTP.quit()</li></ul><p>示例</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> smtplib</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> email</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> email.mime.text </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> MIMEText    </span><span style="color:#7F848E;font-style:italic;"># 负责构造文本</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> email.mime.image </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> MIMEImage  </span><span style="color:#7F848E;font-style:italic;"># 负责构造图片</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> email.mime.multipart </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> MIMEMultipart  </span><span style="color:#7F848E;font-style:italic;"># 负责将多个对象集合起来</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> email.header </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> Header</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># SMTP服务器</span></span>
<span class="line"><span style="color:#ABB2BF;">mail_host </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;smtp.163.com&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 发件人邮箱</span></span>
<span class="line"><span style="color:#ABB2BF;">mail_sender </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;******@163.com&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 邮箱授权码</span></span>
<span class="line"><span style="color:#ABB2BF;">mail_license </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;********&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 收件人邮箱</span></span>
<span class="line"><span style="color:#ABB2BF;">mail_receivers </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;******@qq.com&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;******@outlook.com&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">mm </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">MIMEMultipart</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;related&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 邮件头部内容</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 邮件主题</span></span>
<span class="line"><span style="color:#ABB2BF;">subject_content </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;&quot;&quot;Python邮件测试&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置发送者,注意严格遵守格式,里面邮箱为发件人邮箱</span></span>
<span class="line"><span style="color:#ABB2BF;">mm[</span><span style="color:#98C379;">&quot;From&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;sender_name&lt;******@163.com&gt;&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置接受者,注意严格遵守格式,里面邮箱为接受者邮箱</span></span>
<span class="line"><span style="color:#ABB2BF;">mm[</span><span style="color:#98C379;">&quot;To&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;receiver_1_name&lt;******@qq.com&gt;,receiver_2_name&lt;******@outlook.com&gt;&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置邮件主题</span></span>
<span class="line"><span style="color:#ABB2BF;">mm[</span><span style="color:#98C379;">&quot;Subject&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Header</span><span style="color:#ABB2BF;">(subject_content, </span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 邮件正文内容</span></span>
<span class="line"><span style="color:#ABB2BF;">body_content </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;&quot;&quot;你好，这是一个测试邮件！&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 构造文本</span></span>
<span class="line"><span style="color:#ABB2BF;">message_text </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">MIMEText</span><span style="color:#ABB2BF;">(body_content, </span><span style="color:#98C379;">&quot;plain&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;utf-8&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 向MIMEMultipart对象中添加文本对象</span></span>
<span class="line"><span style="color:#ABB2BF;">mm.</span><span style="color:#61AFEF;">attach</span><span style="color:#ABB2BF;">(message_text)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 二进制读取图片</span></span>
<span class="line"><span style="color:#ABB2BF;">image_data </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;a.jpg&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置读取获取的二进制数据</span></span>
<span class="line"><span style="color:#ABB2BF;">message_image </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">MIMEImage</span><span style="color:#ABB2BF;">(image_data.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">image_data.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加图片文件到邮件信息当中去</span></span>
<span class="line"><span style="color:#ABB2BF;">mm.</span><span style="color:#61AFEF;">attach</span><span style="color:#ABB2BF;">(message_image)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 构造附件</span></span>
<span class="line"><span style="color:#ABB2BF;">atta </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">MIMEText</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;sample.xlsx&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">(), </span><span style="color:#98C379;">&#39;base64&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置附件信息</span></span>
<span class="line"><span style="color:#ABB2BF;">atta[</span><span style="color:#98C379;">&quot;Content-Disposition&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;attachment; filename=&quot;sample.xlsx&quot;&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加附件到邮件信息当中去</span></span>
<span class="line"><span style="color:#ABB2BF;">mm.</span><span style="color:#61AFEF;">attach</span><span style="color:#ABB2BF;">(atta)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建SMTP对象</span></span>
<span class="line"><span style="color:#ABB2BF;">stp </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> smtplib.</span><span style="color:#61AFEF;">SMTP</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置发件人邮箱的域名和端口</span></span>
<span class="line"><span style="color:#ABB2BF;">stp.</span><span style="color:#61AFEF;">connect</span><span style="color:#ABB2BF;">(mail_host, </span><span style="color:#D19A66;">25</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 打印出和SMTP服务器交互的所有信息</span></span>
<span class="line"><span style="color:#ABB2BF;">stp.</span><span style="color:#61AFEF;">set_debuglevel</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 登录邮箱</span></span>
<span class="line"><span style="color:#ABB2BF;">stp.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">(mail_sender, mail_license)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 发送邮件</span></span>
<span class="line"><span style="color:#ABB2BF;">stp.</span><span style="color:#61AFEF;">sendmail</span><span style="color:#ABB2BF;">(mail_sender, mail_receivers, mm.</span><span style="color:#61AFEF;">as_string</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;邮件发送成功&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 关闭SMTP对象</span></span>
<span class="line"><span style="color:#ABB2BF;">stp.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> smtplib</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> email.mime.multipart </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> MIMEMultipart</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> email.mime.base </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> MIMEBase</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> email.mime.text </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> MIMEText</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> email.mime.audio </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> MIMEAudio</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> email.mime.image </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> MIMEImage</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> email.encoders </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> encode_base64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">Mail</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">__init__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">user</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">pwd</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">host</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_user </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> user</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_pwd </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> pwd      </span><span style="color:#7F848E;font-style:italic;"># 邮箱授权码</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_server </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> smtplib.</span><span style="color:#61AFEF;">SMTP</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_server.</span><span style="color:#61AFEF;">connect</span><span style="color:#ABB2BF;">(host, </span><span style="color:#D19A66;">25</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_server.</span><span style="color:#61AFEF;">ehlo</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_server.</span><span style="color:#61AFEF;">login</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_user, </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_pwd)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">__del__</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_server.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 发送邮件</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">send_mail</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">recipient</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">subject</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">text</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">=</span><span style="color:#D19A66;">None</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        msg </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">MIMEMultipart</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        msg[</span><span style="color:#98C379;">&quot;From&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_user</span></span>
<span class="line"><span style="color:#ABB2BF;">        msg[</span><span style="color:#98C379;">&quot;Subject&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> subject</span></span>
<span class="line"><span style="color:#ABB2BF;">        msg[</span><span style="color:#98C379;">&quot;To&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;,&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(recipient)</span></span>
<span class="line"><span style="color:#ABB2BF;">        msg.</span><span style="color:#61AFEF;">attach</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">MIMEText</span><span style="color:#ABB2BF;">(text))</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> file_path:</span></span>
<span class="line"><span style="color:#ABB2BF;">            msg.</span><span style="color:#61AFEF;">attach</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get_attachment</span><span style="color:#ABB2BF;">(file_path))</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_server.</span><span style="color:#61AFEF;">sendmail</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.mail_user, recipient, msg.</span><span style="color:#61AFEF;">as_string</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;——邮件发送成功——&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;"># 添加邮件附件</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">get_attachment</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;font-style:italic;">file_path</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        file_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> file_path.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">)[</span><span style="color:#56B6C2;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        attachment </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">MIMEText</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(file_path, </span><span style="color:#98C379;">&#39;rb&#39;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">(), </span><span style="color:#98C379;">&#39;base64&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># attachment[&quot;Content-Type&quot;] = &#39;application/octet-stream&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        attachment[</span><span style="color:#98C379;">&quot;Content-Disposition&quot;</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;attachment; filename=&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> file_name</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> attachment</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    title </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;自动化测试报告&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    file_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;image.jpg&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    content </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;&quot;&quot;你好，这是一个测试邮件！&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">RECIPIENT</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;xxx@outlook.com&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;rain@126.com&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">    mail </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Mail</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;rain@126.com&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;code&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;smtp.126.com&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    mail.</span><span style="color:#61AFEF;">send_mail</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">RECIPIENT</span><span style="color:#ABB2BF;">, title, content, file_path)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="base64-base16-base32-base64-base85-数据编码" tabindex="-1">base64 --- Base16, Base32, Base64, Base85 数据编码 <a class="header-anchor" href="#base64-base16-base32-base64-base85-数据编码" aria-label="Permalink to &quot;base64 --- Base16, Base32, Base64, Base85 数据编码&quot;">​</a></h3><p>一种用64个字符来表示任意二进制数据的方法。</p><ul><li>base64.b64encode(s, altchars=None)</li><li>对 bytes-like object s 进行 Base64 编码，并返回编码后的 bytes</li><li>base64.b64decode(s, altchars=None, validate=False)</li><li>解码 Base64 编码过的 bytes-like object 或 ASCII 字符串 s 并返回解码过的 bytes</li><li>base64.standard_b64encode(s)</li><li>编码 bytes-like object s，使用标准 Base64 字母表并返回编码过的 bytes</li><li>base64.standard_b64decode(s)</li><li>base64.urlsafe_b64encode(s)</li><li>编码 bytes-like object s，使用 URL 与文件系统安全的字母表，使用 - 以及 _ 代替标准 Base64 字母表中的 + 和 /。返回编码过的 bytes。</li><li>base64.urlsafe_b64decode(s)</li><li>base64.b32encode(s)</li><li>用 Base32 编码 bytes-like object s 并返回编码过的 bytes</li><li>base64.b32decode(s, casefold=False, map01=None)</li><li>base64.b16encode(s)</li><li>用 Base16 编码 bytes-like object s 并返回编码过的 bytes</li><li>base64.b16decode(s, casefold=False)¶</li><li>base64.a85encode(b, *, foldspaces=False, wrapcol=0, pad=False, adobe=False)</li><li>用 Ascii85 编码 bytes-like object s 并返回编码过的 bytes</li><li>base64.a85decode(b, *, foldspaces=False, adobe=False, ignorechars=b&#39; \\t\\n\\r\\v&#39;)</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> base64</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> base64.</span><span style="color:#61AFEF;">b64encode</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">b</span><span style="color:#98C379;">&#39;binary</span><span style="color:#56B6C2;">\\x00</span><span style="color:#98C379;">string&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">b</span><span style="color:#98C379;">&#39;YmluYXJ5AHN0cmluZw==&#39;</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> base64.</span><span style="color:#61AFEF;">b64decode</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">b</span><span style="color:#98C379;">&#39;YmluYXJ5AHN0cmluZw==&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">b</span><span style="color:#98C379;">&#39;binary</span><span style="color:#56B6C2;">\\x00</span><span style="color:#98C379;">string&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="开发工具" tabindex="-1">开发工具 <a class="header-anchor" href="#开发工具" aria-label="Permalink to &quot;开发工具&quot;">​</a></h2><h3 id="timeit-测量小代码片段的执行时间" tabindex="-1">timeit --- 测量小代码片段的执行时间 <a class="header-anchor" href="#timeit-测量小代码片段的执行时间" aria-label="Permalink to &quot;timeit --- 测量小代码片段的执行时间&quot;">​</a></h3><p><strong>命令行界面</strong> <br> <strong>python -m timeit [-n N] [-r N] [-u U] [-s S] [-h] [statement ...]</strong></p><ul><li>-n N, --number=N 执行 &#39;语句&#39; 多少次</li><li>-r N, --repeat=N 重复计时器的次数（默认为5）</li><li>-s S, --setup=S 最初要执行一次的语句（默认为 pass ）</li><li>-p, --process 测量进程时间，使用 time.process_time() 而不是 time.perf_counter() ，这是默认值</li><li>-u, --unit=U 指定定时器输出的时间单位；可以选择 nsec，usec，msec或sec</li><li>-v, --verbose 打印原始计时结果；重复更多位数精度</li><li>-h, --help 打印一条简短的使用信息并退出</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">python</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">m</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">timeit</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;&#39;-&#39;.join(map(str, range(100)))&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>API</strong></p><ul><li>timeit.timeit(stmt=&#39;pass&#39;, setup=&#39;pass&#39;, timer=, number=1000000, globals=None)</li><li>timeit.repeat(stmt=&#39;pass&#39;, setup=&#39;pass&#39;, timer=, repeat=5, number=1000000, globals=None)</li><li>timeit.default_timer() 默认的计时器，总是 time.perf_counter() 。</li></ul><p>class timeit.Timer(stmt=&#39;pass&#39;, setup=&#39;pass&#39;, timer=, globals=None) <br> 用于小代码片段的计数执行速度的类</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// 对比使用 hasattr() 与 try/except 的开销来测试缺失与提供对象属性</span></span>
<span class="line"><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">timeit</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; # </span><span style="color:#E06C75;">attribute</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">is</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">missing</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;"> = </span><span style="color:#98C379;">&quot;&quot;&quot;</span><span style="color:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#98C379;">... try</span><span style="color:#FFFFFF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">...     </span><span style="color:#E06C75;">str</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">__bool__</span></span>
<span class="line"><span style="color:#ABB2BF;">... </span><span style="color:#E06C75;">except</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">AttributeError</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">...     </span><span style="color:#E06C75;">pass</span></span>
<span class="line"><span style="color:#ABB2BF;">... </span><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">&gt;&gt;&gt; timeit.timeit(stmt=s, number=100000</span><span style="color:#FFFFFF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">0.9138244460009446</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;"> = </span><span style="color:#98C379;">&quot;if hasattr(str, &#39;__bool__&#39;): pass&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">&gt;&gt;&gt; </span><span style="color:#E06C75;">timeit</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">timeit</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">stmt</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">number</span><span style="color:#ABB2BF;">=100000)</span></span>
<span class="line"><span style="color:#ABB2BF;">0.5829014980008651</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">f</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">x</span><span style="color:#56B6C2;">**</span><span style="color:#D19A66;">2</span></span>
<span class="line"><span style="color:#E06C75;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">g</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">x</span><span style="color:#56B6C2;">**</span><span style="color:#D19A66;">4</span></span>
<span class="line"><span style="color:#E06C75;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">h</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">x</span><span style="color:#56B6C2;">**</span><span style="color:#D19A66;">8</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">timeit</span></span>
<span class="line"><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">timeit</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">timeit</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;[func(42) for func in (f,g,h)]&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">globals</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">globals</span><span style="color:#ABB2BF;">()))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="argparse-命令行选项、参数和子命令解析器" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/argparse.html#module-argparse" target="_blank" rel="noreferrer">argparse</a> --- 命令行选项、参数和子命令解析器 <a class="header-anchor" href="#argparse-命令行选项、参数和子命令解析器" aria-label="Permalink to &quot;[argparse](https://docs.python.org/zh-cn/3/library/argparse.html#module-argparse) --- 命令行选项、参数和子命令解析器&quot;">​</a></h3><p>class <strong>argparse.ArgumentParser</strong>(prog=None, usage=None, description=None, epilog=None, parents=[], formatter_class=argparse.HelpFormatter, prefix_chars=&#39;-&#39;, fromfile_prefix_chars=None, argument_default=None, conflict_handler=&#39;error&#39;, add_help=True, allow_abbrev=True, exit_on_error=True)</p><ul><li>prog - 程序的名称（默认：sys.argv[0]）</li><li>usage - 描述程序用途的字符串（默认值：从添加到解析器的参数生成）</li><li>description - 在参数帮助文档之前显示的文本</li><li>epilog - 在参数帮助文档之后显示的文本</li><li>parents - 一个 ArgumentParser 对象的列表，它们的参数也应包含在内</li><li>formatter_class - 用于自定义帮助文档输出格式的类</li><li>prefix_chars - 可选参数的前缀字符集合（默认值：&#39;-&#39;）</li><li>fromfile_prefix_chars - 当需要从文件中读取其他参数时，用于标识文件名的前缀字符集合</li><li>argument_default - 参数的全局默认值</li><li>conflict_handler - 解决冲突选项的策略</li><li>add_help - 为解析器添加一个 -h/--help 选项（默认值： True）</li><li>allow_abbrev - 如果缩写是无歧义的，则允许缩写长选项 （默认值：True）</li><li>exit_on_error - 决定当错误发生时是否让 ArgumentParser 附带错误信息退出。 (默认值: True)</li></ul><p>ArgumentParser.add_argument(name or flags...[, action][, nargs][, const][, default][, type][, choices][, required][, help][, metavar][, dest])</p><ul><li>name or flags - 一个命名或者一个选项字符串的列表，例如 foo 或 -f, --foo。</li><li>action - 当参数在命令行中出现时使用的动作基本类型。</li><li>nargs - 命令行参数应当消耗的数目。</li><li>const - 被一些 action 和 nargs 选择所需求的常数。</li><li>default - 当参数未在命令行中出现时使用的值。</li><li>type - 命令行参数应当被转换成的类型。</li><li>choices - 可用的参数的容器。</li><li>required - 此命令行选项是否可省略</li><li>help - 一个此选项作用的简单描述。</li><li>metavar - 在使用方法消息中使用的参数值示例。</li><li>dest - 被添加到 parse_args() 所返回对象上的属性名。</li></ul><p>class** argparse.Action**(option_strings, dest, nargs=None, const=None, default=None, type=None, choices=None, required=False, help=None, metavar=None)</p><p>ArgumentParser.parse_args(args=None, namespace=None) 将参数字符串转换为对象并将其设为命名空间的属性。 <br> ArgumentParser.add_subparsers([title][, description][, prog][, parser_class][, action][, option_string][, dest][, required][, help][, metavar]) 创建子命令 <br> ArgumentParser.add_argument_group(title=None, description=None) 创建适当的分组 <br> ArgumentParser.add_mutually_exclusive_group(required=False) 创建一个互斥组 <br> ArgumentParser.set_defaults(**kwargs) 解析器默认值</p><p>class argparse.FileType(mode=&#39;r&#39;, bufsize=-1, encoding=None, errors=None)</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">argparse</span></span>
<span class="line"><span style="color:#E06C75;">parser</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">argparse</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">ArgumentParser</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">description</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;calculate X to the power of Y&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">group</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">parser</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">add_mutually_exclusive_group</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;">group</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-v&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;--verbose&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">action</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;store_true&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">group</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;-q&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;--quiet&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">action</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;store_true&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">parser</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;x&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">type</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">int</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">help</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;the base&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">parser</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;y&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">type</span><span style="color:#ABB2BF;">=</span><span style="color:#E06C75;">int</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">help</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;the exponent&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">parser</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">parse_args</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;">answer</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">x</span><span style="color:#D19A66;">**</span><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">y</span></span>
<span class="line"><span style="color:#E06C75;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">quiet</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">answer</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">elif</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">verbose</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;{} to the power {} equals {}&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">y</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">answer</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#E06C75;">else</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;{}^{} == {}&quot;</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">format</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">args</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">y</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">answer</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#ABB2BF;">---</span></span>
<span class="line"><span style="color:#E06C75;">$</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">python3</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">prog</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">py</span><span style="color:#ABB2BF;"> --</span><span style="color:#E06C75;">help</span></span>
<span class="line"><span style="color:#E06C75;">usage</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">prog</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">py</span><span style="color:#ABB2BF;"> [-</span><span style="color:#E06C75;">h</span><span style="color:#ABB2BF;">] [-</span><span style="color:#E06C75;">v</span><span style="color:#ABB2BF;"> | -</span><span style="color:#E06C75;">q</span><span style="color:#ABB2BF;">] </span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">y</span></span>
<span class="line"><span style="color:#E06C75;">calculate</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">X</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">to</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">power</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">of</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">Y</span></span>
<span class="line"><span style="color:#E06C75;">positional</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">arguments</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">x</span><span style="color:#ABB2BF;">              </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">base</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#E06C75;">y</span><span style="color:#ABB2BF;">              </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">exponent</span></span>
<span class="line"><span style="color:#E06C75;">optional</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">arguments</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  -</span><span style="color:#E06C75;">h</span><span style="color:#ABB2BF;">, --</span><span style="color:#E06C75;">help</span><span style="color:#ABB2BF;">     </span><span style="color:#E06C75;">show</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">this</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">help</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">message</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">and</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">exit</span></span>
<span class="line"><span style="color:#ABB2BF;">  -</span><span style="color:#E06C75;">v</span><span style="color:#ABB2BF;">, --</span><span style="color:#E06C75;">verbose</span></span>
<span class="line"><span style="color:#ABB2BF;">  -</span><span style="color:#E06C75;">q</span><span style="color:#ABB2BF;">, --</span><span style="color:#E06C75;">quiet</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="logging-python-的日志记录工具" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/logging.html" target="_blank" rel="noreferrer">logging--- Python 的日志记录工具</a> <a class="header-anchor" href="#logging-python-的日志记录工具" aria-label="Permalink to &quot;[logging--- Python 的日志记录工具](https://docs.python.org/zh-cn/3/library/logging.html)&quot;">​</a></h3><p>日志级别</p><table><thead><tr><th>级别</th><th>何时使用</th><th>数值</th></tr></thead><tbody><tr><td>NOTSET</td><td></td><td>0</td></tr><tr><td>DEBUG</td><td>细节信息，仅当诊断问题时适用。</td><td>10</td></tr><tr><td>INFO</td><td>确认程序按预期运行</td><td>20</td></tr><tr><td>WARNING</td><td>表明有已经或即将发生的意外（如：磁盘空间不足）。程序仍按预期进行</td><td>30</td></tr><tr><td>ERROR</td><td>由于严重的问题，程序的某些功能已经不能正常执行</td><td>40</td></tr><tr><td>CRITICAL</td><td>严重的错误，表明程序已不能继续执行</td><td>50</td></tr></tbody></table><p>LogRecord 属性</p><table><thead><tr><th>属性名称</th><th>格式</th><th>描述</th></tr></thead><tbody><tr><td>args</td><td>不需要格式化。</td><td>合并到 msg 以产生 message 的包含参数的元组，或是其中的值将被用于合并的字典</td></tr><tr><td>asctime</td><td>%(asctime)s</td><td>表示 <a href="https://docs.python.org/zh-cn/3/library/logging.html#logging.LogRecord" target="_blank" rel="noreferrer">LogRecord </a>何时被创建的供人查看时间值。 默认形式为 &#39;2003-07-08 16:49:45,896&#39; (逗号之后为毫秒)。</td></tr><tr><td>created</td><td>%(created)f</td><td><a href="https://docs.python.org/zh-cn/3/library/logging.html#logging.LogRecord" target="_blank" rel="noreferrer">LogRecord </a>被创建的时间（即 time.time() 的返回值）。</td></tr><tr><td>exc_info</td><td>不需要格式化。</td><td>异常元组 (例如 sys.exc_info) 或  None</td></tr><tr><td>文件名</td><td>%(filename)s</td><td>pathname 的文件名部分。</td></tr><tr><td>funcName</td><td>%(funcName)s</td><td>函数名包括调用日志记录.</td></tr><tr><td>levelname</td><td>%(levelname)s</td><td>消息文本记录级别 (&#39;DEBUG&#39;, &#39;INFO&#39;, &#39;WARNING&#39;, &#39;ERROR&#39;, &#39;CRITICAL&#39;).</td></tr><tr><td>levelno</td><td>%(levelno)s</td><td>消息数字记录级别 (DEBUG, INFO, WARNING, ERROR, CRITICAL).</td></tr><tr><td>lineno</td><td>%(lineno)d</td><td>发出日志记录调用所在的源行号（如果可用）。</td></tr><tr><td>message</td><td>%(message)s</td><td>记入日志的消息，即 msg % args 的结果</td></tr><tr><td>module</td><td>%(module)s</td><td>模块 (filename 的名称部分)。</td></tr><tr><td>msecs</td><td>%(msecs)d</td><td><a href="https://docs.python.org/zh-cn/3/library/logging.html#logging.LogRecord" target="_blank" rel="noreferrer">LogRecord </a>被创建的时间的毫秒部分。</td></tr><tr><td>msg</td><td>不需要格式化。</td><td>在原始日志记录调用中传入的格式字符串</td></tr><tr><td>名称</td><td>%(name)s</td><td>用于记录调用的日志记录器名称。</td></tr><tr><td>pathname</td><td>%(pathname)s</td><td>发出日志记录调用的源文件的完整路径名</td></tr><tr><td>process</td><td>%(process)d</td><td>进程ID（如果可用）</td></tr><tr><td>processName</td><td>%(processName)s</td><td>进程名（如果可用）</td></tr><tr><td>relativeCreated</td><td>%(relativeCreated)d</td><td>以毫秒数表示的 LogRecord 被创建的时间，即相对于 logging 模块被加载时间的差值。</td></tr><tr><td>stack_info</td><td>不需要格式化。</td><td>当前线程中从堆栈底部起向上直到包括日志记录调用并导致创建此记录的堆栈帧的堆栈帧信息（如果可用）。</td></tr><tr><td>thread</td><td>%(thread)d</td><td>线程ID（如果可用）</td></tr><tr><td>threadName</td><td>%(threadName)s</td><td>线程名（如果可用）</td></tr></tbody></table><p>**class logging.Logger **记录器 <br> propagate 记录到这个记录器的事件除了会发送到此记录器的所有处理程序外，还会传递给更高级别（祖先）记录器的处理器</p><ul><li>setLevel(level)：给记录器设置阈值</li><li>isEnabledFor(level)指示此记录器是否将处理级别为 level 的消息</li><li>getEffectiveLevel()：指示此记录器的有效级别</li><li>getChild(suffix)：返回由后缀确定的，是该记录器的后代的记录器</li><li>debug(msg, *args, **kwargs)：在此纪录器上记录 DEBUG 级别的消息</li><li>info(msg, *args, **kwargs)：在此记录器上记录 INFO 级别的消息</li><li>warning(msg, *args, **kwargs)：在此记录器上记录 WARNING 级别的消息</li><li>error(msg, *args, **kwargs)：在此记录器上记录 ERROR 级别的消息</li><li>critical(msg, *args, **kwargs)：在此记录器上记录 CRITICAL 级别的消息</li><li>log(level, msg, *args, **kwargs)：在此记录器上记录 level 整数代表的级别的消息</li><li>exception(msg, *args, **kwargs)：在此记录器上记录 ERROR 级别的消息。</li><li>addFilter(filter)：将指定的过滤器 filter 添加到此记录器。</li><li>removeFilter(filter)：从此记录器中删除指定的过滤器 filter。</li><li>filter(record)：将此记录器的过滤器应用于记录，如果记录能被处理则返回 True。</li><li>addHandler(hdlr)：将指定的处理器 hdlr 添加到此记录器。</li><li>removeHandler(hdlr)：从此记录器中删除指定的处理器 hdlr。</li><li>findCaller(stack_info=False, stacklevel=1)：查找调用源的文件名和行号，以 文件名，行号，函数名称和堆栈信息 4元素元组的形式返回。</li><li>handle(record)：通过将记录传递给与此记录器及其祖先关联的所有处理器来处理</li><li>makeRecord(name, level, fn, lno, msg, args, exc_info, func=None, extra=None, sinfo=None)：这是一种工厂方法，可以在子类中对其进行重写以创建专门的 LogRecord 实例。</li><li>hasHandlers()：检查此记录器是否配置了任何处理器。</li></ul><p><strong>class logging.Handler</strong> 处理器</p><ul><li><strong>init</strong>(level=NOTSET)：初始化 Handler 实例时，将过滤列表置为空，并且创建锁来序列化对 I/O 的访问</li><li>createLock()：初始化一个线程锁，用来序列化对底层的 I/O 功能的访问</li><li>acquire()：使用 createLock() 获取线程锁</li><li>release()：使用 acquire() 来释放线程锁</li><li>setLevel(level)：给处理器设置阈值为 level 。日志级别小于 level 将被忽略</li><li>setFormatter(fmt)：将此处理器的 Formatter 设置为 fmt</li><li>addFilter(filter)：将指定的过滤器 filter 添加到此处理器</li><li>removeFilter(filter)：从此处理器中删除指定的过滤器 filter</li><li>filter(record)：将此处理器的过滤器应用于记录，在要处理记录时返回 True</li><li>flush()：确保所有日志记录从缓存输出</li><li>close()：整理处理器使用的所有资源</li><li>handle(record)：经已添加到处理器的过滤器过滤后，有条件地发出指定的日志记录</li><li>handleError(record)：调用 emit() 期间遇到异常时，应从处理器中调用此方法</li><li>format(record)：设置了格式器则用其对记录进行格式化</li><li>emit(record)：执行实际记录给定日志记录所需的操作</li></ul><p><strong>class logging.Formatter(fmt=None, datefmt=None, style=&#39;%&#39;)</strong> <br> 格式器——将 <a href="https://docs.python.org/zh-cn/3/library/logging.html#logging.LogRecord" target="_blank" rel="noreferrer">LogRecord</a> 转换为可由人或外部系统解释的字符串</p><ul><li>format(record)：记录的属性字典用作字符串格式化操作的参数。</li><li>formatTime(record, datefmt=None)：由想要使用格式化时间的格式器中的 format() 调用</li><li>formatException(exc_info)：将指定的异常信息（由 sys.exc_info() 返回的标准异常元组）格式化为字符串。</li><li>formatStack(stack_info)：将指定的堆栈信息格式化为字符串</li></ul><p><strong>class logging.Filter(name=&#39;&#39;) 过滤器被 Handlers 和 Loggers 用来实现比按层级提供更复杂的过滤操作</strong> <br> <a href="https://docs.python.org/zh-cn/3/library/logging.handlers.html#module-logging.handlers" target="_blank" rel="noreferrer">logging.handlers</a></p><ul><li>class logging.StreamHandler(stream=None)</li><li>class logging.FileHandler(filename, mode=&#39;a&#39;, encoding=None, delay=False)</li><li>HTTPHandler</li></ul><p><a href="https://docs.python.org/zh-cn/3/library/logging.config.html#module-logging.config" target="_blank" rel="noreferrer">logging.config</a></p><ul><li>logging.config.dictConfig(config)</li><li>logging.config.fileConfig(fname, defaults=None, disable_existing_loggers=True)</li><li>logging.config.listen(port=DEFAULT_LOGGING_CONFIG_PORT, verify=None)：在指定的端口上启动套接字服务器，并监听新的配置</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> logging</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">from</span><span style="color:#ABB2BF;"> logging </span><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> StreamHandler,Formatter,FileHandler</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">new_logger</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;font-style:italic;">name</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">#创建日志记录器</span></span>
<span class="line"><span style="color:#ABB2BF;">    logger </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> logging.</span><span style="color:#61AFEF;">getLogger</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">name</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">name)</span></span>
<span class="line"><span style="color:#ABB2BF;">    logger.</span><span style="color:#61AFEF;">setLevel</span><span style="color:#ABB2BF;">(logging.</span><span style="color:#D19A66;">DEBUG</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">#创建日志处理器</span></span>
<span class="line"><span style="color:#ABB2BF;">    handler </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">StreamHandler</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    handler.</span><span style="color:#61AFEF;">setLevel</span><span style="color:#ABB2BF;">(logging.</span><span style="color:#D19A66;">INFO</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">#设置处理器的日志格式化</span></span>
<span class="line"><span style="color:#ABB2BF;">    formatter </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">Formatter</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">fmt</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;[ </span><span style="color:#D19A66;">%(asctime)s</span><span style="color:#98C379;"> of </span><span style="color:#D19A66;">%(name)s</span><span style="color:#98C379;"> - </span><span style="color:#D19A66;">%(levelname)s</span><span style="color:#98C379;"> ] </span><span style="color:#D19A66;">%(message)s</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;font-style:italic;">datefmt</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    handler.</span><span style="color:#61AFEF;">setFormatter</span><span style="color:#ABB2BF;">(formatter)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">#添加记录器的处理器</span></span>
<span class="line"><span style="color:#ABB2BF;">    logger.</span><span style="color:#61AFEF;">addHandler</span><span style="color:#ABB2BF;">(handler)</span></span>
<span class="line"><span style="color:#ABB2BF;">    fileHandler </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">FileHandler</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;access.log&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">encoding</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    fileHandler.</span><span style="color:#61AFEF;">setLevel</span><span style="color:#ABB2BF;">(logging.</span><span style="color:#D19A66;">DEBUG</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    fileHandler.</span><span style="color:#61AFEF;">setFormatter</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">Formatter</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#98C379;">&#39;&lt; </span><span style="color:#D19A66;">%(asctime)s</span><span style="color:#98C379;"> &gt; at </span><span style="color:#D19A66;">%(lineno)s</span><span style="color:#98C379;"> of </span><span style="color:#D19A66;">%(name)s</span><span style="color:#98C379;">: </span><span style="color:#D19A66;">%(message)s</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#98C379;">&#39;%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H:%M:%S&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">    logger.</span><span style="color:#61AFEF;">addHandler</span><span style="color:#ABB2BF;">(fileHandler)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> logger</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    logger </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">new_logger</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;spider&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    logger.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;logging information&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    logger.</span><span style="color:#61AFEF;">debug</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;logging debug&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#98C379;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#98C379;">日志格式化中的扩展字</span><span style="color:#FFFFFF;">段</span></span>
<span class="line"><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">%</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">扩展字段名</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">s</span></span>
<span class="line"><span style="color:#ABB2BF;">– </span><span style="color:#E5C07B;">logger</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">msg</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">extra</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#98C379;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#98C379;">import loggin</span><span style="color:#FFFFFF;">g</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">init_logger</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    #</span><span style="color:#E06C75;">配置</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">root</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">记录器的基本信息</span><span style="color:#ABB2BF;">（</span><span style="color:#E06C75;">格式化</span><span style="color:#ABB2BF;">、</span><span style="color:#E06C75;">处理器</span><span style="color:#ABB2BF;">）</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">logging</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">basicConfig</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">format</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;&lt; %(asctime)s &gt; of %(user_id)s at %(pathname)s </span><span style="color:#56B6C2;">\\</span></span>
<span class="line"><span style="color:#98C379;">                                %(lineno)s line: %(message)s&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                        </span><span style="color:#E06C75;">datefmt</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;%Y-%m-%d %H:%M:%S&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">                        </span><span style="color:#E06C75;">level</span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;">logging</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">INFO</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">__name__</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">==</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;__main__&#39;</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">init_logger</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">以root</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">logger记录信息</span></span>
<span class="line"><span style="color:#ABB2BF;">    # </span><span style="color:#E06C75;">logger</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;">logging</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getLogger</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">logging</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;hi, info!&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">extra</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&#39;user_id&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;19&#39;</span><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">logging</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">warning</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;logging warning!&#39;</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">extra</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">{</span><span style="color:#98C379;">&#39;user_id&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;20&#39;</span><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="unittest-单元测试框架" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/unittest.html" target="_blank" rel="noreferrer">unittest--- 单元测试框架</a> <a class="header-anchor" href="#unittest-单元测试框架" aria-label="Permalink to &quot;[unittest--- 单元测试框架](https://docs.python.org/zh-cn/3/library/unittest.html)&quot;">​</a></h3><p>继承 <a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase" target="_blank" rel="noreferrer">unittest.TestCase</a> 就创建了一个测试样例 <br> 方法的命名都以 test 开头</p><ul><li>test fixture：测试夹具，初始化和清理测试数据及环境 <ul><li>测试前置（setUp）</li><li>清理（tearDown）</li></ul></li><li>test case 测试用例</li><li>test suite 测试套件：把需要一起执行的用例组合到一起</li><li>test runner：运行用例并返回结果</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#7F848E;font-style:italic;">#测试方法</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">MyTestCase</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">unittest</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">TestCase</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">setUp</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">pass</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">tearDown</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">pass</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#测试类</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">MyTestCase</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">unittest</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">TestCase</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#61AFEF;">    @</span><span style="color:#56B6C2;">classmethod</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">setUpClass</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">cls</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">pass</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;">    @</span><span style="color:#56B6C2;">classmethod</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">tearDownClass</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">cls</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">pass</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#测试模块</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">setUpModule</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">pass</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">tearDownModule</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">pass</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>断言</p><table><thead><tr><th>Method</th><th>Checks that</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertEqual" target="_blank" rel="noreferrer">assertEqual(a, b)</a></td><td>a == b</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertNotEqual" target="_blank" rel="noreferrer">assertNotEqual(a, b)</a></td><td>a != b</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertTrue" target="_blank" rel="noreferrer">assertTrue(x)</a></td><td>bool(x) is True</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertFalse" target="_blank" rel="noreferrer">assertFalse(x)</a></td><td>bool(x) is False</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertIs" target="_blank" rel="noreferrer">assertIs(a, b)</a></td><td>a is b</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertIsNot" target="_blank" rel="noreferrer">assertIsNot(a, b)</a></td><td>a is not b</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertIsNone" target="_blank" rel="noreferrer">assertIsNone(x)</a></td><td>x is None</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertIsNotNone" target="_blank" rel="noreferrer">assertIsNotNone(x)</a></td><td>x is not None</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertIn" target="_blank" rel="noreferrer">assertIn(a, b)</a></td><td>a in b</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertNotIn" target="_blank" rel="noreferrer">assertNotIn(a, b)</a></td><td>a not in b</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertIsInstance" target="_blank" rel="noreferrer">assertIsInstance(a, b)</a></td><td>isinstance(a, b)</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3/library/unittest.html#unittest.TestCase.assertNotIsInstance" target="_blank" rel="noreferrer">assertNotIsInstance(a, b)</a></td><td>not isinstance(a, b)</td></tr></tbody></table><ul><li>通过 skip 装饰器或 SkipTest 直接跳过测试</li><li>通过 skipIf 或 skipUnless 按条件跳过或不跳过测试</li><li>通过 expectedFailure 预计测试失败</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">MyTestCase</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">unittest</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">TestCase</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#61AFEF;">    @unittest</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">skip</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;直接跳过&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_nothing</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">fail</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;shouldn&#39;t happen&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#61AFEF;">    @unittest</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">skipIf</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">mylib</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">__version__</span><span style="color:#61AFEF;"> </span><span style="color:#56B6C2;">&lt;</span><span style="color:#61AFEF;"> </span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">,</span><span style="color:#61AFEF;"> </span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#61AFEF;">                     </span><span style="color:#98C379;">&quot;满足条件跳过&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_format</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># Tests that work for only a certain version of the library.</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">pass</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#61AFEF;">    @unittest</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">skipUnless</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">sys</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">platform</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">startswith</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;win&quot;</span><span style="color:#ABB2BF;">),</span><span style="color:#61AFEF;"> </span><span style="color:#98C379;">&quot;满足条件不跳过&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_windows_support</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># windows specific testing code</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">pass</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_maybe_skipped</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;font-style:italic;">not</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">external_resource_available</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">skipTest</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;跳过&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># test code that depends on the external resource</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">pass</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#61AFEF;">    @unittest</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">expectedFailure</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_fail</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">assertEqual</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;这个目前是失败的&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>class unittest.TestSuite(tests=())</p><ul><li>addTest(test)</li><li>addTests(tests)</li><li>run(result)</li><li>debug()</li><li>countTestCases()</li></ul><p>class unittest.TestLoader</p><p>生成HTMLTestRunner测试报告</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> HTMLTestRunner</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> unittest,time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">TestStringMethods</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">unittest</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">TestCase</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">setUp</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;== setUp ==&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">tearDown</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;== tearDown ==&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_upper</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&#39;测试大写&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">assertEqual</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;foo&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">upper</span><span style="color:#ABB2BF;">(), </span><span style="color:#98C379;">&#39;FOO&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_isupper</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&#39;测试大写判断&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">assertTrue</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;FOO&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isupper</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">assertFalse</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Foo&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isupper</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">test_split</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;font-style:italic;">self</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&#39;测试字符分割&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        s </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;hello world&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">assertEqual</span><span style="color:#ABB2BF;">(s.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(), [</span><span style="color:#98C379;">&#39;hello&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;world&#39;</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#7F848E;font-style:italic;"># check that s.split fails when the separator is not a string</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">assertRaises</span><span style="color:#ABB2BF;">(TypeError):</span></span>
<span class="line"><span style="color:#ABB2BF;">            s.</span><span style="color:#61AFEF;">split</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span></span>
<span class="line"><span style="color:#ABB2BF;">suite</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">unittest.</span><span style="color:#61AFEF;">TestSuite</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">suite.</span><span style="color:#61AFEF;">addTest</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">TestStringMethods</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;test_upper&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">suite.</span><span style="color:#61AFEF;">addTest</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">TestStringMethods</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;test_isupper&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">suite.</span><span style="color:#61AFEF;">addTest</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">TestStringMethods</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;test_split&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">now </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> time.</span><span style="color:#61AFEF;">strftime</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;%Y-%m-</span><span style="color:#D19A66;">%d</span><span style="color:#98C379;"> %H_%M_%S&quot;</span><span style="color:#ABB2BF;">,time.</span><span style="color:#61AFEF;">localtime</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">filename </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> now</span><span style="color:#56B6C2;">+</span><span style="color:#98C379;">&#39;_result.html&#39;</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">open</span><span style="color:#ABB2BF;">(filename,</span><span style="color:#98C379;">&#39;wb&#39;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> fp:</span></span>
<span class="line"><span style="color:#ABB2BF;">    runner </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> HTMLTestRunner.</span><span style="color:#61AFEF;">HTMLTestRunner</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;font-style:italic;">stream</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">fp,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;font-style:italic;">title</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&#39;搜索功能测试报告&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E06C75;font-style:italic;">description</span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;">u</span><span style="color:#98C379;">&#39;用例执行情况：&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    runner.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(suite)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="pydoc-文档生成器和在线帮助系统" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/pydoc.html#module-pydoc" target="_blank" rel="noreferrer">pydoc</a> --- 文档生成器和在线帮助系统 <a class="header-anchor" href="#pydoc-文档生成器和在线帮助系统" aria-label="Permalink to &quot;[pydoc](https://docs.python.org/zh-cn/3/library/pydoc.html#module-pydoc) --- 文档生成器和在线帮助系统&quot;">​</a></h3><ul><li>python -m pydoc 模块名：在控制台查看指定模块的说明性文档</li><li>python -m pydoc -w 模块名：生成 HTML 帮助文档</li><li>查看当前操作系统中所有 Python 模块的 HTML 文档信息 <ul><li>python -m pydoc -p 端口号</li><li>python -m pydoc -b</li></ul></li><li>python -m pydoc -k 模块名：查找模块</li></ul><h3 id="doctest-测试交互性的python示例" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/doctest.html#module-doctest" target="_blank" rel="noreferrer">doctest</a> --- 测试交互性的Python示例 <a class="header-anchor" href="#doctest-测试交互性的python示例" aria-label="Permalink to &quot;[doctest](https://docs.python.org/zh-cn/3/library/doctest.html#module-doctest) --- 测试交互性的Python示例&quot;">​</a></h3><p>寻找像Python交互式(&gt;&gt;&gt;)代码的文本，然后执行这些代码来确保它们的确就像展示的那样正确运行</p><ul><li>doctest.testfile(filename, module_relative=True, name=None, package=None, globs=None, verbose=None, report=True, optionflags=0, extraglobs=None, raise_on_error=False, parser=DocTestParser(), encoding=None)</li><li>doctest.testmod(m=None, name=None, globs=None, verbose=None, report=True, optionflags=0, extraglobs=None, raise_on_error=False, exclude_empty=False)</li><li>doctest.run_docstring_examples(f, globs, verbose=False, name=&quot;NoName&quot;, compileflags=None, optionflags=0)</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">display</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">add</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#98C379;">    这是一个函</span><span style="color:#FFFFFF;">数</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">display</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;http://c.biancheng.net/python/&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    http:</span><span style="color:#7F848E;font-style:italic;">//c.biancheng.net/python/</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">&gt;&gt;&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">display</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;http://c.biancheng.net/java/&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    http:</span><span style="color:#7F848E;font-style:italic;">//c.biancheng.net/java/</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#98C379;">&#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#98C379;">    print(add</span><span style="color:#FFFFFF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#ABB2BF;">   </span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">my_cla</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    &#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">这是一个类</span></span>
<span class="line"><span style="color:#ABB2BF;">    &gt;&gt;&gt; </span><span style="color:#E5C07B;">myClass</span><span style="color:#ABB2BF;"> = </span><span style="color:#E5C07B;">my_cla</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    &gt;&gt;&gt; </span><span style="color:#E5C07B;">myClass</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">say</span><span style="color:#ABB2BF;">(&quot;</span><span style="color:#E5C07B;">http</span><span style="color:#ABB2BF;">:</span><span style="color:#7F848E;font-style:italic;">//c.biancheng.net/shell/&quot;)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">http</span><span style="color:#ABB2BF;">:</span><span style="color:#7F848E;font-style:italic;">//c.biancheng.net/shell/</span></span>
<span class="line"><span style="color:#ABB2BF;">    &gt;&gt;&gt; </span><span style="color:#E5C07B;">myClass</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">say</span><span style="color:#ABB2BF;">(&quot;</span><span style="color:#E5C07B;">http</span><span style="color:#ABB2BF;">:</span><span style="color:#7F848E;font-style:italic;">//c.biancheng.net&quot;)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">abc</span></span>
<span class="line"><span style="color:#ABB2BF;">    &#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">say</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">self</span><span style="color:#ABB2BF;">,</span><span style="color:#E5C07B;">add</span><span style="color:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#ABB2BF;">        &#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">这是一个类实例方法</span></span>
<span class="line"><span style="color:#ABB2BF;">        &#39;&#39;&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#E5C07B;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">add</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#E5C07B;">if</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">__name__</span><span style="color:#ABB2BF;"> == &quot;</span><span style="color:#E5C07B;">__main__</span><span style="color:#ABB2BF;">&quot;:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">doctest</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">doctest</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">testmod</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>CLI</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">python</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">example</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">py</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">v</span></span>
<span class="line"><span style="color:#E06C75;">或</span></span>
<span class="line"><span style="color:#E06C75;">python</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">m</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">doctest</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">v</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">example</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="ctypes-外部函数库" tabindex="-1"><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#module-ctypes" target="_blank" rel="noreferrer">ctypes</a> --- 外部函数库 <a class="header-anchor" href="#ctypes-外部函数库" aria-label="Permalink to &quot;[ctypes](https://docs.python.org/zh-cn/3.9/library/ctypes.html#module-ctypes) --- 外部函数库&quot;">​</a></h3><table><thead><tr><th>ctypes 类型</th><th>C 类型</th><th>Python 数据类型</th></tr></thead><tbody><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_bool" target="_blank" rel="noreferrer">c_bool</a></td><td>_Bool</td><td>bool (1)</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_char" target="_blank" rel="noreferrer">c_char</a></td><td>char</td><td>单字符字节串对象</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_wchar" target="_blank" rel="noreferrer">c_wchar</a></td><td>wchar_t</td><td>单字符字符串</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_byte" target="_blank" rel="noreferrer">c_byte</a></td><td>char</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_ubyte" target="_blank" rel="noreferrer">c_ubyte</a></td><td>unsigned char</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_short" target="_blank" rel="noreferrer">c_short</a></td><td>short</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_ushort" target="_blank" rel="noreferrer">c_ushort</a></td><td>unsigned short</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_int" target="_blank" rel="noreferrer">c_int</a></td><td>int</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_uint" target="_blank" rel="noreferrer">c_uint</a></td><td>unsigned int</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_long" target="_blank" rel="noreferrer">c_long</a></td><td>long</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_ulong" target="_blank" rel="noreferrer">c_ulong</a></td><td>unsigned long</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_longlong" target="_blank" rel="noreferrer">c_longlong</a></td><td>__int64 或 long long</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_ulonglong" target="_blank" rel="noreferrer">c_ulonglong</a></td><td>unsigned __int64 或 unsigned long long</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_size_t" target="_blank" rel="noreferrer">c_size_t</a></td><td>size_t</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_ssize_t" target="_blank" rel="noreferrer">c_ssize_t</a></td><td>ssize_t 或 Py_ssize_t</td><td>int</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_float" target="_blank" rel="noreferrer">c_float</a></td><td>float</td><td>float</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_double" target="_blank" rel="noreferrer">c_double</a></td><td>double</td><td>float</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_longdouble" target="_blank" rel="noreferrer">c_longdouble</a></td><td>long double</td><td>float</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_char_p" target="_blank" rel="noreferrer">c_char_p</a></td><td>char * (NUL terminated)</td><td>字节串对象或 None</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_wchar_p" target="_blank" rel="noreferrer">c_wchar_p</a></td><td>wchar_t * (NUL terminated)</td><td>字符串或 None</td></tr><tr><td><a href="https://docs.python.org/zh-cn/3.9/library/ctypes.html#ctypes.c_void_p" target="_blank" rel="noreferrer">c_void_p</a></td><td>void *</td><td>int 或 None</td></tr></tbody></table><p>class ctypes.CDLL(name, mode=DEFAULT_MODE, handle=None, use_errno=False, use_last_error=False, winmode=0) <br> 此类的实例即已加载的动态链接库</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">gcc</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">原文件名</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">c</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">shared</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">o</span><span style="color:#ABB2BF;"> </span><span style="color:#E5C07B;">新文件名</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">so</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#E06C75;">from</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">ctypes</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">*</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#E06C75;">load</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">the</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">shared</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">object</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">file</span></span>
<span class="line"><span style="color:#E06C75;">adder</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">CDLL</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;./adder.so&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">res_int</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">adder</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">add_int</span><span style="color:#ABB2BF;">(4, 5)</span></span>
<span class="line"><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Sum of 4 and 5 = &quot;</span><span style="color:#ABB2BF;"> + </span><span style="color:#E06C75;">str</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">res_int</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">c_float</span><span style="color:#ABB2BF;">(5.5)</span></span>
<span class="line"><span style="color:#E06C75;">b</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">c_float</span><span style="color:#ABB2BF;">(4.1)</span></span>
<span class="line"><span style="color:#E06C75;">add_float</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">adder</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">add_float</span></span>
<span class="line"><span style="color:#E06C75;">add_float</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">restype</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">c_float</span></span>
<span class="line"><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">( </span><span style="color:#98C379;">&quot;Sum of 5.5 and 4.1 = &quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">str</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">add_float</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">a</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">b</span><span style="color:#ABB2BF;">)))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="加密" tabindex="-1">加密 <a class="header-anchor" href="#加密" aria-label="Permalink to &quot;加密&quot;">​</a></h2><h3 id="hashlib-安全哈希与消息摘要" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/hashlib.html#module-hashlib" target="_blank" rel="noreferrer">hashlib</a> --- 安全哈希与消息摘要 <a class="header-anchor" href="#hashlib-安全哈希与消息摘要" aria-label="Permalink to &quot;[hashlib](https://docs.python.org/zh-cn/3/library/hashlib.html#module-hashlib) --- 安全哈希与消息摘要&quot;">​</a></h3><ul><li>hashlib.algorithms_available</li><li>hash.digest_size 以字节表示的结果哈希对象的大小。</li><li>hash.block_size 以字节表示的哈希算法的内部块大小。</li><li>hash.update(data)：用 bytes-like object 来更新哈希对象</li><li>hash.digest()：返回当前已传给 update() 方法的数据摘要</li><li>hash.hexdigest() 摘要会以两倍长度字符串对象的形式返回，其中仅包含十六进制数码。</li><li>hash.copy() 返回哈希对象的副本</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">hashlib</span></span>
<span class="line"><span style="color:#E06C75;">md5</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">hashlib</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">md5</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;">md5</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">update</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;how to use md5 in python hashlib?&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">encode</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;utf-8&#39;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#E06C75;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">md5</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">hexdigest</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#E06C75;">d26a53750bc40b38b65a520292f69306</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Hmac算法：Keyed-Hashing for Message Authentication。它通过一个标准算法，在计算哈希的过程中，把key混入计算过程中。</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> </span><span style="color:#E06C75;">hmac</span></span>
<span class="line"><span style="color:#E06C75;">message</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">b</span><span style="color:#98C379;">&#39;Hello, world!&#39;</span></span>
<span class="line"><span style="color:#E06C75;">key</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">b</span><span style="color:#98C379;">&#39;secret&#39;</span></span>
<span class="line"><span style="color:#E06C75;">h</span><span style="color:#ABB2BF;"> = </span><span style="color:#E06C75;">hmac</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">new</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">key</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">message</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">digestmod</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&#39;MD5&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;">h</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">hexdigest</span><span style="color:#ABB2BF;">()	# </span><span style="color:#98C379;">&#39;fa4ee7d173f2d97ee79022d1a7355bcf&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="secrets-生成管理密码的安全随机数" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/secrets.html" target="_blank" rel="noreferrer">secrets--- 生成管理密码的安全随机数</a> <a class="header-anchor" href="#secrets-生成管理密码的安全随机数" aria-label="Permalink to &quot;[secrets--- 生成管理密码的安全随机数](https://docs.python.org/zh-cn/3/library/secrets.html)&quot;">​</a></h3><p>_class _secrets.<strong>SystemRandom</strong> <br> 用操作系统提供的最高质量源生成随机数的类。详见 <a href="https://docs.python.org/zh-cn/3/library/random.html#random.SystemRandom" target="_blank" rel="noreferrer">random.SystemRandom</a>。 <br> secrets.<strong>choice</strong>(<em>sequence</em>) <br> 返回从非空序列中随机选取的元素。 <br> secrets.<strong>randbelow</strong>(<em>n</em>) <br> 返回 [0, <em>n</em>) 范围内的随机整数。 <br> secrets.<strong>randbits</strong>(<em>k</em>) <br> 返回 <em>k</em> 个随机比特位的整数。</p><p>secrets.<strong>token_bytes</strong>([<em>nbytes=None</em>]) <br> 返回含 <em>nbytes</em> 个字节的随机字节字符串 <br> secrets.<strong>token_hex</strong>([<em>nbytes=None</em>]) <br> 返回十六进制随机文本字符串。 <br> secrets.<strong>token_urlsafe</strong>([<em>nbytes=None</em>]) <br> 返回安全的 URL 随机文本字符串</p><h2 id="系统" tabindex="-1">系统 <a class="header-anchor" href="#系统" aria-label="Permalink to &quot;系统&quot;">​</a></h2><h3 id="sys-系统相关的参数和函数" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/sys.html" target="_blank" rel="noreferrer">sys--- 系统相关的参数和函数</a> <a class="header-anchor" href="#sys-系统相关的参数和函数" aria-label="Permalink to &quot;[sys--- 系统相关的参数和函数](https://docs.python.org/zh-cn/3/library/sys.html)&quot;">​</a></h3><ul><li>sys.argv 命令行参数List，第一个元素是程序本身路径</li><li>sys.path 返回模块的搜索路径，初始化时使用PYTHONPATH环境变量的值</li><li>sys.modules.keys() 返回所有已经导入的模块列表</li><li>sys.modules 返回系统导入的模块字段，key是模块名，value是模块</li><li>sys.exc_info() 获取当前正在处理的异常类,exc_type、exc_value、exc_traceback当前处理的异常详细信息</li><li>sys.exit(n) 退出程序，正常退出时exit(0)</li><li>sys.hexversion 获取Python解释程序的版本值，16进制格式如：0x020403F0</li><li>sys.version 获取Python解释程序的版本信息</li><li>sys.platform 返回操作系统平台名称</li><li>sys.stdout 标准输出</li><li>sys.stdout.write(‘aaa‘) 标准输出内容</li><li>sys.stdout.writelines() 无换行输出</li><li>sys.stdin 标准输入</li><li>sys.stdin.read() 输入一行</li><li>sys.stderr 错误输出</li><li>sys.exc_clear() 用来清除当前线程所出现的当前的或最近的错误信息</li><li>sys.exec_prefix 返回平台独立的python文件安装的位置</li><li>sys.byteorder 本地字节规则的指示器，big-endian平台的值是‘big‘,little-endian平台的值是‘little‘</li><li>sys.copyright 记录python版权相关的东西</li><li>sys.api_version 解释器的C的API版本</li><li>sys.version_info ‘final‘表示最终,也有‘candidate‘表示候选，表示版本级别，是否有后继的发行</li><li>sys.getdefaultencoding() 返回当前你所用的默认的字符编码格式</li><li>sys.getfilesystemencoding() 返回将Unicode文件名转换成系统文件名的编码的名字</li><li>sys.builtin_module_names Python解释器导入的内建模块列表</li><li>sys.executable Python解释程序路径</li><li>sys.getwindowsversion() 获取Windows的版本</li><li>sys.stdin.readline() 从标准输入读一行，sys.stdout.write(“a”) 屏幕输出a</li><li>sys.setdefaultencoding(name) 用来设置当前默认的字符编码</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> sys</span></span>
<span class="line"><span style="color:#ABB2BF;">scripts_path </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> sys.argv[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">arguments    </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> sys.argv[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">:]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="warnings-——-警告信息的控制" tabindex="-1"><a href="https://docs.python.org/zh-cn/3/library/warnings.html" target="_blank" rel="noreferrer">warnings</a> —— 警告信息的控制 <a class="header-anchor" href="#warnings-——-警告信息的控制" aria-label="Permalink to &quot;[warnings](https://docs.python.org/zh-cn/3/library/warnings.html) —— 警告信息的控制&quot;">​</a></h3><ul><li>warnings.<strong>warn</strong>(<em>message</em>, <em>category=None</em>, <em>stacklevel=1</em>, <em>source=None</em>) 引发警告、忽略或者触发异常</li><li>warnings.<strong>filterwarnings</strong>(<em>action</em>, <em>message=&#39;&#39;</em>, <em>category=Warning</em>, <em>module=&#39;&#39;</em>, <em>lineno=0</em>, <em>append=False</em>)</li><li>warnings.<strong>simplefilter</strong>(<em>action</em>, <em>category=Warning</em>, <em>lineno=0</em>, <em>append=False</em>)</li></ul><p>action</p><table><thead><tr><th>值</th><th>处置</th></tr></thead><tbody><tr><td>&quot;default&quot;</td><td>为发出警告的每个位置（模块+行号）打印第一个匹配警告</td></tr><tr><td>&quot;error&quot;</td><td>将匹配警告转换为异常</td></tr><tr><td>&quot;ignore&quot;</td><td>从不打印匹配的警告</td></tr><tr><td>&quot;always&quot;</td><td>总是打印匹配的警告</td></tr><tr><td>&quot;module&quot;</td><td>为发出警告的每个模块打印第一次匹配警告（无论行号如何）</td></tr><tr><td>&quot;once&quot;</td><td>无论位置如何，仅打印第一次出现的匹配警告</td></tr></tbody></table><h3 id="winreg-—-windows-registry-access" tabindex="-1"><a href="https://docs.python.org/3/library/winreg.html#module-winreg" target="_blank" rel="noreferrer">winreg</a> — Windows registry access <a class="header-anchor" href="#winreg-—-windows-registry-access" aria-label="Permalink to &quot;[winreg](https://docs.python.org/3/library/winreg.html#module-winreg) — Windows registry access&quot;">​</a></h3><p>Function</p><ul><li>winreg.CloseKey(hkey)</li><li>winreg.ConnectRegistry(computer_name, key) 建立到另一台计算上上的预定义注册表句柄的连接，返回一个 handle 对象.</li><li>winreg.CreateKey(key, sub_key) 创建或打开特定的键，返回一个 handle 对象。</li><li>winreg.CreateKeyEx(key, sub_key, reserved=0, access=KEY_WRITE) 创建或打开特定的键</li><li>winreg.DeleteKey(key, sub_key) 删除指定的键</li><li>winreg.DeleteKeyEx(key, sub_key, access=KEY_WOW64_64KEY, reserved=0) 删除指定的键。</li><li>winreg.DeleteValue(key, value) 从某个注册键中删除一个命名值项。</li><li>winreg.EnumKey(key, index) 列举某个已经打开注册表键的子项，并返回一个字符串。</li><li>winreg.EnumValue(key, index) 列举某个已经打开注册表键的值项，并返回一个元组。</li><li>winreg.ExpandEnvironmentStrings(str)</li><li>winreg.FlushKey(key) 将某个键的所有属性写入注册表。</li><li>winreg.LoadKey(key, sub_key, file_name) Creates a subkey under the specified key and stores registration information from a specified file into that subkey.</li><li>winreg.OpenKey(key, sub_key, reserved=0, access=KEY_READ)</li><li>winreg.OpenKeyEx(key, sub_key, reserved=0, access=KEY_READ)</li><li>winreg.QueryInfoKey(key) Returns information about a key, as a tuple.</li><li>winreg.QueryValue(key, sub_key) Retrieves the unnamed value for a key, as a string.</li><li>winreg.QueryValueEx(key, value_name)</li><li>winreg.SaveKey(key, file_name) Saves the specified key, and all its subkeys to the specified file.</li><li>winreg.SetValue(key, sub_key, type, value) Associates a value with a specified key.</li><li>winreg.SetValueEx(key, value_name, reserved, type, value) Stores data in the value field of an open registry key.</li><li>winreg.QueryReflectionKey(key) Determines the reflection state for the specified key.</li></ul><p>访问权限</p><ul><li>winreg.KEY_ALL_ACCESS</li><li>winreg.KEY_WRITE：合并STANDARD_RIGHTS_WRITE，KEY_SET_VALUE和 KEY_CREATE_SUB_KEY访问权限。</li><li>winreg.KEY_READ：结合STANDARD_RIGHTS_READ， ，KEY_QUERY_VALUE， KEY_ENUMERATE_SUB_KEYS和KEY_NOTIFY值。</li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> os</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> winreg </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> wr</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#D19A66;">BASE_PATH</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;Software</span><span style="color:#56B6C2;">\\C</span><span style="color:#E06C75;">lasses</span><span style="color:#56B6C2;">\\L</span><span style="color:#E06C75;">ocal Settings\\Software</span><span style="color:#56B6C2;">\\M</span><span style="color:#E06C75;">icrosoft\\Windows</span><span style="color:#56B6C2;">\\C</span><span style="color:#E06C75;">urrentVersion\\AppContainer</span><span style="color:#56B6C2;">\\M</span><span style="color:#E06C75;">appings&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 获得所有程序的 SID</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">get_apps</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    app_list </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> []</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> wr.</span><span style="color:#61AFEF;">OpenKeyEx</span><span style="color:#ABB2BF;">(wr.</span><span style="color:#D19A66;">HKEY_CURRENT_USER</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">BASE_PATH</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> app:</span></span>
<span class="line"><span style="color:#ABB2BF;">        app_nums </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> wr.</span><span style="color:#61AFEF;">QueryInfoKey</span><span style="color:#ABB2BF;">(app)[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">range</span><span style="color:#ABB2BF;">(app_nums):</span></span>
<span class="line"><span style="color:#ABB2BF;">            info </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [wr.</span><span style="color:#61AFEF;">EnumKey</span><span style="color:#ABB2BF;">(app, i)]</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> wr.</span><span style="color:#61AFEF;">OpenKeyEx</span><span style="color:#ABB2BF;">(app, info[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">]) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> key:</span></span>
<span class="line"><span style="color:#ABB2BF;">                info.</span><span style="color:#61AFEF;">extend</span><span style="color:#ABB2BF;">([wr.</span><span style="color:#61AFEF;">EnumValue</span><span style="color:#ABB2BF;">(key, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">], wr.</span><span style="color:#61AFEF;">EnumValue</span><span style="color:#ABB2BF;">(key, </span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">)[</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">]])</span></span>
<span class="line"><span style="color:#ABB2BF;">            app_list.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(info)</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">return</span><span style="color:#ABB2BF;"> app_list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 开启UWP应用使用代理</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">enable_all_uwp_net</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    apps </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">get_apps</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> app </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> apps:</span></span>
<span class="line"><span style="color:#ABB2BF;">        os.</span><span style="color:#61AFEF;">system</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;CheckNetIsolation loopbackexempt -a -p=&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> app[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 关闭UWP应用使用代理</span></span>
<span class="line"><span style="color:#C678DD;">def</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">disable_all_uwp_net</span><span style="color:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#ABB2BF;">    apps </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">get_apps</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> app </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> apps:</span></span>
<span class="line"><span style="color:#ABB2BF;">        os.</span><span style="color:#61AFEF;">system</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;CheckNetIsolation loopbackexempt -d -p=&#39;</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> app[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;sid</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">DisplayName</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">Moniker&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">apps </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">get_apps</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> app </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> apps:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(*app, </span><span style="color:#E06C75;font-style:italic;">sep</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">&#39;</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>需要以管理员的</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;font-style:italic;">import</span><span style="color:#ABB2BF;"> winreg </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> wr</span></span>
<span class="line"><span style="color:#D19A66;">BASE_PATH</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&quot;SOFTWARE</span><span style="color:#56B6C2;">\\M</span><span style="color:#E06C75;">icrosoft\\Windows</span><span style="color:#56B6C2;">\\C</span><span style="color:#E06C75;">urrentVersion</span><span style="color:#56B6C2;">\\E</span><span style="color:#E06C75;">xplorer</span><span style="color:#56B6C2;">\\F</span><span style="color:#E06C75;">olderDescriptions&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 依次是 图片、音乐、视频、文档、下载、桌面</span></span>
<span class="line"><span style="color:#ABB2BF;">sid </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&#39;{0ddd015d-b06c-45d5-8c4c-f59713854639}&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#98C379;">&#39;{a0c69a99-21c8-4671-8703-7934162fcf1d}&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#98C379;">&#39;{35286a68-3c57-41a1-bbb1-0eae73d76c95}&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#98C379;">&#39;{f42ee2d3-909f-4907-8871-4c22fc0bf756}&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#98C379;">&#39;{7d83ee9b-2244-4e70-b1f5-5393042af1e4}&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">       </span><span style="color:#98C379;">&#39;{B4BFCC3A-DB2C-424C-B029-7FE99A87C641}&#39;</span><span style="color:#ABB2BF;">, ]</span></span>
<span class="line"><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> wr.</span><span style="color:#61AFEF;">OpenKey</span><span style="color:#ABB2BF;">(wr.</span><span style="color:#D19A66;">HKEY_LOCAL_MACHINE</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">BASE_PATH</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">access</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">wr.</span><span style="color:#D19A66;">KEY_ALL_ACCESS</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> fd:</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;font-style:italic;">for</span><span style="color:#ABB2BF;"> i </span><span style="color:#C678DD;font-style:italic;">in</span><span style="color:#ABB2BF;"> sid:</span></span>
<span class="line"><span style="color:#ABB2BF;">        </span><span style="color:#C678DD;font-style:italic;">with</span><span style="color:#ABB2BF;"> wr.</span><span style="color:#61AFEF;">OpenKey</span><span style="color:#ABB2BF;">(fd, i </span><span style="color:#56B6C2;">+</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">r</span><span style="color:#E06C75;">&#39;</span><span style="color:#56B6C2;">\\P</span><span style="color:#E06C75;">ropertyBag&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">access</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">wr.</span><span style="color:#D19A66;">KEY_ALL_ACCESS</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;font-style:italic;">as</span><span style="color:#ABB2BF;"> key:</span></span>
<span class="line"><span style="color:#ABB2BF;">            wr.</span><span style="color:#61AFEF;">SetValueEx</span><span style="color:#ABB2BF;">(key, </span><span style="color:#98C379;">&#39;ThisPCPolicy&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">, wr.</span><span style="color:#D19A66;">REG_SZ</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;Hide&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            </span><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(i,</span><span style="color:#98C379;">&#39;passed&#39;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div>`,346),e=[o];function t(r,c,B,i,y,d){return a(),n("div",null,e)}const A=s(p,[["render",t]]);export{b as __pageData,A as default};
